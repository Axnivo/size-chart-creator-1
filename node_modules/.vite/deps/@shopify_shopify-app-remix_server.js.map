{
  "version": 3,
  "sources": ["../../semver/internal/constants.js", "../../semver/internal/debug.js", "../../semver/internal/re.js", "../../semver/internal/parse-options.js", "../../semver/internal/identifiers.js", "../../semver/classes/semver.js", "../../semver/functions/parse.js", "../../semver/functions/valid.js", "../../semver/functions/clean.js", "../../semver/functions/inc.js", "../../semver/functions/diff.js", "../../semver/functions/major.js", "../../semver/functions/minor.js", "../../semver/functions/patch.js", "../../semver/functions/prerelease.js", "../../semver/functions/compare.js", "../../semver/functions/rcompare.js", "../../semver/functions/compare-loose.js", "../../semver/functions/compare-build.js", "../../semver/functions/sort.js", "../../semver/functions/rsort.js", "../../semver/functions/gt.js", "../../semver/functions/lt.js", "../../semver/functions/eq.js", "../../semver/functions/neq.js", "../../semver/functions/gte.js", "../../semver/functions/lte.js", "../../semver/functions/cmp.js", "../../semver/functions/coerce.js", "../../semver/internal/lrucache.js", "../../semver/classes/range.js", "../../semver/classes/comparator.js", "../../semver/functions/satisfies.js", "../../semver/ranges/to-comparators.js", "../../semver/ranges/max-satisfying.js", "../../semver/ranges/min-satisfying.js", "../../semver/ranges/min-version.js", "../../semver/ranges/valid.js", "../../semver/ranges/outside.js", "../../semver/ranges/gtr.js", "../../semver/ranges/ltr.js", "../../semver/ranges/intersects.js", "../../semver/ranges/simplify.js", "../../semver/ranges/subset.js", "../../semver/index.js", "../../runtime/crypto/crypto.ts", "../../runtime/crypto/types.ts", "../../runtime/http/index.ts", "../../runtime/platform/runtime-string.ts", "../../runtime/http/headers.ts", "../../adapters/web-api/adapter.ts", "../../adapters/web-api/index.ts", "../../lib/error.ts", "../../runtime/crypto/utils.ts", "../../runtime/http/utils.ts", "../../runtime/http/cookies.ts", "../../compare-versions/src/utils.ts", "../../compare-versions/src/compareVersions.ts", "../../compare-versions/src/compare.ts", "../../lib/types.ts", "../../lib/version.ts", "../../lib/logger/log.ts", "../../lib/logger/index.ts", "../../rest/load-rest-resources.ts", "../../future/flags.ts", "../../lib/auth/scopes/index.ts", "../../lib/config.ts", "../../@shopify/graphql-client/src/graphql-client/constants.ts", "../../@shopify/graphql-client/src/graphql-client/utilities.ts", "../../@shopify/graphql-client/src/graphql-client/http-fetch.ts", "../../@shopify/graphql-client/src/graphql-client/graphql-client.ts", "../../@shopify/graphql-client/src/api-client-utilities/validations.ts", "../../@shopify/graphql-client/src/api-client-utilities/api-versions.ts", "../../@shopify/graphql-client/src/api-client-utilities/utilities.ts", "../../@shopify/admin-api-client/src/constants.ts", "../../@shopify/admin-api-client/src/validations.ts", "../../@shopify/admin-api-client/src/graphql/client.ts", "../../@shopify/admin-api-client/src/rest/types.ts", "../../@shopify/admin-api-client/src/rest/client.ts", "../../@shopify/network/build/esm/network.mjs", "../../lib/clients/common.ts", "../../lib/clients/admin/graphql/client.ts", "../../lib/clients/admin/rest/client.ts", "../../@shopify/storefront-api-client/src/constants.ts", "../../@shopify/storefront-api-client/src/validations.ts", "../../@shopify/storefront-api-client/src/storefront-api-client.ts", "../../lib/clients/storefront/client.ts", "../../lib/clients/graphql_proxy/graphql_proxy.ts", "../../lib/clients/index.ts", "../../isbot/index.mjs", "../../lib/utils/processed-query.ts", "../../lib/auth/oauth/safe-compare.ts", "../../lib/utils/types.ts", "../../lib/utils/hmac-validator.ts", "../../lib/auth/decode-host.ts", "../../lib/utils/shop-admin-url-helper.ts", "../../lib/utils/shop-validator.ts", "../../lib/clients/types.ts", "../../lib/utils/fetch-request.ts", "../../lib/auth/oauth/types.ts", "../../lib/auth/oauth/nonce.ts", "../../uuid/dist/esm-browser/regex.js", "../../uuid/dist/esm-browser/validate.js", "../../uuid/dist/esm-browser/parse.js", "../../uuid/dist/esm-browser/stringify.js", "../../uuid/dist/esm-browser/rng.js", "../../uuid/dist/esm-browser/md5.js", "../../uuid/dist/esm-browser/v35.js", "../../uuid/dist/esm-browser/v3.js", "../../uuid/dist/esm-browser/native.js", "../../uuid/dist/esm-browser/v4.js", "../../uuid/dist/esm-browser/sha1.js", "../../uuid/dist/esm-browser/v5.js", "../../lib/session/session.ts", "../../jose/dist/browser/runtime/webcrypto.js", "../../jose/dist/browser/lib/buffer_utils.js", "../../jose/dist/browser/runtime/base64url.js", "../../jose/dist/browser/util/errors.js", "../../jose/dist/browser/runtime/random.js", "../../jose/dist/browser/lib/crypto_key.js", "../../jose/dist/browser/lib/invalid_key_input.js", "../../jose/dist/browser/runtime/is_key_like.js", "../../jose/dist/browser/lib/is_disjoint.js", "../../jose/dist/browser/lib/is_object.js", "../../jose/dist/browser/runtime/check_key_length.js", "../../jose/dist/browser/lib/is_jwk.js", "../../jose/dist/browser/runtime/jwk_to_key.js", "../../jose/dist/browser/runtime/normalize_key.js", "../../jose/dist/browser/key/import.js", "../../jose/dist/browser/lib/check_key_type.js", "../../jose/dist/browser/lib/validate_crit.js", "../../jose/dist/browser/lib/validate_algorithms.js", "../../jose/dist/browser/lib/private_symbols.js", "../../jose/dist/browser/runtime/subtle_dsa.js", "../../jose/dist/browser/runtime/get_sign_verify_key.js", "../../jose/dist/browser/runtime/verify.js", "../../jose/dist/browser/jws/flattened/verify.js", "../../jose/dist/browser/jws/compact/verify.js", "../../jose/dist/browser/lib/epoch.js", "../../jose/dist/browser/lib/secs.js", "../../jose/dist/browser/lib/jwt_claims_set.js", "../../jose/dist/browser/jwt/verify.js", "../../jose/dist/browser/jwks/remote.js", "../../jose/dist/browser/util/base64url.js", "../../lib/utils/get-hmac-key.ts", "../../lib/session/decode-session-token.ts", "../../lib/session/session-utils.ts", "../../lib/auth/oauth/create-session.ts", "../../lib/auth/oauth/oauth.ts", "../../lib/auth/get-embedded-app-url.ts", "../../lib/auth/oauth/token-exchange.ts", "../../lib/auth/oauth/client-credentials.ts", "../../lib/auth/index.ts", "../../lib/session/index.ts", "../../lib/utils/version-compatible.ts", "../../lib/utils/index.ts", "../../lib/webhooks/types.ts", "../../lib/webhooks/registry.ts", "../../lib/webhooks/query-template.ts", "../../lib/webhooks/register.ts", "../../lib/webhooks/validate.ts", "../../lib/webhooks/process.ts", "../../lib/webhooks/index.ts", "../../lib/billing/types.ts", "../../lib/billing/utils.ts", "../../lib/billing/check.ts", "../../lib/billing/request.ts", "../../lib/billing/cancel.ts", "../../lib/billing/subscriptions.ts", "../../lib/billing/create-usage-record.ts", "../../lib/billing/update-usage-subscription-capped-amount.ts", "../../lib/billing/index.ts", "../../lib/flow/validate.ts", "../../lib/flow/index.ts", "../../lib/fulfillment-service/validate.ts", "../../lib/fulfillment-service/index.ts", "../../lib/index.ts", "../../@shopify/src/server/types.ts", "../../@shopify/src/server/boundary/headers.ts", "../../@shopify/src/server/boundary/error.tsx", "../../@shopify/src/server/boundary/index.ts", "../../@shopify/src/server/version.ts", "../../@shopify/src/server/authenticate/webhooks/register.ts", "../../@shopify/src/server/authenticate/const.ts", "../../@shopify/src/server/authenticate/helpers/ensure-cors-headers.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-to-bounce-page.ts", "../../@shopify/src/server/authenticate/helpers/respond-to-invalid-session-token.ts", "../../@shopify/src/server/authenticate/helpers/get-shop-from-request.ts", "../../@shopify/src/server/authenticate/helpers/validate-session-token.ts", "../../@shopify/src/server/authenticate/helpers/get-session-token-header.ts", "../../@shopify/src/server/authenticate/helpers/reject-bot-request.ts", "../../@shopify/src/server/authenticate/helpers/respond-to-options-request.ts", "../../@shopify/src/server/authenticate/admin/helpers/begin-auth.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-with-exitiframe.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-with-app-bridge-headers.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-to-auth-page.ts", "../../@shopify/src/server/authenticate/helpers/invalidate-access-token.ts", "../../@shopify/src/server/authenticate/admin/billing/cancel.ts", "../../@shopify/src/server/authenticate/admin/billing/require.ts", "../../@shopify/src/server/authenticate/admin/billing/helpers.ts", "../../@shopify/src/server/authenticate/admin/billing/request.ts", "../../@shopify/src/server/authenticate/admin/billing/check.ts", "../../@shopify/src/server/authenticate/admin/billing/create-usage-record.ts", "../../@shopify/src/server/authenticate/admin/billing/update-usage-subscription-capped-amount.ts", "../../@shopify/src/server/clients/admin/graphql.ts", "../../@shopify/src/server/clients/admin/rest.ts", "../../@shopify/src/server/clients/admin/factory.ts", "../../@shopify/src/server/authenticate/admin/helpers/create-admin-api-context.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-to-shopify-or-app-root.ts", "../../@shopify/src/server/authenticate/admin/helpers/ensure-app-is-embedded-if-required.ts", "../../@shopify/src/server/authenticate/admin/helpers/ensure-session-token-search-param-if-required.ts", "../../@shopify/src/server/authenticate/helpers/app-bridge-url.ts", "../../@shopify/src/server/authenticate/helpers/add-response-headers.ts", "../../@shopify/src/server/authenticate/admin/helpers/validate-redirect-url.ts", "../../@shopify/src/server/authenticate/admin/helpers/render-app-bridge.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect.ts", "../../@shopify/src/server/authenticate/admin/helpers/validate-shop-and-host-params.ts", "../../@shopify/src/server/authenticate/admin/helpers/redirect-to-install-page.ts", "../../@shopify/src/server/authenticate/admin/scope/client/fetch-scopes-details.ts", "../../@shopify/src/server/authenticate/admin/scope/request.ts", "../../@shopify/src/server/authenticate/admin/scope/query.ts", "../../@shopify/src/server/authenticate/admin/scope/client/revoke-scopes.ts", "../../@shopify/src/server/authenticate/admin/scope/revoke.ts", "../../@shopify/src/server/authenticate/admin/scope/factory.ts", "../../@shopify/src/server/authenticate/admin/authenticate.ts", "../../@shopify/src/server/authenticate/admin/helpers/handle-client-error.ts", "../../@shopify/src/server/authenticate/helpers/create-or-load-offline-session.ts", "../../@shopify/src/server/authenticate/webhooks/authenticate.ts", "../../@shopify/src/server/override-logger.ts", "../../@shopify/src/server/authenticate/login/login.ts", "../../@shopify/src/server/errors.ts", "../../@shopify/src/server/unauthenticated/admin/factory.ts", "../../@shopify/src/server/authenticate/public/extension/authenticate.ts", "../../@shopify/src/server/authenticate/public/checkout/authenticate.ts", "../../@shopify/src/server/clients/storefront/factory.ts", "../../@shopify/src/server/authenticate/public/appProxy/authenticate.ts", "../../@shopify/src/server/authenticate/public/customer-account/authenticate.ts", "../../@shopify/src/server/authenticate/public/pos/authenticate.ts", "../../@shopify/src/server/authenticate/public/factory.ts", "../../@shopify/src/server/unauthenticated/storefront/factory.ts", "../../@shopify/src/server/authenticate/admin/helpers/trigger-after-auth-hook.ts", "../../@shopify/src/server/authenticate/admin/strategies/auth-code-flow.ts", "../../@shopify/src/server/authenticate/admin/strategies/token-exchange.ts", "../../@shopify/src/server/authenticate/admin/strategies/merchant-custom-app.ts", "../../@shopify/src/server/authenticate/helpers/idempotent-promise-handler.ts", "../../@shopify/src/server/authenticate/flow/authenticate.ts", "../../@shopify/src/server/authenticate/fulfillment-service/authenticate.ts", "../../@shopify/src/server/future/flags.ts", "../../@shopify/src/server/shopify-app.ts", "../../@shopify/src/server/index.ts"],
  "sourcesContent": ["'use strict'\n\n// Note: this is the semver.org version of the spec that it implements\n// Not necessarily the package version of this code.\nconst SEMVER_SPEC_VERSION = '2.0.0'\n\nconst MAX_LENGTH = 256\nconst MAX_SAFE_INTEGER = Number.MAX_SAFE_INTEGER ||\n/* istanbul ignore next */ 9007199254740991\n\n// Max safe segment length for coercion.\nconst MAX_SAFE_COMPONENT_LENGTH = 16\n\n// Max safe length for a build identifier. The max length minus 6 characters for\n// the shortest version with a build 0.0.0+BUILD.\nconst MAX_SAFE_BUILD_LENGTH = MAX_LENGTH - 6\n\nconst RELEASE_TYPES = [\n  'major',\n  'premajor',\n  'minor',\n  'preminor',\n  'patch',\n  'prepatch',\n  'prerelease',\n]\n\nmodule.exports = {\n  MAX_LENGTH,\n  MAX_SAFE_COMPONENT_LENGTH,\n  MAX_SAFE_BUILD_LENGTH,\n  MAX_SAFE_INTEGER,\n  RELEASE_TYPES,\n  SEMVER_SPEC_VERSION,\n  FLAG_INCLUDE_PRERELEASE: 0b001,\n  FLAG_LOOSE: 0b010,\n}\n", "'use strict'\n\nconst debug = (\n  typeof process === 'object' &&\n  process.env &&\n  process.env.NODE_DEBUG &&\n  /\\bsemver\\b/i.test(process.env.NODE_DEBUG)\n) ? (...args) => console.error('SEMVER', ...args)\n  : () => {}\n\nmodule.exports = debug\n", "'use strict'\n\nconst {\n  MAX_SAFE_COMPONENT_LENGTH,\n  MAX_SAFE_BUILD_LENGTH,\n  MAX_LENGTH,\n} = require('./constants')\nconst debug = require('./debug')\nexports = module.exports = {}\n\n// The actual regexps go on exports.re\nconst re = exports.re = []\nconst safeRe = exports.safeRe = []\nconst src = exports.src = []\nconst safeSrc = exports.safeSrc = []\nconst t = exports.t = {}\nlet R = 0\n\nconst LETTERDASHNUMBER = '[a-zA-Z0-9-]'\n\n// Replace some greedy regex tokens to prevent regex dos issues. These regex are\n// used internally via the safeRe object since all inputs in this library get\n// normalized first to trim and collapse all extra whitespace. The original\n// regexes are exported for userland consumption and lower level usage. A\n// future breaking change could export the safer regex only with a note that\n// all input should have extra whitespace removed.\nconst safeRegexReplacements = [\n  ['\\\\s', 1],\n  ['\\\\d', MAX_LENGTH],\n  [LETTERDASHNUMBER, MAX_SAFE_BUILD_LENGTH],\n]\n\nconst makeSafeRegex = (value) => {\n  for (const [token, max] of safeRegexReplacements) {\n    value = value\n      .split(`${token}*`).join(`${token}{0,${max}}`)\n      .split(`${token}+`).join(`${token}{1,${max}}`)\n  }\n  return value\n}\n\nconst createToken = (name, value, isGlobal) => {\n  const safe = makeSafeRegex(value)\n  const index = R++\n  debug(name, index, value)\n  t[name] = index\n  src[index] = value\n  safeSrc[index] = safe\n  re[index] = new RegExp(value, isGlobal ? 'g' : undefined)\n  safeRe[index] = new RegExp(safe, isGlobal ? 'g' : undefined)\n}\n\n// The following Regular Expressions can be used for tokenizing,\n// validating, and parsing SemVer version strings.\n\n// ## Numeric Identifier\n// A single `0`, or a non-zero digit followed by zero or more digits.\n\ncreateToken('NUMERICIDENTIFIER', '0|[1-9]\\\\d*')\ncreateToken('NUMERICIDENTIFIERLOOSE', '\\\\d+')\n\n// ## Non-numeric Identifier\n// Zero or more digits, followed by a letter or hyphen, and then zero or\n// more letters, digits, or hyphens.\n\ncreateToken('NONNUMERICIDENTIFIER', `\\\\d*[a-zA-Z-]${LETTERDASHNUMBER}*`)\n\n// ## Main Version\n// Three dot-separated numeric identifiers.\n\ncreateToken('MAINVERSION', `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})\\\\.` +\n                   `(${src[t.NUMERICIDENTIFIER]})`)\n\ncreateToken('MAINVERSIONLOOSE', `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})\\\\.` +\n                        `(${src[t.NUMERICIDENTIFIERLOOSE]})`)\n\n// ## Pre-release Version Identifier\n// A numeric identifier, or a non-numeric identifier.\n// Non-numberic identifiers include numberic identifiers but can be longer.\n// Therefore non-numberic identifiers must go first.\n\ncreateToken('PRERELEASEIDENTIFIER', `(?:${src[t.NONNUMERICIDENTIFIER]\n}|${src[t.NUMERICIDENTIFIER]})`)\n\ncreateToken('PRERELEASEIDENTIFIERLOOSE', `(?:${src[t.NONNUMERICIDENTIFIER]\n}|${src[t.NUMERICIDENTIFIERLOOSE]})`)\n\n// ## Pre-release Version\n// Hyphen, followed by one or more dot-separated pre-release version\n// identifiers.\n\ncreateToken('PRERELEASE', `(?:-(${src[t.PRERELEASEIDENTIFIER]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIER]})*))`)\n\ncreateToken('PRERELEASELOOSE', `(?:-?(${src[t.PRERELEASEIDENTIFIERLOOSE]\n}(?:\\\\.${src[t.PRERELEASEIDENTIFIERLOOSE]})*))`)\n\n// ## Build Metadata Identifier\n// Any combination of digits, letters, or hyphens.\n\ncreateToken('BUILDIDENTIFIER', `${LETTERDASHNUMBER}+`)\n\n// ## Build Metadata\n// Plus sign, followed by one or more period-separated build metadata\n// identifiers.\n\ncreateToken('BUILD', `(?:\\\\+(${src[t.BUILDIDENTIFIER]\n}(?:\\\\.${src[t.BUILDIDENTIFIER]})*))`)\n\n// ## Full Version String\n// A main version, followed optionally by a pre-release version and\n// build metadata.\n\n// Note that the only major, minor, patch, and pre-release sections of\n// the version string are capturing groups.  The build metadata is not a\n// capturing group, because it should not ever be used in version\n// comparison.\n\ncreateToken('FULLPLAIN', `v?${src[t.MAINVERSION]\n}${src[t.PRERELEASE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('FULL', `^${src[t.FULLPLAIN]}$`)\n\n// like full, but allows v1.2.3 and =1.2.3, which people do sometimes.\n// also, 1.0.0alpha1 (prerelease without the hyphen) which is pretty\n// common in the npm registry.\ncreateToken('LOOSEPLAIN', `[v=\\\\s]*${src[t.MAINVERSIONLOOSE]\n}${src[t.PRERELEASELOOSE]}?${\n  src[t.BUILD]}?`)\n\ncreateToken('LOOSE', `^${src[t.LOOSEPLAIN]}$`)\n\ncreateToken('GTLT', '((?:<|>)?=?)')\n\n// Something like \"2.*\" or \"1.2.x\".\n// Note that \"x.x\" is a valid xRange identifer, meaning \"any version\"\n// Only the first item is strictly required.\ncreateToken('XRANGEIDENTIFIERLOOSE', `${src[t.NUMERICIDENTIFIERLOOSE]}|x|X|\\\\*`)\ncreateToken('XRANGEIDENTIFIER', `${src[t.NUMERICIDENTIFIER]}|x|X|\\\\*`)\n\ncreateToken('XRANGEPLAIN', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:\\\\.(${src[t.XRANGEIDENTIFIER]})` +\n                   `(?:${src[t.PRERELEASE]})?${\n                     src[t.BUILD]}?` +\n                   `)?)?`)\n\ncreateToken('XRANGEPLAINLOOSE', `[v=\\\\s]*(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:\\\\.(${src[t.XRANGEIDENTIFIERLOOSE]})` +\n                        `(?:${src[t.PRERELEASELOOSE]})?${\n                          src[t.BUILD]}?` +\n                        `)?)?`)\n\ncreateToken('XRANGE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAIN]}$`)\ncreateToken('XRANGELOOSE', `^${src[t.GTLT]}\\\\s*${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Coercion.\n// Extract anything that could conceivably be a part of a valid semver\ncreateToken('COERCEPLAIN', `${'(^|[^\\\\d])' +\n              '(\\\\d{1,'}${MAX_SAFE_COMPONENT_LENGTH}})` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?` +\n              `(?:\\\\.(\\\\d{1,${MAX_SAFE_COMPONENT_LENGTH}}))?`)\ncreateToken('COERCE', `${src[t.COERCEPLAIN]}(?:$|[^\\\\d])`)\ncreateToken('COERCEFULL', src[t.COERCEPLAIN] +\n              `(?:${src[t.PRERELEASE]})?` +\n              `(?:${src[t.BUILD]})?` +\n              `(?:$|[^\\\\d])`)\ncreateToken('COERCERTL', src[t.COERCE], true)\ncreateToken('COERCERTLFULL', src[t.COERCEFULL], true)\n\n// Tilde ranges.\n// Meaning is \"reasonably at or greater than\"\ncreateToken('LONETILDE', '(?:~>?)')\n\ncreateToken('TILDETRIM', `(\\\\s*)${src[t.LONETILDE]}\\\\s+`, true)\nexports.tildeTrimReplace = '$1~'\n\ncreateToken('TILDE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('TILDELOOSE', `^${src[t.LONETILDE]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// Caret ranges.\n// Meaning is \"at least and backwards compatible with\"\ncreateToken('LONECARET', '(?:\\\\^)')\n\ncreateToken('CARETTRIM', `(\\\\s*)${src[t.LONECARET]}\\\\s+`, true)\nexports.caretTrimReplace = '$1^'\n\ncreateToken('CARET', `^${src[t.LONECARET]}${src[t.XRANGEPLAIN]}$`)\ncreateToken('CARETLOOSE', `^${src[t.LONECARET]}${src[t.XRANGEPLAINLOOSE]}$`)\n\n// A simple gt/lt/eq thing, or just \"\" to indicate \"any version\"\ncreateToken('COMPARATORLOOSE', `^${src[t.GTLT]}\\\\s*(${src[t.LOOSEPLAIN]})$|^$`)\ncreateToken('COMPARATOR', `^${src[t.GTLT]}\\\\s*(${src[t.FULLPLAIN]})$|^$`)\n\n// An expression to strip any whitespace between the gtlt and the thing\n// it modifies, so that `> 1.2.3` ==> `>1.2.3`\ncreateToken('COMPARATORTRIM', `(\\\\s*)${src[t.GTLT]\n}\\\\s*(${src[t.LOOSEPLAIN]}|${src[t.XRANGEPLAIN]})`, true)\nexports.comparatorTrimReplace = '$1$2$3'\n\n// Something like `1.2.3 - 1.2.4`\n// Note that these all use the loose form, because they'll be\n// checked against either the strict or loose comparator form\n// later.\ncreateToken('HYPHENRANGE', `^\\\\s*(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s+-\\\\s+` +\n                   `(${src[t.XRANGEPLAIN]})` +\n                   `\\\\s*$`)\n\ncreateToken('HYPHENRANGELOOSE', `^\\\\s*(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s+-\\\\s+` +\n                        `(${src[t.XRANGEPLAINLOOSE]})` +\n                        `\\\\s*$`)\n\n// Star ranges basically just allow anything at all.\ncreateToken('STAR', '(<|>)?=?\\\\s*\\\\*')\n// >=0.0.0 is like a star\ncreateToken('GTE0', '^\\\\s*>=\\\\s*0\\\\.0\\\\.0\\\\s*$')\ncreateToken('GTE0PRE', '^\\\\s*>=\\\\s*0\\\\.0\\\\.0-0\\\\s*$')\n", "'use strict'\n\n// parse out just the options we care about\nconst looseOption = Object.freeze({ loose: true })\nconst emptyOpts = Object.freeze({ })\nconst parseOptions = options => {\n  if (!options) {\n    return emptyOpts\n  }\n\n  if (typeof options !== 'object') {\n    return looseOption\n  }\n\n  return options\n}\nmodule.exports = parseOptions\n", "'use strict'\n\nconst numeric = /^[0-9]+$/\nconst compareIdentifiers = (a, b) => {\n  const anum = numeric.test(a)\n  const bnum = numeric.test(b)\n\n  if (anum && bnum) {\n    a = +a\n    b = +b\n  }\n\n  return a === b ? 0\n    : (anum && !bnum) ? -1\n    : (bnum && !anum) ? 1\n    : a < b ? -1\n    : 1\n}\n\nconst rcompareIdentifiers = (a, b) => compareIdentifiers(b, a)\n\nmodule.exports = {\n  compareIdentifiers,\n  rcompareIdentifiers,\n}\n", "'use strict'\n\nconst debug = require('../internal/debug')\nconst { MAX_LENGTH, MAX_SAFE_INTEGER } = require('../internal/constants')\nconst { safeRe: re, t } = require('../internal/re')\n\nconst parseOptions = require('../internal/parse-options')\nconst { compareIdentifiers } = require('../internal/identifiers')\nclass SemVer {\n  constructor (version, options) {\n    options = parseOptions(options)\n\n    if (version instanceof SemVer) {\n      if (version.loose === !!options.loose &&\n        version.includePrerelease === !!options.includePrerelease) {\n        return version\n      } else {\n        version = version.version\n      }\n    } else if (typeof version !== 'string') {\n      throw new TypeError(`Invalid version. Must be a string. Got type \"${typeof version}\".`)\n    }\n\n    if (version.length > MAX_LENGTH) {\n      throw new TypeError(\n        `version is longer than ${MAX_LENGTH} characters`\n      )\n    }\n\n    debug('SemVer', version, options)\n    this.options = options\n    this.loose = !!options.loose\n    // this isn't actually relevant for versions, but keep it so that we\n    // don't run into trouble passing this.options around.\n    this.includePrerelease = !!options.includePrerelease\n\n    const m = version.trim().match(options.loose ? re[t.LOOSE] : re[t.FULL])\n\n    if (!m) {\n      throw new TypeError(`Invalid Version: ${version}`)\n    }\n\n    this.raw = version\n\n    // these are actually numbers\n    this.major = +m[1]\n    this.minor = +m[2]\n    this.patch = +m[3]\n\n    if (this.major > MAX_SAFE_INTEGER || this.major < 0) {\n      throw new TypeError('Invalid major version')\n    }\n\n    if (this.minor > MAX_SAFE_INTEGER || this.minor < 0) {\n      throw new TypeError('Invalid minor version')\n    }\n\n    if (this.patch > MAX_SAFE_INTEGER || this.patch < 0) {\n      throw new TypeError('Invalid patch version')\n    }\n\n    // numberify any prerelease numeric ids\n    if (!m[4]) {\n      this.prerelease = []\n    } else {\n      this.prerelease = m[4].split('.').map((id) => {\n        if (/^[0-9]+$/.test(id)) {\n          const num = +id\n          if (num >= 0 && num < MAX_SAFE_INTEGER) {\n            return num\n          }\n        }\n        return id\n      })\n    }\n\n    this.build = m[5] ? m[5].split('.') : []\n    this.format()\n  }\n\n  format () {\n    this.version = `${this.major}.${this.minor}.${this.patch}`\n    if (this.prerelease.length) {\n      this.version += `-${this.prerelease.join('.')}`\n    }\n    return this.version\n  }\n\n  toString () {\n    return this.version\n  }\n\n  compare (other) {\n    debug('SemVer.compare', this.version, this.options, other)\n    if (!(other instanceof SemVer)) {\n      if (typeof other === 'string' && other === this.version) {\n        return 0\n      }\n      other = new SemVer(other, this.options)\n    }\n\n    if (other.version === this.version) {\n      return 0\n    }\n\n    return this.compareMain(other) || this.comparePre(other)\n  }\n\n  compareMain (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    return (\n      compareIdentifiers(this.major, other.major) ||\n      compareIdentifiers(this.minor, other.minor) ||\n      compareIdentifiers(this.patch, other.patch)\n    )\n  }\n\n  comparePre (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    // NOT having a prerelease is > having one\n    if (this.prerelease.length && !other.prerelease.length) {\n      return -1\n    } else if (!this.prerelease.length && other.prerelease.length) {\n      return 1\n    } else if (!this.prerelease.length && !other.prerelease.length) {\n      return 0\n    }\n\n    let i = 0\n    do {\n      const a = this.prerelease[i]\n      const b = other.prerelease[i]\n      debug('prerelease compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  compareBuild (other) {\n    if (!(other instanceof SemVer)) {\n      other = new SemVer(other, this.options)\n    }\n\n    let i = 0\n    do {\n      const a = this.build[i]\n      const b = other.build[i]\n      debug('build compare', i, a, b)\n      if (a === undefined && b === undefined) {\n        return 0\n      } else if (b === undefined) {\n        return 1\n      } else if (a === undefined) {\n        return -1\n      } else if (a === b) {\n        continue\n      } else {\n        return compareIdentifiers(a, b)\n      }\n    } while (++i)\n  }\n\n  // preminor will bump the version up to the next minor release, and immediately\n  // down to pre-release. premajor and prepatch work the same way.\n  inc (release, identifier, identifierBase) {\n    if (release.startsWith('pre')) {\n      if (!identifier && identifierBase === false) {\n        throw new Error('invalid increment argument: identifier is empty')\n      }\n      // Avoid an invalid semver results\n      if (identifier) {\n        const match = `-${identifier}`.match(this.options.loose ? re[t.PRERELEASELOOSE] : re[t.PRERELEASE])\n        if (!match || match[1] !== identifier) {\n          throw new Error(`invalid identifier: ${identifier}`)\n        }\n      }\n    }\n\n    switch (release) {\n      case 'premajor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor = 0\n        this.major++\n        this.inc('pre', identifier, identifierBase)\n        break\n      case 'preminor':\n        this.prerelease.length = 0\n        this.patch = 0\n        this.minor++\n        this.inc('pre', identifier, identifierBase)\n        break\n      case 'prepatch':\n        // If this is already a prerelease, it will bump to the next version\n        // drop any prereleases that might already exist, since they are not\n        // relevant at this point.\n        this.prerelease.length = 0\n        this.inc('patch', identifier, identifierBase)\n        this.inc('pre', identifier, identifierBase)\n        break\n      // If the input is a non-prerelease version, this acts the same as\n      // prepatch.\n      case 'prerelease':\n        if (this.prerelease.length === 0) {\n          this.inc('patch', identifier, identifierBase)\n        }\n        this.inc('pre', identifier, identifierBase)\n        break\n      case 'release':\n        if (this.prerelease.length === 0) {\n          throw new Error(`version ${this.raw} is not a prerelease`)\n        }\n        this.prerelease.length = 0\n        break\n\n      case 'major':\n        // If this is a pre-major version, bump up to the same major version.\n        // Otherwise increment major.\n        // 1.0.0-5 bumps to 1.0.0\n        // 1.1.0 bumps to 2.0.0\n        if (\n          this.minor !== 0 ||\n          this.patch !== 0 ||\n          this.prerelease.length === 0\n        ) {\n          this.major++\n        }\n        this.minor = 0\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'minor':\n        // If this is a pre-minor version, bump up to the same minor version.\n        // Otherwise increment minor.\n        // 1.2.0-5 bumps to 1.2.0\n        // 1.2.1 bumps to 1.3.0\n        if (this.patch !== 0 || this.prerelease.length === 0) {\n          this.minor++\n        }\n        this.patch = 0\n        this.prerelease = []\n        break\n      case 'patch':\n        // If this is not a pre-release version, it will increment the patch.\n        // If it is a pre-release it will bump up to the same patch version.\n        // 1.2.0-5 patches to 1.2.0\n        // 1.2.0 patches to 1.2.1\n        if (this.prerelease.length === 0) {\n          this.patch++\n        }\n        this.prerelease = []\n        break\n      // This probably shouldn't be used publicly.\n      // 1.0.0 'pre' would become 1.0.0-0 which is the wrong direction.\n      case 'pre': {\n        const base = Number(identifierBase) ? 1 : 0\n\n        if (this.prerelease.length === 0) {\n          this.prerelease = [base]\n        } else {\n          let i = this.prerelease.length\n          while (--i >= 0) {\n            if (typeof this.prerelease[i] === 'number') {\n              this.prerelease[i]++\n              i = -2\n            }\n          }\n          if (i === -1) {\n            // didn't increment anything\n            if (identifier === this.prerelease.join('.') && identifierBase === false) {\n              throw new Error('invalid increment argument: identifier already exists')\n            }\n            this.prerelease.push(base)\n          }\n        }\n        if (identifier) {\n          // 1.2.0-beta.1 bumps to 1.2.0-beta.2,\n          // 1.2.0-beta.fooblz or 1.2.0-beta bumps to 1.2.0-beta.0\n          let prerelease = [identifier, base]\n          if (identifierBase === false) {\n            prerelease = [identifier]\n          }\n          if (compareIdentifiers(this.prerelease[0], identifier) === 0) {\n            if (isNaN(this.prerelease[1])) {\n              this.prerelease = prerelease\n            }\n          } else {\n            this.prerelease = prerelease\n          }\n        }\n        break\n      }\n      default:\n        throw new Error(`invalid increment argument: ${release}`)\n    }\n    this.raw = this.format()\n    if (this.build.length) {\n      this.raw += `+${this.build.join('.')}`\n    }\n    return this\n  }\n}\n\nmodule.exports = SemVer\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst parse = (version, options, throwErrors = false) => {\n  if (version instanceof SemVer) {\n    return version\n  }\n  try {\n    return new SemVer(version, options)\n  } catch (er) {\n    if (!throwErrors) {\n      return null\n    }\n    throw er\n  }\n}\n\nmodule.exports = parse\n", "'use strict'\n\nconst parse = require('./parse')\nconst valid = (version, options) => {\n  const v = parse(version, options)\n  return v ? v.version : null\n}\nmodule.exports = valid\n", "'use strict'\n\nconst parse = require('./parse')\nconst clean = (version, options) => {\n  const s = parse(version.trim().replace(/^[=v]+/, ''), options)\n  return s ? s.version : null\n}\nmodule.exports = clean\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\n\nconst inc = (version, release, options, identifier, identifierBase) => {\n  if (typeof (options) === 'string') {\n    identifierBase = identifier\n    identifier = options\n    options = undefined\n  }\n\n  try {\n    return new SemVer(\n      version instanceof SemVer ? version.version : version,\n      options\n    ).inc(release, identifier, identifierBase).version\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = inc\n", "'use strict'\n\nconst parse = require('./parse.js')\n\nconst diff = (version1, version2) => {\n  const v1 = parse(version1, null, true)\n  const v2 = parse(version2, null, true)\n  const comparison = v1.compare(v2)\n\n  if (comparison === 0) {\n    return null\n  }\n\n  const v1Higher = comparison > 0\n  const highVersion = v1Higher ? v1 : v2\n  const lowVersion = v1Higher ? v2 : v1\n  const highHasPre = !!highVersion.prerelease.length\n  const lowHasPre = !!lowVersion.prerelease.length\n\n  if (lowHasPre && !highHasPre) {\n    // Going from prerelease -> no prerelease requires some special casing\n\n    // If the low version has only a major, then it will always be a major\n    // Some examples:\n    // 1.0.0-1 -> 1.0.0\n    // 1.0.0-1 -> 1.1.1\n    // 1.0.0-1 -> 2.0.0\n    if (!lowVersion.patch && !lowVersion.minor) {\n      return 'major'\n    }\n\n    // If the main part has no difference\n    if (lowVersion.compareMain(highVersion) === 0) {\n      if (lowVersion.minor && !lowVersion.patch) {\n        return 'minor'\n      }\n      return 'patch'\n    }\n  }\n\n  // add the `pre` prefix if we are going to a prerelease version\n  const prefix = highHasPre ? 'pre' : ''\n\n  if (v1.major !== v2.major) {\n    return prefix + 'major'\n  }\n\n  if (v1.minor !== v2.minor) {\n    return prefix + 'minor'\n  }\n\n  if (v1.patch !== v2.patch) {\n    return prefix + 'patch'\n  }\n\n  // high and low are preleases\n  return 'prerelease'\n}\n\nmodule.exports = diff\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst major = (a, loose) => new SemVer(a, loose).major\nmodule.exports = major\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst minor = (a, loose) => new SemVer(a, loose).minor\nmodule.exports = minor\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst patch = (a, loose) => new SemVer(a, loose).patch\nmodule.exports = patch\n", "'use strict'\n\nconst parse = require('./parse')\nconst prerelease = (version, options) => {\n  const parsed = parse(version, options)\n  return (parsed && parsed.prerelease.length) ? parsed.prerelease : null\n}\nmodule.exports = prerelease\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst compare = (a, b, loose) =>\n  new SemVer(a, loose).compare(new SemVer(b, loose))\n\nmodule.exports = compare\n", "'use strict'\n\nconst compare = require('./compare')\nconst rcompare = (a, b, loose) => compare(b, a, loose)\nmodule.exports = rcompare\n", "'use strict'\n\nconst compare = require('./compare')\nconst compareLoose = (a, b) => compare(a, b, true)\nmodule.exports = compareLoose\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst compareBuild = (a, b, loose) => {\n  const versionA = new SemVer(a, loose)\n  const versionB = new SemVer(b, loose)\n  return versionA.compare(versionB) || versionA.compareBuild(versionB)\n}\nmodule.exports = compareBuild\n", "'use strict'\n\nconst compareBuild = require('./compare-build')\nconst sort = (list, loose) => list.sort((a, b) => compareBuild(a, b, loose))\nmodule.exports = sort\n", "'use strict'\n\nconst compareBuild = require('./compare-build')\nconst rsort = (list, loose) => list.sort((a, b) => compareBuild(b, a, loose))\nmodule.exports = rsort\n", "'use strict'\n\nconst compare = require('./compare')\nconst gt = (a, b, loose) => compare(a, b, loose) > 0\nmodule.exports = gt\n", "'use strict'\n\nconst compare = require('./compare')\nconst lt = (a, b, loose) => compare(a, b, loose) < 0\nmodule.exports = lt\n", "'use strict'\n\nconst compare = require('./compare')\nconst eq = (a, b, loose) => compare(a, b, loose) === 0\nmodule.exports = eq\n", "'use strict'\n\nconst compare = require('./compare')\nconst neq = (a, b, loose) => compare(a, b, loose) !== 0\nmodule.exports = neq\n", "'use strict'\n\nconst compare = require('./compare')\nconst gte = (a, b, loose) => compare(a, b, loose) >= 0\nmodule.exports = gte\n", "'use strict'\n\nconst compare = require('./compare')\nconst lte = (a, b, loose) => compare(a, b, loose) <= 0\nmodule.exports = lte\n", "'use strict'\n\nconst eq = require('./eq')\nconst neq = require('./neq')\nconst gt = require('./gt')\nconst gte = require('./gte')\nconst lt = require('./lt')\nconst lte = require('./lte')\n\nconst cmp = (a, op, b, loose) => {\n  switch (op) {\n    case '===':\n      if (typeof a === 'object') {\n        a = a.version\n      }\n      if (typeof b === 'object') {\n        b = b.version\n      }\n      return a === b\n\n    case '!==':\n      if (typeof a === 'object') {\n        a = a.version\n      }\n      if (typeof b === 'object') {\n        b = b.version\n      }\n      return a !== b\n\n    case '':\n    case '=':\n    case '==':\n      return eq(a, b, loose)\n\n    case '!=':\n      return neq(a, b, loose)\n\n    case '>':\n      return gt(a, b, loose)\n\n    case '>=':\n      return gte(a, b, loose)\n\n    case '<':\n      return lt(a, b, loose)\n\n    case '<=':\n      return lte(a, b, loose)\n\n    default:\n      throw new TypeError(`Invalid operator: ${op}`)\n  }\n}\nmodule.exports = cmp\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst parse = require('./parse')\nconst { safeRe: re, t } = require('../internal/re')\n\nconst coerce = (version, options) => {\n  if (version instanceof SemVer) {\n    return version\n  }\n\n  if (typeof version === 'number') {\n    version = String(version)\n  }\n\n  if (typeof version !== 'string') {\n    return null\n  }\n\n  options = options || {}\n\n  let match = null\n  if (!options.rtl) {\n    match = version.match(options.includePrerelease ? re[t.COERCEFULL] : re[t.COERCE])\n  } else {\n    // Find the right-most coercible string that does not share\n    // a terminus with a more left-ward coercible string.\n    // Eg, '1.2.3.4' wants to coerce '2.3.4', not '3.4' or '4'\n    // With includePrerelease option set, '1.2.3.4-rc' wants to coerce '2.3.4-rc', not '2.3.4'\n    //\n    // Walk through the string checking with a /g regexp\n    // Manually set the index so as to pick up overlapping matches.\n    // Stop when we get a match that ends at the string end, since no\n    // coercible string can be more right-ward without the same terminus.\n    const coerceRtlRegex = options.includePrerelease ? re[t.COERCERTLFULL] : re[t.COERCERTL]\n    let next\n    while ((next = coerceRtlRegex.exec(version)) &&\n        (!match || match.index + match[0].length !== version.length)\n    ) {\n      if (!match ||\n            next.index + next[0].length !== match.index + match[0].length) {\n        match = next\n      }\n      coerceRtlRegex.lastIndex = next.index + next[1].length + next[2].length\n    }\n    // leave it in a clean state\n    coerceRtlRegex.lastIndex = -1\n  }\n\n  if (match === null) {\n    return null\n  }\n\n  const major = match[2]\n  const minor = match[3] || '0'\n  const patch = match[4] || '0'\n  const prerelease = options.includePrerelease && match[5] ? `-${match[5]}` : ''\n  const build = options.includePrerelease && match[6] ? `+${match[6]}` : ''\n\n  return parse(`${major}.${minor}.${patch}${prerelease}${build}`, options)\n}\nmodule.exports = coerce\n", "'use strict'\n\nclass LRUCache {\n  constructor () {\n    this.max = 1000\n    this.map = new Map()\n  }\n\n  get (key) {\n    const value = this.map.get(key)\n    if (value === undefined) {\n      return undefined\n    } else {\n      // Remove the key from the map and add it to the end\n      this.map.delete(key)\n      this.map.set(key, value)\n      return value\n    }\n  }\n\n  delete (key) {\n    return this.map.delete(key)\n  }\n\n  set (key, value) {\n    const deleted = this.delete(key)\n\n    if (!deleted && value !== undefined) {\n      // If cache is full, delete the least recently used item\n      if (this.map.size >= this.max) {\n        const firstKey = this.map.keys().next().value\n        this.delete(firstKey)\n      }\n\n      this.map.set(key, value)\n    }\n\n    return this\n  }\n}\n\nmodule.exports = LRUCache\n", "'use strict'\n\nconst SPACE_CHARACTERS = /\\s+/g\n\n// hoisted class for cyclic dependency\nclass Range {\n  constructor (range, options) {\n    options = parseOptions(options)\n\n    if (range instanceof Range) {\n      if (\n        range.loose === !!options.loose &&\n        range.includePrerelease === !!options.includePrerelease\n      ) {\n        return range\n      } else {\n        return new Range(range.raw, options)\n      }\n    }\n\n    if (range instanceof Comparator) {\n      // just put it in the set and return\n      this.raw = range.value\n      this.set = [[range]]\n      this.formatted = undefined\n      return this\n    }\n\n    this.options = options\n    this.loose = !!options.loose\n    this.includePrerelease = !!options.includePrerelease\n\n    // First reduce all whitespace as much as possible so we do not have to rely\n    // on potentially slow regexes like \\s*. This is then stored and used for\n    // future error messages as well.\n    this.raw = range.trim().replace(SPACE_CHARACTERS, ' ')\n\n    // First, split on ||\n    this.set = this.raw\n      .split('||')\n      // map the range to a 2d array of comparators\n      .map(r => this.parseRange(r.trim()))\n      // throw out any comparator lists that are empty\n      // this generally means that it was not a valid range, which is allowed\n      // in loose mode, but will still throw if the WHOLE range is invalid.\n      .filter(c => c.length)\n\n    if (!this.set.length) {\n      throw new TypeError(`Invalid SemVer Range: ${this.raw}`)\n    }\n\n    // if we have any that are not the null set, throw out null sets.\n    if (this.set.length > 1) {\n      // keep the first one, in case they're all null sets\n      const first = this.set[0]\n      this.set = this.set.filter(c => !isNullSet(c[0]))\n      if (this.set.length === 0) {\n        this.set = [first]\n      } else if (this.set.length > 1) {\n        // if we have any that are *, then the range is just *\n        for (const c of this.set) {\n          if (c.length === 1 && isAny(c[0])) {\n            this.set = [c]\n            break\n          }\n        }\n      }\n    }\n\n    this.formatted = undefined\n  }\n\n  get range () {\n    if (this.formatted === undefined) {\n      this.formatted = ''\n      for (let i = 0; i < this.set.length; i++) {\n        if (i > 0) {\n          this.formatted += '||'\n        }\n        const comps = this.set[i]\n        for (let k = 0; k < comps.length; k++) {\n          if (k > 0) {\n            this.formatted += ' '\n          }\n          this.formatted += comps[k].toString().trim()\n        }\n      }\n    }\n    return this.formatted\n  }\n\n  format () {\n    return this.range\n  }\n\n  toString () {\n    return this.range\n  }\n\n  parseRange (range) {\n    // memoize range parsing for performance.\n    // this is a very hot path, and fully deterministic.\n    const memoOpts =\n      (this.options.includePrerelease && FLAG_INCLUDE_PRERELEASE) |\n      (this.options.loose && FLAG_LOOSE)\n    const memoKey = memoOpts + ':' + range\n    const cached = cache.get(memoKey)\n    if (cached) {\n      return cached\n    }\n\n    const loose = this.options.loose\n    // `1.2.3 - 1.2.4` => `>=1.2.3 <=1.2.4`\n    const hr = loose ? re[t.HYPHENRANGELOOSE] : re[t.HYPHENRANGE]\n    range = range.replace(hr, hyphenReplace(this.options.includePrerelease))\n    debug('hyphen replace', range)\n\n    // `> 1.2.3 < 1.2.5` => `>1.2.3 <1.2.5`\n    range = range.replace(re[t.COMPARATORTRIM], comparatorTrimReplace)\n    debug('comparator trim', range)\n\n    // `~ 1.2.3` => `~1.2.3`\n    range = range.replace(re[t.TILDETRIM], tildeTrimReplace)\n    debug('tilde trim', range)\n\n    // `^ 1.2.3` => `^1.2.3`\n    range = range.replace(re[t.CARETTRIM], caretTrimReplace)\n    debug('caret trim', range)\n\n    // At this point, the range is completely trimmed and\n    // ready to be split into comparators.\n\n    let rangeList = range\n      .split(' ')\n      .map(comp => parseComparator(comp, this.options))\n      .join(' ')\n      .split(/\\s+/)\n      // >=0.0.0 is equivalent to *\n      .map(comp => replaceGTE0(comp, this.options))\n\n    if (loose) {\n      // in loose mode, throw out any that are not valid comparators\n      rangeList = rangeList.filter(comp => {\n        debug('loose invalid filter', comp, this.options)\n        return !!comp.match(re[t.COMPARATORLOOSE])\n      })\n    }\n    debug('range list', rangeList)\n\n    // if any comparators are the null set, then replace with JUST null set\n    // if more than one comparator, remove any * comparators\n    // also, don't include the same comparator more than once\n    const rangeMap = new Map()\n    const comparators = rangeList.map(comp => new Comparator(comp, this.options))\n    for (const comp of comparators) {\n      if (isNullSet(comp)) {\n        return [comp]\n      }\n      rangeMap.set(comp.value, comp)\n    }\n    if (rangeMap.size > 1 && rangeMap.has('')) {\n      rangeMap.delete('')\n    }\n\n    const result = [...rangeMap.values()]\n    cache.set(memoKey, result)\n    return result\n  }\n\n  intersects (range, options) {\n    if (!(range instanceof Range)) {\n      throw new TypeError('a Range is required')\n    }\n\n    return this.set.some((thisComparators) => {\n      return (\n        isSatisfiable(thisComparators, options) &&\n        range.set.some((rangeComparators) => {\n          return (\n            isSatisfiable(rangeComparators, options) &&\n            thisComparators.every((thisComparator) => {\n              return rangeComparators.every((rangeComparator) => {\n                return thisComparator.intersects(rangeComparator, options)\n              })\n            })\n          )\n        })\n      )\n    })\n  }\n\n  // if ANY of the sets match ALL of its comparators, then pass\n  test (version) {\n    if (!version) {\n      return false\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    for (let i = 0; i < this.set.length; i++) {\n      if (testSet(this.set[i], version, this.options)) {\n        return true\n      }\n    }\n    return false\n  }\n}\n\nmodule.exports = Range\n\nconst LRU = require('../internal/lrucache')\nconst cache = new LRU()\n\nconst parseOptions = require('../internal/parse-options')\nconst Comparator = require('./comparator')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst {\n  safeRe: re,\n  t,\n  comparatorTrimReplace,\n  tildeTrimReplace,\n  caretTrimReplace,\n} = require('../internal/re')\nconst { FLAG_INCLUDE_PRERELEASE, FLAG_LOOSE } = require('../internal/constants')\n\nconst isNullSet = c => c.value === '<0.0.0-0'\nconst isAny = c => c.value === ''\n\n// take a set of comparators and determine whether there\n// exists a version which can satisfy it\nconst isSatisfiable = (comparators, options) => {\n  let result = true\n  const remainingComparators = comparators.slice()\n  let testComparator = remainingComparators.pop()\n\n  while (result && remainingComparators.length) {\n    result = remainingComparators.every((otherComparator) => {\n      return testComparator.intersects(otherComparator, options)\n    })\n\n    testComparator = remainingComparators.pop()\n  }\n\n  return result\n}\n\n// comprised of xranges, tildes, stars, and gtlt's at this point.\n// already replaced the hyphen ranges\n// turn into a set of JUST comparators.\nconst parseComparator = (comp, options) => {\n  debug('comp', comp, options)\n  comp = replaceCarets(comp, options)\n  debug('caret', comp)\n  comp = replaceTildes(comp, options)\n  debug('tildes', comp)\n  comp = replaceXRanges(comp, options)\n  debug('xrange', comp)\n  comp = replaceStars(comp, options)\n  debug('stars', comp)\n  return comp\n}\n\nconst isX = id => !id || id.toLowerCase() === 'x' || id === '*'\n\n// ~, ~> --> * (any, kinda silly)\n// ~2, ~2.x, ~2.x.x, ~>2, ~>2.x ~>2.x.x --> >=2.0.0 <3.0.0-0\n// ~2.0, ~2.0.x, ~>2.0, ~>2.0.x --> >=2.0.0 <2.1.0-0\n// ~1.2, ~1.2.x, ~>1.2, ~>1.2.x --> >=1.2.0 <1.3.0-0\n// ~1.2.3, ~>1.2.3 --> >=1.2.3 <1.3.0-0\n// ~1.2.0, ~>1.2.0 --> >=1.2.0 <1.3.0-0\n// ~0.0.1 --> >=0.0.1 <0.1.0-0\nconst replaceTildes = (comp, options) => {\n  return comp\n    .trim()\n    .split(/\\s+/)\n    .map((c) => replaceTilde(c, options))\n    .join(' ')\n}\n\nconst replaceTilde = (comp, options) => {\n  const r = options.loose ? re[t.TILDELOOSE] : re[t.TILDE]\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('tilde', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0 <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      // ~1.2 == >=1.2.0 <1.3.0-0\n      ret = `>=${M}.${m}.0 <${M}.${+m + 1}.0-0`\n    } else if (pr) {\n      debug('replaceTilde pr', pr)\n      ret = `>=${M}.${m}.${p}-${pr\n      } <${M}.${+m + 1}.0-0`\n    } else {\n      // ~1.2.3 == >=1.2.3 <1.3.0-0\n      ret = `>=${M}.${m}.${p\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('tilde return', ret)\n    return ret\n  })\n}\n\n// ^ --> * (any, kinda silly)\n// ^2, ^2.x, ^2.x.x --> >=2.0.0 <3.0.0-0\n// ^2.0, ^2.0.x --> >=2.0.0 <3.0.0-0\n// ^1.2, ^1.2.x --> >=1.2.0 <2.0.0-0\n// ^1.2.3 --> >=1.2.3 <2.0.0-0\n// ^1.2.0 --> >=1.2.0 <2.0.0-0\n// ^0.0.1 --> >=0.0.1 <0.0.2-0\n// ^0.1.0 --> >=0.1.0 <0.2.0-0\nconst replaceCarets = (comp, options) => {\n  return comp\n    .trim()\n    .split(/\\s+/)\n    .map((c) => replaceCaret(c, options))\n    .join(' ')\n}\n\nconst replaceCaret = (comp, options) => {\n  debug('caret', comp, options)\n  const r = options.loose ? re[t.CARETLOOSE] : re[t.CARET]\n  const z = options.includePrerelease ? '-0' : ''\n  return comp.replace(r, (_, M, m, p, pr) => {\n    debug('caret', comp, _, M, m, p, pr)\n    let ret\n\n    if (isX(M)) {\n      ret = ''\n    } else if (isX(m)) {\n      ret = `>=${M}.0.0${z} <${+M + 1}.0.0-0`\n    } else if (isX(p)) {\n      if (M === '0') {\n        ret = `>=${M}.${m}.0${z} <${M}.${+m + 1}.0-0`\n      } else {\n        ret = `>=${M}.${m}.0${z} <${+M + 1}.0.0-0`\n      }\n    } else if (pr) {\n      debug('replaceCaret pr', pr)\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p}-${pr\n          } <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p}-${pr\n        } <${+M + 1}.0.0-0`\n      }\n    } else {\n      debug('no pr')\n      if (M === '0') {\n        if (m === '0') {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${m}.${+p + 1}-0`\n        } else {\n          ret = `>=${M}.${m}.${p\n          }${z} <${M}.${+m + 1}.0-0`\n        }\n      } else {\n        ret = `>=${M}.${m}.${p\n        } <${+M + 1}.0.0-0`\n      }\n    }\n\n    debug('caret return', ret)\n    return ret\n  })\n}\n\nconst replaceXRanges = (comp, options) => {\n  debug('replaceXRanges', comp, options)\n  return comp\n    .split(/\\s+/)\n    .map((c) => replaceXRange(c, options))\n    .join(' ')\n}\n\nconst replaceXRange = (comp, options) => {\n  comp = comp.trim()\n  const r = options.loose ? re[t.XRANGELOOSE] : re[t.XRANGE]\n  return comp.replace(r, (ret, gtlt, M, m, p, pr) => {\n    debug('xRange', comp, ret, gtlt, M, m, p, pr)\n    const xM = isX(M)\n    const xm = xM || isX(m)\n    const xp = xm || isX(p)\n    const anyX = xp\n\n    if (gtlt === '=' && anyX) {\n      gtlt = ''\n    }\n\n    // if we're including prereleases in the match, then we need\n    // to fix this to -0, the lowest possible prerelease value\n    pr = options.includePrerelease ? '-0' : ''\n\n    if (xM) {\n      if (gtlt === '>' || gtlt === '<') {\n        // nothing is allowed\n        ret = '<0.0.0-0'\n      } else {\n        // nothing is forbidden\n        ret = '*'\n      }\n    } else if (gtlt && anyX) {\n      // we know patch is an x, because we have any x at all.\n      // replace X with 0\n      if (xm) {\n        m = 0\n      }\n      p = 0\n\n      if (gtlt === '>') {\n        // >1 => >=2.0.0\n        // >1.2 => >=1.3.0\n        gtlt = '>='\n        if (xm) {\n          M = +M + 1\n          m = 0\n          p = 0\n        } else {\n          m = +m + 1\n          p = 0\n        }\n      } else if (gtlt === '<=') {\n        // <=0.7.x is actually <0.8.0, since any 0.7.x should\n        // pass.  Similarly, <=7.x is actually <8.0.0, etc.\n        gtlt = '<'\n        if (xm) {\n          M = +M + 1\n        } else {\n          m = +m + 1\n        }\n      }\n\n      if (gtlt === '<') {\n        pr = '-0'\n      }\n\n      ret = `${gtlt + M}.${m}.${p}${pr}`\n    } else if (xm) {\n      ret = `>=${M}.0.0${pr} <${+M + 1}.0.0-0`\n    } else if (xp) {\n      ret = `>=${M}.${m}.0${pr\n      } <${M}.${+m + 1}.0-0`\n    }\n\n    debug('xRange return', ret)\n\n    return ret\n  })\n}\n\n// Because * is AND-ed with everything else in the comparator,\n// and '' means \"any version\", just remove the *s entirely.\nconst replaceStars = (comp, options) => {\n  debug('replaceStars', comp, options)\n  // Looseness is ignored here.  star is always as loose as it gets!\n  return comp\n    .trim()\n    .replace(re[t.STAR], '')\n}\n\nconst replaceGTE0 = (comp, options) => {\n  debug('replaceGTE0', comp, options)\n  return comp\n    .trim()\n    .replace(re[options.includePrerelease ? t.GTE0PRE : t.GTE0], '')\n}\n\n// This function is passed to string.replace(re[t.HYPHENRANGE])\n// M, m, patch, prerelease, build\n// 1.2 - 3.4.5 => >=1.2.0 <=3.4.5\n// 1.2.3 - 3.4 => >=1.2.0 <3.5.0-0 Any 3.4.x will do\n// 1.2 - 3.4 => >=1.2.0 <3.5.0-0\n// TODO build?\nconst hyphenReplace = incPr => ($0,\n  from, fM, fm, fp, fpr, fb,\n  to, tM, tm, tp, tpr) => {\n  if (isX(fM)) {\n    from = ''\n  } else if (isX(fm)) {\n    from = `>=${fM}.0.0${incPr ? '-0' : ''}`\n  } else if (isX(fp)) {\n    from = `>=${fM}.${fm}.0${incPr ? '-0' : ''}`\n  } else if (fpr) {\n    from = `>=${from}`\n  } else {\n    from = `>=${from}${incPr ? '-0' : ''}`\n  }\n\n  if (isX(tM)) {\n    to = ''\n  } else if (isX(tm)) {\n    to = `<${+tM + 1}.0.0-0`\n  } else if (isX(tp)) {\n    to = `<${tM}.${+tm + 1}.0-0`\n  } else if (tpr) {\n    to = `<=${tM}.${tm}.${tp}-${tpr}`\n  } else if (incPr) {\n    to = `<${tM}.${tm}.${+tp + 1}-0`\n  } else {\n    to = `<=${to}`\n  }\n\n  return `${from} ${to}`.trim()\n}\n\nconst testSet = (set, version, options) => {\n  for (let i = 0; i < set.length; i++) {\n    if (!set[i].test(version)) {\n      return false\n    }\n  }\n\n  if (version.prerelease.length && !options.includePrerelease) {\n    // Find the set of versions that are allowed to have prereleases\n    // For example, ^1.2.3-pr.1 desugars to >=1.2.3-pr.1 <2.0.0\n    // That should allow `1.2.3-pr.2` to pass.\n    // However, `1.2.4-alpha.notready` should NOT be allowed,\n    // even though it's within the range set by the comparators.\n    for (let i = 0; i < set.length; i++) {\n      debug(set[i].semver)\n      if (set[i].semver === Comparator.ANY) {\n        continue\n      }\n\n      if (set[i].semver.prerelease.length > 0) {\n        const allowed = set[i].semver\n        if (allowed.major === version.major &&\n            allowed.minor === version.minor &&\n            allowed.patch === version.patch) {\n          return true\n        }\n      }\n    }\n\n    // Version has a -pre, but it's not one of the ones we like.\n    return false\n  }\n\n  return true\n}\n", "'use strict'\n\nconst ANY = Symbol('SemVer ANY')\n// hoisted class for cyclic dependency\nclass Comparator {\n  static get ANY () {\n    return ANY\n  }\n\n  constructor (comp, options) {\n    options = parseOptions(options)\n\n    if (comp instanceof Comparator) {\n      if (comp.loose === !!options.loose) {\n        return comp\n      } else {\n        comp = comp.value\n      }\n    }\n\n    comp = comp.trim().split(/\\s+/).join(' ')\n    debug('comparator', comp, options)\n    this.options = options\n    this.loose = !!options.loose\n    this.parse(comp)\n\n    if (this.semver === ANY) {\n      this.value = ''\n    } else {\n      this.value = this.operator + this.semver.version\n    }\n\n    debug('comp', this)\n  }\n\n  parse (comp) {\n    const r = this.options.loose ? re[t.COMPARATORLOOSE] : re[t.COMPARATOR]\n    const m = comp.match(r)\n\n    if (!m) {\n      throw new TypeError(`Invalid comparator: ${comp}`)\n    }\n\n    this.operator = m[1] !== undefined ? m[1] : ''\n    if (this.operator === '=') {\n      this.operator = ''\n    }\n\n    // if it literally is just '>' or '' then allow anything.\n    if (!m[2]) {\n      this.semver = ANY\n    } else {\n      this.semver = new SemVer(m[2], this.options.loose)\n    }\n  }\n\n  toString () {\n    return this.value\n  }\n\n  test (version) {\n    debug('Comparator.test', version, this.options.loose)\n\n    if (this.semver === ANY || version === ANY) {\n      return true\n    }\n\n    if (typeof version === 'string') {\n      try {\n        version = new SemVer(version, this.options)\n      } catch (er) {\n        return false\n      }\n    }\n\n    return cmp(version, this.operator, this.semver, this.options)\n  }\n\n  intersects (comp, options) {\n    if (!(comp instanceof Comparator)) {\n      throw new TypeError('a Comparator is required')\n    }\n\n    if (this.operator === '') {\n      if (this.value === '') {\n        return true\n      }\n      return new Range(comp.value, options).test(this.value)\n    } else if (comp.operator === '') {\n      if (comp.value === '') {\n        return true\n      }\n      return new Range(this.value, options).test(comp.semver)\n    }\n\n    options = parseOptions(options)\n\n    // Special cases where nothing can possibly be lower\n    if (options.includePrerelease &&\n      (this.value === '<0.0.0-0' || comp.value === '<0.0.0-0')) {\n      return false\n    }\n    if (!options.includePrerelease &&\n      (this.value.startsWith('<0.0.0') || comp.value.startsWith('<0.0.0'))) {\n      return false\n    }\n\n    // Same direction increasing (> or >=)\n    if (this.operator.startsWith('>') && comp.operator.startsWith('>')) {\n      return true\n    }\n    // Same direction decreasing (< or <=)\n    if (this.operator.startsWith('<') && comp.operator.startsWith('<')) {\n      return true\n    }\n    // same SemVer and both sides are inclusive (<= or >=)\n    if (\n      (this.semver.version === comp.semver.version) &&\n      this.operator.includes('=') && comp.operator.includes('=')) {\n      return true\n    }\n    // opposite directions less than\n    if (cmp(this.semver, '<', comp.semver, options) &&\n      this.operator.startsWith('>') && comp.operator.startsWith('<')) {\n      return true\n    }\n    // opposite directions greater than\n    if (cmp(this.semver, '>', comp.semver, options) &&\n      this.operator.startsWith('<') && comp.operator.startsWith('>')) {\n      return true\n    }\n    return false\n  }\n}\n\nmodule.exports = Comparator\n\nconst parseOptions = require('../internal/parse-options')\nconst { safeRe: re, t } = require('../internal/re')\nconst cmp = require('../functions/cmp')\nconst debug = require('../internal/debug')\nconst SemVer = require('./semver')\nconst Range = require('./range')\n", "'use strict'\n\nconst Range = require('../classes/range')\nconst satisfies = (version, range, options) => {\n  try {\n    range = new Range(range, options)\n  } catch (er) {\n    return false\n  }\n  return range.test(version)\n}\nmodule.exports = satisfies\n", "'use strict'\n\nconst Range = require('../classes/range')\n\n// Mostly just for testing and legacy API reasons\nconst toComparators = (range, options) =>\n  new Range(range, options).set\n    .map(comp => comp.map(c => c.value).join(' ').trim().split(' '))\n\nmodule.exports = toComparators\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\n\nconst maxSatisfying = (versions, range, options) => {\n  let max = null\n  let maxSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!max || maxSV.compare(v) === -1) {\n        // compare(max, v, true)\n        max = v\n        maxSV = new SemVer(max, options)\n      }\n    }\n  })\n  return max\n}\nmodule.exports = maxSatisfying\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst minSatisfying = (versions, range, options) => {\n  let min = null\n  let minSV = null\n  let rangeObj = null\n  try {\n    rangeObj = new Range(range, options)\n  } catch (er) {\n    return null\n  }\n  versions.forEach((v) => {\n    if (rangeObj.test(v)) {\n      // satisfies(v, range, options)\n      if (!min || minSV.compare(v) === 1) {\n        // compare(min, v, true)\n        min = v\n        minSV = new SemVer(min, options)\n      }\n    }\n  })\n  return min\n}\nmodule.exports = minSatisfying\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst Range = require('../classes/range')\nconst gt = require('../functions/gt')\n\nconst minVersion = (range, loose) => {\n  range = new Range(range, loose)\n\n  let minver = new SemVer('0.0.0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = new SemVer('0.0.0-0')\n  if (range.test(minver)) {\n    return minver\n  }\n\n  minver = null\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let setMin = null\n    comparators.forEach((comparator) => {\n      // Clone to avoid manipulating the comparator's semver object.\n      const compver = new SemVer(comparator.semver.version)\n      switch (comparator.operator) {\n        case '>':\n          if (compver.prerelease.length === 0) {\n            compver.patch++\n          } else {\n            compver.prerelease.push(0)\n          }\n          compver.raw = compver.format()\n          /* fallthrough */\n        case '':\n        case '>=':\n          if (!setMin || gt(compver, setMin)) {\n            setMin = compver\n          }\n          break\n        case '<':\n        case '<=':\n          /* Ignore maximum versions */\n          break\n        /* istanbul ignore next */\n        default:\n          throw new Error(`Unexpected operation: ${comparator.operator}`)\n      }\n    })\n    if (setMin && (!minver || gt(minver, setMin))) {\n      minver = setMin\n    }\n  }\n\n  if (minver && range.test(minver)) {\n    return minver\n  }\n\n  return null\n}\nmodule.exports = minVersion\n", "'use strict'\n\nconst Range = require('../classes/range')\nconst validRange = (range, options) => {\n  try {\n    // Return '*' instead of '' so that truthiness works.\n    // This will throw if it's invalid anyway\n    return new Range(range, options).range || '*'\n  } catch (er) {\n    return null\n  }\n}\nmodule.exports = validRange\n", "'use strict'\n\nconst SemVer = require('../classes/semver')\nconst Comparator = require('../classes/comparator')\nconst { ANY } = Comparator\nconst Range = require('../classes/range')\nconst satisfies = require('../functions/satisfies')\nconst gt = require('../functions/gt')\nconst lt = require('../functions/lt')\nconst lte = require('../functions/lte')\nconst gte = require('../functions/gte')\n\nconst outside = (version, range, hilo, options) => {\n  version = new SemVer(version, options)\n  range = new Range(range, options)\n\n  let gtfn, ltefn, ltfn, comp, ecomp\n  switch (hilo) {\n    case '>':\n      gtfn = gt\n      ltefn = lte\n      ltfn = lt\n      comp = '>'\n      ecomp = '>='\n      break\n    case '<':\n      gtfn = lt\n      ltefn = gte\n      ltfn = gt\n      comp = '<'\n      ecomp = '<='\n      break\n    default:\n      throw new TypeError('Must provide a hilo val of \"<\" or \">\"')\n  }\n\n  // If it satisfies the range it is not outside\n  if (satisfies(version, range, options)) {\n    return false\n  }\n\n  // From now on, variable terms are as if we're in \"gtr\" mode.\n  // but note that everything is flipped for the \"ltr\" function.\n\n  for (let i = 0; i < range.set.length; ++i) {\n    const comparators = range.set[i]\n\n    let high = null\n    let low = null\n\n    comparators.forEach((comparator) => {\n      if (comparator.semver === ANY) {\n        comparator = new Comparator('>=0.0.0')\n      }\n      high = high || comparator\n      low = low || comparator\n      if (gtfn(comparator.semver, high.semver, options)) {\n        high = comparator\n      } else if (ltfn(comparator.semver, low.semver, options)) {\n        low = comparator\n      }\n    })\n\n    // If the edge version comparator has a operator then our version\n    // isn't outside it\n    if (high.operator === comp || high.operator === ecomp) {\n      return false\n    }\n\n    // If the lowest version comparator has an operator and our version\n    // is less than it then it isn't higher than the range\n    if ((!low.operator || low.operator === comp) &&\n        ltefn(version, low.semver)) {\n      return false\n    } else if (low.operator === ecomp && ltfn(version, low.semver)) {\n      return false\n    }\n  }\n  return true\n}\n\nmodule.exports = outside\n", "'use strict'\n\n// Determine if version is greater than all the versions possible in the range.\nconst outside = require('./outside')\nconst gtr = (version, range, options) => outside(version, range, '>', options)\nmodule.exports = gtr\n", "'use strict'\n\nconst outside = require('./outside')\n// Determine if version is less than all the versions possible in the range\nconst ltr = (version, range, options) => outside(version, range, '<', options)\nmodule.exports = ltr\n", "'use strict'\n\nconst Range = require('../classes/range')\nconst intersects = (r1, r2, options) => {\n  r1 = new Range(r1, options)\n  r2 = new Range(r2, options)\n  return r1.intersects(r2, options)\n}\nmodule.exports = intersects\n", "'use strict'\n\n// given a set of versions and a range, create a \"simplified\" range\n// that includes the same versions that the original range does\n// If the original range is shorter than the simplified one, return that.\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\nmodule.exports = (versions, range, options) => {\n  const set = []\n  let first = null\n  let prev = null\n  const v = versions.sort((a, b) => compare(a, b, options))\n  for (const version of v) {\n    const included = satisfies(version, range, options)\n    if (included) {\n      prev = version\n      if (!first) {\n        first = version\n      }\n    } else {\n      if (prev) {\n        set.push([first, prev])\n      }\n      prev = null\n      first = null\n    }\n  }\n  if (first) {\n    set.push([first, null])\n  }\n\n  const ranges = []\n  for (const [min, max] of set) {\n    if (min === max) {\n      ranges.push(min)\n    } else if (!max && min === v[0]) {\n      ranges.push('*')\n    } else if (!max) {\n      ranges.push(`>=${min}`)\n    } else if (min === v[0]) {\n      ranges.push(`<=${max}`)\n    } else {\n      ranges.push(`${min} - ${max}`)\n    }\n  }\n  const simplified = ranges.join(' || ')\n  const original = typeof range.raw === 'string' ? range.raw : String(range)\n  return simplified.length < original.length ? simplified : range\n}\n", "'use strict'\n\nconst Range = require('../classes/range.js')\nconst Comparator = require('../classes/comparator.js')\nconst { ANY } = Comparator\nconst satisfies = require('../functions/satisfies.js')\nconst compare = require('../functions/compare.js')\n\n// Complex range `r1 || r2 || ...` is a subset of `R1 || R2 || ...` iff:\n// - Every simple range `r1, r2, ...` is a null set, OR\n// - Every simple range `r1, r2, ...` which is not a null set is a subset of\n//   some `R1, R2, ...`\n//\n// Simple range `c1 c2 ...` is a subset of simple range `C1 C2 ...` iff:\n// - If c is only the ANY comparator\n//   - If C is only the ANY comparator, return true\n//   - Else if in prerelease mode, return false\n//   - else replace c with `[>=0.0.0]`\n// - If C is only the ANY comparator\n//   - if in prerelease mode, return true\n//   - else replace C with `[>=0.0.0]`\n// - Let EQ be the set of = comparators in c\n// - If EQ is more than one, return true (null set)\n// - Let GT be the highest > or >= comparator in c\n// - Let LT be the lowest < or <= comparator in c\n// - If GT and LT, and GT.semver > LT.semver, return true (null set)\n// - If any C is a = range, and GT or LT are set, return false\n// - If EQ\n//   - If GT, and EQ does not satisfy GT, return true (null set)\n//   - If LT, and EQ does not satisfy LT, return true (null set)\n//   - If EQ satisfies every C, return true\n//   - Else return false\n// - If GT\n//   - If GT.semver is lower than any > or >= comp in C, return false\n//   - If GT is >=, and GT.semver does not satisfy every C, return false\n//   - If GT.semver has a prerelease, and not in prerelease mode\n//     - If no C has a prerelease and the GT.semver tuple, return false\n// - If LT\n//   - If LT.semver is greater than any < or <= comp in C, return false\n//   - If LT is <=, and LT.semver does not satisfy every C, return false\n//   - If GT.semver has a prerelease, and not in prerelease mode\n//     - If no C has a prerelease and the LT.semver tuple, return false\n// - Else return true\n\nconst subset = (sub, dom, options = {}) => {\n  if (sub === dom) {\n    return true\n  }\n\n  sub = new Range(sub, options)\n  dom = new Range(dom, options)\n  let sawNonNull = false\n\n  OUTER: for (const simpleSub of sub.set) {\n    for (const simpleDom of dom.set) {\n      const isSub = simpleSubset(simpleSub, simpleDom, options)\n      sawNonNull = sawNonNull || isSub !== null\n      if (isSub) {\n        continue OUTER\n      }\n    }\n    // the null set is a subset of everything, but null simple ranges in\n    // a complex range should be ignored.  so if we saw a non-null range,\n    // then we know this isn't a subset, but if EVERY simple range was null,\n    // then it is a subset.\n    if (sawNonNull) {\n      return false\n    }\n  }\n  return true\n}\n\nconst minimumVersionWithPreRelease = [new Comparator('>=0.0.0-0')]\nconst minimumVersion = [new Comparator('>=0.0.0')]\n\nconst simpleSubset = (sub, dom, options) => {\n  if (sub === dom) {\n    return true\n  }\n\n  if (sub.length === 1 && sub[0].semver === ANY) {\n    if (dom.length === 1 && dom[0].semver === ANY) {\n      return true\n    } else if (options.includePrerelease) {\n      sub = minimumVersionWithPreRelease\n    } else {\n      sub = minimumVersion\n    }\n  }\n\n  if (dom.length === 1 && dom[0].semver === ANY) {\n    if (options.includePrerelease) {\n      return true\n    } else {\n      dom = minimumVersion\n    }\n  }\n\n  const eqSet = new Set()\n  let gt, lt\n  for (const c of sub) {\n    if (c.operator === '>' || c.operator === '>=') {\n      gt = higherGT(gt, c, options)\n    } else if (c.operator === '<' || c.operator === '<=') {\n      lt = lowerLT(lt, c, options)\n    } else {\n      eqSet.add(c.semver)\n    }\n  }\n\n  if (eqSet.size > 1) {\n    return null\n  }\n\n  let gtltComp\n  if (gt && lt) {\n    gtltComp = compare(gt.semver, lt.semver, options)\n    if (gtltComp > 0) {\n      return null\n    } else if (gtltComp === 0 && (gt.operator !== '>=' || lt.operator !== '<=')) {\n      return null\n    }\n  }\n\n  // will iterate one or zero times\n  for (const eq of eqSet) {\n    if (gt && !satisfies(eq, String(gt), options)) {\n      return null\n    }\n\n    if (lt && !satisfies(eq, String(lt), options)) {\n      return null\n    }\n\n    for (const c of dom) {\n      if (!satisfies(eq, String(c), options)) {\n        return false\n      }\n    }\n\n    return true\n  }\n\n  let higher, lower\n  let hasDomLT, hasDomGT\n  // if the subset has a prerelease, we need a comparator in the superset\n  // with the same tuple and a prerelease, or it's not a subset\n  let needDomLTPre = lt &&\n    !options.includePrerelease &&\n    lt.semver.prerelease.length ? lt.semver : false\n  let needDomGTPre = gt &&\n    !options.includePrerelease &&\n    gt.semver.prerelease.length ? gt.semver : false\n  // exception: <1.2.3-0 is the same as <1.2.3\n  if (needDomLTPre && needDomLTPre.prerelease.length === 1 &&\n      lt.operator === '<' && needDomLTPre.prerelease[0] === 0) {\n    needDomLTPre = false\n  }\n\n  for (const c of dom) {\n    hasDomGT = hasDomGT || c.operator === '>' || c.operator === '>='\n    hasDomLT = hasDomLT || c.operator === '<' || c.operator === '<='\n    if (gt) {\n      if (needDomGTPre) {\n        if (c.semver.prerelease && c.semver.prerelease.length &&\n            c.semver.major === needDomGTPre.major &&\n            c.semver.minor === needDomGTPre.minor &&\n            c.semver.patch === needDomGTPre.patch) {\n          needDomGTPre = false\n        }\n      }\n      if (c.operator === '>' || c.operator === '>=') {\n        higher = higherGT(gt, c, options)\n        if (higher === c && higher !== gt) {\n          return false\n        }\n      } else if (gt.operator === '>=' && !satisfies(gt.semver, String(c), options)) {\n        return false\n      }\n    }\n    if (lt) {\n      if (needDomLTPre) {\n        if (c.semver.prerelease && c.semver.prerelease.length &&\n            c.semver.major === needDomLTPre.major &&\n            c.semver.minor === needDomLTPre.minor &&\n            c.semver.patch === needDomLTPre.patch) {\n          needDomLTPre = false\n        }\n      }\n      if (c.operator === '<' || c.operator === '<=') {\n        lower = lowerLT(lt, c, options)\n        if (lower === c && lower !== lt) {\n          return false\n        }\n      } else if (lt.operator === '<=' && !satisfies(lt.semver, String(c), options)) {\n        return false\n      }\n    }\n    if (!c.operator && (lt || gt) && gtltComp !== 0) {\n      return false\n    }\n  }\n\n  // if there was a < or >, and nothing in the dom, then must be false\n  // UNLESS it was limited by another range in the other direction.\n  // Eg, >1.0.0 <1.0.1 is still a subset of <2.0.0\n  if (gt && hasDomLT && !lt && gtltComp !== 0) {\n    return false\n  }\n\n  if (lt && hasDomGT && !gt && gtltComp !== 0) {\n    return false\n  }\n\n  // we needed a prerelease range in a specific tuple, but didn't get one\n  // then this isn't a subset.  eg >=1.2.3-pre is not a subset of >=1.0.0,\n  // because it includes prereleases in the 1.2.3 tuple\n  if (needDomGTPre || needDomLTPre) {\n    return false\n  }\n\n  return true\n}\n\n// >=1.2.3 is lower than >1.2.3\nconst higherGT = (a, b, options) => {\n  if (!a) {\n    return b\n  }\n  const comp = compare(a.semver, b.semver, options)\n  return comp > 0 ? a\n    : comp < 0 ? b\n    : b.operator === '>' && a.operator === '>=' ? b\n    : a\n}\n\n// <=1.2.3 is higher than <1.2.3\nconst lowerLT = (a, b, options) => {\n  if (!a) {\n    return b\n  }\n  const comp = compare(a.semver, b.semver, options)\n  return comp < 0 ? a\n    : comp > 0 ? b\n    : b.operator === '<' && a.operator === '<=' ? b\n    : a\n}\n\nmodule.exports = subset\n", "'use strict'\n\n// just pre-load all the stuff that index.js lazily exports\nconst internalRe = require('./internal/re')\nconst constants = require('./internal/constants')\nconst SemVer = require('./classes/semver')\nconst identifiers = require('./internal/identifiers')\nconst parse = require('./functions/parse')\nconst valid = require('./functions/valid')\nconst clean = require('./functions/clean')\nconst inc = require('./functions/inc')\nconst diff = require('./functions/diff')\nconst major = require('./functions/major')\nconst minor = require('./functions/minor')\nconst patch = require('./functions/patch')\nconst prerelease = require('./functions/prerelease')\nconst compare = require('./functions/compare')\nconst rcompare = require('./functions/rcompare')\nconst compareLoose = require('./functions/compare-loose')\nconst compareBuild = require('./functions/compare-build')\nconst sort = require('./functions/sort')\nconst rsort = require('./functions/rsort')\nconst gt = require('./functions/gt')\nconst lt = require('./functions/lt')\nconst eq = require('./functions/eq')\nconst neq = require('./functions/neq')\nconst gte = require('./functions/gte')\nconst lte = require('./functions/lte')\nconst cmp = require('./functions/cmp')\nconst coerce = require('./functions/coerce')\nconst Comparator = require('./classes/comparator')\nconst Range = require('./classes/range')\nconst satisfies = require('./functions/satisfies')\nconst toComparators = require('./ranges/to-comparators')\nconst maxSatisfying = require('./ranges/max-satisfying')\nconst minSatisfying = require('./ranges/min-satisfying')\nconst minVersion = require('./ranges/min-version')\nconst validRange = require('./ranges/valid')\nconst outside = require('./ranges/outside')\nconst gtr = require('./ranges/gtr')\nconst ltr = require('./ranges/ltr')\nconst intersects = require('./ranges/intersects')\nconst simplifyRange = require('./ranges/simplify')\nconst subset = require('./ranges/subset')\nmodule.exports = {\n  parse,\n  valid,\n  clean,\n  inc,\n  diff,\n  major,\n  minor,\n  patch,\n  prerelease,\n  compare,\n  rcompare,\n  compareLoose,\n  compareBuild,\n  sort,\n  rsort,\n  gt,\n  lt,\n  eq,\n  neq,\n  gte,\n  lte,\n  cmp,\n  coerce,\n  Comparator,\n  Range,\n  satisfies,\n  toComparators,\n  maxSatisfying,\n  minSatisfying,\n  minVersion,\n  validRange,\n  outside,\n  gtr,\n  ltr,\n  intersects,\n  simplifyRange,\n  subset,\n  SemVer,\n  re: internalRe.re,\n  src: internalRe.src,\n  tokens: internalRe.t,\n  SEMVER_SPEC_VERSION: constants.SEMVER_SPEC_VERSION,\n  RELEASE_TYPES: constants.RELEASE_TYPES,\n  compareIdentifiers: identifiers.compareIdentifiers,\n  rcompareIdentifiers: identifiers.rcompareIdentifiers,\n}\n", "// The mutable export is the whole key to the adapter architecture.\n\n// eslint-disable-next-line import/no-mutable-exports\nlet cryptoVar: Crypto;\n\ntry {\n  cryptoVar = crypto;\n} catch (_e) {\n  // This will fail for Node, but we're explicitly calling the below function to set it\n}\n\nexport function setCrypto(crypto: Crypto): void {\n  cryptoVar = crypto;\n}\n\nexport {cryptoVar as crypto};\n", "export enum HashFormat {\n  Base64 = 'base64',\n  Hex = 'hex',\n}\n", "import type {\n  AbstractFetchFunc,\n  AbstractConvertRequestFunc,\n  AbstractConvertIncomingResponseFunc,\n  AbstractConvertResponseFunc,\n  NormalizedResponse,\n  AbstractConvertHeadersFunc,\n} from './types';\n\nexport * from './cookies';\nexport * from './headers';\nexport * from './utils';\n\nexport * from './types';\n\nexport function isOK(resp: NormalizedResponse) {\n  // https://fetch.spec.whatwg.org/#ok-status\n  return resp.statusCode >= 200 && resp.statusCode <= 299;\n}\n\n// We ignore mutable export linting errors because we explicitly want these abstract functions to be overwritten.\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractFetch: AbstractFetchFunc = () => {\n  throw new Error(\n    \"Missing adapter implementation for 'abstractFetch' - make sure to import the appropriate adapter for your platform\",\n  );\n};\nexport function setAbstractFetchFunc(func: AbstractFetchFunc) {\n  abstractFetch = func;\n}\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractConvertRequest: AbstractConvertRequestFunc = () => {\n  throw new Error(\n    \"Missing adapter implementation for 'abstractConvertRequest' - make sure to import the appropriate adapter for your platform\",\n  );\n};\nexport function setAbstractConvertRequestFunc(\n  func: AbstractConvertRequestFunc,\n) {\n  abstractConvertRequest = func;\n}\n\n// By default we just return an empty NormalizedResponse because not all adapters will need to convert an incoming response\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractConvertIncomingResponse: AbstractConvertIncomingResponseFunc =\n  () => Promise.resolve({} as NormalizedResponse);\nexport function setAbstractConvertIncomingResponseFunc(\n  func: AbstractConvertIncomingResponseFunc,\n) {\n  abstractConvertIncomingResponse = func;\n}\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractConvertResponse: AbstractConvertResponseFunc = () => {\n  throw new Error(\n    \"Missing adapter implementation for 'abstractConvertResponse' - make sure to import the appropriate adapter for your platform\",\n  );\n};\nexport function setAbstractConvertResponseFunc(\n  func: AbstractConvertResponseFunc,\n) {\n  abstractConvertResponse = func;\n}\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractConvertHeaders: AbstractConvertHeadersFunc = () => {\n  throw new Error(\n    \"Missing adapter implementation for 'abstractConvertHeaders' - make sure to import the appropriate adapter for your platform\",\n  );\n};\nexport function setAbstractConvertHeadersFunc(\n  func: AbstractConvertHeadersFunc,\n) {\n  abstractConvertHeaders = func;\n}\n", "import {AbstractRuntimeStringFunc} from './types';\n\n// eslint-disable-next-line import/no-mutable-exports\nexport let abstractRuntimeString: AbstractRuntimeStringFunc = () => {\n  throw new Error(\n    \"Missing adapter implementation for 'abstractRuntimeString' - make sure to import the appropriate adapter for your platform\",\n  );\n};\nexport function setAbstractRuntimeString(func: AbstractRuntimeStringFunc) {\n  abstractRuntimeString = func;\n}\n", "import type {Headers} from './types';\n\n/**\n * Canonicalizes a header name by capitalizing each segment and ensuring consistent hyphenation.\n *\n * @param hdr - The header name to canonicalize.\n * @returns The canonicalized header name.\n */\nexport function canonicalizeHeaderName(hdr: string): string {\n  return hdr.replace(\n    /(^|-)(\\w+)/g,\n    (_fullMatch, start, letters) =>\n      start +\n      letters.slice(0, 1).toUpperCase() +\n      letters.slice(1).toLowerCase(),\n  );\n}\n\n/**\n * Retrieves all values associated with a canonicalized header name from the headers object.\n *\n * @param headers - The headers object or undefined.\n * @param needle_ - The header name to search for.\n * @returns An array of header values associated with the canonicalized header name.\n */\nexport function getHeaders(\n  headers: Headers | undefined,\n  needle_: string,\n): string[] {\n  const result: string[] = [];\n  if (!headers) return result;\n  const needle = canonicalizeHeaderName(needle_);\n  for (const [key, values] of Object.entries(headers)) {\n    if (canonicalizeHeaderName(key) !== needle) continue;\n    if (Array.isArray(values)) {\n      result.push(...values);\n    } else {\n      result.push(values);\n    }\n  }\n  return result;\n}\n\n/**\n * Retrieves the first value associated with a canonicalized header name from the headers object.\n *\n * @param headers - The headers object or undefined.\n * @param needle - The header name to search for.\n * @returns The first value associated with the canonicalized header name, or undefined if not found.\n */\nexport function getHeader(\n  headers: Headers | undefined,\n  needle: string,\n): string | undefined {\n  if (!headers) return undefined;\n  return getHeaders(headers, needle)?.[0];\n}\n/**\n * Sets a header to a single value, canonicalizing the header name.\n *\n * @param headers - The headers object.\n * @param key - The header name to set.\n * @param value - The value to assign to the header.\n */\nexport function setHeader(headers: Headers, key: string, value: string) {\n  canonicalizeHeaders(headers);\n  headers[canonicalizeHeaderName(key)] = [value];\n}\n/**\n * Adds a value to an existing header, creating a new array if necessary, and canonicalizing the header name.\n *\n * @param headers - The headers object.\n * @param key - The header name to add to.\n * @param value - The value to add.\n */\nexport function addHeader(headers: Headers, key: string, value: string) {\n  canonicalizeHeaders(headers);\n  const canonKey = canonicalizeHeaderName(key);\n  let list = headers[canonKey];\n  if (!list) {\n    list = [];\n  } else if (!Array.isArray(list)) {\n    list = [list];\n  }\n  headers[canonKey] = list;\n  list.push(value);\n}\n\n/**\n * Canonicalizes a header value, converting numbers to strings.\n *\n * @param value - The value to canonicalize.\n * @returns The canonicalized value as a string.\n */\nfunction canonicalizeValue(value: any): any {\n  if (typeof value === 'number') return value.toString();\n  return value;\n}\n\n/**\n * Canonicalizes all headers in the headers object by ensuring consistent header names and values.\n *\n * @param hdr - The headers object to canonicalize.\n * @returns The headers object with canonicalized header names and values.\n */\nexport function canonicalizeHeaders(hdr: Headers): Headers {\n  for (const [key, values] of Object.entries(hdr)) {\n    const canonKey = canonicalizeHeaderName(key);\n    if (!hdr[canonKey]) hdr[canonKey] = [];\n    if (!Array.isArray(hdr[canonKey]))\n      hdr[canonKey] = [canonicalizeValue(hdr[canonKey])];\n    if (key === canonKey) continue;\n    delete hdr[key];\n    (hdr[canonKey] as any).push(\n      ...[values].flat().map((value) => canonicalizeValue(value)),\n    );\n  }\n  return hdr;\n}\n\n/**\n * Removes a header from the headers object.\n *\n * @param headers - The headers object.\n * @param needle - The header name to remove.\n */\nexport function removeHeader(headers: Headers, needle: string) {\n  canonicalizeHeaders(headers);\n  const canonKey = canonicalizeHeaderName(needle);\n  delete headers[canonKey];\n}\n\n/**\n * Converts a headers object into an array of tuples, where each tuple represents a header name and value.\n *\n * @param {Object|string[][]} headers - The headers object or undefined/null.\n * @returns {string[][]} An array of tuples where each tuple contains a header name and its corresponding value.\n *\n * @example\n * // Example headers object\n * const headers = {\n *   'Set-Cookie': 'a=b',\n *   'Set-Cookie': 'x=y'\n * };\n *\n * // Converted to an array of tuples\n * const result = convertHeadersToTuples(headers);\n * console.log(result);\n * // Output: [\n * //   [\"Set-Cookie\", \"a=b\"],\n * //   [\"Set-Cookie\", \"x=y\"]\n * // ]\n */\nexport function flatHeaders(\n  headers: Headers | undefined | null,\n): [string, string][] {\n  if (!headers) return [];\n\n  return Object.entries(headers).flatMap(([header, values]) =>\n    Array.isArray(values)\n      ? values.map((value): [string, string] => [header, value])\n      : [[header, values]],\n  );\n}\n", "import type {\n  Headers as ShopifyHeaders,\n  AdapterArgs,\n  NormalizedResponse,\n  NormalizedRequest,\n} from '../../runtime';\nimport {addHeader, flatHeaders} from '../../runtime';\n\ninterface WebApiAdapterArgs extends AdapterArgs {\n  rawRequest: Request;\n}\n\nexport async function webApiConvertRequest(\n  adapterArgs: WebApiAdapterArgs,\n): Promise<NormalizedRequest> {\n  const request = adapterArgs.rawRequest;\n  const headers = {};\n  for (const [key, value] of request.headers.entries()) {\n    addHeader(headers, key, value);\n  }\n\n  return {\n    headers,\n    method: request.method ?? 'GET',\n    url: new URL(request.url).toString(),\n  };\n}\n\nexport async function webApiConvertHeaders(\n  headers: ShopifyHeaders,\n  _adapterArgs: WebApiAdapterArgs,\n): Promise<Headers> {\n  const remixHeaders = new Headers();\n  flatHeaders(headers ?? {}).forEach(([key, value]) =>\n    remixHeaders.append(key, value),\n  );\n  return Promise.resolve(remixHeaders);\n}\n\nexport async function webApiConvertResponse(\n  resp: NormalizedResponse,\n  adapterArgs: WebApiAdapterArgs,\n): Promise<Response> {\n  return new Response(resp.body, {\n    status: resp.statusCode,\n    statusText: resp.statusText,\n    headers: await webApiConvertHeaders(resp.headers ?? {}, adapterArgs),\n  });\n}\n\nexport function webApiRuntimeString(): string {\n  return 'Web API';\n}\n", "import {\n  setAbstractFetchFunc,\n  setAbstractConvertRequestFunc,\n  setAbstractConvertResponseFunc,\n  setAbstractConvertHeadersFunc,\n  setAbstractRuntimeString,\n} from '../../runtime';\n\nimport {\n  webApiConvertHeaders,\n  webApiConvertRequest,\n  webApiConvertResponse,\n  webApiRuntimeString,\n} from './adapter';\n\nsetAbstractFetchFunc(fetch);\nsetAbstractConvertRequestFunc(webApiConvertRequest);\nsetAbstractConvertResponseFunc(webApiConvertResponse);\nsetAbstractConvertHeadersFunc(webApiConvertHeaders);\nsetAbstractRuntimeString(webApiRuntimeString);\n", "import {AdapterResponse} from '../runtime/http/types';\n\nexport class ShopifyError extends Error {\n  constructor(message?: string) {\n    super(message);\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n}\n\nexport class InvalidHmacError extends ShopifyError {}\nexport class InvalidShopError extends ShopifyError {}\nexport class InvalidHostError extends ShopifyError {}\nexport class InvalidJwtError extends ShopifyError {}\nexport class MissingJwtTokenError extends ShopifyError {}\nexport class InvalidDeliveryMethodError extends ShopifyError {}\n\nexport class SafeCompareError extends ShopifyError {}\nexport class PrivateAppError extends ShopifyError {}\n\nexport class HttpRequestError extends ShopifyError {}\nexport class HttpMaxRetriesError extends ShopifyError {}\n\ninterface HttpResponseData {\n  code: number;\n  statusText: string;\n  body?: Record<string, unknown>;\n  headers?: Record<string, unknown>;\n}\n\ninterface HttpResponseErrorParams extends HttpResponseData {\n  message: string;\n}\nexport class HttpResponseError<\n  ResponseType extends HttpResponseData = HttpResponseData,\n> extends ShopifyError {\n  readonly response: ResponseType;\n\n  constructor({\n    message,\n    code,\n    statusText,\n    body,\n    headers,\n  }: HttpResponseErrorParams) {\n    super(message);\n    this.response = {\n      code,\n      statusText,\n      body,\n      headers,\n    } as ResponseType;\n  }\n}\nexport class HttpRetriableError<\n  ResponseType extends HttpResponseData = HttpResponseData,\n> extends HttpResponseError<ResponseType> {}\nexport class HttpInternalError extends HttpRetriableError {}\n\ninterface HttpThrottlingErrorData extends HttpResponseData {\n  retryAfter?: number;\n}\ninterface HttpThrottlingErrorParams extends HttpThrottlingErrorData {\n  message: string;\n}\nexport class HttpThrottlingError extends HttpRetriableError<HttpThrottlingErrorData> {\n  constructor({retryAfter, ...params}: HttpThrottlingErrorParams) {\n    super(params);\n    this.response.retryAfter = retryAfter;\n  }\n}\n\nexport class RestResourceError extends ShopifyError {}\n\ninterface GraphqlQueryErrorParams {\n  message: string;\n  response: Record<string, unknown>;\n  headers?: Record<string, unknown>;\n  body?: Record<string, any>;\n}\n\nexport class GraphqlQueryError extends ShopifyError {\n  readonly response: Record<string, unknown>;\n  readonly headers?: Record<string, unknown>;\n  readonly body?: Record<string, any>;\n\n  constructor({message, response, headers, body}: GraphqlQueryErrorParams) {\n    super(message);\n    this.response = response;\n    this.headers = headers;\n    this.body = body;\n  }\n}\n\nexport class InvalidOAuthError extends ShopifyError {}\nexport class BotActivityDetected extends ShopifyError {}\nexport class CookieNotFound extends ShopifyError {}\nexport class InvalidSession extends ShopifyError {}\n\ninterface InvalidWebhookParams {\n  message: string;\n  response: AdapterResponse;\n}\nexport class InvalidWebhookError extends ShopifyError {\n  readonly response: AdapterResponse;\n\n  constructor({message, response}: InvalidWebhookParams) {\n    super(message);\n    this.response = response;\n  }\n}\nexport class MissingWebhookCallbackError extends InvalidWebhookError {}\nexport class SessionStorageError extends ShopifyError {}\nexport class MissingRequiredArgument extends ShopifyError {}\nexport class UnsupportedClientType extends ShopifyError {}\nexport class InvalidRequestError extends ShopifyError {}\ninterface BillingErrorParams {\n  message: string;\n  errorData: any;\n}\nexport class BillingError extends ShopifyError {\n  readonly errorData: any;\n\n  constructor({message, errorData}: BillingErrorParams) {\n    super(message);\n    this.errorData = errorData;\n  }\n}\nexport class FeatureDeprecatedError extends ShopifyError {}\n", "import {ShopifyError} from '../../lib/error';\n\nimport {crypto} from './crypto';\nimport {HashFormat} from './types';\n\nexport async function createSHA256HMAC(\n  secret: string,\n  payload: string,\n  returnFormat: HashFormat = HashFormat.Base64,\n): Promise<string> {\n  const cryptoLib =\n    typeof (crypto as any)?.webcrypto === 'undefined'\n      ? crypto\n      : (crypto as any).webcrypto;\n\n  const enc = new TextEncoder();\n  const key = await cryptoLib.subtle.importKey(\n    'raw',\n    enc.encode(secret),\n    {\n      name: 'HMAC',\n      hash: {name: 'SHA-256'},\n    },\n    false,\n    ['sign'],\n  );\n\n  const signature = await cryptoLib.subtle.sign(\n    'HMAC',\n    key,\n    enc.encode(payload),\n  );\n  return returnFormat === HashFormat.Base64\n    ? asBase64(signature)\n    : asHex(signature);\n}\n\nexport function asHex(buffer: ArrayBuffer): string {\n  return [...new Uint8Array(buffer)]\n    .map((byte) => byte.toString(16).padStart(2, '0'))\n    .join('');\n}\n\nconst LookupTable =\n  'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nexport function asBase64(buffer: ArrayBuffer): string {\n  let output = '';\n\n  const input = new Uint8Array(buffer);\n  for (let i = 0; i < input.length; ) {\n    const byte1 = input[i++];\n    const byte2 = input[i++];\n    const byte3 = input[i++];\n\n    const enc1 = byte1 >> 2;\n    const enc2 = ((byte1 & 0b00000011) << 4) | (byte2 >> 4);\n    let enc3 = ((byte2 & 0b00001111) << 2) | (byte3 >> 6);\n    let enc4 = byte3 & 0b00111111;\n\n    if (isNaN(byte2)) {\n      enc3 = 64;\n    }\n    if (isNaN(byte3)) {\n      enc4 = 64;\n    }\n\n    output +=\n      LookupTable[enc1] +\n      LookupTable[enc2] +\n      LookupTable[enc3] +\n      LookupTable[enc4];\n  }\n  return output;\n}\n\nexport function hashString(str: string, returnFormat: HashFormat): string {\n  const buffer = new TextEncoder().encode(str);\n\n  switch (returnFormat) {\n    case HashFormat.Base64:\n      return asBase64(buffer);\n    case HashFormat.Hex:\n      return asHex(buffer);\n    default:\n      throw new ShopifyError(`Unrecognized hash format '${returnFormat}'`);\n  }\n}\n", "export function splitN(\n  str: string,\n  sep: string,\n  maxNumParts: number,\n): string[] {\n  const parts = str.split(sep);\n  const maxParts = Math.min(Math.abs(maxNumParts), parts.length);\n\n  return [...parts.slice(0, maxParts - 1), parts.slice(maxParts - 1).join(sep)];\n}\n", "// import type {Headers} from \"./headers\";\nimport {createSHA256HMAC} from '../crypto/utils';\n\nimport {splitN} from './utils';\nimport {getHeader, getHeaders, removeHeader, addHeader} from './headers';\n\nimport type {NormalizedRequest, NormalizedResponse} from '.';\n\nexport interface CookieData {\n  name: string;\n  value: string;\n  /**\n   * a number representing the milliseconds from Date.now() for expiry\n   */\n  maxAge?: number;\n  /**\n   * a Date object indicating the cookie's expiration\n   * date (expires at the end of session by default).\n   */\n  expires?: Date;\n  /**\n   * a string indicating the path of the cookie (/ by default).\n   */\n  path?: string;\n  /**\n   * a string indicating the domain of the cookie (no default).\n   */\n  domain?: string;\n  /**\n   * a boolean indicating whether the cookie is only to be sent\n   * over HTTPS (false by default for HTTP, true by default for HTTPS).\n   */\n  secure?: boolean;\n  /**\n   * a boolean indicating whether the cookie is only to be sent over HTTP(S),\n   * and not made available to client JavaScript (true by default).\n   */\n  httpOnly?: boolean;\n  /**\n   * a boolean or string indicating whether the cookie is a \"same site\" cookie (false by default).\n   * This can be set to 'strict', 'lax', or true (which maps to 'strict').\n   */\n  sameSite?: 'strict' | 'lax' | 'none';\n}\n\nexport type CookieJar = Record<string, CookieData>;\ninterface CookiesOptions {\n  keys: string[];\n  // Ignored. Only for type-compatibility with the node package for now.\n  secure: boolean;\n}\nexport class Cookies {\n  static parseCookies(hdrs: string[]): CookieJar {\n    const entries = hdrs\n      .filter((hdr) => hdr.trim().length > 0)\n      .map((cookieDef) => {\n        const [keyval, ...opts] = cookieDef.split(';');\n        const [name, value] = splitN(keyval, '=', 2).map((value) =>\n          value.trim(),\n        );\n        return [\n          name,\n          {\n            name,\n            value,\n            ...Object.fromEntries(\n              opts.map((opt) =>\n                splitN(opt, '=', 2).map((value) => value.trim()),\n              ),\n            ),\n          },\n        ];\n      });\n    const jar = Object.fromEntries(entries) as CookieJar;\n    for (const cookie of Object.values(jar)) {\n      if (typeof cookie.expires === 'string') {\n        cookie.expires = new Date(cookie.expires);\n      }\n    }\n    return jar;\n  }\n\n  static encodeCookie(data: CookieData): string {\n    let result = '';\n    result += `${data.name}=${data.value};`;\n    result += Object.entries(data)\n      .filter(([key]) => !['name', 'value', 'expires'].includes(key))\n      .map(([key, value]) => `${key}=${value}`)\n      .join('; ');\n    if (data.expires) {\n      result += ';';\n      result += `expires=${data.expires.toUTCString()}`;\n    }\n    return result;\n  }\n\n  receivedCookieJar: CookieJar = {};\n  outgoingCookieJar: CookieJar = {};\n  private keys: string[] = [];\n\n  constructor(\n    request: NormalizedRequest,\n    public response: NormalizedResponse,\n    {keys = []}: Partial<CookiesOptions> = {},\n  ) {\n    if (keys) this.keys = keys;\n\n    const cookieReqHdr = getHeader(request.headers, 'Cookie') ?? '';\n    this.receivedCookieJar = Cookies.parseCookies(cookieReqHdr.split(';'));\n    const cookieResHdr = getHeaders(response.headers, 'Set-Cookie') ?? [];\n    this.outgoingCookieJar = Cookies.parseCookies(cookieResHdr);\n  }\n\n  toHeaders(): string[] {\n    return Object.values(this.outgoingCookieJar).map((cookie) =>\n      Cookies.encodeCookie(cookie),\n    );\n  }\n\n  updateHeader() {\n    if (!this.response.headers) {\n      this.response.headers = {};\n    }\n    removeHeader(this.response.headers, 'Set-Cookie');\n    this.toHeaders().map((hdr) =>\n      addHeader(this.response.headers!, 'Set-Cookie', hdr),\n    );\n  }\n\n  get(name: string): string | undefined {\n    return this.receivedCookieJar[name]?.value;\n  }\n\n  deleteCookie(name: string) {\n    this.set(name, '', {\n      path: '/',\n      expires: new Date(0),\n    });\n  }\n\n  async getAndVerify(name: string): Promise<string | undefined> {\n    const value = this.get(name);\n    if (!value) return undefined;\n    if (!(await this.isSignedCookieValid(name))) {\n      return undefined;\n    }\n    return value;\n  }\n\n  private get canSign() {\n    return this.keys?.length > 0;\n  }\n\n  set(name: string, value: string, opts: Partial<CookieData> = {}): void {\n    this.outgoingCookieJar[name] = {\n      ...opts,\n      name,\n      value,\n    };\n    this.updateHeader();\n  }\n\n  async setAndSign(\n    name: string,\n    value: string,\n    opts: Partial<CookieData> = {},\n  ): Promise<void> {\n    if (!this.canSign) {\n      throw Error('No keys provided for signing.');\n    }\n    this.set(name, value, opts);\n    const sigName = `${name}.sig`;\n    const signature = await createSHA256HMAC(this.keys[0], value);\n    this.set(sigName, signature, opts);\n    this.updateHeader();\n  }\n\n  async isSignedCookieValid(cookieName: string): Promise<boolean> {\n    const signedCookieName = `${cookieName}.sig`;\n    if (\n      !this.cookieExists(cookieName) ||\n      !this.cookieExists(signedCookieName)\n    ) {\n      this.deleteInvalidCookies(cookieName, signedCookieName);\n      return false;\n    }\n    const cookieValue = this.get(cookieName);\n    const signature = this.get(signedCookieName);\n\n    if (!cookieValue || !signature) {\n      this.deleteInvalidCookies(cookieName, signedCookieName);\n      return false;\n    }\n\n    const allCheckSignatures = await Promise.all(\n      this.keys.map((key) => createSHA256HMAC(key, cookieValue)),\n    );\n\n    if (!allCheckSignatures.includes(signature)) {\n      this.deleteInvalidCookies(cookieName, signedCookieName);\n      return false;\n    }\n\n    return true;\n  }\n\n  private cookieExists(cookieName: string) {\n    return Boolean(this.get(cookieName));\n  }\n\n  private deleteInvalidCookies(...cookieNames: string[]): void {\n    cookieNames.forEach((cookieName) => this.deleteCookie(cookieName));\n  }\n}\n", "/**\n * Allowed arithmetic operators\n */\nexport type CompareOperator = '>' | '>=' | '=' | '<' | '<=' | '!=';\n\nexport const semver =\n  /^[v^~<>=]*?(\\d+)(?:\\.([x*]|\\d+)(?:\\.([x*]|\\d+)(?:\\.([x*]|\\d+))?(?:-([\\da-z\\-]+(?:\\.[\\da-z\\-]+)*))?(?:\\+[\\da-z\\-]+(?:\\.[\\da-z\\-]+)*)?)?)?$/i;\n\nexport const validateAndParse = (version: string) => {\n  if (typeof version !== 'string') {\n    throw new TypeError('Invalid argument expected string');\n  }\n  const match = version.match(semver);\n  if (!match) {\n    throw new Error(\n      `Invalid argument not valid semver ('${version}' received)`\n    );\n  }\n  match.shift();\n  return match;\n};\n\nconst isWildcard = (s: string) => s === '*' || s === 'x' || s === 'X';\n\nconst tryParse = (v: string) => {\n  const n = parseInt(v, 10);\n  return isNaN(n) ? v : n;\n};\n\nconst forceType = (a: string | number, b: string | number) =>\n  typeof a !== typeof b ? [String(a), String(b)] : [a, b];\n\nconst compareStrings = (a: string, b: string) => {\n  if (isWildcard(a) || isWildcard(b)) return 0;\n  const [ap, bp] = forceType(tryParse(a), tryParse(b));\n  if (ap > bp) return 1;\n  if (ap < bp) return -1;\n  return 0;\n};\n\nexport const compareSegments = (\n  a: string | string[] | RegExpMatchArray,\n  b: string | string[] | RegExpMatchArray\n) => {\n  for (let i = 0; i < Math.max(a.length, b.length); i++) {\n    const r = compareStrings(a[i] || '0', b[i] || '0');\n    if (r !== 0) return r;\n  }\n  return 0;\n};\n", "import { compareSegments, validateAndParse } from './utils.js';\n\n/**\n * Compare [semver](https://semver.org/) version strings to find greater, equal or lesser.\n * This library supports the full semver specification, including comparing versions with different number of digits like `1.0.0`, `1.0`, `1`, and pre-release versions like `1.0.0-alpha`.\n * @param v1 - First version to compare\n * @param v2 - Second version to compare\n * @returns Numeric value compatible with the [Array.sort(fn) interface](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort#Parameters).\n */\nexport const compareVersions = (v1: string, v2: string) => {\n  // validate input and split into segments\n  const n1 = validateAndParse(v1);\n  const n2 = validateAndParse(v2);\n\n  // pop off the patch\n  const p1 = n1.pop();\n  const p2 = n2.pop();\n\n  // validate numbers\n  const r = compareSegments(n1, n2);\n  if (r !== 0) return r;\n\n  // validate pre-release\n  if (p1 && p2) {\n    return compareSegments(p1.split('.'), p2.split('.'));\n  } else if (p1 || p2) {\n    return p1 ? -1 : 1;\n  }\n\n  return 0;\n};\n", "import { compareVersions } from './compareVersions.js';\nimport { CompareOperator } from './utils.js';\n\n/**\n * Compare [semver](https://semver.org/) version strings using the specified operator.\n *\n * @param v1 First version to compare\n * @param v2 Second version to compare\n * @param operator Allowed arithmetic operator to use\n * @returns `true` if the comparison between the firstVersion and the secondVersion satisfies the operator, `false` otherwise.\n *\n * @example\n * ```\n * compare('10.1.8', '10.0.4', '>'); // return true\n * compare('10.0.1', '10.0.1', '='); // return true\n * compare('10.1.1', '10.2.2', '<'); // return true\n * compare('10.1.1', '10.2.2', '<='); // return true\n * compare('10.1.1', '10.2.2', '>='); // return false\n * ```\n */\nexport const compare = (v1: string, v2: string, operator: CompareOperator) => {\n  // validate input operator\n  assertValidOperator(operator);\n\n  // since result of compareVersions can only be -1 or 0 or 1\n  // a simple map can be used to replace switch\n  const res = compareVersions(v1, v2);\n\n  return operatorResMap[operator].includes(res);\n};\n\nconst operatorResMap = {\n  '>': [1],\n  '>=': [0, 1],\n  '=': [0],\n  '<=': [-1, 0],\n  '<': [-1],\n  '!=': [-1, 1],\n};\n\nconst allowedOperators = Object.keys(operatorResMap);\n\nconst assertValidOperator = (op: string) => {\n  if (typeof op !== 'string') {\n    throw new TypeError(\n      `Invalid operator type, expected string but got ${typeof op}`\n    );\n  }\n  if (allowedOperators.indexOf(op) === -1) {\n    throw new Error(\n      `Invalid operator, expected one of ${allowedOperators.join('|')}`\n    );\n  }\n};\n", "export enum LogSeverity {\n  Error,\n  Warning,\n  Info,\n  Debug,\n}\n\nexport enum ApiVersion {\n  October22 = '2022-10',\n  January23 = '2023-01',\n  April23 = '2023-04',\n  July23 = '2023-07',\n  October23 = '2023-10',\n  January24 = '2024-01',\n  April24 = '2024-04',\n  July24 = '2024-07',\n  October24 = '2024-10',\n  January25 = '2025-01',\n  April25 = '2025-04',\n  July25 = '2025-07',\n  October25 = '2025-10',\n  Unstable = 'unstable',\n}\n\nexport const LIBRARY_NAME = 'Shopify API Library';\nexport const LATEST_API_VERSION = ApiVersion.July25;\nexport const RELEASE_CANDIDATE_API_VERSION = ApiVersion.October25;\n\n/* eslint-disable @shopify/typescript/prefer-pascal-case-enums */\nexport enum ShopifyHeader {\n  AccessToken = 'X-Shopify-Access-Token',\n  ApiVersion = 'X-Shopify-API-Version',\n  Domain = 'X-Shopify-Shop-Domain',\n  Hmac = 'X-Shopify-Hmac-Sha256',\n  Topic = 'X-Shopify-Topic',\n  SubTopic = 'X-Shopify-Sub-Topic',\n  WebhookId = 'X-Shopify-Webhook-Id',\n  StorefrontPrivateToken = 'Shopify-Storefront-Private-Token',\n  StorefrontSDKVariant = 'X-SDK-Variant',\n  StorefrontSDKVersion = 'X-SDK-Version',\n}\n/* eslint-enable @shopify/typescript/prefer-pascal-case-enums */\n\nexport enum ClientType {\n  Rest = 'rest',\n  Graphql = 'graphql',\n}\n\nexport const privacyTopics: string[] = [\n  'CUSTOMERS_DATA_REQUEST',\n  'CUSTOMERS_REDACT',\n  'SHOP_REDACT',\n];\n\nexport enum BillingInterval {\n  OneTime = 'ONE_TIME',\n  Every30Days = 'EVERY_30_DAYS',\n  Annual = 'ANNUAL',\n  Usage = 'USAGE',\n}\n\nexport type RecurringBillingIntervals = Exclude<\n  BillingInterval,\n  BillingInterval.OneTime\n>;\n\nexport enum BillingReplacementBehavior {\n  ApplyImmediately = 'APPLY_IMMEDIATELY',\n  ApplyOnNextBillingCycle = 'APPLY_ON_NEXT_BILLING_CYCLE',\n  Standard = 'STANDARD',\n}\n", "export const SHOPIFY_API_LIBRARY_VERSION = '11.14.1';\n", "import {LogSeverity} from '../types';\nimport {ConfigInterface} from '../base-types';\n\nimport {LogContext} from './types';\n\nexport type LoggerFunction = (\n  severity: LogSeverity,\n  message: string,\n  context?: Record<string, any>,\n) => void;\n\nexport function log(config: ConfigInterface): LoggerFunction {\n  return function (\n    severity: LogSeverity,\n    message: string,\n    context: LogContext = {},\n  ): void {\n    if (severity > config.logger.level) {\n      return;\n    }\n\n    const prefix: string[] = [];\n\n    if (config.logger.timestamps) {\n      prefix.push(`${new Date().toISOString().slice(0, -5)}Z`);\n    }\n\n    let packageString = context.package || 'shopify-api';\n    delete context.package;\n\n    switch (severity) {\n      case LogSeverity.Debug:\n        packageString = `${packageString}/DEBUG`;\n        break;\n      case LogSeverity.Info:\n        packageString = `${packageString}/INFO`;\n        break;\n      case LogSeverity.Warning:\n        packageString = `${packageString}/WARNING`;\n        break;\n      case LogSeverity.Error:\n        packageString = `${packageString}/ERROR`;\n        break;\n    }\n\n    prefix.push(packageString);\n\n    const contextParts: string[] = [];\n    Object.entries(context).forEach(([key, value]) => {\n      contextParts.push(`${key}: ${value}`);\n    });\n\n    let suffix = '';\n    if (contextParts.length > 0) {\n      suffix = ` | {${contextParts.join(', ')}}`;\n    }\n\n    config.logger.log(severity, `[${prefix.join('] [')}] ${message}${suffix}`);\n  };\n}\n", "import {compare} from 'compare-versions';\n\nimport {LogSeverity} from '../types';\nimport {ConfigInterface} from '../base-types';\nimport {FeatureDeprecatedError} from '../error';\nimport {SHOPIFY_API_LIBRARY_VERSION} from '../version';\n\nimport {log, LoggerFunction} from './log';\nimport {LogContext} from './types';\n\nexport function logger(config: ConfigInterface) {\n  const logFunction = log(config);\n\n  return {\n    log: logFunction,\n    debug: async (message: string, context: LogContext = {}) =>\n      logFunction(LogSeverity.Debug, message, context),\n    info: async (message: string, context: LogContext = {}) =>\n      logFunction(LogSeverity.Info, message, context),\n    warning: async (message: string, context: LogContext = {}) =>\n      logFunction(LogSeverity.Warning, message, context),\n    error: async (message: string, context: LogContext = {}) =>\n      logFunction(LogSeverity.Error, message, context),\n    deprecated: deprecated(logFunction),\n  };\n}\n\nexport type ShopifyLogger = ReturnType<typeof logger>;\n\nfunction deprecated(logFunction: LoggerFunction) {\n  return function (version: string, message: string): void {\n    if (compare(SHOPIFY_API_LIBRARY_VERSION, version, '>=')) {\n      throw new FeatureDeprecatedError(\n        `Feature was deprecated in version ${version}`,\n      );\n    }\n\n    return logFunction(\n      LogSeverity.Warning,\n      `[Deprecated | ${version}] ${message}`,\n    );\n  };\n}\n", "import type {ShopifyClients} from '../lib';\nimport {ConfigInterface} from '../lib/base-types';\nimport {logger} from '../lib/logger';\n\nimport {Base} from './base';\nimport {ShopifyRestResources} from './types';\n\nexport interface LoadRestResourcesParams<\n  Resources extends ShopifyRestResources,\n> {\n  resources: Resources;\n  config: ConfigInterface;\n  RestClient: ShopifyClients['Rest'];\n}\n\nexport function loadRestResources<Resources extends ShopifyRestResources>({\n  resources,\n  config,\n  RestClient,\n}: LoadRestResourcesParams<Resources>): Resources {\n  const firstResource = Object.keys(resources)[0];\n  if (config.apiVersion !== resources[firstResource].apiVersion) {\n    logger(config).warning(\n      `Loading REST resources for API version ${resources[firstResource].apiVersion}, which doesn't match the default ${config.apiVersion}`,\n    );\n  }\n\n  return Object.fromEntries(\n    Object.entries(resources).map(([name, resource]) => {\n      class NewResource extends resource {}\n\n      NewResource.setClassProperties({\n        Client: RestClient,\n        config,\n      });\n\n      Object.entries(NewResource.hasOne).map(([_attribute, klass]) => {\n        (klass as typeof Base).setClassProperties({\n          Client: RestClient,\n          config,\n        });\n      });\n\n      Object.entries(NewResource.hasMany).map(([_attribute, klass]) => {\n        (klass as typeof Base).setClassProperties({\n          Client: RestClient,\n          config,\n        });\n      });\n\n      Reflect.defineProperty(NewResource, 'name', {\n        value: name,\n      });\n\n      return [name, NewResource];\n    }),\n  ) as Resources;\n}\n", "import {type ShopifyLogger} from '../lib/logger';\nimport {type ConfigInterface} from '../lib/base-types';\n\n/**\n * Future flags are used to enable features that are not yet available by default.\n */\nexport interface FutureFlags {\n  /**\n   * Enable line item billing, to make billing configuration more similar to the GraphQL API. Default enabling of this\n   * feature has been moved to v11. Use lineItemBilling instead.\n   */\n  v10_lineItemBilling?: boolean;\n\n  /**\n   * Enable line item billing, to make billing configuration more similar to the GraphQL API.\n   */\n  lineItemBilling?: boolean;\n\n  /**\n   * Enable support for managed pricing, so apps can check for payments without needing a billing config.\n   */\n  unstable_managedPricingSupport?: boolean;\n\n  /**\n   * Change the CustomerAddress classes to expose a `is_default` property instead of `default` when fetching data. This\n   * resolves a conflict with the default() method in that class.\n   */\n  customerAddressDefaultFix?: boolean;\n}\n\n/**\n * Configuration option for future flags.\n */\nexport type FutureFlagOptions = FutureFlags | undefined;\n\nexport type FeatureEnabled<\n  Future extends FutureFlagOptions,\n  Flag extends keyof FutureFlags,\n> = Future extends FutureFlags\n  ? Future[Flag] extends true\n    ? true\n    : false\n  : false;\n\nexport function logDisabledFutureFlags(\n  config: ConfigInterface,\n  logger: ShopifyLogger,\n) {\n  if (!config._logDisabledFutureFlags) {\n    return;\n  }\n\n  const logFlag = (flag: string, message: string) =>\n    logger.info(`Future flag ${flag} is disabled.\\n\\n  ${message}\\n`);\n\n  if (!config.future?.lineItemBilling) {\n    logFlag(\n      'lineItemBilling',\n      'Enable this flag to use the new billing API, that supports multiple line items per plan.',\n    );\n  }\n  if (config.future?.v10_lineItemBilling) {\n    logger.deprecated(\n      '12.0.0',\n      'v10_lineItemBilling will become enabled in v11. Use flag lineItemBilling instead',\n    );\n  }\n\n  if (!config.future?.customerAddressDefaultFix) {\n    logFlag(\n      'customerAddressDefaultFix',\n      \"Enable this flag to change the CustomerAddress classes to expose a 'is_default' property instead of 'default' when fetching data.\",\n    );\n  }\n\n  if (!config.future?.unstable_managedPricingSupport) {\n    logFlag(\n      'unstable_managedPricingSupport',\n      'Enable this flag to support managed pricing, so apps can check for payments without needing a billing config. Learn more at https://shopify.dev/docs/apps/launch/billing/managed-pricing',\n    );\n  }\n}\n", "/**\n * A class that represents a set of access token scopes.\n */\nclass AuthScopes {\n  public static SCOPE_DELIMITER = ',';\n\n  private compressedScopes: Set<string>;\n  private expandedScopes: Set<string>;\n  private originalScopes: Set<string>;\n\n  constructor(scopes: string | string[] | AuthScopes | undefined) {\n    let scopesArray: string[] = [];\n    if (typeof scopes === 'string') {\n      scopesArray = scopes.split(\n        new RegExp(`${AuthScopes.SCOPE_DELIMITER}\\\\s*`),\n      );\n    } else if (Array.isArray(scopes)) {\n      scopesArray = scopes;\n    } else if (scopes) {\n      scopesArray = Array.from(scopes.expandedScopes);\n    }\n\n    scopesArray = scopesArray\n      .map((scope) => scope.trim())\n      .filter((scope) => scope.length);\n\n    const impliedScopes = this.getImpliedScopes(scopesArray);\n\n    const scopeSet = new Set(scopesArray);\n    const impliedSet = new Set(impliedScopes);\n\n    this.compressedScopes = new Set(\n      [...scopeSet].filter((x) => !impliedSet.has(x)),\n    );\n    this.expandedScopes = new Set([...scopeSet, ...impliedSet]);\n    this.originalScopes = scopeSet;\n  }\n\n  /**\n   * Checks whether the current set of scopes includes the given one.\n   */\n  public has(scope: string | string[] | AuthScopes | undefined) {\n    let other: AuthScopes;\n\n    if (scope instanceof AuthScopes) {\n      other = scope;\n    } else {\n      other = new AuthScopes(scope);\n    }\n\n    return (\n      other.toArray().filter((x) => !this.expandedScopes.has(x)).length === 0\n    );\n  }\n\n  /**\n   * Checks whether the current set of scopes equals the given one.\n   */\n  public equals(otherScopes: string | string[] | AuthScopes | undefined) {\n    let other: AuthScopes;\n\n    if (otherScopes instanceof AuthScopes) {\n      other = otherScopes;\n    } else {\n      other = new AuthScopes(otherScopes);\n    }\n\n    return (\n      this.compressedScopes.size === other.compressedScopes.size &&\n      this.toArray().filter((x) => !other.has(x)).length === 0\n    );\n  }\n\n  /**\n   * Returns a comma-separated string with the current set of scopes.\n   */\n  public toString() {\n    return this.toArray().join(AuthScopes.SCOPE_DELIMITER);\n  }\n\n  /**\n   * Returns an array with the current set of scopes.\n   */\n  public toArray(returnOriginalScopes = false) {\n    return returnOriginalScopes\n      ? [...this.originalScopes]\n      : [...this.compressedScopes];\n  }\n\n  private getImpliedScopes(scopesArray: string[]): string[] {\n    return scopesArray.reduce((array: string[], current: string) => {\n      const matches = current.match(/^(unauthenticated_)?write_(.*)$/);\n      if (matches) {\n        array.push(`${matches[1] ? matches[1] : ''}read_${matches[2]}`);\n      }\n\n      return array;\n    }, []);\n  }\n}\n\nexport {AuthScopes};\n", "import {ShopifyError} from './error';\nimport {ConfigInterface, ConfigParams} from './base-types';\nimport {LATEST_API_VERSION, LogSeverity} from './types';\nimport {AuthScopes} from './auth/scopes';\nimport {logger as createLogger} from './logger';\n\nexport function validateConfig<Params extends ConfigParams>(\n  params: Params,\n): ConfigInterface<Params> {\n  const config = {\n    apiKey: '',\n    apiSecretKey: '',\n    hostName: '',\n    hostScheme: 'https',\n    apiVersion: LATEST_API_VERSION,\n    isEmbeddedApp: true,\n    isCustomStoreApp: false,\n    logger: {\n      log: defaultLogFunction,\n      level: LogSeverity.Info,\n      httpRequests: false,\n      timestamps: false,\n    },\n    future: {},\n    _logDisabledFutureFlags: true,\n  } as ConfigInterface<Params>;\n\n  // Make sure that the essential params actually have content in them\n  const mandatory: (keyof Params)[] = ['apiSecretKey', 'hostName'];\n  if (!('isCustomStoreApp' in params) || !params.isCustomStoreApp) {\n    mandatory.push('apiKey');\n  }\n  if ('isCustomStoreApp' in params && params.isCustomStoreApp) {\n    if (\n      !('adminApiAccessToken' in params) ||\n      params.adminApiAccessToken?.length === 0\n    ) {\n      mandatory.push('adminApiAccessToken');\n    }\n  }\n\n  const missing: (keyof Params)[] = [];\n  mandatory.forEach((key) => {\n    if (!notEmpty(params[key])) {\n      missing.push(key);\n    }\n  });\n\n  if (missing.length) {\n    throw new ShopifyError(\n      `Cannot initialize Shopify API Library. Missing values for: ${missing.join(\n        ', ',\n      )}`,\n    );\n  }\n\n  // Alias the v10_lineItemBilling flag to lineItemBilling because we aren't releasing in v10\n  const future = params.future?.v10_lineItemBilling\n    ? {\n        lineItemBilling: params.future?.v10_lineItemBilling,\n        ...params.future,\n      }\n    : params.future;\n\n  const {\n    hostScheme,\n    isCustomStoreApp,\n    adminApiAccessToken,\n    userAgentPrefix,\n    logger,\n    privateAppStorefrontAccessToken,\n    customShopDomains,\n    billing,\n    ...mandatoryParams\n  } = params;\n\n  let scopes;\n  if (params.scopes === undefined) {\n    scopes = undefined;\n  } else if (params.scopes instanceof AuthScopes) {\n    scopes = params.scopes;\n  } else {\n    scopes = new AuthScopes(params.scopes);\n  }\n\n  Object.assign(config, mandatoryParams, {\n    hostName: params.hostName.replace(/\\/$/, ''),\n    scopes,\n    hostScheme: hostScheme ?? config.hostScheme,\n    isCustomStoreApp: isCustomStoreApp ?? config.isCustomStoreApp,\n    adminApiAccessToken: adminApiAccessToken ?? config.adminApiAccessToken,\n    userAgentPrefix: userAgentPrefix ?? config.userAgentPrefix,\n    logger: {...config.logger, ...(logger || {})},\n    privateAppStorefrontAccessToken:\n      privateAppStorefrontAccessToken ?? config.privateAppStorefrontAccessToken,\n    customShopDomains: customShopDomains ?? config.customShopDomains,\n    billing: billing ?? config.billing,\n    future: future ?? config.future,\n  });\n\n  if (\n    config.isCustomStoreApp &&\n    params.adminApiAccessToken === params.apiSecretKey\n  ) {\n    createLogger(config).warning(\n      \"adminApiAccessToken is set to the same value as apiSecretKey. adminApiAccessToken should be set to the Admin API access token for custom store apps; apiSecretKey should be set to the custom store app's API secret key.\",\n    );\n  }\n\n  return config;\n}\n\nfunction notEmpty<T>(value: T): value is NonNullable<T> {\n  if (value == null) {\n    return false;\n  }\n  return typeof value === 'string' || Array.isArray(value)\n    ? value.length > 0\n    : true;\n}\n\nfunction defaultLogFunction(severity: LogSeverity, message: string): void {\n  switch (severity) {\n    case LogSeverity.Debug:\n      console.debug(message);\n      break;\n    case LogSeverity.Info:\n      console.log(message);\n      break;\n    case LogSeverity.Warning:\n      console.warn(message);\n      break;\n    case LogSeverity.Error:\n      console.error(message);\n      break;\n  }\n}\n", "export const CLIENT = 'GraphQL Client';\nexport const MIN_RETRIES = 0;\nexport const MAX_RETRIES = 3;\n\nexport const GQL_API_ERROR =\n  \"An error occurred while fetching from the API. Review 'graphQLErrors' for details.\";\nexport const UNEXPECTED_CONTENT_TYPE_ERROR =\n  'Response returned unexpected Content-Type:';\nexport const NO_DATA_OR_ERRORS_ERROR =\n  'An unknown error has occurred. The API did not return a data object or any errors in its response.';\n\nexport const CONTENT_TYPES = {\n  json: 'application/json',\n  multipart: 'multipart/mixed',\n};\nexport const SDK_VARIANT_HEADER = 'X-SDK-Variant';\nexport const SDK_VERSION_HEADER = 'X-SDK-Version';\n\nexport const DEFAULT_SDK_VARIANT = 'shopify-graphql-client';\n// This is value is replaced with package.json version during rollup build process\nexport const DEFAULT_CLIENT_VERSION = 'ROLLUP_REPLACE_CLIENT_VERSION';\n\nexport const RETRY_WAIT_TIME = 1000;\nexport const RETRIABLE_STATUS_CODES = [429, 503];\nexport const DEFER_OPERATION_REGEX = /@(defer)\\b/i;\nexport const NEWLINE_SEPARATOR = '\\r\\n';\nexport const BOUNDARY_HEADER_REGEX = /boundary=\"?([^=\";]+)\"?/i;\nexport const HEADER_SEPARATOR = NEWLINE_SEPARATOR + NEWLINE_SEPARATOR;\n", "import {CLIENT, MAX_RETRIES, MIN_RETRIES} from './constants';\n\nexport function formatErrorMessage(message: string, client = CLIENT) {\n  return message.startsWith(`${client}`) ? message : `${client}: ${message}`;\n}\n\nexport function getErrorMessage(error: any) {\n  return error instanceof Error ? error.message : JSON.stringify(error);\n}\n\nexport function getErrorCause(error: any): Record<string, any> | undefined {\n  return error instanceof Error && error.cause ? error.cause : undefined;\n}\n\nexport function combineErrors(dataArray: Record<string, any>[]) {\n  return dataArray.flatMap(({errors}) => {\n    return errors ?? [];\n  });\n}\n\nexport function validateRetries({\n  client,\n  retries,\n}: {\n  client: string;\n  retries?: number;\n}) {\n  if (\n    retries !== undefined &&\n    (typeof retries !== 'number' ||\n      retries < MIN_RETRIES ||\n      retries > MAX_RETRIES)\n  ) {\n    throw new Error(\n      `${client}: The provided \"retries\" value (${retries}) is invalid - it cannot be less than ${MIN_RETRIES} or greater than ${MAX_RETRIES}`,\n    );\n  }\n}\n\nexport function getKeyValueIfValid(key: string, value?: any) {\n  return value &&\n    (typeof value !== 'object' ||\n      Array.isArray(value) ||\n      (typeof value === 'object' && Object.keys(value).length > 0))\n    ? {[key]: value}\n    : {};\n}\n\nexport function buildDataObjectByPath(\n  path: string[],\n  data: any,\n): Record<string | number, any> {\n  if (path.length === 0) {\n    return data;\n  }\n\n  const key = path.pop() as string | number;\n  const newData = {\n    [key]: data,\n  };\n\n  if (path.length === 0) {\n    return newData;\n  }\n\n  return buildDataObjectByPath(path, newData);\n}\n\nfunction combineObjects(baseObject: any, newObject: any) {\n  return Object.keys(newObject || {}).reduce(\n    (acc: any, key: string | number) => {\n      if (\n        (typeof newObject[key] === 'object' || Array.isArray(newObject[key])) &&\n        baseObject[key]\n      ) {\n        acc[key] = combineObjects(baseObject[key], newObject[key]);\n        return acc;\n      }\n\n      acc[key] = newObject[key];\n      return acc;\n    },\n    Array.isArray(baseObject) ? [...baseObject] : {...baseObject},\n  );\n}\n\nexport function buildCombinedDataObject([\n  initialDatum,\n  ...remainingData\n]: any[]) {\n  return remainingData.reduce(combineObjects, {...initialDatum});\n}\n", "import {CLIENT, RETRIABLE_STATUS_CODES, RETRY_WAIT_TIME} from './constants';\nimport {CustomFetchApi, GraphQLClient, Logger} from './types';\nimport {formatErrorMessage, getErrorMessage} from './utilities';\n\ninterface GenerateHttpFetchOptions {\n  clientLogger: Logger;\n  customFetchApi?: CustomFetchApi;\n  client?: string;\n  defaultRetryWaitTime?: number;\n  retriableCodes?: number[];\n}\n\nexport function generateHttpFetch({\n  clientLogger,\n  customFetchApi = fetch,\n  client = CLIENT,\n  defaultRetryWaitTime = RETRY_WAIT_TIME,\n  retriableCodes = RETRIABLE_STATUS_CODES,\n}: GenerateHttpFetchOptions) {\n  const httpFetch = async (\n    requestParams: Parameters<CustomFetchApi>,\n    count: number,\n    maxRetries: number,\n  ): ReturnType<GraphQLClient['fetch']> => {\n    const nextCount = count + 1;\n    const maxTries = maxRetries + 1;\n    let response: Response | undefined;\n\n    try {\n      response = await customFetchApi(...requestParams);\n\n      clientLogger({\n        type: 'HTTP-Response',\n        content: {\n          requestParams,\n          response,\n        },\n      });\n\n      if (\n        !response.ok &&\n        retriableCodes.includes(response.status) &&\n        nextCount <= maxTries\n      ) {\n        throw new Error();\n      }\n\n      const deprecationNotice =\n        response?.headers.get('X-Shopify-API-Deprecated-Reason') || '';\n      if (deprecationNotice) {\n        clientLogger({\n          type: 'HTTP-Response-GraphQL-Deprecation-Notice',\n          content: {\n            requestParams,\n            deprecationNotice,\n          },\n        });\n      }\n\n      return response;\n    } catch (error) {\n      if (nextCount <= maxTries) {\n        const retryAfter = response?.headers.get('Retry-After');\n        await sleep(\n          retryAfter ? parseInt(retryAfter, 10) : defaultRetryWaitTime,\n        );\n\n        clientLogger({\n          type: 'HTTP-Retry',\n          content: {\n            requestParams,\n            lastResponse: response,\n            retryAttempt: count,\n            maxRetries,\n          },\n        });\n\n        return httpFetch(requestParams, nextCount, maxRetries);\n      }\n\n      throw new Error(\n        formatErrorMessage(\n          `${\n            maxRetries > 0\n              ? `Attempted maximum number of ${maxRetries} network retries. Last message - `\n              : ''\n          }${getErrorMessage(error)}`,\n          client,\n        ),\n      );\n    }\n  };\n\n  return httpFetch;\n}\n\nasync function sleep(waitTime: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, waitTime));\n}\n", "import {generateHttpFetch} from './http-fetch';\nimport {\n  ClientOptions,\n  CustomFetchApi,\n  GraphQLClient,\n  ClientResponse,\n  ClientConfig,\n  Logger,\n  LogContentTypes,\n  DataChunk,\n} from './types';\nimport {\n  CLIENT,\n  GQL_API_ERROR,\n  UNEXPECTED_CONTENT_TYPE_ERROR,\n  NO_DATA_OR_ERRORS_ERROR,\n  CONTENT_TYPES,\n  RETRY_WAIT_TIME,\n  HEADER_SEPARATOR,\n  DEFER_OPERATION_REGEX,\n  BOUNDARY_HEADER_REGEX,\n  SDK_VARIANT_HEADER,\n  SDK_VERSION_HEADER,\n  DEFAULT_SDK_VARIANT,\n  DEFAULT_CLIENT_VERSION,\n} from './constants';\nimport {\n  formatErrorMessage,\n  getErrorMessage,\n  validateRetries,\n  getKeyValueIfValid,\n  buildDataObjectByPath,\n  buildCombinedDataObject,\n  getErrorCause,\n  combineErrors,\n} from './utilities';\n\nexport function createGraphQLClient({\n  headers,\n  url,\n  customFetchApi = fetch,\n  retries = 0,\n  logger,\n}: ClientOptions): GraphQLClient {\n  validateRetries({client: CLIENT, retries});\n\n  const config: ClientConfig = {\n    headers,\n    url,\n    retries,\n  };\n\n  const clientLogger = generateClientLogger(logger);\n  const httpFetch = generateHttpFetch({\n    customFetchApi,\n    clientLogger,\n    defaultRetryWaitTime: RETRY_WAIT_TIME,\n  });\n  const fetchFn = generateFetch(httpFetch, config);\n  const request = generateRequest(fetchFn);\n  const requestStream = generateRequestStream(fetchFn);\n\n  return {\n    config,\n    fetch: fetchFn,\n    request,\n    requestStream,\n  };\n}\n\nexport function generateClientLogger(logger?: Logger): Logger {\n  return (logContent: LogContentTypes) => {\n    if (logger) {\n      logger(logContent);\n    }\n  };\n}\n\nasync function processJSONResponse<TData = any>(\n  response: Response,\n): Promise<ClientResponse<TData>> {\n  const {errors, data, extensions} = await response.json<any>();\n\n  return {\n    ...getKeyValueIfValid('data', data),\n    ...getKeyValueIfValid('extensions', extensions),\n    headers: response.headers,\n\n    ...(errors || !data\n      ? {\n          errors: {\n            networkStatusCode: response.status,\n            message: formatErrorMessage(\n              errors ? GQL_API_ERROR : NO_DATA_OR_ERRORS_ERROR,\n            ),\n            ...getKeyValueIfValid('graphQLErrors', errors),\n            response,\n          },\n        }\n      : {}),\n  };\n}\n\nfunction generateFetch(\n  httpFetch: ReturnType<typeof generateHttpFetch>,\n  {url, headers, retries}: ClientConfig,\n): GraphQLClient['fetch'] {\n  return async (operation, options = {}) => {\n    const {\n      variables,\n      headers: overrideHeaders,\n      url: overrideUrl,\n      retries: overrideRetries,\n      keepalive,\n      signal,\n    } = options;\n\n    const body = JSON.stringify({\n      query: operation,\n      variables,\n    });\n\n    validateRetries({client: CLIENT, retries: overrideRetries});\n\n    const flatHeaders = Object.entries({\n      ...headers,\n      ...overrideHeaders,\n    }).reduce((headers: Record<string, string>, [key, value]) => {\n      headers[key] = Array.isArray(value) ? value.join(', ') : value.toString();\n      return headers;\n    }, {});\n\n    if (!flatHeaders[SDK_VARIANT_HEADER] && !flatHeaders[SDK_VERSION_HEADER]) {\n      flatHeaders[SDK_VARIANT_HEADER] = DEFAULT_SDK_VARIANT;\n      flatHeaders[SDK_VERSION_HEADER] = DEFAULT_CLIENT_VERSION;\n    }\n\n    const fetchParams: Parameters<CustomFetchApi> = [\n      overrideUrl ?? url,\n      {\n        method: 'POST',\n        headers: flatHeaders,\n        body,\n        signal,\n        keepalive,\n      },\n    ];\n\n    return httpFetch(fetchParams, 1, overrideRetries ?? retries);\n  };\n}\n\nfunction generateRequest(\n  fetchFn: ReturnType<typeof generateFetch>,\n): GraphQLClient['request'] {\n  return async (...props) => {\n    if (DEFER_OPERATION_REGEX.test(props[0])) {\n      throw new Error(\n        formatErrorMessage(\n          'This operation will result in a streamable response - use requestStream() instead.',\n        ),\n      );\n    }\n\n    let response: Response | null = null;\n    try {\n      response = await fetchFn(...props);\n      const {status, statusText} = response;\n      const contentType = response.headers.get('content-type') || '';\n\n      if (!response.ok) {\n        return {\n          errors: {\n            networkStatusCode: status,\n            message: formatErrorMessage(statusText),\n            response,\n          },\n        };\n      }\n\n      if (!contentType.includes(CONTENT_TYPES.json)) {\n        return {\n          errors: {\n            networkStatusCode: status,\n            message: formatErrorMessage(\n              `${UNEXPECTED_CONTENT_TYPE_ERROR} ${contentType}`,\n            ),\n            response,\n          },\n        };\n      }\n\n      return await processJSONResponse(response);\n    } catch (error) {\n      return {\n        errors: {\n          message: getErrorMessage(error),\n          ...(response == null\n            ? {}\n            : {\n                networkStatusCode: response.status,\n                response,\n              }),\n        },\n      };\n    }\n  };\n}\n\nasync function* getStreamBodyIterator(\n  response: Response,\n): AsyncIterableIterator<string> {\n  const decoder = new TextDecoder();\n\n  // Response body is an async iterator\n  if ((response.body as any)![Symbol.asyncIterator]) {\n    for await (const chunk of response.body! as any) {\n      yield decoder.decode(chunk);\n    }\n  } else {\n    const reader = response.body!.getReader();\n\n    let readResult: ReadableStreamReadResult<DataChunk>;\n    try {\n      while (!(readResult = await reader.read()).done) {\n        yield decoder.decode(readResult.value);\n      }\n    } finally {\n      reader.cancel();\n    }\n  }\n}\n\nfunction readStreamChunk(\n  streamBodyIterator: AsyncIterableIterator<string>,\n  boundary: string,\n) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      try {\n        let buffer = '';\n\n        for await (const textChunk of streamBodyIterator) {\n          buffer += textChunk;\n\n          if (buffer.indexOf(boundary) > -1) {\n            const lastBoundaryIndex = buffer.lastIndexOf(boundary);\n            const fullResponses = buffer.slice(0, lastBoundaryIndex);\n\n            const chunkBodies = fullResponses\n              .split(boundary)\n              .filter((chunk) => chunk.trim().length > 0)\n              .map((chunk) => {\n                const body = chunk\n                  .slice(\n                    chunk.indexOf(HEADER_SEPARATOR) + HEADER_SEPARATOR.length,\n                  )\n                  .trim();\n                return body;\n              });\n\n            if (chunkBodies.length > 0) {\n              yield chunkBodies;\n            }\n\n            buffer = buffer.slice(lastBoundaryIndex + boundary.length);\n\n            if (buffer.trim() === `--`) {\n              buffer = '';\n            }\n          }\n        }\n      } catch (error) {\n        throw new Error(\n          `Error occured while processing stream payload - ${getErrorMessage(\n            error,\n          )}`,\n        );\n      }\n    },\n  };\n}\n\nfunction createJsonResponseAsyncIterator(response: Response) {\n  return {\n    async *[Symbol.asyncIterator]() {\n      const processedResponse = await processJSONResponse(response);\n\n      yield {\n        ...processedResponse,\n        hasNext: false,\n      };\n    },\n  };\n}\n\nfunction getResponseDataFromChunkBodies(chunkBodies: string[]): {\n  data: any;\n  errors?: any;\n  extensions?: any;\n  hasNext: boolean;\n}[] {\n  return chunkBodies\n    .map((value) => {\n      try {\n        return JSON.parse(value);\n      } catch (error) {\n        throw new Error(\n          `Error in parsing multipart response - ${getErrorMessage(error)}`,\n        );\n      }\n    })\n    .map((payload) => {\n      const {data, incremental, hasNext, extensions, errors} = payload;\n\n      // initial data chunk\n      if (!incremental) {\n        return {\n          data: data || {},\n          ...getKeyValueIfValid('errors', errors),\n          ...getKeyValueIfValid('extensions', extensions),\n          hasNext,\n        };\n      }\n\n      // subsequent data chunks\n      const incrementalArray: {data: any; errors?: any}[] = incremental.map(\n        ({data, path, errors}: any) => {\n          return {\n            data: data && path ? buildDataObjectByPath(path, data) : {},\n            ...getKeyValueIfValid('errors', errors),\n          };\n        },\n      );\n\n      return {\n        data:\n          incrementalArray.length === 1\n            ? incrementalArray[0].data\n            : buildCombinedDataObject([\n                ...incrementalArray.map(({data}) => data),\n              ]),\n        ...getKeyValueIfValid('errors', combineErrors(incrementalArray)),\n        hasNext,\n      };\n    });\n}\n\nfunction validateResponseData(\n  responseErrors: any[],\n  combinedData: ReturnType<typeof buildCombinedDataObject>,\n) {\n  if (responseErrors.length > 0) {\n    throw new Error(GQL_API_ERROR, {\n      cause: {\n        graphQLErrors: responseErrors,\n      },\n    });\n  }\n\n  if (Object.keys(combinedData).length === 0) {\n    throw new Error(NO_DATA_OR_ERRORS_ERROR);\n  }\n}\n\nfunction createMultipartResponseAsyncInterator(\n  response: Response,\n  responseContentType: string,\n) {\n  const boundaryHeader = (responseContentType ?? '').match(\n    BOUNDARY_HEADER_REGEX,\n  );\n  const boundary = `--${boundaryHeader ? boundaryHeader[1] : '-'}`;\n\n  if (\n    !response.body?.getReader &&\n    !(response.body as any)?.[Symbol.asyncIterator]\n  ) {\n    throw new Error('API multipart response did not return an iterable body', {\n      cause: response,\n    });\n  }\n\n  const streamBodyIterator = getStreamBodyIterator(response);\n\n  let combinedData: Record<string, any> = {};\n  let responseExtensions: Record<string, any> | undefined;\n\n  return {\n    async *[Symbol.asyncIterator]() {\n      try {\n        let streamHasNext = true;\n\n        for await (const chunkBodies of readStreamChunk(\n          streamBodyIterator,\n          boundary,\n        )) {\n          const responseData = getResponseDataFromChunkBodies(chunkBodies);\n\n          responseExtensions =\n            responseData.find((datum) => datum.extensions)?.extensions ??\n            responseExtensions;\n\n          const responseErrors = combineErrors(responseData);\n\n          combinedData = buildCombinedDataObject([\n            combinedData,\n            ...responseData.map(({data}) => data),\n          ]);\n\n          streamHasNext = responseData.slice(-1)[0].hasNext;\n\n          validateResponseData(responseErrors, combinedData);\n\n          yield {\n            ...getKeyValueIfValid('data', combinedData),\n            ...getKeyValueIfValid('extensions', responseExtensions),\n            hasNext: streamHasNext,\n          };\n        }\n\n        if (streamHasNext) {\n          throw new Error(`Response stream terminated unexpectedly`);\n        }\n      } catch (error) {\n        const cause = getErrorCause(error);\n\n        yield {\n          ...getKeyValueIfValid('data', combinedData),\n          ...getKeyValueIfValid('extensions', responseExtensions),\n          errors: {\n            message: formatErrorMessage(getErrorMessage(error)),\n            networkStatusCode: response.status,\n            ...getKeyValueIfValid('graphQLErrors', cause?.graphQLErrors),\n            response,\n          },\n          hasNext: false,\n        };\n      }\n    },\n  };\n}\n\nfunction generateRequestStream(\n  fetchFn: ReturnType<typeof generateFetch>,\n): GraphQLClient['requestStream'] {\n  return async (...props) => {\n    if (!DEFER_OPERATION_REGEX.test(props[0])) {\n      throw new Error(\n        formatErrorMessage(\n          'This operation does not result in a streamable response - use request() instead.',\n        ),\n      );\n    }\n\n    try {\n      const response = await fetchFn(...props);\n\n      const {statusText} = response;\n\n      if (!response.ok) {\n        throw new Error(statusText, {cause: response});\n      }\n\n      const responseContentType = response.headers.get('content-type') || '';\n\n      switch (true) {\n        case responseContentType.includes(CONTENT_TYPES.json):\n          return createJsonResponseAsyncIterator(response);\n        case responseContentType.includes(CONTENT_TYPES.multipart):\n          return createMultipartResponseAsyncInterator(\n            response,\n            responseContentType,\n          );\n        default:\n          throw new Error(\n            `${UNEXPECTED_CONTENT_TYPE_ERROR} ${responseContentType}`,\n            {cause: response},\n          );\n      }\n    } catch (error) {\n      return {\n        async *[Symbol.asyncIterator]() {\n          const response = getErrorCause(error);\n\n          yield {\n            errors: {\n              message: formatErrorMessage(getErrorMessage(error)),\n              ...getKeyValueIfValid('networkStatusCode', response?.status),\n              ...getKeyValueIfValid('response', response),\n            },\n            hasNext: false,\n          };\n        },\n      };\n    }\n  };\n}\n", "import {ApiClientLogger} from './types';\n\nexport function validateDomainAndGetStoreUrl({\n  client,\n  storeDomain,\n}: {\n  client: string;\n  storeDomain: string | undefined;\n}) {\n  try {\n    if (!storeDomain || typeof storeDomain !== 'string') {\n      throw new Error();\n    }\n\n    const trimmedDomain = storeDomain.trim();\n\n    const protocolUrl = trimmedDomain.match(/^https?:/)\n      ? trimmedDomain\n      : `https://${trimmedDomain}`;\n\n    const url = new URL(protocolUrl);\n    url.protocol = 'https';\n\n    return url.origin;\n  } catch (error) {\n    throw new Error(\n      `${client}: a valid store domain (\"${storeDomain}\") must be provided`,\n      {cause: error},\n    );\n  }\n}\n\nexport function validateApiVersion({\n  client,\n  currentSupportedApiVersions,\n  apiVersion,\n  logger,\n}: {\n  client: string;\n  currentSupportedApiVersions: string[];\n  apiVersion: string;\n  logger?: ApiClientLogger;\n}) {\n  const versionError = `${client}: the provided apiVersion (\"${apiVersion}\")`;\n  const supportedVersion = `Currently supported API versions: ${currentSupportedApiVersions.join(\n    ', ',\n  )}`;\n\n  if (!apiVersion || typeof apiVersion !== 'string') {\n    throw new Error(`${versionError} is invalid. ${supportedVersion}`);\n  }\n\n  const trimmedApiVersion = apiVersion.trim();\n\n  if (!currentSupportedApiVersions.includes(trimmedApiVersion)) {\n    if (logger) {\n      logger({\n        type: 'Unsupported_Api_Version',\n        content: {\n          apiVersion,\n          supportedApiVersions: currentSupportedApiVersions,\n        },\n      });\n    } else {\n      console.warn(\n        `${versionError} is likely deprecated or not supported. ${supportedVersion}`,\n      );\n    }\n  }\n}\n", "function getQuarterMonth(quarter: number) {\n  const month = quarter * 3 - 2;\n  return month === 10 ? month : `0${month}`;\n}\n\nfunction getPrevousVersion(year: number, quarter: number, nQuarter: number) {\n  const versionQuarter = quarter - nQuarter;\n\n  if (versionQuarter <= 0) {\n    return `${year - 1}-${getQuarterMonth(versionQuarter + 4)}`;\n  }\n\n  return `${year}-${getQuarterMonth(versionQuarter)}`;\n}\n\nexport function getCurrentApiVersion() {\n  const date = new Date();\n  const month = date.getUTCMonth();\n  const year = date.getUTCFullYear();\n\n  const quarter = Math.floor(month / 3 + 1);\n\n  return {\n    year,\n    quarter,\n    version: `${year}-${getQuarterMonth(quarter)}`,\n  };\n}\n\nexport function getCurrentSupportedApiVersions() {\n  const {year, quarter, version: currentVersion} = getCurrentApiVersion();\n\n  const nextVersion =\n    quarter === 4\n      ? `${year + 1}-01`\n      : `${year}-${getQuarterMonth(quarter + 1)}`;\n\n  return [\n    getPrevousVersion(year, quarter, 3),\n    getPrevousVersion(year, quarter, 2),\n    getPrevousVersion(year, quarter, 1),\n    currentVersion,\n    nextVersion,\n    'unstable',\n  ];\n}\n", "import {RequestParams} from '../graphql-client/types';\n\nimport {\n  AllOperations,\n  ApiClient,\n  ApiClientConfig,\n  ApiClientRequestOptions,\n} from './types';\n\nexport function generateGetHeaders(\n  config: ApiClientConfig,\n): ApiClient['getHeaders'] {\n  return (customHeaders) => {\n    return {...(customHeaders ?? {}), ...config.headers};\n  };\n}\n\nexport function generateGetGQLClientParams<\n  Operations extends AllOperations = AllOperations,\n>({getHeaders, getApiUrl}: Pick<ApiClient, 'getHeaders' | 'getApiUrl'>) {\n  return <Operation extends keyof Operations>(\n    operation: Operation,\n    options?: ApiClientRequestOptions<Operation, Operations>,\n  ): RequestParams => {\n    const props: RequestParams = [operation as string];\n\n    if (options && Object.keys(options).length > 0) {\n      const {\n        variables,\n        apiVersion: propApiVersion,\n        headers,\n        retries,\n        signal,\n      } = options as any;\n\n      props.push({\n        ...(variables ? {variables} : {}),\n        ...(headers ? {headers: getHeaders(headers)} : {}),\n        ...(propApiVersion ? {url: getApiUrl(propApiVersion)} : {}),\n        ...(retries ? {retries} : {}),\n        ...(signal ? {signal} : {}),\n      });\n    }\n\n    return props;\n  };\n}\n", "export const DEFAULT_CONTENT_TYPE = 'application/json';\n// This is value is replaced with package.json version during rollup build process\nexport const DEFAULT_CLIENT_VERSION = 'ROLLUP_REPLACE_CLIENT_VERSION';\nexport const ACCESS_TOKEN_HEADER = 'X-Shopify-Access-Token';\nexport const CLIENT = 'Admin API Client';\nexport const RETRIABLE_STATUS_CODES = [429, 500, 503];\nexport const DEFAULT_RETRY_WAIT_TIME = 1000;\n", "import {CLIENT} from './constants';\n\nexport function validateRequiredStoreDomain(storeDomain: string | undefined) {\n  if (\n    !storeDomain ||\n    typeof storeDomain !== 'string' ||\n    storeDomain.trim().length < 1\n  ) {\n    throw new Error(`${CLIENT}: a valid store domain must be provided`);\n  }\n}\n\nexport function validateRequiredAccessToken(accessToken: string) {\n  if (!accessToken) {\n    throw new Error(`${CLIENT}: an access token must be provided`);\n  }\n}\n\nexport function validateServerSideUsage(isTesting = false) {\n  if (typeof window !== 'undefined' && !isTesting) {\n    throw new Error(`${CLIENT}: this client should not be used in the browser`);\n  }\n}\n", "import {\n  createGraphQLClient,\n  getCurrentSupportedApiVersions,\n  validateApiVersion,\n  validateDomainAndGetStoreUrl,\n  generateGetGQLClientParams,\n  generateGetHeaders,\n} from '@shopify/graphql-client';\n\nimport {\n  DEFAULT_CONTENT_TYPE,\n  ACCESS_TOKEN_HEADER,\n  CLIENT,\n  DEFAULT_CLIENT_VERSION,\n} from '../constants';\nimport {\n  validateRequiredAccessToken,\n  validateServerSideUsage,\n} from '../validations';\nimport {AdminApiClientConfig, AdminApiClientOptions} from '../types';\n\nimport {AdminApiClient, AdminOperations} from './types';\n\nexport function createAdminApiClient({\n  storeDomain,\n  apiVersion,\n  accessToken,\n  userAgentPrefix,\n  retries = 0,\n  customFetchApi,\n  logger,\n  isTesting,\n}: AdminApiClientOptions): AdminApiClient {\n  const currentSupportedApiVersions = getCurrentSupportedApiVersions();\n\n  const storeUrl = validateDomainAndGetStoreUrl({\n    client: CLIENT,\n    storeDomain,\n  });\n\n  const baseApiVersionValidationParams = {\n    client: CLIENT,\n    currentSupportedApiVersions,\n    logger,\n  };\n\n  validateServerSideUsage(isTesting);\n  validateApiVersion({\n    client: CLIENT,\n    currentSupportedApiVersions,\n    apiVersion,\n    logger,\n  });\n  validateRequiredAccessToken(accessToken);\n\n  const apiUrlFormatter = generateApiUrlFormatter(\n    storeUrl,\n    apiVersion,\n    baseApiVersionValidationParams,\n  );\n\n  const config: AdminApiClientConfig = {\n    storeDomain: storeUrl,\n    apiVersion,\n    accessToken,\n    headers: {\n      'Content-Type': DEFAULT_CONTENT_TYPE,\n      Accept: DEFAULT_CONTENT_TYPE,\n      [ACCESS_TOKEN_HEADER]: accessToken,\n      'User-Agent': `${\n        userAgentPrefix ? `${userAgentPrefix} | ` : ''\n      }${CLIENT} v${DEFAULT_CLIENT_VERSION}`,\n    },\n    apiUrl: apiUrlFormatter(),\n    userAgentPrefix,\n  };\n\n  const graphqlClient = createGraphQLClient({\n    headers: config.headers,\n    url: config.apiUrl,\n    retries,\n    customFetchApi,\n    logger,\n  });\n\n  const getHeaders = generateGetHeaders(config);\n  const getApiUrl = generateGetApiUrl(config, apiUrlFormatter);\n\n  const getGQLClientParams = generateGetGQLClientParams<AdminOperations>({\n    getHeaders,\n    getApiUrl,\n  });\n\n  const client: AdminApiClient = {\n    config,\n    getHeaders,\n    getApiUrl,\n    fetch: (...props) => {\n      return graphqlClient.fetch(...getGQLClientParams(...props));\n    },\n    request: (...props) => {\n      return graphqlClient.request(...getGQLClientParams(...props));\n    },\n  };\n\n  return Object.freeze(client);\n}\n\nfunction generateApiUrlFormatter(\n  storeUrl: string,\n  defaultApiVersion: string,\n  baseApiVersionValidationParams: Omit<\n    Parameters<typeof validateApiVersion>[0],\n    'apiVersion'\n  >,\n) {\n  return (apiVersion?: string) => {\n    if (apiVersion) {\n      validateApiVersion({\n        ...baseApiVersionValidationParams,\n        apiVersion,\n      });\n    }\n\n    const urlApiVersion = (apiVersion ?? defaultApiVersion).trim();\n\n    return `${storeUrl}/admin/api/${urlApiVersion}/graphql.json`;\n  };\n}\n\nfunction generateGetApiUrl(\n  config: AdminApiClientConfig,\n  apiUrlFormatter: (version?: string) => string,\n): AdminApiClient['getApiUrl'] {\n  return (propApiVersion?: string) => {\n    return propApiVersion ? apiUrlFormatter(propApiVersion) : config.apiUrl;\n  };\n}\n", "import {CustomFetchApi} from '@shopify/graphql-client';\n\nimport {AdminApiClientOptions} from '../types';\n\nexport enum Method {\n  Get = 'GET',\n  Post = 'POST',\n  Put = 'PUT',\n  Delete = 'DELETE',\n}\n\ntype SearchParamField = string | number;\nexport type SearchParamFields =\n  | SearchParamField\n  | SearchParamField[]\n  | Record<string, SearchParamField | SearchParamField[]>;\nexport type SearchParams = Record<string, SearchParamFields>;\n\nexport type HeaderOptions = Record<string, string | number | string[]>;\n\nexport interface GetRequestOptions {\n  headers?: HeaderOptions;\n  data?: Record<string, any> | string;\n  searchParams?: SearchParams;\n  retries?: number;\n  apiVersion?: string;\n}\n\nexport interface PostRequestOptions extends GetRequestOptions {\n  data: Required<GetRequestOptions>['data'];\n}\n\nexport interface PutRequestOptions extends PostRequestOptions {}\n\nexport interface DeleteRequestOptions extends GetRequestOptions {}\n\nexport interface AdminRestApiClientOptions extends AdminApiClientOptions {\n  scheme?: 'https' | 'http';\n  defaultRetryTime?: number;\n  formatPaths?: boolean;\n}\n\nexport type RequestOptions = (GetRequestOptions | PostRequestOptions) & {\n  method: Method;\n};\n\nexport interface AdminRestApiClient {\n  get: (\n    path: string,\n    options?: GetRequestOptions,\n  ) => ReturnType<CustomFetchApi>;\n  put: (\n    path: string,\n    options?: PutRequestOptions,\n  ) => ReturnType<CustomFetchApi>;\n  post: (\n    path: string,\n    options?: PostRequestOptions,\n  ) => ReturnType<CustomFetchApi>;\n  delete: (\n    path: string,\n    options?: DeleteRequestOptions,\n  ) => ReturnType<CustomFetchApi>;\n}\n", "import {\n  CustomFetchApi,\n  LogContentTypes,\n  Logger,\n  generateHttpFetch,\n  getCurrentSupportedApiVersions,\n  validateApiVersion,\n  validateDomainAndGetStoreUrl,\n  validateRetries,\n} from '@shopify/graphql-client';\n\nimport {\n  validateRequiredAccessToken,\n  validateServerSideUsage,\n} from '../validations';\nimport {\n  ACCESS_TOKEN_HEADER,\n  CLIENT,\n  DEFAULT_CLIENT_VERSION,\n  DEFAULT_CONTENT_TYPE,\n  DEFAULT_RETRY_WAIT_TIME,\n  RETRIABLE_STATUS_CODES,\n} from '../constants';\n\nimport {\n  AdminRestApiClient,\n  AdminRestApiClientOptions,\n  DeleteRequestOptions,\n  GetRequestOptions,\n  HeaderOptions,\n  Method,\n  PostRequestOptions,\n  PutRequestOptions,\n  RequestOptions,\n  SearchParamFields,\n  SearchParams,\n} from './types';\n\nexport function createAdminRestApiClient({\n  storeDomain,\n  apiVersion,\n  accessToken,\n  userAgentPrefix,\n  logger,\n  customFetchApi = fetch,\n  retries: clientRetries = 0,\n  scheme = 'https',\n  defaultRetryTime = DEFAULT_RETRY_WAIT_TIME,\n  formatPaths = true,\n  isTesting,\n}: AdminRestApiClientOptions): AdminRestApiClient {\n  const currentSupportedApiVersions = getCurrentSupportedApiVersions();\n\n  const storeUrl = validateDomainAndGetStoreUrl({\n    client: CLIENT,\n    storeDomain,\n  }).replace('https://', `${scheme}://`);\n\n  const baseApiVersionValidationParams = {\n    client: CLIENT,\n    currentSupportedApiVersions,\n    logger,\n  };\n\n  validateServerSideUsage(isTesting);\n  validateApiVersion({\n    client: CLIENT,\n    currentSupportedApiVersions,\n    apiVersion,\n    logger,\n  });\n  validateRequiredAccessToken(accessToken);\n  validateRetries({client: CLIENT, retries: clientRetries});\n\n  const apiUrlFormatter = generateApiUrlFormatter(\n    storeUrl,\n    apiVersion,\n    baseApiVersionValidationParams,\n    formatPaths,\n  );\n  const clientLogger = generateClientLogger(logger);\n  const httpFetch = generateHttpFetch({\n    customFetchApi,\n    clientLogger,\n    defaultRetryWaitTime: defaultRetryTime,\n    client: CLIENT,\n    retriableCodes: RETRIABLE_STATUS_CODES,\n  });\n\n  const request = async (\n    path: string,\n    {\n      method,\n      data,\n      headers: requestHeadersObj,\n      searchParams,\n      retries = 0,\n      apiVersion,\n    }: RequestOptions,\n  ): ReturnType<CustomFetchApi> => {\n    validateRetries({client: CLIENT, retries});\n\n    const url = apiUrlFormatter(path, searchParams ?? {}, apiVersion);\n\n    const requestHeaders = normalizedHeaders(requestHeadersObj ?? {});\n    const userAgent = [\n      ...(requestHeaders['user-agent'] ? [requestHeaders['user-agent']] : []),\n      ...(userAgentPrefix ? [userAgentPrefix] : []),\n      `${CLIENT} v${DEFAULT_CLIENT_VERSION}`,\n    ].join(' | ');\n\n    const headers = normalizedHeaders({\n      'Content-Type': DEFAULT_CONTENT_TYPE,\n      ...requestHeaders,\n      Accept: DEFAULT_CONTENT_TYPE,\n      [ACCESS_TOKEN_HEADER]: accessToken,\n      'User-Agent': userAgent,\n    });\n\n    const body = data && typeof data !== 'string' ? JSON.stringify(data) : data;\n\n    return httpFetch(\n      [url, {method, headers, ...(body ? {body} : undefined)}],\n      1,\n      retries ?? clientRetries,\n    );\n  };\n\n  return {\n    get: (path: string, options?: GetRequestOptions) =>\n      request(path, {method: Method.Get, ...options}),\n    put: (path: string, options?: PutRequestOptions) =>\n      request(path, {method: Method.Put, ...options}),\n    post: (path: string, options?: PostRequestOptions) =>\n      request(path, {method: Method.Post, ...options}),\n    delete: (path: string, options?: DeleteRequestOptions) =>\n      request(path, {method: Method.Delete, ...options}),\n  };\n}\n\nfunction generateApiUrlFormatter(\n  storeUrl: string,\n  defaultApiVersion: string,\n  baseApiVersionValidationParams: Omit<\n    Parameters<typeof validateApiVersion>[0],\n    'apiVersion'\n  >,\n  formatPaths = true,\n) {\n  return (path: string, searchParams: SearchParams, apiVersion?: string) => {\n    if (apiVersion) {\n      validateApiVersion({\n        ...baseApiVersionValidationParams,\n        apiVersion,\n      });\n    }\n\n    function convertValue(\n      params: URLSearchParams,\n      key: string,\n      value: SearchParamFields,\n    ) {\n      if (Array.isArray(value)) {\n        value.forEach((arrayValue) =>\n          convertValue(params, `${key}[]`, arrayValue),\n        );\n        return;\n      } else if (typeof value === 'object') {\n        Object.entries(value).forEach(([objKey, objValue]) =>\n          convertValue(params, `${key}[${objKey}]`, objValue),\n        );\n        return;\n      }\n\n      params.append(key, String(value));\n    }\n\n    const urlApiVersion = (apiVersion ?? defaultApiVersion).trim();\n    let cleanPath = path.replace(/^\\//, '');\n    if (formatPaths) {\n      if (!cleanPath.startsWith('admin')) {\n        cleanPath = `admin/api/${urlApiVersion}/${cleanPath}`;\n      }\n      if (!cleanPath.endsWith('.json')) {\n        cleanPath = `${cleanPath}.json`;\n      }\n    }\n\n    const params = new URLSearchParams();\n    if (searchParams) {\n      for (const [key, value] of Object.entries(searchParams)) {\n        convertValue(params, key, value);\n      }\n    }\n    const queryString = params.toString() ? `?${params.toString()}` : '';\n\n    return `${storeUrl}/${cleanPath}${queryString}`;\n  };\n}\n\nfunction generateClientLogger(logger?: Logger): Logger {\n  return (logContent: LogContentTypes) => {\n    if (logger) {\n      logger(logContent);\n    }\n  };\n}\n\nfunction normalizedHeaders(headersObj: HeaderOptions): Record<string, string> {\n  const normalizedHeaders: Record<string, string> = {};\n  for (const [key, value] of Object.entries(headersObj)) {\n    normalizedHeaders[key.toLowerCase()] = Array.isArray(value)\n      ? value.join(', ')\n      : String(value);\n  }\n  return normalizedHeaders;\n}\n", "let Method;\n(function (Method) {\n  Method[\"Get\"] = \"GET\";\n  Method[\"Post\"] = \"POST\";\n  Method[\"Put\"] = \"PUT\";\n  Method[\"Patch\"] = \"PATCH\";\n  Method[\"Delete\"] = \"DELETE\";\n  Method[\"Head\"] = \"HEAD\";\n  Method[\"Options\"] = \"OPTIONS\";\n  Method[\"Connect\"] = \"CONNECT\";\n})(Method || (Method = {}));\nlet StatusCode;\n\n// Keep this sorted\n(function (StatusCode) {\n  StatusCode[StatusCode[\"Continue\"] = 100] = \"Continue\";\n  StatusCode[StatusCode[\"SwitchingProtocols\"] = 101] = \"SwitchingProtocols\";\n  StatusCode[StatusCode[\"Ok\"] = 200] = \"Ok\";\n  StatusCode[StatusCode[\"Created\"] = 201] = \"Created\";\n  StatusCode[StatusCode[\"Accepted\"] = 202] = \"Accepted\";\n  StatusCode[StatusCode[\"NonAuthoritativeInformation\"] = 203] = \"NonAuthoritativeInformation\";\n  StatusCode[StatusCode[\"NoContent\"] = 204] = \"NoContent\";\n  StatusCode[StatusCode[\"ResetContent\"] = 205] = \"ResetContent\";\n  StatusCode[StatusCode[\"PartialContent\"] = 206] = \"PartialContent\";\n  StatusCode[StatusCode[\"MultipleChoices\"] = 300] = \"MultipleChoices\";\n  StatusCode[StatusCode[\"MovedPermanently\"] = 301] = \"MovedPermanently\";\n  StatusCode[StatusCode[\"Found\"] = 302] = \"Found\";\n  StatusCode[StatusCode[\"SeeOther\"] = 303] = \"SeeOther\";\n  StatusCode[StatusCode[\"NotModified\"] = 304] = \"NotModified\";\n  StatusCode[StatusCode[\"UseProxy\"] = 305] = \"UseProxy\";\n  StatusCode[StatusCode[\"TemporaryRedirect\"] = 307] = \"TemporaryRedirect\";\n  StatusCode[StatusCode[\"BadRequest\"] = 400] = \"BadRequest\";\n  StatusCode[StatusCode[\"Unauthorized\"] = 401] = \"Unauthorized\";\n  StatusCode[StatusCode[\"PaymentRequired\"] = 402] = \"PaymentRequired\";\n  StatusCode[StatusCode[\"Forbidden\"] = 403] = \"Forbidden\";\n  StatusCode[StatusCode[\"NotFound\"] = 404] = \"NotFound\";\n  StatusCode[StatusCode[\"MethodNotAllowed\"] = 405] = \"MethodNotAllowed\";\n  StatusCode[StatusCode[\"NotAcceptable\"] = 406] = \"NotAcceptable\";\n  StatusCode[StatusCode[\"ProxyAuthenticationRequired\"] = 407] = \"ProxyAuthenticationRequired\";\n  StatusCode[StatusCode[\"RequestTimeout\"] = 408] = \"RequestTimeout\";\n  StatusCode[StatusCode[\"Conflict\"] = 409] = \"Conflict\";\n  StatusCode[StatusCode[\"Gone\"] = 410] = \"Gone\";\n  StatusCode[StatusCode[\"LengthRequired\"] = 411] = \"LengthRequired\";\n  StatusCode[StatusCode[\"PreconditionFailed\"] = 412] = \"PreconditionFailed\";\n  StatusCode[StatusCode[\"RequestEntityTooLarge\"] = 413] = \"RequestEntityTooLarge\";\n  StatusCode[StatusCode[\"RequestUriTooLong\"] = 414] = \"RequestUriTooLong\";\n  StatusCode[StatusCode[\"UnsupportedMediaType\"] = 415] = \"UnsupportedMediaType\";\n  StatusCode[StatusCode[\"RequestedRangeNotSatisfiable\"] = 416] = \"RequestedRangeNotSatisfiable\";\n  StatusCode[StatusCode[\"ExpectationFailed\"] = 417] = \"ExpectationFailed\";\n  StatusCode[StatusCode[\"ImATeapot\"] = 418] = \"ImATeapot\";\n  StatusCode[StatusCode[\"UnprocessableEntity\"] = 422] = \"UnprocessableEntity\";\n  StatusCode[StatusCode[\"TooManyRequests\"] = 429] = \"TooManyRequests\";\n  StatusCode[StatusCode[\"InternalServerError\"] = 500] = \"InternalServerError\";\n  StatusCode[StatusCode[\"NotImplemented\"] = 501] = \"NotImplemented\";\n  StatusCode[StatusCode[\"BadGateway\"] = 502] = \"BadGateway\";\n  StatusCode[StatusCode[\"ServiceUnavailable\"] = 503] = \"ServiceUnavailable\";\n  StatusCode[StatusCode[\"GatewayTimeout\"] = 504] = \"GatewayTimeout\";\n  StatusCode[StatusCode[\"HttpVersionNotSupported\"] = 505] = \"HttpVersionNotSupported\";\n})(StatusCode || (StatusCode = {}));\nlet Header;\n(function (Header) {\n  Header[\"Accept\"] = \"Accept\";\n  Header[\"AcceptEncoding\"] = \"Accept-Encoding\";\n  Header[\"AcceptLanguage\"] = \"Accept-Language\";\n  Header[\"AccessControlAllowCredentials\"] = \"Access-Control-Allow-Credentials\";\n  Header[\"AccessControlAllowHeaders\"] = \"Access-Control-Allow-Headers\";\n  Header[\"AccessControlAllowMethods\"] = \"Access-Control-Allow-Methods\";\n  Header[\"AccessControlAllowOrigin\"] = \"Access-Control-Allow-Origin\";\n  Header[\"AccessControlExposeHeaders\"] = \"Access-Control-Expose-Headers\";\n  Header[\"AccessControlMaxAge\"] = \"Access-Control-Max-Age\";\n  Header[\"AccessControlRequestHeaders\"] = \"Access-Control-Request-Headers\";\n  Header[\"AccessControlRequestMethod\"] = \"Access-Control-Request-Method\";\n  Header[\"Authorization\"] = \"Authorization\";\n  Header[\"CacheControl\"] = \"Cache-Control\";\n  Header[\"CacheStatus\"] = \"Cache-Status\";\n  Header[\"Connection\"] = \"Connection\";\n  Header[\"ContentDisposition\"] = \"Content-Disposition\";\n  Header[\"ContentEncoding\"] = \"Content-Encoding\";\n  Header[\"ContentLength\"] = \"Content-Length\";\n  Header[\"ContentSecurityPolicy\"] = \"Content-Security-Policy\";\n  Header[\"ContentSecurityPolicyReportOnly\"] = \"Content-Security-Policy-Report-Only\";\n  Header[\"ContentType\"] = \"Content-Type\";\n  Header[\"ContentTypeOptions\"] = \"X-Content-Type-Options\";\n  Header[\"Cookie\"] = \"Cookie\";\n  Header[\"DownloadOptions\"] = \"X-Download-Options\";\n  Header[\"ETag\"] = \"ETag\";\n  Header[\"Forwarded\"] = \"Forwarded\";\n  Header[\"ForwardedFor\"] = \"X-Forwarded-For\";\n  Header[\"ForwardedHost\"] = \"X-Forwarded-Host\";\n  Header[\"ForwardedProtocol\"] = \"X-Forwarded-Proto\";\n  Header[\"FrameOptions\"] = \"X-Frame-Options\";\n  Header[\"Host\"] = \"Host\";\n  Header[\"IfNoneMatch\"] = \"If-None-Match\";\n  Header[\"Location\"] = \"Location\";\n  Header[\"Origin\"] = \"Origin\";\n  Header[\"ReferrerPolicy\"] = \"Referrer-Policy\";\n  Header[\"ServerTiming\"] = \"Server-Timing\";\n  Header[\"StrictTransportSecurity\"] = \"Strict-Transport-Security\";\n  Header[\"TimingAllowOrigin\"] = \"Timing-Allow-Origin\";\n  Header[\"Trailer\"] = \"Trailer\";\n  Header[\"TransferEncoding\"] = \"Transfer-Encoding\";\n  Header[\"UserAgent\"] = \"User-Agent\";\n  Header[\"WwwAuthenticate\"] = \"WWW-Authenticate\";\n  Header[\"XhrRedirectedTo\"] = \"X-XHR-Redirected-To\";\n  Header[\"XhrReferer\"] = \"X-XHR-Referer\";\n  Header[\"XssProtecton\"] = \"X-XSS-Protection\";\n  Header[\"XContentTypeOptions\"] = \"X-Content-Type-Options\";\n  Header[\"XDownloadOptions\"] = \"X-Download-Options\";\n  Header[\"XForwardedFor\"] = \"X-Forwarded-For\";\n  Header[\"XForwardedHost\"] = \"X-Forwarded-Host\";\n  Header[\"XForwardedProto\"] = \"X-Forwarded-Proto\";\n  Header[\"XFrameOptions\"] = \"X-Frame-Options\";\n  Header[\"XXhrRedirectedTo\"] = \"X-XHR-Redirected-To\";\n  Header[\"XXhrReferer\"] = \"X-XHR-Referer\";\n  Header[\"XXssProtecton\"] = \"X-XSS-Protection\";\n  Header[\"XXssProtection\"] = \"X-XSS-Protection\";\n})(Header || (Header = {}));\nlet CspDirective;\n(function (CspDirective) {\n  CspDirective[\"ChildSrc\"] = \"child-src\";\n  CspDirective[\"ConnectSrc\"] = \"connect-src\";\n  CspDirective[\"DefaultSrc\"] = \"default-src\";\n  CspDirective[\"FontSrc\"] = \"font-src\";\n  CspDirective[\"FrameSrc\"] = \"frame-src\";\n  CspDirective[\"ImgSrc\"] = \"img-src\";\n  CspDirective[\"ManifestSrc\"] = \"manifest-src\";\n  CspDirective[\"MediaSrc\"] = \"media-src\";\n  CspDirective[\"ObjectSrc\"] = \"object-src\";\n  CspDirective[\"PrefetchSrc\"] = \"prefetch-src\";\n  CspDirective[\"ScriptSrc\"] = \"script-src\";\n  CspDirective[\"StyleSrc\"] = \"style-src\";\n  CspDirective[\"WebrtcSrc\"] = \"webrtc-src\";\n  CspDirective[\"WorkerSrc\"] = \"worker-src\";\n  CspDirective[\"BaseUri\"] = \"base-uri\";\n  CspDirective[\"PluginTypes\"] = \"plugin-types\";\n  CspDirective[\"Sandbox\"] = \"sandbox\";\n  CspDirective[\"FormAction\"] = \"form-action\";\n  CspDirective[\"FrameAncestors\"] = \"frame-ancestors\";\n  CspDirective[\"ReportUri\"] = \"report-uri\";\n  CspDirective[\"BlockAllMixedContent\"] = \"block-all-mixed-content\";\n  CspDirective[\"RequireSriFor\"] = \"require-sri-for\";\n  CspDirective[\"UpgradeInsecureRequests\"] = \"upgrade-insecure-requests\";\n})(CspDirective || (CspDirective = {}));\nlet CspSandboxAllow;\n(function (CspSandboxAllow) {\n  CspSandboxAllow[\"Forms\"] = \"allow-forms\";\n  CspSandboxAllow[\"SameOrigin\"] = \"allow-same-origin\";\n  CspSandboxAllow[\"Scripts\"] = \"allow-scripts\";\n  CspSandboxAllow[\"Popups\"] = \"allow-popups\";\n  CspSandboxAllow[\"Modals\"] = \"allow-modals\";\n  CspSandboxAllow[\"OrientationLock\"] = \"allow-orientation-lock\";\n  CspSandboxAllow[\"PointerLock\"] = \"allow-pointer-lock\";\n  CspSandboxAllow[\"Presentation\"] = \"allow-presentation\";\n  CspSandboxAllow[\"PopupsToEscapeSandbox\"] = \"allow-popups-to-escape-sandbox\";\n  CspSandboxAllow[\"TopNavigation\"] = \"allow-top-navigation\";\n})(CspSandboxAllow || (CspSandboxAllow = {}));\nlet SpecialSource;\n(function (SpecialSource) {\n  SpecialSource[\"Any\"] = \"*\";\n  SpecialSource[\"Self\"] = \"'self'\";\n  SpecialSource[\"UnsafeInline\"] = \"'unsafe-inline'\";\n  SpecialSource[\"UnsafeEval\"] = \"'unsafe-eval'\";\n  SpecialSource[\"None\"] = \"'none'\";\n  SpecialSource[\"StrictDynamic\"] = \"'strict-dynamic'\";\n  SpecialSource[\"ReportSample\"] = \"'report-sample'\";\n  SpecialSource[\"Data\"] = \"data:\";\n  SpecialSource[\"Blob\"] = \"blob:\";\n  SpecialSource[\"FileSystem\"] = \"filesystem:\";\n})(SpecialSource || (SpecialSource = {}));\nlet SriAsset;\n(function (SriAsset) {\n  SriAsset[\"Script\"] = \"script\";\n  SriAsset[\"Style\"] = \"style\";\n})(SriAsset || (SriAsset = {}));\nlet HashAlgorithm;\n(function (HashAlgorithm) {\n  HashAlgorithm[\"Sha256\"] = \"sha256\";\n  HashAlgorithm[\"Sha384\"] = \"sha384\";\n  HashAlgorithm[\"Sha512\"] = \"sha512\";\n})(HashAlgorithm || (HashAlgorithm = {}));\nlet ResponseType;\n(function (ResponseType) {\n  ResponseType[\"Informational\"] = \"1xx\";\n  ResponseType[\"Success\"] = \"2xx\";\n  ResponseType[\"Redirection\"] = \"3xx\";\n  ResponseType[\"ClientError\"] = \"4xx\";\n  ResponseType[\"ServerError\"] = \"5xx\";\n  ResponseType[\"Unknown\"] = \"Unknown\";\n})(ResponseType || (ResponseType = {}));\nfunction getResponseType(status) {\n  if (status >= 100 && status < 200) {\n    return ResponseType.Informational;\n  } else if (status >= 200 && status < 300) {\n    return ResponseType.Success;\n  } else if (status >= 300 && status < 400) {\n    return ResponseType.Redirection;\n  } else if (status >= 400 && status < 500) {\n    return ResponseType.ClientError;\n  } else if (status >= 500 && status < 600) {\n    return ResponseType.ServerError;\n  } else {\n    return ResponseType.Unknown;\n  }\n}\nfunction nonceSource(nonce) {\n  return `'nonce-${nonce}'`;\n}\nfunction hashSource(hashAlgorithm, value) {\n  return `'${hashAlgorithm}-${value}'`;\n}\nlet CacheControl;\n(function (CacheControl) {\n  CacheControl[\"NoCache\"] = \"no-cache\";\n  CacheControl[\"NoStore\"] = \"no-store\";\n  CacheControl[\"MustRevalidate\"] = \"must-revalidate\";\n  CacheControl[\"MaxAge\"] = \"max-age\";\n})(CacheControl || (CacheControl = {}));\nconst noCache = `${CacheControl.NoCache},${CacheControl.NoStore},${CacheControl.MustRevalidate},${CacheControl.MaxAge}=0`;\n\nexport { CacheControl, CspDirective, CspSandboxAllow, HashAlgorithm, Header, Method, ResponseType, SpecialSource, SriAsset, StatusCode, getResponseType, hashSource, noCache, nonceSource };\n", "import {\n  HTTPResponseLog,\n  HTTPRetryLog,\n  HTTPResponseGraphQLDeprecationNotice,\n  LogContent,\n} from '@shopify/admin-api-client';\nimport {StatusCode} from '@shopify/network';\n\nimport * as ShopifyErrors from '../error';\nimport {LIBRARY_NAME} from '../types';\nimport {ConfigInterface} from '../base-types';\nimport {SHOPIFY_API_LIBRARY_VERSION} from '../version';\nimport {\n  abstractRuntimeString,\n  canonicalizeHeaders,\n  getHeader,\n} from '../../runtime';\nimport {logger} from '../logger';\n\nexport function getUserAgent(config: ConfigInterface): string {\n  let userAgentPrefix = `${LIBRARY_NAME} v${SHOPIFY_API_LIBRARY_VERSION} | ${abstractRuntimeString()}`;\n  if (config.userAgentPrefix) {\n    userAgentPrefix = `${config.userAgentPrefix} | ${userAgentPrefix}`;\n  }\n\n  return userAgentPrefix;\n}\n\nfunction serializeResponse(response: Response | any) {\n  if (!response) {\n    return {error: 'No response object provided'};\n  }\n\n  try {\n    const {status, statusText, ok, redirected, type, url, headers} = response;\n\n    const serialized: any = {\n      status,\n      statusText,\n      ok,\n      redirected,\n      type,\n      url,\n    };\n\n    if (headers?.entries) {\n      serialized.headers = Object.fromEntries(headers.entries());\n    } else if (headers) {\n      serialized.headers = headers;\n    }\n\n    return serialized;\n  } catch {\n    return response;\n  }\n}\n\nexport function clientLoggerFactory(config: ConfigInterface) {\n  return (logContent: LogContent) => {\n    if (config.logger.httpRequests) {\n      switch (logContent.type) {\n        case 'HTTP-Response': {\n          const responseLog: HTTPResponseLog['content'] = logContent.content;\n          logger(config).debug('Received response for HTTP request', {\n            requestParams: JSON.stringify(responseLog.requestParams),\n            response: JSON.stringify(serializeResponse(responseLog.response)),\n          });\n          break;\n        }\n        case 'HTTP-Retry': {\n          const responseLog: HTTPRetryLog['content'] = logContent.content;\n          logger(config).debug('Retrying HTTP request', {\n            requestParams: JSON.stringify(responseLog.requestParams),\n            retryAttempt: responseLog.retryAttempt,\n            maxRetries: responseLog.maxRetries,\n            response: responseLog.lastResponse\n              ? JSON.stringify(serializeResponse(responseLog.lastResponse))\n              : 'undefined',\n          });\n          break;\n        }\n        case 'HTTP-Response-GraphQL-Deprecation-Notice': {\n          const responseLog: HTTPResponseGraphQLDeprecationNotice['content'] =\n            logContent.content;\n          logger(config).debug(\n            'Received response containing Deprecated GraphQL Notice',\n            {\n              requestParams: JSON.stringify(responseLog.requestParams),\n              deprecationNotice: responseLog.deprecationNotice,\n            },\n          );\n          break;\n        }\n        default: {\n          logger(config).debug(`HTTP request event: ${logContent.content}`);\n          break;\n        }\n      }\n    }\n  };\n}\n\nexport function throwFailedRequest(\n  body: any,\n  atMaxRetries: boolean,\n  response?: Response,\n): never {\n  if (typeof response === 'undefined') {\n    const message = body?.errors?.message ?? '';\n    throw new ShopifyErrors.HttpRequestError(\n      `Http request error, no response available: ${message}`,\n    );\n  }\n\n  const responseHeaders = canonicalizeHeaders(\n    Object.fromEntries(response.headers.entries() ?? []),\n  );\n\n  if (response.status === StatusCode.Ok && body.errors.graphQLErrors) {\n    throw new ShopifyErrors.GraphqlQueryError({\n      message:\n        body.errors.graphQLErrors?.[0].message ?? 'GraphQL operation failed',\n      response: response as Record<string, any>,\n      headers: responseHeaders,\n      body: body as Record<string, any>,\n    });\n  }\n\n  const errorMessages: string[] = [];\n  if (body.errors) {\n    errorMessages.push(JSON.stringify(body.errors, null, 2));\n  }\n  const xRequestId = getHeader(responseHeaders, 'x-request-id');\n  if (xRequestId) {\n    errorMessages.push(\n      `If you report this error, please include this id: ${xRequestId}`,\n    );\n  }\n\n  const errorMessage = errorMessages.length\n    ? `:\\n${errorMessages.join('\\n')}`\n    : '';\n  const code = response.status;\n  const statusText = response.statusText;\n\n  switch (true) {\n    case response.status === StatusCode.TooManyRequests: {\n      if (atMaxRetries) {\n        throw new ShopifyErrors.HttpMaxRetriesError(\n          'Attempted the maximum number of retries for HTTP request.',\n        );\n      } else {\n        const retryAfter = getHeader(responseHeaders, 'Retry-After');\n        throw new ShopifyErrors.HttpThrottlingError({\n          message: `Shopify is throttling requests ${errorMessage}`,\n          code,\n          statusText,\n          body,\n          headers: responseHeaders,\n          retryAfter: retryAfter ? parseFloat(retryAfter) : undefined,\n        });\n      }\n    }\n    case response.status >= StatusCode.InternalServerError:\n      if (atMaxRetries) {\n        throw new ShopifyErrors.HttpMaxRetriesError(\n          'Attempted the maximum number of retries for HTTP request.',\n        );\n      } else {\n        throw new ShopifyErrors.HttpInternalError({\n          message: `Shopify internal error${errorMessage}`,\n          code,\n          statusText,\n          body,\n          headers: responseHeaders,\n        });\n      }\n    default:\n      throw new ShopifyErrors.HttpResponseError({\n        message: `Received an error response (${response.status} ${response.statusText}) from Shopify${errorMessage}`,\n        code,\n        statusText,\n        body,\n        headers: responseHeaders,\n      });\n  }\n}\n", "import {\n  AdminApiClient,\n  AdminOperations,\n  ApiClientRequestOptions,\n  createAdminApiClient,\n  ReturnData,\n} from '@shopify/admin-api-client';\n\nimport {ApiVersion} from '../../../types';\nimport {ConfigInterface} from '../../../base-types';\nimport type {\n  RequestReturn,\n  GraphqlParams,\n  GraphqlClientParams,\n  GraphqlQueryOptions,\n  GraphQLClientResponse,\n} from '../../types';\nimport {Session} from '../../../session/session';\nimport {logger} from '../../../logger';\nimport * as ShopifyErrors from '../../../error';\nimport {abstractFetch, canonicalizeHeaders} from '../../../../runtime';\nimport {\n  clientLoggerFactory,\n  getUserAgent,\n  throwFailedRequest,\n} from '../../common';\n\ninterface GraphqlClientClassParams {\n  config: ConfigInterface;\n}\nexport class GraphqlClient {\n  public static config: ConfigInterface;\n\n  readonly session: Session;\n  readonly client: AdminApiClient;\n  readonly apiVersion?: ApiVersion;\n\n  constructor(params: GraphqlClientParams) {\n    const config = this.graphqlClass().config;\n\n    if (!config.isCustomStoreApp && !params.session.accessToken) {\n      throw new ShopifyErrors.MissingRequiredArgument(\n        'Missing access token when creating GraphQL client',\n      );\n    }\n\n    if (params.apiVersion) {\n      const message =\n        params.apiVersion === config.apiVersion\n          ? `Admin client has a redundant API version override to the default ${params.apiVersion}`\n          : `Admin client overriding default API version ${config.apiVersion} with ${params.apiVersion}`;\n\n      logger(config).debug(message);\n    }\n\n    this.session = params.session;\n    this.apiVersion = params.apiVersion;\n    this.client = createAdminApiClient({\n      accessToken: config.adminApiAccessToken ?? this.session.accessToken!,\n      apiVersion: this.apiVersion ?? config.apiVersion,\n      storeDomain: this.session.shop,\n      customFetchApi: abstractFetch,\n      logger: clientLoggerFactory(config),\n      userAgentPrefix: getUserAgent(config),\n      isTesting: config.isTesting,\n    });\n  }\n\n  public async query<T = undefined>(\n    params: GraphqlParams,\n  ): Promise<RequestReturn<T>> {\n    logger(this.graphqlClass().config).deprecated(\n      '12.0.0',\n      'The query method is deprecated, and was replaced with the request method.\\n' +\n        'See the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients.',\n    );\n\n    if (\n      (typeof params.data === 'string' && params.data.length === 0) ||\n      Object.entries(params.data).length === 0\n    ) {\n      throw new ShopifyErrors.MissingRequiredArgument('Query missing.');\n    }\n\n    let operation: string;\n    let variables: Record<string, any> | undefined;\n    if (typeof params.data === 'string') {\n      operation = params.data;\n    } else {\n      operation = params.data.query;\n      variables = params.data.variables;\n    }\n\n    const headers = Object.fromEntries(\n      Object.entries(params?.extraHeaders ?? {}).map(([key, value]) => [\n        key,\n        Array.isArray(value) ? value.join(', ') : value.toString(),\n      ]),\n    );\n\n    const response = await this.request<T>(operation, {\n      headers,\n      retries: params.tries ? params.tries - 1 : undefined,\n      variables,\n    });\n\n    return {body: response as T, headers: {}};\n  }\n\n  public async request<\n    T = undefined,\n    Operation extends keyof Operations = string,\n    Operations extends AdminOperations = AdminOperations,\n  >(\n    operation: Operation,\n    options?: GraphqlQueryOptions<Operation, Operations>,\n  ): Promise<\n    GraphQLClientResponse<\n      T extends undefined ? ReturnData<Operation, Operations> : T\n    >\n  > {\n    const response = await this.client.request<\n      T extends undefined ? ReturnData<Operation, Operations> : T,\n      Operation\n    >(operation, {\n      apiVersion: this.apiVersion || this.graphqlClass().config.apiVersion,\n      ...(options as ApiClientRequestOptions<Operation, AdminOperations>),\n    });\n\n    if (response.errors) {\n      const fetchResponse = response.errors.response;\n\n      throwFailedRequest(response, (options?.retries ?? 0) > 0, fetchResponse);\n    }\n\n    const headerObject = Object.fromEntries(\n      response.headers ? response.headers.entries() : [],\n    );\n\n    return {\n      ...response,\n      headers: canonicalizeHeaders(headerObject ?? {}),\n    };\n  }\n\n  private graphqlClass() {\n    return this.constructor as typeof GraphqlClient;\n  }\n}\n\nexport function graphqlClientClass({\n  config,\n}: GraphqlClientClassParams): typeof GraphqlClient {\n  class NewGraphqlClient extends GraphqlClient {\n    public static config = config;\n  }\n\n  Reflect.defineProperty(NewGraphqlClient, 'name', {\n    value: 'GraphqlClient',\n  });\n\n  return NewGraphqlClient as typeof GraphqlClient;\n}\n", "import {\n  AdminRestApiClient,\n  createAdminRestApiClient,\n} from '@shopify/admin-api-client';\nimport {Method} from '@shopify/network';\n\nimport {\n  clientLoggerFactory,\n  getUserAgent,\n  throwFailedRequest,\n} from '../../common';\nimport {\n  HashFormat,\n  NormalizedRequest,\n  abstractFetch,\n  canonicalizeHeaders,\n  createSHA256HMAC,\n  getHeader,\n} from '../../../../runtime';\nimport {ConfigInterface} from '../../../base-types';\nimport * as ShopifyErrors from '../../../error';\nimport {logger} from '../../../logger';\nimport {\n  RestRequestReturn,\n  PageInfo,\n  RestClientParams,\n  PageInfoParams,\n} from '../types';\nimport type {\n  RequestParams,\n  GetRequestParams,\n  PutRequestParams,\n  PostRequestParams,\n  DeleteRequestParams,\n} from '../../types';\nimport {ApiVersion} from '../../../types';\nimport {Session} from '../../../session/session';\n\nexport interface RestClientClassParams {\n  config: ConfigInterface;\n  formatPaths?: boolean;\n}\n\ninterface DeprecationInterface {\n  message: string | null;\n  path: string;\n  body?: string;\n}\n\nexport class RestClient {\n  public static config: ConfigInterface;\n  public static formatPaths: boolean;\n\n  static LINK_HEADER_REGEXP = /<([^<]+)>; rel=\"([^\"]+)\"/;\n  static DEFAULT_LIMIT = '50';\n  static RETRY_WAIT_TIME = 1000;\n\n  static readonly DEPRECATION_ALERT_DELAY = 300000;\n  loggedDeprecations: Record<string, number> = {};\n\n  readonly client: AdminRestApiClient;\n  readonly session: Session;\n  readonly apiVersion: ApiVersion;\n\n  public constructor({session, apiVersion}: RestClientParams) {\n    const config = this.restClass().config;\n\n    if (!config.isCustomStoreApp && !session.accessToken) {\n      throw new ShopifyErrors.MissingRequiredArgument(\n        'Missing access token when creating REST client',\n      );\n    }\n\n    if (apiVersion) {\n      const message =\n        apiVersion === config.apiVersion\n          ? `REST client has a redundant API version override to the default ${apiVersion}`\n          : `REST client overriding default API version ${config.apiVersion} with ${apiVersion}`;\n\n      logger(config).debug(message);\n    }\n\n    const customStoreAppAccessToken =\n      config.adminApiAccessToken ?? config.apiSecretKey;\n\n    this.session = session;\n    this.apiVersion = apiVersion ?? config.apiVersion;\n    this.client = createAdminRestApiClient({\n      scheme: config.hostScheme,\n      storeDomain: session.shop,\n      apiVersion: apiVersion ?? config.apiVersion,\n      accessToken: config.isCustomStoreApp\n        ? customStoreAppAccessToken\n        : session.accessToken!,\n      customFetchApi: abstractFetch,\n      logger: clientLoggerFactory(config),\n      userAgentPrefix: getUserAgent(config),\n      defaultRetryTime: this.restClass().RETRY_WAIT_TIME,\n      formatPaths: this.restClass().formatPaths,\n      isTesting: config.isTesting,\n    });\n  }\n\n  /**\n   * Performs a GET request on the given path.\n   */\n  public async get<T = any>(params: GetRequestParams) {\n    return this.request<T>({method: Method.Get, ...params});\n  }\n\n  /**\n   * Performs a POST request on the given path.\n   */\n  public async post<T = any>(params: PostRequestParams) {\n    return this.request<T>({method: Method.Post, ...params});\n  }\n\n  /**\n   * Performs a PUT request on the given path.\n   */\n  public async put<T = any>(params: PutRequestParams) {\n    return this.request<T>({method: Method.Put, ...params});\n  }\n\n  /**\n   * Performs a DELETE request on the given path.\n   */\n  public async delete<T = any>(params: DeleteRequestParams) {\n    return this.request<T>({method: Method.Delete, ...params});\n  }\n\n  protected async request<T = any>(\n    params: RequestParams,\n  ): Promise<RestRequestReturn<T>> {\n    const requestParams = {\n      headers: {\n        ...params.extraHeaders,\n        ...(params.type ? {'Content-Type': params.type.toString()} : {}),\n      },\n      retries: params.tries ? params.tries - 1 : undefined,\n      searchParams: params.query,\n    };\n\n    let response: Response;\n    switch (params.method) {\n      case Method.Get:\n        response = await this.client.get(params.path, requestParams);\n        break;\n      case Method.Put:\n        response = await this.client.put(params.path, {\n          ...requestParams,\n          data: params.data!,\n        });\n        break;\n      case Method.Post:\n        response = await this.client.post(params.path, {\n          ...requestParams,\n          data: params.data!,\n        });\n        break;\n      case Method.Delete:\n        response = await this.client.delete(params.path, requestParams);\n        break;\n      default:\n        throw new ShopifyErrors.InvalidRequestError(\n          `Unsupported request method '${params.method}'`,\n        );\n    }\n\n    const bodyString: string = await response.text();\n\n    // Some DELETE requests return an empty body but are still valid responses, we want those to go through\n    const body: any =\n      params.method === Method.Delete && bodyString === ''\n        ? {}\n        : JSON.parse(bodyString);\n\n    const responseHeaders = canonicalizeHeaders(\n      Object.fromEntries(response.headers.entries()),\n    );\n\n    if (!response.ok) {\n      throwFailedRequest(body, (params.tries ?? 1) > 1, response);\n    }\n\n    const requestReturn: RestRequestReturn<T> = {\n      body,\n      headers: responseHeaders,\n    };\n\n    await this.logDeprecations(\n      {\n        method: params.method,\n        url: params.path,\n        headers: requestParams.headers,\n        body: params.data ? JSON.stringify(params.data) : undefined,\n      },\n      requestReturn,\n    );\n\n    const link = response.headers.get('Link');\n    if (link !== undefined) {\n      const pageInfo: PageInfo = {\n        limit: params.query?.limit\n          ? params.query?.limit.toString()\n          : RestClient.DEFAULT_LIMIT,\n      };\n\n      if (link) {\n        const links = link.split(', ');\n\n        for (const link of links) {\n          const parsedLink = link.match(RestClient.LINK_HEADER_REGEXP);\n          if (!parsedLink) {\n            continue;\n          }\n\n          const linkRel = parsedLink[2];\n          const linkUrl = new URL(parsedLink[1]);\n          const linkFields = linkUrl.searchParams.get('fields');\n          const linkPageToken = linkUrl.searchParams.get('page_info');\n\n          if (!pageInfo.fields && linkFields) {\n            pageInfo.fields = linkFields.split(',');\n          }\n\n          if (linkPageToken) {\n            switch (linkRel) {\n              case 'previous':\n                pageInfo.previousPageUrl = parsedLink[1];\n                pageInfo.prevPage = this.buildRequestParams(parsedLink[1]);\n                break;\n              case 'next':\n                pageInfo.nextPageUrl = parsedLink[1];\n                pageInfo.nextPage = this.buildRequestParams(parsedLink[1]);\n                break;\n            }\n          }\n        }\n      }\n\n      requestReturn.pageInfo = pageInfo;\n    }\n\n    return requestReturn;\n  }\n\n  private restClass() {\n    return this.constructor as typeof RestClient;\n  }\n\n  private buildRequestParams(newPageUrl: string): PageInfoParams {\n    const pattern = `^/admin/api/[^/]+/(.*).json$`;\n\n    const url = new URL(newPageUrl);\n    const path = url.pathname.replace(new RegExp(pattern), '$1');\n    return {\n      path,\n      query: Object.fromEntries(url.searchParams.entries()),\n    };\n  }\n\n  private async logDeprecations(\n    request: NormalizedRequest,\n    response: RestRequestReturn,\n  ) {\n    const config = this.restClass().config;\n\n    const deprecationReason = getHeader(\n      response.headers,\n      'X-Shopify-API-Deprecated-Reason',\n    );\n    if (deprecationReason) {\n      const deprecation: DeprecationInterface = {\n        message: deprecationReason,\n        path: request.url,\n      };\n\n      if (request.body) {\n        // This can only be a string, since we're always converting the body before calling this method\n        deprecation.body = `${(request.body as string).substring(0, 100)}...`;\n      }\n\n      const depHash = await createSHA256HMAC(\n        config.apiSecretKey,\n        JSON.stringify(deprecation),\n        HashFormat.Hex,\n      );\n\n      if (\n        !Object.keys(this.loggedDeprecations).includes(depHash) ||\n        Date.now() - this.loggedDeprecations[depHash] >=\n          RestClient.DEPRECATION_ALERT_DELAY\n      ) {\n        this.loggedDeprecations[depHash] = Date.now();\n\n        const stack = new Error().stack;\n        const message = `API Deprecation Notice ${new Date().toLocaleString()} : ${JSON.stringify(\n          deprecation,\n        )}  -  Stack Trace: ${stack}`;\n        await logger(config).warning(message);\n      }\n    }\n  }\n}\n\nexport function restClientClass(\n  params: RestClientClassParams,\n): typeof RestClient {\n  const {config, formatPaths} = params;\n\n  class NewRestClient extends RestClient {\n    public static config = config;\n    public static formatPaths = formatPaths === undefined ? true : formatPaths;\n  }\n\n  Reflect.defineProperty(NewRestClient, 'name', {\n    value: 'RestClient',\n  });\n\n  return NewRestClient as typeof RestClient;\n}\n", "export const DEFAULT_CONTENT_TYPE = 'application/json';\nexport const DEFAULT_SDK_VARIANT = 'storefront-api-client';\n// This is value is replaced with package.json version during rollup build process\nexport const DEFAULT_CLIENT_VERSION = 'ROLLUP_REPLACE_CLIENT_VERSION';\n\nexport const PUBLIC_ACCESS_TOKEN_HEADER = 'X-Shopify-Storefront-Access-Token';\nexport const PRIVATE_ACCESS_TOKEN_HEADER = 'Shopify-Storefront-Private-Token';\nexport const SDK_VARIANT_HEADER = 'X-SDK-Variant';\nexport const SDK_VERSION_HEADER = 'X-SDK-Version';\nexport const SDK_VARIANT_SOURCE_HEADER = 'X-SDK-Variant-Source';\n\nexport const CLIENT = 'Storefront API Client';\n", "import {CLIENT} from './constants';\n\nexport function validatePrivateAccessTokenUsage(\n  privateAccessToken: string | undefined,\n) {\n  if (privateAccessToken && typeof window !== 'undefined') {\n    throw new Error(\n      `${CLIENT}: private access tokens and headers should only be used in a server-to-server implementation. Use the public API access token in nonserver environments.`,\n    );\n  }\n}\n\nexport function validateRequiredAccessTokens(\n  publicAccessToken: string | undefined,\n  privateAccessToken: string | undefined,\n) {\n  if (!publicAccessToken && !privateAccessToken) {\n    throw new Error(\n      `${CLIENT}: a public or private access token must be provided`,\n    );\n  }\n\n  if (publicAccessToken && privateAccessToken) {\n    throw new Error(\n      `${CLIENT}: only provide either a public or private access token`,\n    );\n  }\n}\n", "import {\n  createGraphQLClient,\n  getCurrentSupportedApiVersions,\n  validateDomainAndGetStoreUrl,\n  validateApiVersion,\n  generateGetGQLClientParams,\n  generateGetHeaders,\n} from '@shopify/graphql-client';\n\nimport {\n  StorefrontApiClientOptions,\n  StorefrontApiClient,\n  StorefrontApiClientConfig,\n  StorefrontOperations,\n} from './types';\nimport {\n  DEFAULT_SDK_VARIANT,\n  DEFAULT_CLIENT_VERSION,\n  SDK_VARIANT_HEADER,\n  SDK_VARIANT_SOURCE_HEADER,\n  SDK_VERSION_HEADER,\n  DEFAULT_CONTENT_TYPE,\n  PUBLIC_ACCESS_TOKEN_HEADER,\n  PRIVATE_ACCESS_TOKEN_HEADER,\n  CLIENT,\n} from './constants';\nimport {\n  validateRequiredAccessTokens,\n  validatePrivateAccessTokenUsage,\n} from './validations';\n\nexport function createStorefrontApiClient({\n  storeDomain,\n  apiVersion,\n  publicAccessToken,\n  privateAccessToken,\n  clientName,\n  retries = 0,\n  customFetchApi,\n  logger,\n}: StorefrontApiClientOptions): StorefrontApiClient {\n  const currentSupportedApiVersions = getCurrentSupportedApiVersions();\n\n  const storeUrl = validateDomainAndGetStoreUrl({\n    client: CLIENT,\n    storeDomain,\n  });\n\n  const baseApiVersionValidationParams = {\n    client: CLIENT,\n    currentSupportedApiVersions,\n    logger,\n  };\n\n  validateApiVersion({...baseApiVersionValidationParams, apiVersion});\n  validateRequiredAccessTokens(publicAccessToken, privateAccessToken);\n  validatePrivateAccessTokenUsage(privateAccessToken);\n\n  const apiUrlFormatter = generateApiUrlFormatter(\n    storeUrl,\n    apiVersion,\n    baseApiVersionValidationParams,\n  );\n\n  const config: StorefrontApiClientConfig = {\n    storeDomain: storeUrl,\n    apiVersion,\n    ...(publicAccessToken\n      ? {publicAccessToken}\n      : {\n          privateAccessToken: privateAccessToken!,\n        }),\n    headers: {\n      'Content-Type': DEFAULT_CONTENT_TYPE,\n      Accept: DEFAULT_CONTENT_TYPE,\n      [SDK_VARIANT_HEADER]: DEFAULT_SDK_VARIANT,\n      [SDK_VERSION_HEADER]: DEFAULT_CLIENT_VERSION,\n      ...(clientName ? {[SDK_VARIANT_SOURCE_HEADER]: clientName} : {}),\n      ...(publicAccessToken\n        ? {[PUBLIC_ACCESS_TOKEN_HEADER]: publicAccessToken}\n        : {[PRIVATE_ACCESS_TOKEN_HEADER]: privateAccessToken!}),\n    },\n    apiUrl: apiUrlFormatter(),\n    clientName,\n  };\n\n  const graphqlClient = createGraphQLClient({\n    headers: config.headers,\n    url: config.apiUrl,\n    retries,\n    customFetchApi,\n    logger,\n  });\n\n  const getHeaders = generateGetHeaders(config);\n  const getApiUrl = generateGetApiUrl(config, apiUrlFormatter);\n\n  const getGQLClientParams = generateGetGQLClientParams<StorefrontOperations>({\n    getHeaders,\n    getApiUrl,\n  });\n\n  const client: StorefrontApiClient = {\n    config,\n    getHeaders,\n    getApiUrl,\n    fetch: (...props) => {\n      return graphqlClient.fetch(...getGQLClientParams(...props));\n    },\n    request: (...props) => {\n      return graphqlClient.request(...getGQLClientParams(...props));\n    },\n    requestStream: (...props) => {\n      return graphqlClient.requestStream(...getGQLClientParams(...props));\n    },\n  };\n\n  return Object.freeze(client);\n}\n\nfunction generateApiUrlFormatter(\n  storeUrl: string,\n  defaultApiVersion: string,\n  baseApiVersionValidationParams: Omit<\n    Parameters<typeof validateApiVersion>[0],\n    'apiVersion'\n  >,\n) {\n  return (apiVersion?: string) => {\n    if (apiVersion) {\n      validateApiVersion({\n        ...baseApiVersionValidationParams,\n        apiVersion,\n      });\n    }\n\n    const urlApiVersion = (apiVersion ?? defaultApiVersion).trim();\n\n    return `${storeUrl}/api/${urlApiVersion}/graphql.json`;\n  };\n}\n\nfunction generateGetApiUrl(\n  config: StorefrontApiClientConfig,\n  apiUrlFormatter: (version?: string) => string,\n): StorefrontApiClient['getApiUrl'] {\n  return (propApiVersion?: string) => {\n    return propApiVersion ? apiUrlFormatter(propApiVersion) : config.apiUrl;\n  };\n}\n", "import {\n  StorefrontApiClient,\n  StorefrontOperations,\n  ClientResponse,\n  createStorefrontApiClient,\n  ReturnData,\n  ApiClientRequestOptions,\n} from '@shopify/storefront-api-client';\n\nimport {ApiVersion} from '../../types';\nimport {logger} from '../../logger';\nimport * as ShopifyErrors from '../../error';\nimport {MissingRequiredArgument} from '../../error';\nimport type {\n  GraphqlClientParams,\n  GraphqlParams,\n  GraphqlQueryOptions,\n  RequestReturn,\n} from '../types';\nimport {ConfigInterface} from '../../base-types';\nimport {Session} from '../../session/session';\nimport {abstractFetch} from '../../../runtime';\nimport {clientLoggerFactory, getUserAgent, throwFailedRequest} from '../common';\n\ninterface GraphqlClientClassParams {\n  config: ConfigInterface;\n}\n\nexport class StorefrontClient {\n  public static config: ConfigInterface;\n\n  readonly session: Session;\n  readonly client: StorefrontApiClient;\n  readonly apiVersion?: ApiVersion;\n\n  constructor(params: GraphqlClientParams) {\n    const config = this.storefrontClass().config;\n\n    if (!config.isCustomStoreApp && !params.session.accessToken) {\n      throw new ShopifyErrors.MissingRequiredArgument(\n        'Missing access token when creating GraphQL client',\n      );\n    }\n\n    if (params.apiVersion) {\n      const message =\n        params.apiVersion === config.apiVersion\n          ? `Storefront client has a redundant API version override to the default ${params.apiVersion}`\n          : `Storefront client overriding default API version ${config.apiVersion} with ${params.apiVersion}`;\n\n      logger(config).debug(message);\n    }\n\n    let accessToken: string | undefined;\n    if (config.isCustomStoreApp) {\n      accessToken = config.privateAppStorefrontAccessToken;\n\n      if (!accessToken) {\n        throw new MissingRequiredArgument(\n          'Custom store apps must set the privateAppStorefrontAccessToken property to call the Storefront API.',\n        );\n      }\n    } else {\n      accessToken = params.session.accessToken;\n\n      if (!accessToken) {\n        throw new MissingRequiredArgument('Session missing access token.');\n      }\n    }\n\n    this.session = params.session;\n    this.apiVersion = params.apiVersion;\n    this.client = createStorefrontApiClient({\n      privateAccessToken: accessToken,\n      apiVersion: this.apiVersion ?? config.apiVersion,\n      storeDomain: this.session.shop,\n      customFetchApi: abstractFetch,\n      logger: clientLoggerFactory(config),\n      clientName: getUserAgent(config),\n    });\n  }\n\n  public async query<T = undefined>(\n    params: GraphqlParams,\n  ): Promise<RequestReturn<T>> {\n    logger(this.storefrontClass().config).deprecated(\n      '12.0.0',\n      'The query method is deprecated, and was replaced with the request method.\\n' +\n        'See the migration guide: https://github.com/Shopify/shopify-app-js/blob/main/packages/apps/shopify-api/docs/migrating-to-v9.md#using-the-new-clients.',\n    );\n\n    if (\n      (typeof params.data === 'string' && params.data.length === 0) ||\n      Object.entries(params.data).length === 0\n    ) {\n      throw new ShopifyErrors.MissingRequiredArgument('Query missing.');\n    }\n\n    let operation: string;\n    let variables: Record<string, any> | undefined;\n    if (typeof params.data === 'string') {\n      operation = params.data;\n    } else {\n      operation = params.data.query;\n      variables = params.data.variables;\n    }\n\n    const headers = Object.fromEntries(\n      Object.entries(params?.extraHeaders ?? {}).map(([key, value]) => [\n        key,\n        Array.isArray(value) ? value.join(', ') : value.toString(),\n      ]),\n    );\n\n    const response = await this.request<T>(operation, {\n      headers,\n      retries: params.tries ? params.tries - 1 : undefined,\n      variables,\n    });\n\n    return {body: response as T, headers: {}};\n  }\n\n  public async request<\n    T = undefined,\n    Operation extends keyof Operations = string,\n    Operations extends StorefrontOperations = StorefrontOperations,\n  >(\n    operation: Operation,\n    options?: GraphqlQueryOptions<Operation, Operations>,\n  ): Promise<\n    ClientResponse<T extends undefined ? ReturnData<Operation, Operations> : T>\n  > {\n    const response = await this.client.request<T, Operation>(operation, {\n      apiVersion: this.apiVersion || this.storefrontClass().config.apiVersion,\n      ...(options as ApiClientRequestOptions<Operation, StorefrontOperations>),\n    });\n\n    if (response.errors) {\n      const fetchResponse = response.errors.response;\n\n      throwFailedRequest(response, (options?.retries ?? 0) > 0, fetchResponse);\n    }\n\n    return response;\n  }\n\n  private storefrontClass() {\n    return this.constructor as typeof StorefrontClient;\n  }\n}\n\nexport function storefrontClientClass(params: GraphqlClientClassParams) {\n  const {config} = params;\n  class NewStorefrontClient extends StorefrontClient {\n    public static config = config;\n  }\n\n  Reflect.defineProperty(NewStorefrontClient, 'name', {\n    value: 'StorefrontClient',\n  });\n\n  return NewStorefrontClient as typeof StorefrontClient;\n}\n", "import {ConfigInterface} from '../../base-types';\nimport * as ShopifyErrors from '../../error';\nimport {graphqlClientClass} from '../admin';\n\nimport {GraphqlProxy} from './types';\n\nexport function graphqlProxy(config: ConfigInterface): GraphqlProxy {\n  return async ({session, rawBody}) => {\n    if (!session.accessToken) {\n      throw new ShopifyErrors.InvalidSession(\n        'Cannot proxy query. Session not authenticated.',\n      );\n    }\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    let query: string;\n    let variables: Record<string, any> | undefined;\n    if (typeof rawBody === 'string') {\n      query = rawBody;\n    } else {\n      query = rawBody.query;\n      variables = rawBody.variables;\n    }\n\n    if (!query) {\n      throw new ShopifyErrors.MissingRequiredArgument('Query missing.');\n    }\n\n    const response = await client.request(query, {variables});\n\n    return {body: response, headers: {}};\n  };\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {restClientClass, graphqlClientClass} from './admin';\nimport {storefrontClientClass} from './storefront';\nimport {graphqlProxy} from './graphql_proxy/graphql_proxy';\nimport {ShopifyClients} from './types';\n\nexport type {ShopifyClients} from './types';\n\nexport function clientClasses(config: ConfigInterface): ShopifyClients {\n  return {\n    // We don't pass in the HttpClient because the RestClient inherits from it, and goes through the same setup process\n    Rest: restClientClass({config}),\n    Graphql: graphqlClientClass({config}),\n    Storefront: storefrontClientClass({config}),\n    graphqlProxy: graphqlProxy(config),\n  };\n}\n", "// src/patterns.json\nvar patterns_default = [\n  \" daum[ /]\",\n  \" deusu/\",\n  \"(?:^|[^g])news(?!sapphire)\",\n  \"(?<! (?:channel/|google/))google(?!(app|/google| pixel))\",\n  \"(?<! cu)bots?(?:\\\\b|_)\",\n  \"(?<!(?:lib))http\",\n  \"(?<![hg]m)score\",\n  \"(?<!cam)scan\",\n  \"@[a-z][\\\\w-]+\\\\.\",\n  \"\\\\(\\\\)\",\n  \"\\\\.com\\\\b\",\n  \"\\\\btime/\",\n  \"\\\\|\",\n  \"^<\",\n  \"^[\\\\w \\\\.\\\\-\\\\(?:\\\\):%]+(?:/v?\\\\d+(?:\\\\.\\\\d+)?(?:\\\\.\\\\d{1,10})*?)?(?:,|$)\",\n  \"^[^ ]{50,}$\",\n  \"^\\\\d+\\\\b\",\n  \"^\\\\w*search\\\\b\",\n  \"^\\\\w+/[\\\\w\\\\(\\\\)]*$\",\n  \"^active\",\n  \"^ad muncher\",\n  \"^amaya\",\n  \"^avsdevicesdk/\",\n  \"^azure\",\n  \"^biglotron\",\n  \"^bot\",\n  \"^bw/\",\n  \"^clamav[ /]\",\n  \"^client/\",\n  \"^cobweb/\",\n  \"^custom\",\n  \"^ddg[_-]android\",\n  \"^discourse\",\n  \"^dispatch/\\\\d\",\n  \"^downcast/\",\n  \"^duckduckgo\",\n  \"^email\",\n  \"^facebook\",\n  \"^getright/\",\n  \"^gozilla/\",\n  \"^hobbit\",\n  \"^hotzonu\",\n  \"^hwcdn/\",\n  \"^igetter/\",\n  \"^jeode/\",\n  \"^jetty/\",\n  \"^jigsaw\",\n  \"^microsoft bits\",\n  \"^movabletype\",\n  \"^mozilla/\\\\d\\\\.\\\\d\\\\s[\\\\w\\\\.-]+$\",\n  \"^mozilla/\\\\d\\\\.\\\\d\\\\s\\\\(compatible;?(?:\\\\s\\\\w+\\\\/\\\\d+\\\\.\\\\d+)?\\\\)$\",\n  \"^navermailapp\",\n  \"^netsurf\",\n  \"^offline\",\n  \"^openai/\",\n  \"^owler\",\n  \"^php\",\n  \"^postman\",\n  \"^python\",\n  \"^rank\",\n  \"^read\",\n  \"^reed\",\n  \"^rest\",\n  \"^rss\",\n  \"^snapchat\",\n  \"^space bison\",\n  \"^svn\",\n  \"^swcd \",\n  \"^taringa\",\n  \"^thumbor/\",\n  \"^track\",\n  \"^w3c\",\n  \"^webbandit/\",\n  \"^webcopier\",\n  \"^wget\",\n  \"^whatsapp\",\n  \"^wordpress\",\n  \"^xenu link sleuth\",\n  \"^yahoo\",\n  \"^yandex\",\n  \"^zdm/\\\\d\",\n  \"^zoom marketplace/\",\n  \"agent\",\n  \"analyzer\",\n  \"archive\",\n  \"ask jeeves/teoma\",\n  \"audit\",\n  \"bit\\\\.ly/\",\n  \"bluecoat drtr\",\n  \"browsex\",\n  \"burpcollaborator\",\n  \"capture\",\n  \"catch\",\n  \"check\\\\b\",\n  \"checker\",\n  \"chrome-lighthouse\",\n  \"chromeframe\",\n  \"classifier\",\n  \"cloudflare\",\n  \"convertify\",\n  \"crawl\",\n  \"cypress/\",\n  \"dareboost\",\n  \"datanyze\",\n  \"dejaclick\",\n  \"detect\",\n  \"dmbrowser\",\n  \"download\",\n  \"evc-batch/\",\n  \"exaleadcloudview\",\n  \"feed\",\n  \"fetcher\",\n  \"firephp\",\n  \"functionize\",\n  \"grab\",\n  \"headless\",\n  \"httrack\",\n  \"hubspot marketing grader\",\n  \"hydra\",\n  \"ibisbrowser\",\n  \"infrawatch\",\n  \"insight\",\n  \"inspect\",\n  \"iplabel\",\n  \"java(?!;)\",\n  \"library\",\n  \"linkcheck\",\n  \"mail\\\\.ru/\",\n  \"manager\",\n  \"measure\",\n  \"neustar wpm\",\n  \"node\",\n  \"nutch\",\n  \"offbyone\",\n  \"onetrust\",\n  \"optimize\",\n  \"pageburst\",\n  \"pagespeed\",\n  \"parser\",\n  \"perl\",\n  \"phantomjs\",\n  \"pingdom\",\n  \"powermarks\",\n  \"preview\",\n  \"proxy\",\n  \"ptst[ /]\\\\d\",\n  \"retriever\",\n  \"rexx;\",\n  \"rigor\",\n  \"rss\\\\b\",\n  \"scrape\",\n  \"server\",\n  \"sogou\",\n  \"sparkler/\",\n  \"speedcurve\",\n  \"spider\",\n  \"splash\",\n  \"statuscake\",\n  \"supercleaner\",\n  \"synapse\",\n  \"synthetic\",\n  \"tools\",\n  \"torrent\",\n  \"transcoder\",\n  \"url\",\n  \"validator\",\n  \"virtuoso\",\n  \"wappalyzer\",\n  \"webglance\",\n  \"webkit2png\",\n  \"whatcms/\",\n  \"xtate/\"\n];\n\n// src/pattern.ts\nvar fullPattern = \" daum[ /]| deusu/|(?:^|[^g])news(?!sapphire)|(?<! (?:channel/|google/))google(?!(app|/google| pixel))|(?<! cu)bots?(?:\\\\b|_)|(?<!(?:lib))http|(?<![hg]m)score|(?<!cam)scan|@[a-z][\\\\w-]+\\\\.|\\\\(\\\\)|\\\\.com\\\\b|\\\\btime/|\\\\||^<|^[\\\\w \\\\.\\\\-\\\\(?:\\\\):%]+(?:/v?\\\\d+(?:\\\\.\\\\d+)?(?:\\\\.\\\\d{1,10})*?)?(?:,|$)|^[^ ]{50,}$|^\\\\d+\\\\b|^\\\\w*search\\\\b|^\\\\w+/[\\\\w\\\\(\\\\)]*$|^active|^ad muncher|^amaya|^avsdevicesdk/|^azure|^biglotron|^bot|^bw/|^clamav[ /]|^client/|^cobweb/|^custom|^ddg[_-]android|^discourse|^dispatch/\\\\d|^downcast/|^duckduckgo|^email|^facebook|^getright/|^gozilla/|^hobbit|^hotzonu|^hwcdn/|^igetter/|^jeode/|^jetty/|^jigsaw|^microsoft bits|^movabletype|^mozilla/\\\\d\\\\.\\\\d\\\\s[\\\\w\\\\.-]+$|^mozilla/\\\\d\\\\.\\\\d\\\\s\\\\(compatible;?(?:\\\\s\\\\w+\\\\/\\\\d+\\\\.\\\\d+)?\\\\)$|^navermailapp|^netsurf|^offline|^openai/|^owler|^php|^postman|^python|^rank|^read|^reed|^rest|^rss|^snapchat|^space bison|^svn|^swcd |^taringa|^thumbor/|^track|^w3c|^webbandit/|^webcopier|^wget|^whatsapp|^wordpress|^xenu link sleuth|^yahoo|^yandex|^zdm/\\\\d|^zoom marketplace/|agent|analyzer|archive|ask jeeves/teoma|audit|bit\\\\.ly/|bluecoat drtr|browsex|burpcollaborator|capture|catch|check\\\\b|checker|chrome-lighthouse|chromeframe|classifier|cloudflare|convertify|crawl|cypress/|dareboost|datanyze|dejaclick|detect|dmbrowser|download|evc-batch/|exaleadcloudview|feed|fetcher|firephp|functionize|grab|headless|httrack|hubspot marketing grader|hydra|ibisbrowser|infrawatch|insight|inspect|iplabel|java(?!;)|library|linkcheck|mail\\\\.ru/|manager|measure|neustar wpm|node|nutch|offbyone|onetrust|optimize|pageburst|pagespeed|parser|perl|phantomjs|pingdom|powermarks|preview|proxy|ptst[ /]\\\\d|retriever|rexx;|rigor|rss\\\\b|scrape|server|sogou|sparkler/|speedcurve|spider|splash|statuscake|supercleaner|synapse|synthetic|tools|torrent|transcoder|url|validator|virtuoso|wappalyzer|webglance|webkit2png|whatcms/|xtate/\";\n\n// src/index.ts\nvar naivePattern = /bot|crawl|http|lighthouse|scan|search|spider/i;\nvar pattern;\nfunction getPattern() {\n  if (pattern instanceof RegExp) {\n    return pattern;\n  }\n  try {\n    pattern = new RegExp(fullPattern, \"i\");\n  } catch (error) {\n    pattern = naivePattern;\n  }\n  return pattern;\n}\nvar list = patterns_default;\nvar isbotNaive = (userAgent) => Boolean(userAgent) && naivePattern.test(userAgent);\nfunction isbot(userAgent) {\n  return Boolean(userAgent) && getPattern().test(userAgent);\n}\nvar createIsbot = (customPattern) => (userAgent) => Boolean(userAgent) && customPattern.test(userAgent);\nvar createIsbotFromList = (list2) => {\n  const pattern2 = new RegExp(list2.join(\"|\"), \"i\");\n  return (userAgent) => Boolean(userAgent) && pattern2.test(userAgent);\n};\nvar isbotMatch = (userAgent) => {\n  var _a, _b;\n  return (_b = (_a = userAgent == null ? void 0 : userAgent.match(getPattern())) == null ? void 0 : _a[0]) != null ? _b : null;\n};\nvar isbotMatches = (userAgent) => list.map((part) => {\n  var _a;\n  return (_a = userAgent == null ? void 0 : userAgent.match(new RegExp(part, \"i\"))) == null ? void 0 : _a[0];\n}).filter(Boolean);\nvar isbotPattern = (userAgent) => {\n  var _a;\n  return userAgent ? (_a = list.find((pattern2) => new RegExp(pattern2, \"i\").test(userAgent))) != null ? _a : null : null;\n};\nvar isbotPatterns = (userAgent) => userAgent ? list.filter((pattern2) => new RegExp(pattern2, \"i\").test(userAgent)) : [];\nexport {\n  createIsbot,\n  createIsbotFromList,\n  getPattern,\n  isbot,\n  isbotMatch,\n  isbotMatches,\n  isbotNaive,\n  isbotPattern,\n  isbotPatterns,\n  list\n};\n", "export default class ProcessedQuery {\n  static stringify(keyValuePairs?: Record<string, any>): string {\n    if (!keyValuePairs || Object.keys(keyValuePairs).length === 0) return '';\n\n    return new ProcessedQuery().putAll(keyValuePairs).stringify();\n  }\n\n  processedQuery: URLSearchParams;\n\n  constructor() {\n    this.processedQuery = new URLSearchParams();\n  }\n\n  putAll(keyValuePairs: Record<string, any>): ProcessedQuery {\n    Object.entries(keyValuePairs).forEach(([key, value]: [string, any]) =>\n      this.put(key, value),\n    );\n    return this;\n  }\n\n  put(key: string, value: any): void {\n    if (Array.isArray(value)) {\n      this.putArray(key, value);\n    } else if (value?.constructor === Object) {\n      this.putObject(key, value);\n    } else {\n      this.putSimple(key, value);\n    }\n  }\n\n  putArray(key: string, value: (string | number)[]): void {\n    value.forEach((arrayValue) =>\n      this.processedQuery.append(`${key}[]`, `${arrayValue}`),\n    );\n  }\n\n  putObject(key: string, value: object): void {\n    Object.entries(value).forEach(\n      ([entry, entryValue]: [string, string | number]) => {\n        this.processedQuery.append(`${key}[${entry}]`, `${entryValue}`);\n      },\n    );\n  }\n\n  putSimple(key: string, value: string | number): void {\n    this.processedQuery.append(key, `${value}`);\n  }\n\n  stringify(omitQuestionMark = false): string {\n    const queryString = this.processedQuery.toString();\n    return omitQuestionMark ? queryString : `?${queryString}`;\n  }\n}\n", "import * as ShopifyErrors from '../../error';\n\nexport type SafeCompare = (\n  strA: string | Record<string, string> | string[] | number[],\n  strB: string | Record<string, string> | string[] | number[],\n) => boolean;\n\nexport const safeCompare: SafeCompare = (strA, strB) => {\n  if (typeof strA === typeof strB) {\n    const enc = new TextEncoder();\n    const buffA = enc.encode(JSON.stringify(strA));\n    const buffB = enc.encode(JSON.stringify(strB));\n\n    if (buffA.length === buffB.length) {\n      return timingSafeEqual(buffA, buffB);\n    }\n  } else {\n    throw new ShopifyErrors.SafeCompareError(\n      `Mismatched data types provided: ${typeof strA} and ${typeof strB}`,\n    );\n  }\n  return false;\n};\n\n// Buffer must be same length for this function to be secure.\nfunction timingSafeEqual(bufA: ArrayBuffer, bufB: ArrayBuffer): boolean {\n  const viewA = new Uint8Array(bufA);\n  const viewB = new Uint8Array(bufB);\n  let out = 0;\n  for (let i = 0; i < viewA.length; i++) {\n    out |= viewA[i] ^ viewB[i];\n  }\n  return out === 0;\n}\n", "import {AdapterArgs} from '../../runtime/types';\n\nexport enum HmacValidationType {\n  Flow = 'flow',\n  Webhook = 'webhook',\n  FulfillmentService = 'fulfillment_service',\n}\n\nexport interface ValidateParams extends AdapterArgs {\n  /**\n   * The raw body of the request.\n   */\n  rawBody: string;\n}\n\nexport const ValidationErrorReason = {\n  MissingBody: 'missing_body',\n  InvalidHmac: 'invalid_hmac',\n  MissingHmac: 'missing_hmac',\n} as const;\n\nexport type ValidationErrorReasonType =\n  (typeof ValidationErrorReason)[keyof typeof ValidationErrorReason];\n\nexport interface ValidationInvalid {\n  /**\n   * Whether the request is a valid Flow request from Shopify.\n   */\n  valid: false;\n  /**\n   * The reason why the request is not valid.\n   */\n  reason: ValidationErrorReasonType;\n}\n\nexport interface ValidationValid {\n  /**\n   * Whether the request is a valid request from Shopify.\n   */\n  valid: true;\n}\n", "import {logger} from '../logger';\nimport {ShopifyHeader} from '../types';\nimport {\n  AdapterArgs,\n  abstractConvertRequest,\n  getHeader,\n} from '../../runtime/http';\nimport {ConfigInterface} from '../base-types';\nimport {createSHA256HMAC} from '../../runtime/crypto';\nimport {HashFormat} from '../../runtime/crypto/types';\nimport {AuthQuery} from '../auth/oauth/types';\nimport * as ShopifyErrors from '../error';\nimport {safeCompare} from '../auth/oauth/safe-compare';\n\nimport ProcessedQuery from './processed-query';\nimport {\n  ValidationErrorReason,\n  ValidationInvalid,\n  HmacValidationType,\n  ValidationValid,\n  ValidationErrorReasonType,\n} from './types';\n\nconst HMAC_TIMESTAMP_PERMITTED_CLOCK_TOLERANCE_SEC = 90;\n\nexport type HMACSignator = 'admin' | 'appProxy';\n\nexport interface ValidateParams extends AdapterArgs {\n  /**\n   * The type of validation to perform, either 'flow' or 'webhook'.\n   */\n  type: HmacValidationType;\n  /**\n   * The raw body of the request.\n   */\n  rawBody: string;\n}\n\nfunction stringifyQueryForAdmin(query: AuthQuery): string {\n  const processedQuery = new ProcessedQuery();\n  Object.keys(query)\n    .sort((val1, val2) => val1.localeCompare(val2))\n    .forEach((key: string) => processedQuery.put(key, query[key]));\n\n  return processedQuery.stringify(true);\n}\n\nfunction stringifyQueryForAppProxy(query: AuthQuery): string {\n  return Object.entries(query)\n    .sort(([val1], [val2]) => val1.localeCompare(val2))\n    .reduce((acc, [key, value]) => {\n      return `${acc}${key}=${Array.isArray(value) ? value.join(',') : value}`;\n    }, '');\n}\n\nexport function generateLocalHmac(config: ConfigInterface) {\n  return async (\n    params: AuthQuery,\n    signator: HMACSignator = 'admin',\n  ): Promise<string> => {\n    const {hmac, signature, ...query} = params;\n\n    const queryString =\n      signator === 'admin'\n        ? stringifyQueryForAdmin(query)\n        : stringifyQueryForAppProxy(query);\n\n    return createSHA256HMAC(config.apiSecretKey, queryString, HashFormat.Hex);\n  };\n}\n\nexport function validateHmac(config: ConfigInterface) {\n  return async (\n    query: AuthQuery,\n    {signator}: {signator: HMACSignator} = {signator: 'admin'},\n  ): Promise<boolean> => {\n    if (signator === 'admin' && !query.hmac) {\n      throw new ShopifyErrors.InvalidHmacError(\n        'Query does not contain an HMAC value.',\n      );\n    }\n\n    if (signator === 'appProxy' && !query.signature) {\n      throw new ShopifyErrors.InvalidHmacError(\n        'Query does not contain a signature value.',\n      );\n    }\n\n    validateHmacTimestamp(query);\n\n    const hmac = signator === 'appProxy' ? query.signature : query.hmac;\n    const localHmac = await generateLocalHmac(config)(query, signator);\n\n    return safeCompare(hmac as string, localHmac);\n  };\n}\n\nexport async function validateHmacString(\n  config: ConfigInterface,\n  data: string,\n  hmac: string,\n  format: HashFormat,\n) {\n  const localHmac = await createSHA256HMAC(config.apiSecretKey, data, format);\n\n  return safeCompare(hmac, localHmac);\n}\n\nexport function getCurrentTimeInSec() {\n  return Math.trunc(Date.now() / 1000);\n}\n\nexport function validateHmacFromRequestFactory(config: ConfigInterface) {\n  return async function validateHmacFromRequest({\n    type,\n    rawBody,\n    ...adapterArgs\n  }: ValidateParams): Promise<ValidationInvalid | ValidationValid> {\n    const request = await abstractConvertRequest(adapterArgs);\n    if (!rawBody.length) {\n      return fail(ValidationErrorReason.MissingBody, type, config);\n    }\n    const hmac = getHeader(request.headers, ShopifyHeader.Hmac);\n    if (!hmac) {\n      return fail(ValidationErrorReason.MissingHmac, type, config);\n    }\n    const validHmac = await validateHmacString(\n      config,\n      rawBody,\n      hmac,\n      HashFormat.Base64,\n    );\n    if (!validHmac) {\n      return fail(ValidationErrorReason.InvalidHmac, type, config);\n    }\n\n    return succeed(type, config);\n  };\n}\n\nfunction validateHmacTimestamp(query: AuthQuery) {\n  if (\n    Math.abs(getCurrentTimeInSec() - Number(query.timestamp)) >\n    HMAC_TIMESTAMP_PERMITTED_CLOCK_TOLERANCE_SEC\n  ) {\n    throw new ShopifyErrors.InvalidHmacError(\n      'HMAC timestamp is outside of the tolerance range',\n    );\n  }\n}\n\nasync function fail(\n  reason: ValidationErrorReasonType,\n  type: HmacValidationType,\n  config: ConfigInterface,\n): Promise<ValidationInvalid> {\n  const log = logger(config);\n  await log.debug(`${type} request is not valid`, {reason});\n\n  return {\n    valid: false,\n    reason,\n  };\n}\n\nasync function succeed(\n  type: HmacValidationType,\n  config: ConfigInterface,\n): Promise<ValidationValid> {\n  const log = logger(config);\n  await log.debug(`${type} request is valid`);\n\n  return {\n    valid: true,\n  };\n}\n", "export function decodeHost(host: string): string {\n  return atob(host);\n}\n", "// Converts admin.shopify.com/store/my-shop to my-shop.myshopify.com\nexport function shopAdminUrlToLegacyUrl(shopAdminUrl: string): string | null {\n  const shopUrl = removeProtocol(shopAdminUrl);\n\n  const isShopAdminUrl = shopUrl.split('.')[0] === 'admin';\n\n  if (!isShopAdminUrl) {\n    return null;\n  }\n\n  const regex = new RegExp(`admin\\\\..+/store/([^/]+)`);\n  const matches = shopUrl.match(regex);\n\n  if (matches && matches.length === 2) {\n    const shopName = matches[1];\n    const isSpinUrl = shopUrl.includes('spin.dev/store/');\n    const isLocalUrl = shopUrl.includes('shop.dev/store/');\n\n    if (isSpinUrl) {\n      return spinAdminUrlToLegacyUrl(shopUrl);\n    } else if (isLocalUrl) {\n      return localAdminUrlToLegacyUrl(shopUrl);\n    } else {\n      return `${shopName}.myshopify.com`;\n    }\n  } else {\n    return null;\n  }\n}\n\n// Converts my-shop.myshopify.com to admin.shopify.com/store/my-shop\nexport function legacyUrlToShopAdminUrl(legacyAdminUrl: string): string | null {\n  const shopUrl = removeProtocol(legacyAdminUrl);\n  const regex = new RegExp(`(.+)\\\\.myshopify\\\\.com$`);\n  const matches = shopUrl.match(regex);\n\n  if (matches && matches.length === 2) {\n    const shopName = matches[1];\n    return `admin.shopify.com/store/${shopName}`;\n  } else {\n    const isSpinUrl = shopUrl.endsWith('spin.dev');\n    const isLocalUrl = shopUrl.endsWith('shop.dev');\n    if (isSpinUrl) {\n      return spinLegacyUrlToAdminUrl(shopUrl);\n    } else if (isLocalUrl) {\n      return localLegacyUrlToAdminUrl(shopUrl);\n    } else {\n      return null;\n    }\n  }\n}\n\nfunction spinAdminUrlToLegacyUrl(shopAdminUrl: string) {\n  const spinRegex = new RegExp(`admin\\\\.web\\\\.(.+\\\\.spin\\\\.dev)/store/(.+)`);\n  const spinMatches = shopAdminUrl.match(spinRegex);\n\n  if (spinMatches && spinMatches.length === 3) {\n    const spinUrl = spinMatches[1];\n    const shopName = spinMatches[2];\n    return `${shopName}.shopify.${spinUrl}`;\n  } else {\n    return null;\n  }\n}\n\nfunction localAdminUrlToLegacyUrl(shopAdminUrl: string) {\n  const localRegex = new RegExp(`admin\\\\.shop\\\\.dev/store/(.+)`);\n  const localMatches = shopAdminUrl.match(localRegex);\n\n  if (localMatches && localMatches.length === 2) {\n    const shopName = localMatches[1];\n    return `${shopName}.shop.dev`;\n  } else {\n    return null;\n  }\n}\n\nfunction spinLegacyUrlToAdminUrl(legacyAdminUrl: string) {\n  const spinRegex = new RegExp(`(.+)\\\\.shopify\\\\.(.+\\\\.spin\\\\.dev)`);\n  const spinMatches = legacyAdminUrl.match(spinRegex);\n\n  if (spinMatches && spinMatches.length === 3) {\n    const shopName = spinMatches[1];\n    const spinUrl = spinMatches[2];\n    return `admin.web.${spinUrl}/store/${shopName}`;\n  } else {\n    return null;\n  }\n}\n\nfunction localLegacyUrlToAdminUrl(legacyAdminUrl: string) {\n  const localRegex = new RegExp(`(.+)\\\\.shop\\\\.dev$`);\n  const localMatches = legacyAdminUrl.match(localRegex);\n\n  if (localMatches && localMatches.length === 2) {\n    const shopName = localMatches[1];\n    return `admin.shop.dev/store/${shopName}`;\n  } else {\n    return null;\n  }\n}\nfunction removeProtocol(url: string): string {\n  return url.replace(/^https?:\\/\\//, '').replace(/\\/$/, '');\n}\n", "import {ConfigInterface} from '../base-types';\nimport {InvalidHostError, InvalidShopError} from '../error';\nimport {decodeHost} from '../auth/decode-host';\n\nimport {shopAdminUrlToLegacyUrl} from './shop-admin-url-helper';\n\nexport function sanitizeShop(config: ConfigInterface) {\n  return (shop: string, throwOnInvalid = false): string | null => {\n    let shopUrl = shop;\n    const domainsRegex = [\n      'myshopify\\\\.com',\n      'shopify\\\\.com',\n      'myshopify\\\\.io',\n      'shop\\\\.dev',\n    ];\n    if (config.customShopDomains) {\n      domainsRegex.push(\n        ...config.customShopDomains.map((regex) =>\n          typeof regex === 'string' ? regex : regex.source,\n        ),\n      );\n    }\n\n    const shopUrlRegex = new RegExp(\n      `^[a-zA-Z0-9][a-zA-Z0-9-_]*\\\\.(${domainsRegex.join('|')})[/]*$`,\n    );\n\n    const shopAdminRegex = new RegExp(\n      `^admin\\\\.(${domainsRegex.join('|')})/store/([a-zA-Z0-9][a-zA-Z0-9-_]*)$`,\n    );\n\n    const isShopAdminUrl = shopAdminRegex.test(shopUrl);\n    if (isShopAdminUrl) {\n      shopUrl = shopAdminUrlToLegacyUrl(shopUrl) || '';\n    }\n\n    const sanitizedShop = shopUrlRegex.test(shopUrl) ? shopUrl : null;\n    if (!sanitizedShop && throwOnInvalid) {\n      throw new InvalidShopError('Received invalid shop argument');\n    }\n\n    return sanitizedShop;\n  };\n}\n\nexport function sanitizeHost() {\n  return (host: string, throwOnInvalid = false): string | null => {\n    const base64regex = /^[0-9a-zA-Z+/]+={0,2}$/;\n\n    let sanitizedHost = base64regex.test(host) ? host : null;\n    if (sanitizedHost) {\n      const {hostname} = new URL(`https://${decodeHost(sanitizedHost)}`);\n\n      const originsRegex = [\n        'myshopify\\\\.com',\n        'shopify\\\\.com',\n        'myshopify\\\\.io',\n        'spin\\\\.dev',\n        'shop\\\\.dev',\n      ];\n\n      const hostRegex = new RegExp(`\\\\.(${originsRegex.join('|')})$`);\n      if (!hostRegex.test(hostname)) {\n        sanitizedHost = null;\n      }\n    }\n    if (!sanitizedHost && throwOnInvalid) {\n      throw new InvalidHostError('Received invalid host argument');\n    }\n\n    return sanitizedHost;\n  };\n}\n", "import {\n  AllOperations,\n  ApiClientRequestOptions,\n  SearchParams,\n} from '@shopify/admin-api-client';\nimport {Method} from '@shopify/network';\n\nimport {Session} from '../session/session';\nimport type {ApiVersion} from '../types';\nimport {Headers} from '../../runtime/http';\n\nimport {GraphqlClient} from './admin/graphql/client';\nimport {StorefrontClient} from './storefront/client';\nimport type {GraphqlProxy} from './graphql_proxy/types';\nimport {RestClient} from './admin/rest/client';\n\nexport * from './admin/types';\nexport * from './graphql_proxy/types';\n\nexport interface ClientArgs {\n  session: Session;\n  apiVersion?: ApiVersion;\n  retries?: number;\n}\n\n/**\n * Headers to be sent with the request.\n */\nexport type HeaderParams = Record<string, string | number | string[]>;\n\n/* eslint-disable @shopify/typescript/prefer-pascal-case-enums */\nexport enum DataType {\n  JSON = 'application/json',\n  GraphQL = 'application/graphql',\n  URLEncoded = 'application/x-www-form-urlencoded',\n}\n\n/* eslint-enable @shopify/typescript/prefer-pascal-case-enums */\n\nexport interface GetRequestParams {\n  /**\n   * The path to the resource, relative to the API version root.\n   */\n  path: string;\n  /**\n   * The type of data expected in the response.\n   */\n  type?: DataType;\n  /**\n   * The request body.\n   */\n  data?: Record<string, any> | string;\n  /**\n   * Query parameters to be sent with the request.\n   */\n  query?: SearchParams;\n  /**\n   * Additional headers to be sent with the request.\n   */\n  extraHeaders?: HeaderParams;\n  /**\n   * The maximum number of times the request can be made if it fails with a throttling or server error.\n   */\n  tries?: number;\n}\n\nexport type PostRequestParams = GetRequestParams & {\n  data: Record<string, any> | string;\n};\n\nexport type PutRequestParams = PostRequestParams;\n\nexport type DeleteRequestParams = GetRequestParams;\n\nexport type RequestParams = (GetRequestParams | PostRequestParams) & {\n  method: Method;\n};\n\nexport interface RequestReturn<T = unknown> {\n  /**\n   * The response body.\n   */\n  body: T;\n  /**\n   * The response headers.\n   */\n  headers: Headers;\n}\n\nexport type GraphqlParams = Omit<PostRequestParams, 'path' | 'type'>;\n\nexport interface GraphqlClientParams {\n  session: Session;\n  apiVersion?: ApiVersion;\n}\n\nexport interface GraphqlQueryOptions<\n  Operation extends keyof Operations,\n  Operations extends AllOperations,\n> {\n  /**\n   * The variables to include in the operation.\n   */\n  variables?: ApiClientRequestOptions<Operation, Operations>['variables'];\n  /**\n   * Additional headers to be sent with the request.\n   */\n  headers?: Record<string, string | number>;\n  /**\n   * The maximum number of times to retry the request if it fails with a throttling or server error.\n   */\n  retries?: number;\n  /**\n   * An optional AbortSignal to cancel the request.\n   */\n  signal?: AbortSignal;\n}\n\nexport {GraphqlClient} from './admin/graphql/client';\nexport {RestClient} from './admin/rest/client';\n\nexport interface ShopifyClients {\n  Rest: typeof RestClient;\n  Graphql: typeof GraphqlClient;\n  Storefront: typeof StorefrontClient;\n  graphqlProxy: GraphqlProxy;\n}\n", "import {logger} from '../logger';\nimport {LogSeverity} from '../types';\nimport {abstractFetch} from '../../runtime';\nimport {ConfigInterface} from '../base-types';\n\nexport function fetchRequestFactory(config: ConfigInterface) {\n  return async function fetchRequest(\n    url: string,\n    options?: RequestInit,\n  ): Promise<Response> {\n    const log = logger(config);\n    const doLog =\n      config.logger.httpRequests && config.logger.level === LogSeverity.Debug;\n\n    if (doLog) {\n      log.debug('Making HTTP request', {\n        method: options?.method || 'GET',\n        url,\n        ...(options?.body && {body: options?.body}),\n      });\n    }\n\n    const response = await abstractFetch(url, options);\n\n    if (doLog) {\n      log.debug('HTTP request completed', {\n        method: options?.method || 'GET',\n        url,\n        status: response.status,\n      });\n    }\n\n    return response;\n  };\n}\n", "import {AdapterArgs} from '../../../runtime/http/types';\n\nexport const SESSION_COOKIE_NAME = 'shopify_app_session';\nexport const STATE_COOKIE_NAME = 'shopify_app_state';\n\nexport interface AuthQuery {\n  [key: string]: string | undefined;\n  hmac?: string;\n  signature?: string;\n}\n\nexport interface BeginParams extends AdapterArgs {\n  /**\n   * The shop domain. For example: `{exampleshop}.myshopify.com`.\n   */\n  shop: string;\n  /**\n   * The path to the callback endpoint, with a leading `/`.\n   * This URL must be allowed in the Partners dashboard, or using the CLI to run your app.\n   */\n  callbackPath: string;\n  /**\n   * Defines if the session is online or offline.\n   * Learn more about [OAuth access modes](https://shopify.dev/docs/apps/auth/oauth/access-modes).\n   */\n  isOnline: boolean;\n}\n\nexport interface CallbackParams extends AdapterArgs {}\n\nexport interface AccessTokenResponse {\n  access_token: string;\n  scope: string;\n}\n\nexport interface OnlineAccessInfo {\n  /**\n   * How long the access token is valid for, in seconds.\n   */\n  expires_in: number;\n  /**\n   * The effective set of scopes for the session.\n   */\n  associated_user_scope: string;\n  /**\n   * The user associated with the access token.\n   */\n  associated_user: OnlineAccessUser;\n}\n\nexport interface OfflineAccessInfo {\n  /**\n   * How long the access token is valid for, in seconds.\n   */\n  expires_in?: number;\n}\n\nexport interface OnlineAccessUser {\n  /**\n   * The user's ID.\n   */\n  id: number;\n  /**\n   * The user's first name.\n   */\n  first_name: string;\n  /**\n   * The user's last name.\n   */\n  last_name: string;\n  /**\n   * The user's email address.\n   */\n  email: string;\n  /**\n   * Whether the user has verified their email address.\n   */\n  email_verified: boolean;\n  /**\n   * Whether the user is the account owner.\n   */\n  account_owner: boolean;\n  /**\n   * The user's locale.\n   */\n  locale: string;\n  /**\n   * Whether the user is a collaborator.\n   */\n  collaborator: boolean;\n}\n\nexport interface OnlineAccessResponse\n  extends AccessTokenResponse,\n    OnlineAccessInfo {}\n\nexport interface OfflineAccessResponse\n  extends AccessTokenResponse,\n    OfflineAccessInfo {}\n", "import {crypto} from '../../../runtime/crypto';\n\nexport type Nonce = () => string;\n\nexport function nonce(): string {\n  const length = 15;\n\n  const bytes = crypto.getRandomValues(new Uint8Array(length));\n\n  const nonce = bytes\n    .map((byte: number) => {\n      return byte % 10;\n    })\n    .join('');\n\n  return nonce;\n}\n", "export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;\n", "import REGEX from './regex.js';\nfunction validate(uuid) {\n    return typeof uuid === 'string' && REGEX.test(uuid);\n}\nexport default validate;\n", "import validate from './validate.js';\nfunction parse(uuid) {\n    if (!validate(uuid)) {\n        throw TypeError('Invalid UUID');\n    }\n    let v;\n    return Uint8Array.of((v = parseInt(uuid.slice(0, 8), 16)) >>> 24, (v >>> 16) & 0xff, (v >>> 8) & 0xff, v & 0xff, (v = parseInt(uuid.slice(9, 13), 16)) >>> 8, v & 0xff, (v = parseInt(uuid.slice(14, 18), 16)) >>> 8, v & 0xff, (v = parseInt(uuid.slice(19, 23), 16)) >>> 8, v & 0xff, ((v = parseInt(uuid.slice(24, 36), 16)) / 0x10000000000) & 0xff, (v / 0x100000000) & 0xff, (v >>> 24) & 0xff, (v >>> 16) & 0xff, (v >>> 8) & 0xff, v & 0xff);\n}\nexport default parse;\n", "import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n", "let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n", "function md5(bytes) {\n    const words = uint8ToUint32(bytes);\n    const md5Bytes = wordsToMd5(words, bytes.length * 8);\n    return uint32ToUint8(md5Bytes);\n}\nfunction uint32ToUint8(input) {\n    const bytes = new Uint8Array(input.length * 4);\n    for (let i = 0; i < input.length * 4; i++) {\n        bytes[i] = (input[i >> 2] >>> ((i % 4) * 8)) & 0xff;\n    }\n    return bytes;\n}\nfunction getOutputLength(inputLength8) {\n    return (((inputLength8 + 64) >>> 9) << 4) + 14 + 1;\n}\nfunction wordsToMd5(x, len) {\n    const xpad = new Uint32Array(getOutputLength(len)).fill(0);\n    xpad.set(x);\n    xpad[len >> 5] |= 0x80 << len % 32;\n    xpad[xpad.length - 1] = len;\n    x = xpad;\n    let a = 1732584193;\n    let b = -271733879;\n    let c = -1732584194;\n    let d = 271733878;\n    for (let i = 0; i < x.length; i += 16) {\n        const olda = a;\n        const oldb = b;\n        const oldc = c;\n        const oldd = d;\n        a = md5ff(a, b, c, d, x[i], 7, -680876936);\n        d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);\n        c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);\n        b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);\n        a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);\n        d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);\n        c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);\n        b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);\n        a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);\n        d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);\n        c = md5ff(c, d, a, b, x[i + 10], 17, -42063);\n        b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);\n        a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);\n        d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);\n        c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);\n        b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);\n        a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);\n        d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);\n        c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);\n        b = md5gg(b, c, d, a, x[i], 20, -373897302);\n        a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);\n        d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);\n        c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);\n        b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);\n        a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);\n        d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);\n        c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);\n        b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);\n        a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);\n        d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);\n        c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);\n        b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);\n        a = md5hh(a, b, c, d, x[i + 5], 4, -378558);\n        d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);\n        c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);\n        b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);\n        a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);\n        d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);\n        c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);\n        b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);\n        a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);\n        d = md5hh(d, a, b, c, x[i], 11, -358537222);\n        c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);\n        b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);\n        a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);\n        d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);\n        c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);\n        b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);\n        a = md5ii(a, b, c, d, x[i], 6, -198630844);\n        d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);\n        c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);\n        b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);\n        a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);\n        d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);\n        c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);\n        b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);\n        a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);\n        d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);\n        c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);\n        b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);\n        a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);\n        d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);\n        c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);\n        b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);\n        a = safeAdd(a, olda);\n        b = safeAdd(b, oldb);\n        c = safeAdd(c, oldc);\n        d = safeAdd(d, oldd);\n    }\n    return Uint32Array.of(a, b, c, d);\n}\nfunction uint8ToUint32(input) {\n    if (input.length === 0) {\n        return new Uint32Array();\n    }\n    const output = new Uint32Array(getOutputLength(input.length * 8)).fill(0);\n    for (let i = 0; i < input.length; i++) {\n        output[i >> 2] |= (input[i] & 0xff) << ((i % 4) * 8);\n    }\n    return output;\n}\nfunction safeAdd(x, y) {\n    const lsw = (x & 0xffff) + (y & 0xffff);\n    const msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n    return (msw << 16) | (lsw & 0xffff);\n}\nfunction bitRotateLeft(num, cnt) {\n    return (num << cnt) | (num >>> (32 - cnt));\n}\nfunction md5cmn(q, a, b, x, s, t) {\n    return safeAdd(bitRotateLeft(safeAdd(safeAdd(a, q), safeAdd(x, t)), s), b);\n}\nfunction md5ff(a, b, c, d, x, s, t) {\n    return md5cmn((b & c) | (~b & d), a, b, x, s, t);\n}\nfunction md5gg(a, b, c, d, x, s, t) {\n    return md5cmn((b & d) | (c & ~d), a, b, x, s, t);\n}\nfunction md5hh(a, b, c, d, x, s, t) {\n    return md5cmn(b ^ c ^ d, a, b, x, s, t);\n}\nfunction md5ii(a, b, c, d, x, s, t) {\n    return md5cmn(c ^ (b | ~d), a, b, x, s, t);\n}\nexport default md5;\n", "import parse from './parse.js';\nimport { unsafeStringify } from './stringify.js';\nexport function stringToBytes(str) {\n    str = unescape(encodeURIComponent(str));\n    const bytes = new Uint8Array(str.length);\n    for (let i = 0; i < str.length; ++i) {\n        bytes[i] = str.charCodeAt(i);\n    }\n    return bytes;\n}\nexport const DNS = '6ba7b810-9dad-11d1-80b4-00c04fd430c8';\nexport const URL = '6ba7b811-9dad-11d1-80b4-00c04fd430c8';\nexport default function v35(version, hash, value, namespace, buf, offset) {\n    const valueBytes = typeof value === 'string' ? stringToBytes(value) : value;\n    const namespaceBytes = typeof namespace === 'string' ? parse(namespace) : namespace;\n    if (typeof namespace === 'string') {\n        namespace = parse(namespace);\n    }\n    if (namespace?.length !== 16) {\n        throw TypeError('Namespace must be array-like (16 iterable integer values, 0-255)');\n    }\n    let bytes = new Uint8Array(16 + valueBytes.length);\n    bytes.set(namespaceBytes);\n    bytes.set(valueBytes, namespaceBytes.length);\n    bytes = hash(bytes);\n    bytes[6] = (bytes[6] & 0x0f) | version;\n    bytes[8] = (bytes[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = bytes[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(bytes);\n}\n", "import md5 from './md5.js';\nimport v35, { DNS, URL } from './v35.js';\nexport { DNS, URL } from './v35.js';\nfunction v3(value, namespace, buf, offset) {\n    return v35(0x30, md5, value, namespace, buf, offset);\n}\nv3.DNS = DNS;\nv3.URL = URL;\nexport default v3;\n", "const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n", "function f(s, x, y, z) {\n    switch (s) {\n        case 0:\n            return (x & y) ^ (~x & z);\n        case 1:\n            return x ^ y ^ z;\n        case 2:\n            return (x & y) ^ (x & z) ^ (y & z);\n        case 3:\n            return x ^ y ^ z;\n    }\n}\nfunction ROTL(x, n) {\n    return (x << n) | (x >>> (32 - n));\n}\nfunction sha1(bytes) {\n    const K = [0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6];\n    const H = [0x67452301, 0xefcdab89, 0x98badcfe, 0x10325476, 0xc3d2e1f0];\n    const newBytes = new Uint8Array(bytes.length + 1);\n    newBytes.set(bytes);\n    newBytes[bytes.length] = 0x80;\n    bytes = newBytes;\n    const l = bytes.length / 4 + 2;\n    const N = Math.ceil(l / 16);\n    const M = new Array(N);\n    for (let i = 0; i < N; ++i) {\n        const arr = new Uint32Array(16);\n        for (let j = 0; j < 16; ++j) {\n            arr[j] =\n                (bytes[i * 64 + j * 4] << 24) |\n                    (bytes[i * 64 + j * 4 + 1] << 16) |\n                    (bytes[i * 64 + j * 4 + 2] << 8) |\n                    bytes[i * 64 + j * 4 + 3];\n        }\n        M[i] = arr;\n    }\n    M[N - 1][14] = ((bytes.length - 1) * 8) / Math.pow(2, 32);\n    M[N - 1][14] = Math.floor(M[N - 1][14]);\n    M[N - 1][15] = ((bytes.length - 1) * 8) & 0xffffffff;\n    for (let i = 0; i < N; ++i) {\n        const W = new Uint32Array(80);\n        for (let t = 0; t < 16; ++t) {\n            W[t] = M[i][t];\n        }\n        for (let t = 16; t < 80; ++t) {\n            W[t] = ROTL(W[t - 3] ^ W[t - 8] ^ W[t - 14] ^ W[t - 16], 1);\n        }\n        let a = H[0];\n        let b = H[1];\n        let c = H[2];\n        let d = H[3];\n        let e = H[4];\n        for (let t = 0; t < 80; ++t) {\n            const s = Math.floor(t / 20);\n            const T = (ROTL(a, 5) + f(s, b, c, d) + e + K[s] + W[t]) >>> 0;\n            e = d;\n            d = c;\n            c = ROTL(b, 30) >>> 0;\n            b = a;\n            a = T;\n        }\n        H[0] = (H[0] + a) >>> 0;\n        H[1] = (H[1] + b) >>> 0;\n        H[2] = (H[2] + c) >>> 0;\n        H[3] = (H[3] + d) >>> 0;\n        H[4] = (H[4] + e) >>> 0;\n    }\n    return Uint8Array.of(H[0] >> 24, H[0] >> 16, H[0] >> 8, H[0], H[1] >> 24, H[1] >> 16, H[1] >> 8, H[1], H[2] >> 24, H[2] >> 16, H[2] >> 8, H[2], H[3] >> 24, H[3] >> 16, H[3] >> 8, H[3], H[4] >> 24, H[4] >> 16, H[4] >> 8, H[4]);\n}\nexport default sha1;\n", "import sha1 from './sha1.js';\nimport v35, { DNS, URL } from './v35.js';\nexport { DNS, URL } from './v35.js';\nfunction v5(value, namespace, buf, offset) {\n    return v35(0x50, sha1, value, namespace, buf, offset);\n}\nv5.DNS = DNS;\nv5.URL = URL;\nexport default v5;\n", "/* eslint-disable no-fallthrough */\nimport {InvalidSession} from '../error';\nimport {OnlineAccessInfo} from '../auth/oauth/types';\nimport {AuthScopes} from '../auth/scopes';\n\nimport {SessionParams} from './types';\n\nconst propertiesToSave = [\n  'id',\n  'shop',\n  'state',\n  'isOnline',\n  'scope',\n  'accessToken',\n  'expires',\n  'onlineAccessInfo',\n];\n\n/**\n * Stores App information from logged in merchants so they can make authenticated requests to the Admin API.\n */\nexport class Session {\n  public static fromPropertyArray(\n    entries: [string, string | number | boolean][],\n    returnUserData = false,\n  ): Session {\n    if (!Array.isArray(entries)) {\n      throw new InvalidSession(\n        'The parameter is not an array: a Session cannot be created from this object.',\n      );\n    }\n\n    const obj = Object.fromEntries(\n      entries\n        .filter(([_key, value]) => value !== null && value !== undefined)\n        // Sanitize keys\n        .map(([key, value]) => {\n          switch (key.toLowerCase()) {\n            case 'isonline':\n              return ['isOnline', value];\n            case 'accesstoken':\n              return ['accessToken', value];\n            case 'onlineaccessinfo':\n              return ['onlineAccessInfo', value];\n            case 'userid':\n              return ['userId', value];\n            case 'firstname':\n              return ['firstName', value];\n            case 'lastname':\n              return ['lastName', value];\n            case 'accountowner':\n              return ['accountOwner', value];\n            case 'emailverified':\n              return ['emailVerified', value];\n            default:\n              return [key.toLowerCase(), value];\n          }\n        }),\n    );\n\n    const sessionData = {} as SessionParams;\n    const onlineAccessInfo = {\n      associated_user: {},\n    } as OnlineAccessInfo;\n    Object.entries(obj).forEach(([key, value]) => {\n      switch (key) {\n        case 'isOnline':\n          if (typeof value === 'string') {\n            sessionData[key] = value.toString().toLowerCase() === 'true';\n          } else if (typeof value === 'number') {\n            sessionData[key] = Boolean(value);\n          } else {\n            sessionData[key] = value;\n          }\n          break;\n        case 'scope':\n          sessionData[key] = value.toString();\n          break;\n        case 'expires':\n          sessionData[key] = value ? new Date(Number(value)) : undefined;\n          break;\n        case 'onlineAccessInfo':\n          onlineAccessInfo.associated_user.id = Number(value);\n          break;\n        case 'userId':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.id = Number(value);\n            break;\n          }\n        case 'firstName':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.first_name = String(value);\n            break;\n          }\n        case 'lastName':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.last_name = String(value);\n            break;\n          }\n        case 'email':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.email = String(value);\n            break;\n          }\n        case 'accountOwner':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.account_owner = Boolean(value);\n            break;\n          }\n        case 'locale':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.locale = String(value);\n            break;\n          }\n        case 'collaborator':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.collaborator = Boolean(value);\n            break;\n          }\n        case 'emailVerified':\n          if (returnUserData) {\n            onlineAccessInfo.associated_user.email_verified = Boolean(value);\n            break;\n          }\n        // Return any user keys as passed in\n        default:\n          sessionData[key] = value;\n      }\n    });\n    if (sessionData.isOnline) {\n      sessionData.onlineAccessInfo = onlineAccessInfo;\n    }\n    const session = new Session(sessionData);\n    return session;\n  }\n\n  /**\n   * The unique identifier for the session.\n   */\n  readonly id: string;\n  /**\n   * The Shopify shop domain, such as `example.myshopify.com`.\n   */\n  public shop: string;\n  /**\n   * The state of the session. Used for the OAuth authentication code flow.\n   */\n  public state: string;\n  /**\n   * Whether the access token in the session is online or offline.\n   */\n  public isOnline: boolean;\n  /**\n   * The desired scopes for the access token, at the time the session was created.\n   */\n  public scope?: string;\n  /**\n   * The date the access token expires.\n   */\n  public expires?: Date;\n  /**\n   * The access token for the session.\n   */\n  public accessToken?: string;\n  /**\n   * Information on the user for the session. Only present for online sessions.\n   */\n  public onlineAccessInfo?: OnlineAccessInfo;\n\n  constructor(params: SessionParams) {\n    Object.assign(this, params);\n  }\n\n  /**\n   * Whether the session is active. Active sessions have an access token that is not expired, and has has the given\n   * scopes if scopes is equal to a truthy value.\n   */\n  public isActive(\n    scopes: AuthScopes | string | string[] | undefined,\n    withinMillisecondsOfExpiry = 500,\n  ): boolean {\n    const hasAccessToken = Boolean(this.accessToken);\n    const isTokenNotExpired = !this.isExpired(withinMillisecondsOfExpiry);\n    const isScopeChanged = this.isScopeChanged(scopes);\n    return !isScopeChanged && hasAccessToken && isTokenNotExpired;\n  }\n\n  /**\n   * Whether the access token includes the given scopes if they are provided.\n   */\n  public isScopeChanged(\n    scopes: AuthScopes | string | string[] | undefined,\n  ): boolean {\n    if (typeof scopes === 'undefined') {\n      return false;\n    }\n\n    return !this.isScopeIncluded(scopes);\n  }\n\n  /**\n   * Whether the access token includes the given scopes.\n   */\n  public isScopeIncluded(scopes: AuthScopes | string | string[]): boolean {\n    const requiredScopes =\n      scopes instanceof AuthScopes ? scopes : new AuthScopes(scopes);\n    const sessionScopes = new AuthScopes(this.scope);\n\n    return sessionScopes.has(requiredScopes);\n  }\n\n  /**\n   * Whether the access token is expired.\n   */\n  public isExpired(withinMillisecondsOfExpiry = 0): boolean {\n    return Boolean(\n      this.expires &&\n        this.expires.getTime() - withinMillisecondsOfExpiry < Date.now(),\n    );\n  }\n\n  /**\n   * Converts an object with data into a Session.\n   */\n  public toObject(): SessionParams {\n    const object: SessionParams = {\n      id: this.id,\n      shop: this.shop,\n      state: this.state,\n      isOnline: this.isOnline,\n    };\n\n    if (this.scope) {\n      object.scope = this.scope;\n    }\n    if (this.expires) {\n      object.expires = this.expires;\n    }\n    if (this.accessToken) {\n      object.accessToken = this.accessToken;\n    }\n    if (this.onlineAccessInfo) {\n      object.onlineAccessInfo = this.onlineAccessInfo;\n    }\n    return object;\n  }\n\n  /**\n   * Checks whether the given session is equal to this session.\n   */\n  public equals(other: Session | undefined): boolean {\n    if (!other) return false;\n\n    const mandatoryPropsMatch =\n      this.id === other.id &&\n      this.shop === other.shop &&\n      this.state === other.state &&\n      this.isOnline === other.isOnline;\n\n    if (!mandatoryPropsMatch) return false;\n\n    const copyA = this.toPropertyArray(true);\n    copyA.sort(([k1], [k2]) => (k1 < k2 ? -1 : 1));\n\n    const copyB = other.toPropertyArray(true);\n    copyB.sort(([k1], [k2]) => (k1 < k2 ? -1 : 1));\n\n    return JSON.stringify(copyA) === JSON.stringify(copyB);\n  }\n\n  /**\n   * Converts the session into an array of key-value pairs.\n   */\n  public toPropertyArray(\n    returnUserData = false,\n  ): [string, string | number | boolean][] {\n    return (\n      Object.entries(this)\n        .filter(\n          ([key, value]) =>\n            propertiesToSave.includes(key) &&\n            value !== undefined &&\n            value !== null,\n        )\n        // Prepare values for db storage\n        .flatMap(([key, value]): [string, string | number | boolean][] => {\n          switch (key) {\n            case 'expires':\n              return [[key, value ? value.getTime() : undefined]];\n            case 'onlineAccessInfo':\n              // eslint-disable-next-line no-negated-condition\n              if (!returnUserData) {\n                return [[key, value.associated_user.id]];\n              } else {\n                return [\n                  ['userId', value?.associated_user?.id],\n                  ['firstName', value?.associated_user?.first_name],\n                  ['lastName', value?.associated_user?.last_name],\n                  ['email', value?.associated_user?.email],\n                  ['locale', value?.associated_user?.locale],\n                  ['emailVerified', value?.associated_user?.email_verified],\n                  ['accountOwner', value?.associated_user?.account_owner],\n                  ['collaborator', value?.associated_user?.collaborator],\n                ];\n              }\n            default:\n              return [[key, value]];\n          }\n        })\n        // Filter out tuples with undefined values\n        .filter(([_key, value]) => value !== undefined)\n    );\n  }\n}\n", "export default crypto;\nexport const isCryptoKey = (key) => key instanceof CryptoKey;\n", "import digest from '../runtime/digest.js';\nexport const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nexport function p2s(alg, p2sInput) {\n    return concat(encoder.encode(alg), new Uint8Array([0]), p2sInput);\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function lengthAndInput(input) {\n    return concat(uint32be(input.length), input);\n}\nexport async function concatKdf(secret, bits, value) {\n    const iterations = Math.ceil((bits >> 3) / 32);\n    const res = new Uint8Array(iterations * 32);\n    for (let iter = 0; iter < iterations; iter++) {\n        const buf = new Uint8Array(4 + secret.length + value.length);\n        buf.set(uint32be(iter + 1));\n        buf.set(secret, 4);\n        buf.set(value, 4 + secret.length);\n        res.set(await digest('sha256', buf), iter * 32);\n    }\n    return res.slice(0, bits >> 3);\n}\n", "import { encoder, decoder } from '../lib/buffer_utils.js';\nexport const encodeBase64 = (input) => {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < unencoded.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, unencoded.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n};\nexport const encode = (input) => {\n    return encodeBase64(input).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n};\nexport const decodeBase64 = (encoded) => {\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n};\nexport const decode = (input) => {\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/').replace(/\\s/g, '');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n};\n", "export class JOSEError extends Error {\n    constructor(message, options) {\n        super(message, options);\n        this.code = 'ERR_JOSE_GENERIC';\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nJOSEError.code = 'ERR_JOSE_GENERIC';\nexport class JWTClaimValidationFailed extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTClaimValidationFailed.code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\nexport class JWTExpired extends JOSEError {\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.code = 'ERR_JWT_EXPIRED';\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nJWTExpired.code = 'ERR_JWT_EXPIRED';\nexport class JOSEAlgNotAllowed extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    }\n}\nJOSEAlgNotAllowed.code = 'ERR_JOSE_ALG_NOT_ALLOWED';\nexport class JOSENotSupported extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JOSE_NOT_SUPPORTED';\n    }\n}\nJOSENotSupported.code = 'ERR_JOSE_NOT_SUPPORTED';\nexport class JWEDecryptionFailed extends JOSEError {\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWE_DECRYPTION_FAILED';\n    }\n}\nJWEDecryptionFailed.code = 'ERR_JWE_DECRYPTION_FAILED';\nexport class JWEInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWE_INVALID';\n    }\n}\nJWEInvalid.code = 'ERR_JWE_INVALID';\nexport class JWSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWS_INVALID';\n    }\n}\nJWSInvalid.code = 'ERR_JWS_INVALID';\nexport class JWTInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWT_INVALID';\n    }\n}\nJWTInvalid.code = 'ERR_JWT_INVALID';\nexport class JWKInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWK_INVALID';\n    }\n}\nJWKInvalid.code = 'ERR_JWK_INVALID';\nexport class JWKSInvalid extends JOSEError {\n    constructor() {\n        super(...arguments);\n        this.code = 'ERR_JWKS_INVALID';\n    }\n}\nJWKSInvalid.code = 'ERR_JWKS_INVALID';\nexport class JWKSNoMatchingKey extends JOSEError {\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_NO_MATCHING_KEY';\n    }\n}\nJWKSNoMatchingKey.code = 'ERR_JWKS_NO_MATCHING_KEY';\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    }\n}\nSymbol.asyncIterator;\nJWKSMultipleMatchingKeys.code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\nexport class JWKSTimeout extends JOSEError {\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n        this.code = 'ERR_JWKS_TIMEOUT';\n    }\n}\nJWKSTimeout.code = 'ERR_JWKS_TIMEOUT';\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n        this.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    }\n}\nJWSSignatureVerificationFailed.code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n", "import crypto from './webcrypto.js';\nexport default crypto.getRandomValues.bind(crypto);\n", "function unusable(name, prop = 'algorithm.name') {\n    return new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\n}\nfunction isAlgorithm(algorithm, name) {\n    return algorithm.name === name;\n}\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usages) {\n    if (usages.length && !usages.some((expected) => key.usages.includes(expected))) {\n        let msg = 'CryptoKey does not support this operation, its usages must include ';\n        if (usages.length > 2) {\n            const last = usages.pop();\n            msg += `one of ${usages.join(', ')}, or ${last}.`;\n        }\n        else if (usages.length === 2) {\n            msg += `one of ${usages[0]} or ${usages[1]}.`;\n        }\n        else {\n            msg += `${usages[0]}.`;\n        }\n        throw new TypeError(msg);\n    }\n}\nexport function checkSigCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'EdDSA': {\n            if (key.algorithm.name !== 'Ed25519' && key.algorithm.name !== 'Ed448') {\n                throw unusable('Ed25519 or Ed448');\n            }\n            break;\n        }\n        case 'Ed25519': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\nexport function checkEncCryptoKey(key, alg, ...usages) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                case 'X448':\n                    break;\n                default:\n                    throw unusable('ECDH, X25519, or X448');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usages);\n}\n", "function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport default (actual, ...types) => {\n    return message('Key must be ', actual, ...types);\n};\nexport function withAlg(alg, actual, ...types) {\n    return message(`Key for the ${alg} algorithm must be `, actual, ...types);\n}\n", "import { isCryptoKey } from './webcrypto.js';\nexport default (key) => {\n    if (isCryptoKey(key)) {\n        return true;\n    }\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nexport const types = ['CryptoKey'];\n", "const isDisjoint = (...headers) => {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n};\nexport default isDisjoint;\n", "function isObjectLike(value) {\n    return typeof value === 'object' && value !== null;\n}\nexport default function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n", "export default (alg, key) => {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n};\n", "import isObject from './is_object.js';\nexport function isJWK(key) {\n    return isObject(key) && typeof key.kty === 'string';\n}\nexport function isPrivateJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'string';\n}\nexport function isPublicJWK(key) {\n    return key.kty !== 'oct' && typeof key.d === 'undefined';\n}\nexport function isSecretJWK(key) {\n    return isJWK(key) && key.kty === 'oct' && typeof key.k === 'string';\n}\n", "import crypto from './webcrypto.js';\nimport { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'EdDSA':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nconst parse = async (jwk) => {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const rest = [\n        algorithm,\n        jwk.ext ?? false,\n        jwk.key_ops ?? keyUsages,\n    ];\n    const keyData = { ...jwk };\n    delete keyData.alg;\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, ...rest);\n};\nexport default parse;\n", "import { isJWK } from '../lib/is_jwk.js';\nimport { decode } from './base64url.js';\nimport importJWK from './jwk_to_key.js';\nconst exportKeyValue = (k) => decode(k);\nlet privCache;\nlet pubCache;\nconst isKeyObject = (key) => {\n    return key?.[Symbol.toStringTag] === 'KeyObject';\n};\nconst importAndCache = async (cache, key, jwk, alg, freeze = false) => {\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await importJWK({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst normalizePublicKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        delete jwk.d;\n        delete jwk.dp;\n        delete jwk.dq;\n        delete jwk.p;\n        delete jwk.q;\n        delete jwk.qi;\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        pubCache || (pubCache = new WeakMap());\n        return importAndCache(pubCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        pubCache || (pubCache = new WeakMap());\n        const cryptoKey = importAndCache(pubCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nconst normalizePrivateKey = (key, alg) => {\n    if (isKeyObject(key)) {\n        let jwk = key.export({ format: 'jwk' });\n        if (jwk.k) {\n            return exportKeyValue(jwk.k);\n        }\n        privCache || (privCache = new WeakMap());\n        return importAndCache(privCache, key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k)\n            return decode(key.k);\n        privCache || (privCache = new WeakMap());\n        const cryptoKey = importAndCache(privCache, key, key, alg, true);\n        return cryptoKey;\n    }\n    return key;\n};\nexport default { normalizePublicKey, normalizePrivateKey };\n", "import { decode as decodeBase64URL } from '../runtime/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../runtime/asn1.js';\nimport asKeyObject from '../runtime/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport isObject from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    alg || (alg = jwk.alg);\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n        case 'EC':\n        case 'OKP':\n            return asKeyObject({ ...jwk, alg });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n", "import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport isKeyLike, { types } from '../runtime/is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined && key.use !== 'sig') {\n        throw new TypeError('Invalid key for this operation, when present its use must be sig');\n    }\n    if (key.key_ops !== undefined && key.key_ops.includes?.(usage) !== true) {\n        throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${usage}`);\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, when present its alg must be ${alg}`);\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (allowJwk && jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, 'Uint8Array', allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage, allowJwk) => {\n    if (allowJwk && jwk.isJWK(key)) {\n        switch (usage) {\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a private JWK`);\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, ...types, allowJwk ? 'JSON Web Key' : null));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (usage === 'sign' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n    }\n    if (usage === 'decrypt' && key.type === 'public') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n    }\n    if (key.algorithm && usage === 'verify' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n    }\n    if (key.algorithm && usage === 'encrypt' && key.type === 'private') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n    }\n};\nfunction checkKeyType(allowJwk, alg, key, usage) {\n    const symmetric = alg.startsWith('HS') ||\n        alg === 'dir' ||\n        alg.startsWith('PBES2') ||\n        /^A\\d{3}(?:GCM)?KW$/.test(alg);\n    if (symmetric) {\n        symmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n    else {\n        asymmetricTypeCheck(alg, key, usage, allowJwk);\n    }\n}\nexport default checkKeyType.bind(undefined, false);\nexport const checkKeyTypeWithJwk = checkKeyType.bind(undefined, true);\n", "import { JOSENotSupported } from '../util/errors.js';\nfunction validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\nexport default validateCrit;\n", "const validateAlgorithms = (option, algorithms) => {\n    if (algorithms !== undefined &&\n        (!Array.isArray(algorithms) || algorithms.some((s) => typeof s !== 'string'))) {\n        throw new TypeError(`\"${option}\" option must be an array of strings`);\n    }\n    if (!algorithms) {\n        return undefined;\n    }\n    return new Set(algorithms);\n};\nexport default validateAlgorithms;\n", "export const unprotected = Symbol();\n", "import { JOSENotSupported } from '../util/errors.js';\nexport default function subtleDsa(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: alg.slice(-3) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n            return { name: 'Ed25519' };\n        case 'EdDSA':\n            return { name: algorithm.name };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n", "import crypto, { isCryptoKey } from './webcrypto.js';\nimport { checkSigCryptoKey } from '../lib/crypto_key.js';\nimport invalidKeyInput from '../lib/invalid_key_input.js';\nimport { types } from './is_key_like.js';\nimport normalize from './normalize_key.js';\nexport default async function getCryptoKey(alg, key, usage) {\n    if (usage === 'sign') {\n        key = await normalize.normalizePrivateKey(key, alg);\n    }\n    if (usage === 'verify') {\n        key = await normalize.normalizePublicKey(key, alg);\n    }\n    if (isCryptoKey(key)) {\n        checkSigCryptoKey(key, alg, usage);\n        return key;\n    }\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, ...types));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    throw new TypeError(invalidKeyInput(key, ...types, 'Uint8Array', 'JSON Web Key'));\n}\n", "import subtleAlgorithm from './subtle_dsa.js';\nimport crypto from './webcrypto.js';\nimport checkKeyLength from './check_key_length.js';\nimport getVerifyKey from './get_sign_verify_key.js';\nconst verify = async (alg, key, signature, data) => {\n    const cryptoKey = await getVerifyKey(alg, key, 'verify');\n    checkKeyLength(alg, cryptoKey);\n    const algorithm = subtleAlgorithm(alg, cryptoKey.algorithm);\n    try {\n        return await crypto.subtle.verify(algorithm, cryptoKey, signature, data);\n    }\n    catch {\n        return false;\n    }\n};\nexport default verify;\n", "import { decode as base64url } from '../../runtime/base64url.js';\nimport verify from '../../runtime/verify.js';\nimport { JOSEAlgNotAllowed, JWSInvalid, JWSSignatureVerificationFailed } from '../../util/errors.js';\nimport { concat, encoder, decoder } from '../../lib/buffer_utils.js';\nimport isDisjoint from '../../lib/is_disjoint.js';\nimport isObject from '../../lib/is_object.js';\nimport { checkKeyTypeWithJwk } from '../../lib/check_key_type.js';\nimport validateCrit from '../../lib/validate_crit.js';\nimport validateAlgorithms from '../../lib/validate_algorithms.js';\nimport { isJWK } from '../../lib/is_jwk.js';\nimport { importJWK } from '../../key/import.js';\nexport async function flattenedVerify(jws, key, options) {\n    if (!isObject(jws)) {\n        throw new JWSInvalid('Flattened JWS must be an object');\n    }\n    if (jws.protected === undefined && jws.header === undefined) {\n        throw new JWSInvalid('Flattened JWS must have either of the \"protected\" or \"header\" members');\n    }\n    if (jws.protected !== undefined && typeof jws.protected !== 'string') {\n        throw new JWSInvalid('JWS Protected Header incorrect type');\n    }\n    if (jws.payload === undefined) {\n        throw new JWSInvalid('JWS Payload missing');\n    }\n    if (typeof jws.signature !== 'string') {\n        throw new JWSInvalid('JWS Signature missing or incorrect type');\n    }\n    if (jws.header !== undefined && !isObject(jws.header)) {\n        throw new JWSInvalid('JWS Unprotected Header incorrect type');\n    }\n    let parsedProt = {};\n    if (jws.protected) {\n        try {\n            const protectedHeader = base64url(jws.protected);\n            parsedProt = JSON.parse(decoder.decode(protectedHeader));\n        }\n        catch {\n            throw new JWSInvalid('JWS Protected Header is invalid');\n        }\n    }\n    if (!isDisjoint(parsedProt, jws.header)) {\n        throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n    }\n    const joseHeader = {\n        ...parsedProt,\n        ...jws.header,\n    };\n    const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, parsedProt, joseHeader);\n    let b64 = true;\n    if (extensions.has('b64')) {\n        b64 = parsedProt.b64;\n        if (typeof b64 !== 'boolean') {\n            throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n        }\n    }\n    const { alg } = joseHeader;\n    if (typeof alg !== 'string' || !alg) {\n        throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n    }\n    const algorithms = options && validateAlgorithms('algorithms', options.algorithms);\n    if (algorithms && !algorithms.has(alg)) {\n        throw new JOSEAlgNotAllowed('\"alg\" (Algorithm) Header Parameter value not allowed');\n    }\n    if (b64) {\n        if (typeof jws.payload !== 'string') {\n            throw new JWSInvalid('JWS Payload must be a string');\n        }\n    }\n    else if (typeof jws.payload !== 'string' && !(jws.payload instanceof Uint8Array)) {\n        throw new JWSInvalid('JWS Payload must be a string or an Uint8Array instance');\n    }\n    let resolvedKey = false;\n    if (typeof key === 'function') {\n        key = await key(parsedProt, jws);\n        resolvedKey = true;\n        checkKeyTypeWithJwk(alg, key, 'verify');\n        if (isJWK(key)) {\n            key = await importJWK(key, alg);\n        }\n    }\n    else {\n        checkKeyTypeWithJwk(alg, key, 'verify');\n    }\n    const data = concat(encoder.encode(jws.protected ?? ''), encoder.encode('.'), typeof jws.payload === 'string' ? encoder.encode(jws.payload) : jws.payload);\n    let signature;\n    try {\n        signature = base64url(jws.signature);\n    }\n    catch {\n        throw new JWSInvalid('Failed to base64url decode the signature');\n    }\n    const verified = await verify(alg, key, signature, data);\n    if (!verified) {\n        throw new JWSSignatureVerificationFailed();\n    }\n    let payload;\n    if (b64) {\n        try {\n            payload = base64url(jws.payload);\n        }\n        catch {\n            throw new JWSInvalid('Failed to base64url decode the payload');\n        }\n    }\n    else if (typeof jws.payload === 'string') {\n        payload = encoder.encode(jws.payload);\n    }\n    else {\n        payload = jws.payload;\n    }\n    const result = { payload };\n    if (jws.protected !== undefined) {\n        result.protectedHeader = parsedProt;\n    }\n    if (jws.header !== undefined) {\n        result.unprotectedHeader = jws.header;\n    }\n    if (resolvedKey) {\n        return { ...result, key };\n    }\n    return result;\n}\n", "import { flattenedVerify } from '../flattened/verify.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { decoder } from '../../lib/buffer_utils.js';\nexport async function compactVerify(jws, key, options) {\n    if (jws instanceof Uint8Array) {\n        jws = decoder.decode(jws);\n    }\n    if (typeof jws !== 'string') {\n        throw new JWSInvalid('Compact JWS must be a string or Uint8Array');\n    }\n    const { 0: protectedHeader, 1: payload, 2: signature, length } = jws.split('.');\n    if (length !== 3) {\n        throw new JWSInvalid('Invalid Compact JWS');\n    }\n    const verified = await flattenedVerify({ payload, protected: protectedHeader, signature }, key, options);\n    const result = { payload: verified.payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n", "export default (date) => Math.floor(date.getTime() / 1000);\n", "const minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport default (str) => {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n};\n", "import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { decoder } from './buffer_utils.js';\nimport epoch from './epoch.js';\nimport secs from './secs.js';\nimport isObject from './is_object.js';\nconst normalizeTyp = (value) => value.toLowerCase().replace(/^application\\//, '');\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport default (protectedHeader, encodedPayload, options = {}) => {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n};\n", "import { compactVerify } from '../jws/compact/verify.js';\nimport jwtPayload from '../lib/jwt_claims_set.js';\nimport { JWTInvalid } from '../util/errors.js';\nexport async function jwtVerify(jwt, key, options) {\n    const verified = await compactVerify(jwt, key, options);\n    if (verified.protectedHeader.crit?.includes('b64') && verified.protectedHeader.b64 === false) {\n        throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n    }\n    const payload = jwtPayload(verified.protectedHeader, verified.payload, options);\n    const result = { payload, protectedHeader: verified.protectedHeader };\n    if (typeof key === 'function') {\n        return { ...result, key: verified.key };\n    }\n    return result;\n}\n", "import fetchJwks from '../runtime/fetch_jwks.js';\nimport { JWKSNoMatchingKey } from '../util/errors.js';\nimport { createLocalJWKSet } from './local.js';\nimport isObject from '../lib/is_object.js';\nfunction isCloudflareWorkers() {\n    return (typeof WebSocketPair !== 'undefined' ||\n        (typeof navigator !== 'undefined' && navigator.userAgent === 'Cloudflare-Workers') ||\n        (typeof EdgeRuntime !== 'undefined' && EdgeRuntime === 'vercel'));\n}\nlet USER_AGENT;\nif (typeof navigator === 'undefined' || !navigator.userAgent?.startsWith?.('Mozilla/5.0 ')) {\n    const NAME = 'jose';\n    const VERSION = 'v5.10.0';\n    USER_AGENT = `${NAME}/${VERSION}`;\n}\nexport const jwksCache = Symbol();\nfunction isFreshJwksCache(input, cacheMaxAge) {\n    if (typeof input !== 'object' || input === null) {\n        return false;\n    }\n    if (!('uat' in input) || typeof input.uat !== 'number' || Date.now() - input.uat >= cacheMaxAge) {\n        return false;\n    }\n    if (!('jwks' in input) ||\n        !isObject(input.jwks) ||\n        !Array.isArray(input.jwks.keys) ||\n        !Array.prototype.every.call(input.jwks.keys, isObject)) {\n        return false;\n    }\n    return true;\n}\nclass RemoteJWKSet {\n    constructor(url, options) {\n        if (!(url instanceof URL)) {\n            throw new TypeError('url must be an instance of URL');\n        }\n        this._url = new URL(url.href);\n        this._options = { agent: options?.agent, headers: options?.headers };\n        this._timeoutDuration =\n            typeof options?.timeoutDuration === 'number' ? options?.timeoutDuration : 5000;\n        this._cooldownDuration =\n            typeof options?.cooldownDuration === 'number' ? options?.cooldownDuration : 30000;\n        this._cacheMaxAge = typeof options?.cacheMaxAge === 'number' ? options?.cacheMaxAge : 600000;\n        if (options?.[jwksCache] !== undefined) {\n            this._cache = options?.[jwksCache];\n            if (isFreshJwksCache(options?.[jwksCache], this._cacheMaxAge)) {\n                this._jwksTimestamp = this._cache.uat;\n                this._local = createLocalJWKSet(this._cache.jwks);\n            }\n        }\n    }\n    coolingDown() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cooldownDuration\n            : false;\n    }\n    fresh() {\n        return typeof this._jwksTimestamp === 'number'\n            ? Date.now() < this._jwksTimestamp + this._cacheMaxAge\n            : false;\n    }\n    async getKey(protectedHeader, token) {\n        if (!this._local || !this.fresh()) {\n            await this.reload();\n        }\n        try {\n            return await this._local(protectedHeader, token);\n        }\n        catch (err) {\n            if (err instanceof JWKSNoMatchingKey) {\n                if (this.coolingDown() === false) {\n                    await this.reload();\n                    return this._local(protectedHeader, token);\n                }\n            }\n            throw err;\n        }\n    }\n    async reload() {\n        if (this._pendingFetch && isCloudflareWorkers()) {\n            this._pendingFetch = undefined;\n        }\n        const headers = new Headers(this._options.headers);\n        if (USER_AGENT && !headers.has('User-Agent')) {\n            headers.set('User-Agent', USER_AGENT);\n            this._options.headers = Object.fromEntries(headers.entries());\n        }\n        this._pendingFetch || (this._pendingFetch = fetchJwks(this._url, this._timeoutDuration, this._options)\n            .then((json) => {\n            this._local = createLocalJWKSet(json);\n            if (this._cache) {\n                this._cache.uat = Date.now();\n                this._cache.jwks = json;\n            }\n            this._jwksTimestamp = Date.now();\n            this._pendingFetch = undefined;\n        })\n            .catch((err) => {\n            this._pendingFetch = undefined;\n            throw err;\n        }));\n        await this._pendingFetch;\n    }\n}\nexport function createRemoteJWKSet(url, options) {\n    const set = new RemoteJWKSet(url, options);\n    const remoteJWKSet = async (protectedHeader, token) => set.getKey(protectedHeader, token);\n    Object.defineProperties(remoteJWKSet, {\n        coolingDown: {\n            get: () => set.coolingDown(),\n            enumerable: true,\n            configurable: false,\n        },\n        fresh: {\n            get: () => set.fresh(),\n            enumerable: true,\n            configurable: false,\n        },\n        reload: {\n            value: () => set.reload(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n        reloading: {\n            get: () => !!set._pendingFetch,\n            enumerable: true,\n            configurable: false,\n        },\n        jwks: {\n            value: () => set._local?.jwks(),\n            enumerable: true,\n            configurable: false,\n            writable: false,\n        },\n    });\n    return remoteJWKSet;\n}\nexport const experimental_jwksCache = jwksCache;\n", "import * as base64url from '../runtime/base64url.js';\nexport const encode = base64url.encode;\nexport const decode = base64url.decode;\n", "export function getHMACKey(key: string): Uint8Array {\n  const arrayBuffer = new Uint8Array(key.length);\n  for (let i = 0, keyLen = key.length; i < keyLen; i++) {\n    arrayBuffer[i] = key.charCodeAt(i);\n  }\n\n  return arrayBuffer;\n}\n", "import * as jose from 'jose';\n\nimport {ConfigInterface} from '../base-types';\nimport * as ShopifyErrors from '../error';\nimport {getHMACKey} from '../utils/get-hmac-key';\n\nimport {JwtPayload} from './types';\n\nconst JWT_PERMITTED_CLOCK_TOLERANCE = 10;\n\nexport interface DecodeSessionTokenOptions {\n  checkAudience?: boolean;\n}\n\nexport function decodeSessionToken(config: ConfigInterface) {\n  return async (\n    token: string,\n    {checkAudience = true}: DecodeSessionTokenOptions = {},\n  ): Promise<JwtPayload> => {\n    let payload: JwtPayload;\n    try {\n      payload = (\n        await jose.jwtVerify(token, getHMACKey(config.apiSecretKey), {\n          algorithms: ['HS256'],\n          clockTolerance: JWT_PERMITTED_CLOCK_TOLERANCE,\n        })\n      ).payload as unknown as JwtPayload;\n    } catch (error) {\n      throw new ShopifyErrors.InvalidJwtError(\n        `Failed to parse session token '${token}': ${error.message}`,\n      );\n    }\n\n    // The exp and nbf fields are validated by the JWT library\n\n    if (checkAudience && payload.aud !== config.apiKey) {\n      throw new ShopifyErrors.InvalidJwtError(\n        'Session token had invalid API key',\n      );\n    }\n\n    return payload;\n  };\n}\n", "import {ConfigInterface} from '../base-types';\nimport {SESSION_COOKIE_NAME} from '../auth/oauth/types';\nimport {\n  abstractConvertRequest,\n  Cookies,\n  NormalizedResponse,\n} from '../../runtime/http';\nimport {sanitizeShop} from '../utils/shop-validator';\nimport {logger} from '../logger';\nimport * as ShopifyErrors from '../error';\n\nimport {decodeSessionToken} from './decode-session-token';\nimport type {GetCurrentSessionIdParams} from './types';\nimport {Session} from './session';\n\nexport function getJwtSessionId(config: ConfigInterface) {\n  return (shop: string, userId: string): string => {\n    return `${sanitizeShop(config)(shop, true)}_${userId}`;\n  };\n}\n\nexport function getOfflineId(config: ConfigInterface) {\n  return (shop: string): string => {\n    return `offline_${sanitizeShop(config)(shop, true)}`;\n  };\n}\n\nexport function getCurrentSessionId(config: ConfigInterface) {\n  return async function getCurrentSessionId({\n    isOnline,\n    ...adapterArgs\n  }: GetCurrentSessionIdParams): Promise<string | undefined> {\n    const request = await abstractConvertRequest(adapterArgs);\n\n    const log = logger(config);\n\n    if (config.isEmbeddedApp) {\n      log.debug('App is embedded, looking for session id in JWT payload', {\n        isOnline,\n      });\n\n      const authHeader = request.headers.Authorization;\n      if (authHeader) {\n        const matches = (\n          typeof authHeader === 'string' ? authHeader : authHeader[0]\n        ).match(/^Bearer (.+)$/);\n        if (!matches) {\n          log.error('Missing Bearer token in authorization header', {isOnline});\n\n          throw new ShopifyErrors.MissingJwtTokenError(\n            'Missing Bearer token in authorization header',\n          );\n        }\n\n        const jwtPayload = await decodeSessionToken(config)(matches[1]);\n        const shop = jwtPayload.dest.replace(/^https:\\/\\//, '');\n\n        log.debug('Found valid JWT payload', {shop, isOnline});\n\n        if (isOnline) {\n          return getJwtSessionId(config)(shop, jwtPayload.sub);\n        } else {\n          return getOfflineId(config)(shop);\n        }\n      } else {\n        log.error(\n          'Missing Authorization header, was the request made with authenticatedFetch?',\n          {isOnline},\n        );\n      }\n    } else {\n      log.debug('App is not embedded, looking for session id in cookies', {\n        isOnline,\n      });\n\n      const cookies = new Cookies(request, {} as NormalizedResponse, {\n        keys: [config.apiSecretKey],\n      });\n      return cookies.getAndVerify(SESSION_COOKIE_NAME);\n    }\n\n    return undefined;\n  };\n}\n\nexport function customAppSession(config: ConfigInterface) {\n  return (shop: string): Session => {\n    return new Session({\n      id: '',\n      shop: `${sanitizeShop(config)(shop, true)}`,\n      state: '',\n      isOnline: false,\n    });\n  };\n}\n", "import {v4 as uuidv4} from 'uuid';\n\nimport {Session} from '../../session/session';\nimport {ConfigInterface} from '../../base-types';\nimport {logger} from '../../logger';\nimport {getJwtSessionId, getOfflineId} from '../../session/session-utils';\n\nimport {\n  AccessTokenResponse,\n  OnlineAccessResponse,\n  OnlineAccessInfo,\n  OfflineAccessResponse,\n} from './types';\n\nexport function createSession({\n  config,\n  accessTokenResponse,\n  shop,\n  state,\n}: {\n  config: ConfigInterface;\n  accessTokenResponse: AccessTokenResponse;\n  shop: string;\n  state: string;\n}): Session {\n  const associatedUser = (accessTokenResponse as OnlineAccessResponse)\n    .associated_user;\n  const isOnline = Boolean(associatedUser);\n\n  logger(config).info('Creating new session', {shop, isOnline});\n\n  const getSessionExpiration = (expires_in: number) =>\n    new Date(Date.now() + expires_in * 1000);\n\n  const getOnlineSessionProperties = (responseBody: OnlineAccessResponse) => {\n    const {access_token, scope, ...rest} = responseBody;\n    const sessionId = config.isEmbeddedApp\n      ? getJwtSessionId(config)(\n          shop,\n          `${(rest as OnlineAccessInfo).associated_user.id}`,\n        )\n      : uuidv4();\n\n    return {\n      id: sessionId,\n      onlineAccessInfo: rest,\n      expires: getSessionExpiration(rest.expires_in),\n    };\n  };\n\n  const getOfflineSessionProperties = (responseBody: OfflineAccessResponse) => {\n    const {expires_in} = responseBody;\n    return {\n      id: getOfflineId(config)(shop),\n      ...(expires_in && {expires: getSessionExpiration(expires_in)}),\n    };\n  };\n\n  return new Session({\n    shop,\n    state,\n    isOnline,\n    accessToken: accessTokenResponse.access_token,\n    scope: accessTokenResponse.scope,\n    ...(isOnline\n      ? getOnlineSessionProperties(accessTokenResponse as OnlineAccessResponse)\n      : getOfflineSessionProperties(\n          accessTokenResponse as OfflineAccessResponse,\n        )),\n  });\n}\n", "import {isbot} from 'isbot';\n\nimport {throwFailedRequest} from '../../clients/common';\nimport ProcessedQuery from '../../utils/processed-query';\nimport {ConfigInterface} from '../../base-types';\nimport * as ShopifyErrors from '../../error';\nimport {validateHmac} from '../../utils/hmac-validator';\nimport {sanitizeShop} from '../../utils/shop-validator';\nimport {Session} from '../../session/session';\nimport {\n  abstractConvertRequest,\n  abstractConvertIncomingResponse,\n  abstractConvertResponse,\n  abstractConvertHeaders,\n  AdapterResponse,\n  AdapterHeaders,\n  Cookies,\n  NormalizedResponse,\n  NormalizedRequest,\n} from '../../../runtime/http';\nimport {logger, ShopifyLogger} from '../../logger';\nimport {DataType} from '../../clients/types';\nimport {fetchRequestFactory} from '../../utils/fetch-request';\n\nimport {\n  SESSION_COOKIE_NAME,\n  STATE_COOKIE_NAME,\n  BeginParams,\n  CallbackParams,\n  AuthQuery,\n  AccessTokenResponse,\n} from './types';\nimport {nonce} from './nonce';\nimport {safeCompare} from './safe-compare';\nimport {createSession} from './create-session';\n\nexport type OAuthBegin = (beginParams: BeginParams) => Promise<AdapterResponse>;\n\nexport interface CallbackResponse<T = AdapterHeaders> {\n  headers: T;\n  session: Session;\n}\n\nexport type OAuthCallback = <T = AdapterHeaders>(\n  callbackParams: CallbackParams,\n) => Promise<CallbackResponse<T>>;\n\ninterface BotLog {\n  request: NormalizedRequest;\n  log: ShopifyLogger;\n  func: string;\n}\n\nconst logForBot = ({request, log, func}: BotLog) => {\n  log.debug(`Possible bot request to auth ${func}: `, {\n    userAgent: request.headers['User-Agent'],\n  });\n};\n\nexport function begin(config: ConfigInterface): OAuthBegin {\n  return async ({\n    shop,\n    callbackPath,\n    isOnline,\n    ...adapterArgs\n  }: BeginParams): Promise<AdapterResponse> => {\n    throwIfCustomStoreApp(\n      config.isCustomStoreApp,\n      'Cannot perform OAuth for private apps',\n    );\n\n    const log = logger(config);\n    log.info('Beginning OAuth', {shop, isOnline, callbackPath});\n\n    const request = await abstractConvertRequest(adapterArgs);\n    const response = await abstractConvertIncomingResponse(adapterArgs);\n\n    let userAgent = request.headers['User-Agent'];\n    if (Array.isArray(userAgent)) {\n      userAgent = userAgent[0];\n    }\n    if (isbot(userAgent)) {\n      logForBot({request, log, func: 'begin'});\n      response.statusCode = 410;\n      return abstractConvertResponse(response, adapterArgs);\n    }\n\n    const cookies = new Cookies(request, response, {\n      keys: [config.apiSecretKey],\n      secure: true,\n    });\n\n    const state = nonce();\n\n    await cookies.setAndSign(STATE_COOKIE_NAME, state, {\n      expires: new Date(Date.now() + 60000),\n      sameSite: 'lax',\n      secure: true,\n      path: callbackPath,\n    });\n\n    const scopes = config.scopes ? config.scopes.toString() : '';\n    const query = {\n      client_id: config.apiKey,\n      scope: scopes,\n      redirect_uri: `${config.hostScheme}://${config.hostName}${callbackPath}`,\n      state,\n      'grant_options[]': isOnline ? 'per-user' : '',\n    };\n    const processedQuery = new ProcessedQuery();\n    processedQuery.putAll(query);\n\n    const cleanShop = sanitizeShop(config)(shop, true)!;\n    const redirectUrl = `https://${cleanShop}/admin/oauth/authorize${processedQuery.stringify()}`;\n    response.statusCode = 302;\n    response.statusText = 'Found';\n    response.headers = {\n      ...response.headers,\n      ...cookies.response.headers!,\n      Location: redirectUrl,\n    };\n\n    log.debug(`OAuth started, redirecting to ${redirectUrl}`, {shop, isOnline});\n\n    return abstractConvertResponse(response, adapterArgs);\n  };\n}\n\nexport function callback(config: ConfigInterface): OAuthCallback {\n  return async function callback<T = AdapterHeaders>({\n    ...adapterArgs\n  }: CallbackParams): Promise<CallbackResponse<T>> {\n    throwIfCustomStoreApp(\n      config.isCustomStoreApp,\n      'Cannot perform OAuth for private apps',\n    );\n\n    const log = logger(config);\n\n    const request = await abstractConvertRequest(adapterArgs);\n\n    const query = new URL(\n      request.url,\n      `${config.hostScheme}://${config.hostName}`,\n    ).searchParams;\n    const shop = query.get('shop')!;\n\n    const response = {} as NormalizedResponse;\n    let userAgent = request.headers['User-Agent'];\n    if (Array.isArray(userAgent)) {\n      userAgent = userAgent[0];\n    }\n    if (isbot(userAgent)) {\n      logForBot({request, log, func: 'callback'});\n      throw new ShopifyErrors.BotActivityDetected(\n        'Invalid OAuth callback initiated by bot',\n      );\n    }\n\n    log.info('Completing OAuth', {shop});\n\n    const cookies = new Cookies(request, response, {\n      keys: [config.apiSecretKey],\n      secure: true,\n    });\n\n    const stateFromCookie = await cookies.getAndVerify(STATE_COOKIE_NAME);\n    cookies.deleteCookie(STATE_COOKIE_NAME);\n    if (!stateFromCookie) {\n      log.error('Could not find OAuth cookie', {shop});\n\n      throw new ShopifyErrors.CookieNotFound(\n        `Cannot complete OAuth process. Could not find an OAuth cookie for shop url: ${shop}`,\n      );\n    }\n\n    const authQuery: AuthQuery = Object.fromEntries(query.entries());\n    if (!(await validQuery({config, query: authQuery, stateFromCookie}))) {\n      log.error('Invalid OAuth callback', {shop, stateFromCookie});\n\n      throw new ShopifyErrors.InvalidOAuthError('Invalid OAuth callback.');\n    }\n\n    log.debug('OAuth request is valid, requesting access token', {shop});\n\n    const body = {\n      client_id: config.apiKey,\n      client_secret: config.apiSecretKey,\n      code: query.get('code'),\n    };\n\n    const cleanShop = sanitizeShop(config)(query.get('shop')!, true)!;\n\n    const postResponse = await fetchRequestFactory(config)(\n      `https://${cleanShop}/admin/oauth/access_token`,\n      {\n        method: 'POST',\n        body: JSON.stringify(body),\n        headers: {\n          'Content-Type': DataType.JSON,\n          Accept: DataType.JSON,\n        },\n      },\n    );\n\n    if (!postResponse.ok) {\n      throwFailedRequest(await postResponse.json(), false, postResponse);\n    }\n\n    const session: Session = createSession({\n      accessTokenResponse: await postResponse.json<AccessTokenResponse>(),\n      shop: cleanShop,\n      state: stateFromCookie,\n      config,\n    });\n\n    if (!config.isEmbeddedApp) {\n      await cookies.setAndSign(SESSION_COOKIE_NAME, session.id, {\n        expires: session.expires,\n        sameSite: 'lax',\n        secure: true,\n        path: '/',\n      });\n    }\n\n    return {\n      headers: (await abstractConvertHeaders(\n        cookies.response.headers!,\n        adapterArgs,\n      )) as T,\n      session,\n    };\n  };\n}\n\nasync function validQuery({\n  config,\n  query,\n  stateFromCookie,\n}: {\n  config: ConfigInterface;\n  query: AuthQuery;\n  stateFromCookie: string;\n}): Promise<boolean> {\n  return (\n    (await validateHmac(config)(query)) &&\n    safeCompare(query.state!, stateFromCookie)\n  );\n}\n\nfunction throwIfCustomStoreApp(\n  isCustomStoreApp: boolean,\n  message: string,\n): void {\n  if (isCustomStoreApp) {\n    throw new ShopifyErrors.PrivateAppError(message);\n  }\n}\n", "import * as ShopifyErrors from '../error';\nimport {ConfigInterface} from '../base-types';\nimport {abstractConvertRequest} from '../../runtime/http';\nimport {sanitizeHost} from '../utils/shop-validator';\n\nimport {decodeHost} from './decode-host';\nimport {GetEmbeddedAppUrlParams} from './types';\n\nexport type GetEmbeddedAppUrl = (\n  params: GetEmbeddedAppUrlParams,\n) => Promise<string>;\n\nexport type BuildEmbeddedAppUrl = (host: string) => string;\n\nexport function getEmbeddedAppUrl(config: ConfigInterface): GetEmbeddedAppUrl {\n  return async ({...adapterArgs}: GetEmbeddedAppUrlParams): Promise<string> => {\n    const request = await abstractConvertRequest(adapterArgs);\n\n    if (!request) {\n      throw new ShopifyErrors.MissingRequiredArgument(\n        'getEmbeddedAppUrl requires a request object argument',\n      );\n    }\n\n    if (!request.url) {\n      throw new ShopifyErrors.InvalidRequestError(\n        'Request does not contain a URL',\n      );\n    }\n\n    const url = new URL(request.url, `https://${request.headers.host}`);\n    const host = url.searchParams.get('host');\n\n    if (typeof host !== 'string') {\n      throw new ShopifyErrors.InvalidRequestError(\n        'Request does not contain a host query parameter',\n      );\n    }\n\n    return buildEmbeddedAppUrl(config)(host);\n  };\n}\n\nexport function buildEmbeddedAppUrl(\n  config: ConfigInterface,\n): BuildEmbeddedAppUrl {\n  return (host: string): string => {\n    sanitizeHost()(host, true);\n    const decodedHost = decodeHost(host);\n\n    return `https://${decodedHost}/apps/${config.apiKey}`;\n  };\n}\n", "import {throwFailedRequest} from '../../clients/common';\nimport {decodeSessionToken} from '../../session/decode-session-token';\nimport {sanitizeShop} from '../../utils/shop-validator';\nimport {ConfigInterface} from '../../base-types';\nimport {Session} from '../../session/session';\nimport {DataType} from '../../clients/types';\nimport {fetchRequestFactory} from '../../utils/fetch-request';\n\nimport {createSession} from './create-session';\nimport {AccessTokenResponse} from './types';\n\nexport enum RequestedTokenType {\n  OnlineAccessToken = 'urn:shopify:params:oauth:token-type:online-access-token',\n  OfflineAccessToken = 'urn:shopify:params:oauth:token-type:offline-access-token',\n}\n\nconst TokenExchangeGrantType =\n  'urn:ietf:params:oauth:grant-type:token-exchange';\nconst IdTokenType = 'urn:ietf:params:oauth:token-type:id_token';\n\nexport interface TokenExchangeParams {\n  shop: string;\n  sessionToken: string;\n  requestedTokenType: RequestedTokenType;\n}\n\nexport type TokenExchange = (\n  params: TokenExchangeParams,\n) => Promise<{session: Session}>;\n\nexport function tokenExchange(config: ConfigInterface): TokenExchange {\n  return async ({\n    shop,\n    sessionToken,\n    requestedTokenType,\n  }: TokenExchangeParams) => {\n    await decodeSessionToken(config)(sessionToken);\n\n    const body = {\n      client_id: config.apiKey,\n      client_secret: config.apiSecretKey,\n      grant_type: TokenExchangeGrantType,\n      subject_token: sessionToken,\n      subject_token_type: IdTokenType,\n      requested_token_type: requestedTokenType,\n    };\n\n    const cleanShop = sanitizeShop(config)(shop, true)!;\n\n    const postResponse = await fetchRequestFactory(config)(\n      `https://${cleanShop}/admin/oauth/access_token`,\n      {\n        method: 'POST',\n        body: JSON.stringify(body),\n        headers: {\n          'Content-Type': DataType.JSON,\n          Accept: DataType.JSON,\n        },\n      },\n    );\n\n    if (!postResponse.ok) {\n      throwFailedRequest(await postResponse.json(), false, postResponse);\n    }\n\n    return {\n      session: createSession({\n        accessTokenResponse: await postResponse.json<AccessTokenResponse>(),\n        shop: cleanShop,\n        // We need to keep this as an empty string as our template DB schemas have this required\n        state: '',\n        config,\n      }),\n    };\n  };\n}\n", "import {ConfigInterface} from '../../base-types';\nimport {throwFailedRequest} from '../../clients/common';\nimport {DataType} from '../../clients/types';\nimport {Session} from '../../session/session';\nimport {fetchRequestFactory} from '../../utils/fetch-request';\nimport {sanitizeShop} from '../../utils/shop-validator';\n\nimport {createSession} from './create-session';\nimport {AccessTokenResponse} from './types';\n\nexport interface ClientCredentialsParams {\n  shop: string;\n}\n\nconst ClientCredentialsGrantType = 'client_credentials';\n\nexport type ClientCredentials = (\n  params: ClientCredentialsParams,\n) => Promise<{session: Session}>;\n\nexport function clientCredentials(config: ConfigInterface): ClientCredentials {\n  return async ({shop}: ClientCredentialsParams) => {\n    const cleanShop = sanitizeShop(config)(shop, true)!;\n\n    const requestConfig = {\n      method: 'POST',\n      body: JSON.stringify({\n        client_id: config.apiKey,\n        client_secret: config.apiSecretKey,\n        grant_type: ClientCredentialsGrantType,\n      }),\n      headers: {\n        'Content-Type': DataType.JSON,\n        Accept: DataType.JSON,\n      },\n    };\n\n    const postResponse = await fetchRequestFactory(config)(\n      `https://${cleanShop}/admin/oauth/access_token`,\n      requestConfig,\n    );\n\n    const responseData = (await postResponse.json()) as AccessTokenResponse;\n\n    if (!postResponse.ok) {\n      throwFailedRequest(responseData, false, postResponse);\n    }\n\n    return {\n      session: createSession({\n        accessTokenResponse: responseData,\n        shop: cleanShop,\n        // We need to keep this as an empty string as our template DB schemas have this required\n        state: '',\n        config,\n      }),\n    };\n  };\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {OAuthBegin, OAuthCallback, begin, callback} from './oauth/oauth';\nimport {Nonce, nonce} from './oauth/nonce';\nimport {SafeCompare, safeCompare} from './oauth/safe-compare';\nimport {\n  getEmbeddedAppUrl,\n  buildEmbeddedAppUrl,\n  GetEmbeddedAppUrl,\n  BuildEmbeddedAppUrl,\n} from './get-embedded-app-url';\nimport {TokenExchange, tokenExchange} from './oauth/token-exchange';\nimport {ClientCredentials, clientCredentials} from './oauth/client-credentials';\n\nexport {AuthScopes} from './scopes';\n\nexport function shopifyAuth<Config extends ConfigInterface>(\n  config: Config,\n): ShopifyAuth {\n  const shopify = {\n    begin: begin(config),\n    callback: callback(config),\n    nonce,\n    safeCompare,\n    getEmbeddedAppUrl: getEmbeddedAppUrl(config),\n    buildEmbeddedAppUrl: buildEmbeddedAppUrl(config),\n    tokenExchange: tokenExchange(config),\n    clientCredentials: clientCredentials(config),\n  } as ShopifyAuth;\n\n  return shopify;\n}\n\nexport interface ShopifyAuth {\n  begin: OAuthBegin;\n  callback: OAuthCallback;\n  nonce: Nonce;\n  safeCompare: SafeCompare;\n  getEmbeddedAppUrl: GetEmbeddedAppUrl;\n  buildEmbeddedAppUrl: BuildEmbeddedAppUrl;\n  tokenExchange: TokenExchange;\n  clientCredentials: ClientCredentials;\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {decodeSessionToken} from './decode-session-token';\nimport {\n  customAppSession,\n  getCurrentSessionId,\n  getJwtSessionId,\n  getOfflineId,\n} from './session-utils';\n\nexport function shopifySession(config: ConfigInterface) {\n  return {\n    customAppSession: customAppSession(config),\n    getCurrentId: getCurrentSessionId(config),\n    getOfflineId: getOfflineId(config),\n    getJwtSessionId: getJwtSessionId(config),\n    decodeSessionToken: decodeSessionToken(config),\n  };\n}\n\nexport type ShopifySession = ReturnType<typeof shopifySession>;\n", "import {ConfigInterface} from '../base-types';\nimport {ApiVersion} from '../types';\n\nexport function versionCompatible(config: ConfigInterface) {\n  return (\n    referenceVersion: ApiVersion,\n    currentVersion: ApiVersion = config.apiVersion,\n  ): boolean => {\n    // Return true if not using a dated version\n    if (currentVersion === ApiVersion.Unstable) {\n      return true;\n    }\n    const numericVersion = (version: string) =>\n      parseInt(version.replace('-', ''), 10);\n    const current = numericVersion(currentVersion);\n    const reference = numericVersion(referenceVersion);\n    return current >= reference;\n  };\n}\n\nexport function versionPriorTo(config: ConfigInterface) {\n  return (\n    referenceVersion: ApiVersion,\n    currentVersion: ApiVersion = config.apiVersion,\n  ): boolean => {\n    return !versionCompatible(config)(referenceVersion, currentVersion);\n  };\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {sanitizeShop, sanitizeHost} from './shop-validator';\nimport {validateHmac} from './hmac-validator';\nimport {versionCompatible, versionPriorTo} from './version-compatible';\nimport {\n  shopAdminUrlToLegacyUrl,\n  legacyUrlToShopAdminUrl,\n} from './shop-admin-url-helper';\n\nexport function shopifyUtils(config: ConfigInterface) {\n  return {\n    sanitizeShop: sanitizeShop(config),\n    sanitizeHost: sanitizeHost(),\n    validateHmac: validateHmac(config),\n    versionCompatible: versionCompatible(config),\n    versionPriorTo: versionPriorTo(config),\n    shopAdminUrlToLegacyUrl,\n    legacyUrlToShopAdminUrl,\n  };\n}\n\nexport type ShopifyUtils = ReturnType<typeof shopifyUtils>;\n", "import {ValidationErrorReason, ValidationInvalid} from '../utils/types';\nimport {AdapterArgs} from '../../runtime/types';\nimport {Session} from '../session/session';\n\nexport enum DeliveryMethod {\n  Http = 'http',\n  EventBridge = 'eventbridge',\n  PubSub = 'pubsub',\n}\n\nexport type WebhookHandlerFunction = (\n  topic: string,\n  shop_domain: string,\n  body: string,\n  webhookId: string,\n  apiVersion?: string,\n  subTopic?: string,\n  context?: any,\n) => Promise<void>;\n\ninterface BaseWebhookHandler {\n  id?: string;\n  includeFields?: string[];\n  metafieldNamespaces?: string[];\n  subTopic?: string;\n  context?: any;\n}\n\nexport interface HttpWebhookHandler extends BaseWebhookHandler {\n  deliveryMethod: DeliveryMethod.Http;\n  callbackUrl: string;\n}\n\nexport interface HttpWebhookHandlerWithCallback extends HttpWebhookHandler {\n  callback: WebhookHandlerFunction;\n}\n\nexport interface EventBridgeWebhookHandler extends BaseWebhookHandler {\n  deliveryMethod: DeliveryMethod.EventBridge;\n  arn: string;\n}\n\nexport interface PubSubWebhookHandler extends BaseWebhookHandler {\n  deliveryMethod: DeliveryMethod.PubSub;\n  pubSubProject: string;\n  pubSubTopic: string;\n}\n\nexport type WebhookHandler =\n  | HttpWebhookHandler\n  | HttpWebhookHandlerWithCallback\n  | EventBridgeWebhookHandler\n  | PubSubWebhookHandler;\n\n// See https://shopify.dev/docs/api/admin-graphql/latest/enums/webhooksubscriptiontopic for available topics\nexport type WebhookRegistry<Handler extends WebhookHandler = WebhookHandler> =\n  Record<string, Handler[]>;\n\n// eslint-disable-next-line no-warning-comments\n// TODO Rethink the wording for this enum - the operations we're doing are actually \"subscribing\" and \"unsubscribing\"\n// Consider changing the values when releasing v12.0.0 when it can be safely deprecated\nexport enum WebhookOperation {\n  Create = 'create',\n  Update = 'update',\n  Delete = 'delete',\n}\n\nexport interface RegisterParams {\n  session: Session;\n}\n\nexport interface RegisterResult {\n  success: boolean;\n  deliveryMethod: DeliveryMethod;\n  result: unknown;\n  operation: WebhookOperation;\n}\n\nexport type RegisterReturn = Record<string, RegisterResult[]>;\n\ninterface WebhookHttpEndpoint {\n  __typename: 'WebhookHttpEndpoint';\n  callbackUrl: string;\n}\ninterface WebhookEventBridgeEndpoint {\n  __typename: 'WebhookEventBridgeEndpoint';\n  arn: string;\n}\ninterface WebhookPubSubEndpoint {\n  __typename: 'WebhookPubSubEndpoint';\n  pubSubProject: string;\n  pubSubTopic: string;\n}\n\ntype WebhookEndpoint =\n  | WebhookHttpEndpoint\n  | WebhookEventBridgeEndpoint\n  | WebhookPubSubEndpoint;\n\nexport interface WebhookCheckResponseNode<\n  T = {\n    endpoint: WebhookEndpoint;\n  },\n> {\n  node: {\n    id: string;\n    topic: string;\n    includeFields: string[];\n    metafieldNamespaces: string[];\n  } & T;\n}\n\nexport interface WebhookCheckResponse<T = WebhookCheckResponseNode> {\n  webhookSubscriptions: {\n    edges: T[];\n    pageInfo: {\n      endCursor: string;\n      hasNextPage: boolean;\n    };\n  };\n}\n\nexport type AddHandlersParams = Record<\n  string,\n  WebhookHandler | WebhookHandler[]\n>;\n\nexport interface WebhookProcessParams extends AdapterArgs {\n  rawBody: string;\n  context?: any;\n}\n\nexport interface WebhookValidateParams extends WebhookProcessParams {}\n\nexport const WebhookValidationErrorReason = {\n  ...ValidationErrorReason,\n  MissingHeaders: 'missing_headers',\n} as const;\n\nexport type WebhookValidationErrorReasonType =\n  (typeof WebhookValidationErrorReason)[keyof typeof WebhookValidationErrorReason];\n\nexport interface WebhookFields {\n  webhookId: string;\n  apiVersion: string;\n  domain: string;\n  hmac: string;\n  topic: string;\n  subTopic?: string;\n}\n\nexport interface WebhookValidationInvalid\n  extends Omit<ValidationInvalid, 'reason'> {\n  valid: false;\n  reason: WebhookValidationErrorReasonType;\n}\n\nexport interface WebhookValidationMissingHeaders\n  extends WebhookValidationInvalid {\n  reason: typeof WebhookValidationErrorReason.MissingHeaders;\n  missingHeaders: string[];\n}\n\nexport interface WebhookValidationValid extends WebhookFields {\n  valid: true;\n}\n\nexport type WebhookValidation =\n  | WebhookValidationValid\n  | WebhookValidationInvalid\n  | WebhookValidationMissingHeaders;\n", "import {InvalidDeliveryMethodError} from '../error';\nimport {ConfigInterface} from '../base-types';\nimport {logger} from '../logger';\n\nimport {\n  AddHandlersParams,\n  DeliveryMethod,\n  WebhookHandler,\n  WebhookRegistry,\n} from './types';\n\nexport function registry(): WebhookRegistry {\n  return {};\n}\n\nexport function topicForStorage(topic: string): string {\n  return topic.toUpperCase().replace(/\\/|\\./g, '_');\n}\n\nexport function addHandlers(\n  config: ConfigInterface,\n  webhookRegistry: WebhookRegistry,\n) {\n  return function addHandlers(handlersToAdd: AddHandlersParams) {\n    for (const [topic, handlers] of Object.entries(handlersToAdd)) {\n      const topicKey = topicForStorage(topic);\n\n      if (Array.isArray(handlers)) {\n        for (const handler of handlers) {\n          mergeOrAddHandler(config, webhookRegistry, topicKey, handler);\n        }\n      } else {\n        mergeOrAddHandler(config, webhookRegistry, topicKey, handlers);\n      }\n    }\n  };\n}\n\nexport function getTopicsAdded(webhookRegistry: WebhookRegistry) {\n  return function getTopicsAdded(): string[] {\n    return Object.keys(webhookRegistry);\n  };\n}\n\nexport function getHandlers(webhookRegistry: WebhookRegistry) {\n  return function getHandlers(topic: string): WebhookHandler[] {\n    return webhookRegistry[topicForStorage(topic)] || [];\n  };\n}\n\nexport function handlerIdentifier(\n  config: ConfigInterface,\n  handler: WebhookHandler,\n): string {\n  const prefix = handler.deliveryMethod;\n\n  switch (handler.deliveryMethod) {\n    case DeliveryMethod.Http:\n      return `${prefix}_${addHostToCallbackUrl(config, handler.callbackUrl)}`;\n    case DeliveryMethod.EventBridge:\n      return `${prefix}_${handler.arn}`;\n    case DeliveryMethod.PubSub:\n      return `${prefix}_${handler.pubSubProject}:${handler.pubSubTopic}`;\n    default:\n      throw new InvalidDeliveryMethodError(\n        `Unrecognized delivery method '${(handler as any).deliveryMethod}'`,\n      );\n  }\n}\n\nexport function addHostToCallbackUrl(\n  config: ConfigInterface,\n  callbackUrl: string,\n): string {\n  if (callbackUrl.startsWith('/')) {\n    return `${config.hostScheme}://${config.hostName}${callbackUrl}`;\n  } else {\n    return callbackUrl;\n  }\n}\n\nfunction mergeOrAddHandler(\n  config: ConfigInterface,\n  webhookRegistry: WebhookRegistry,\n  topic: string,\n  handler: WebhookHandler,\n) {\n  const log = logger(config);\n\n  handler.includeFields?.sort();\n  handler.metafieldNamespaces?.sort();\n\n  if (!(topic in webhookRegistry)) {\n    webhookRegistry[topic] = [handler];\n    return;\n  }\n\n  const identifier = handlerIdentifier(config, handler);\n\n  for (const index in webhookRegistry[topic]) {\n    if (!Object.prototype.hasOwnProperty.call(webhookRegistry[topic], index)) {\n      continue;\n    }\n\n    const existingHandler = webhookRegistry[topic][index];\n    const existingIdentifier = handlerIdentifier(config, existingHandler);\n\n    if (identifier !== existingIdentifier) {\n      continue;\n    }\n\n    if (handler.deliveryMethod === DeliveryMethod.Http) {\n      log.info(\n        `Detected multiple handlers for '${topic}', webhooks.process will call them sequentially`,\n      );\n      break;\n    } else {\n      throw new InvalidDeliveryMethodError(\n        `Can only add multiple handlers for a topic when deliveryMethod is Http. Please be sure that you used addHandler method once after creating ShopifyApi instance in your app.  Invalid handler: ${JSON.stringify(\n          handler,\n        )}`,\n      );\n    }\n  }\n\n  webhookRegistry[topic].push(handler);\n}\n", "export function queryTemplate(template: string, params: Record<string, any>) {\n  let query = template;\n\n  Object.entries(params).forEach(([key, value]) => {\n    query = query.replace(`{{${key}}}`, value);\n  });\n\n  return query;\n}\n", "import {graphqlClientClass, GraphqlClient} from '../clients/admin';\nimport {InvalidDeliveryMethodError, ShopifyError} from '../error';\nimport {logger} from '../logger';\nimport {privacyTopics} from '../types';\nimport {ConfigInterface} from '../base-types';\nimport {Session} from '../session/session';\n\nimport {addHostToCallbackUrl, getHandlers, handlerIdentifier} from './registry';\nimport {queryTemplate} from './query-template';\nimport {\n  WebhookRegistry,\n  RegisterReturn,\n  WebhookHandler,\n  WebhookCheckResponse,\n  DeliveryMethod,\n  WebhookCheckResponseNode,\n  WebhookOperation,\n  RegisterResult,\n  RegisterParams,\n} from './types';\n\ninterface RegisterTopicParams {\n  config: ConfigInterface;\n  session: Session;\n  topic: string;\n  existingHandlers: WebhookHandler[];\n  handlers: WebhookHandler[];\n}\n\ninterface RunMutationsParams {\n  config: ConfigInterface;\n  client: GraphqlClient;\n  topic: string;\n  handlers: WebhookHandler[];\n  operation: WebhookOperation;\n}\n\ninterface RunMutationParams {\n  config: ConfigInterface;\n  client: GraphqlClient;\n  topic: string;\n  handler: WebhookHandler;\n  operation: WebhookOperation;\n}\n\nexport function register(\n  config: ConfigInterface,\n  webhookRegistry: WebhookRegistry,\n) {\n  return async function register({\n    session,\n  }: RegisterParams): Promise<RegisterReturn> {\n    const log = logger(config);\n    log.info('Registering webhooks', {shop: session.shop});\n\n    const registerReturn: RegisterReturn = Object.keys(webhookRegistry).reduce(\n      (acc: RegisterReturn, topic) => {\n        acc[topic] = [];\n        return acc;\n      },\n      {},\n    );\n\n    const existingHandlers = await getExistingHandlers(config, session);\n\n    log.debug(\n      `Existing topics: [${Object.keys(existingHandlers).join(', ')}]`,\n      {shop: session.shop},\n    );\n\n    for (const topic in webhookRegistry) {\n      if (!Object.prototype.hasOwnProperty.call(webhookRegistry, topic)) {\n        continue;\n      }\n\n      if (privacyTopics.includes(topic)) {\n        continue;\n      }\n\n      registerReturn[topic] = await registerTopic({\n        config,\n        session,\n        topic,\n        existingHandlers: existingHandlers[topic] || [],\n        handlers: getHandlers(webhookRegistry)(topic),\n      });\n\n      // Remove this topic from the list of existing handlers so we have a list of leftovers\n      delete existingHandlers[topic];\n    }\n\n    // Delete any leftover handlers\n    for (const topic in existingHandlers) {\n      if (!Object.prototype.hasOwnProperty.call(existingHandlers, topic)) {\n        continue;\n      }\n\n      const GraphqlClient = graphqlClientClass({config});\n      const client = new GraphqlClient({session});\n\n      registerReturn[topic] = await runMutations({\n        config,\n        client,\n        topic,\n        handlers: existingHandlers[topic],\n        operation: WebhookOperation.Delete,\n      });\n    }\n\n    return registerReturn;\n  };\n}\n\nasync function getExistingHandlers(\n  config: ConfigInterface,\n  session: Session,\n): Promise<WebhookRegistry> {\n  const GraphqlClient = graphqlClientClass({config});\n  const client = new GraphqlClient({session});\n\n  const existingHandlers: WebhookRegistry = {};\n\n  let hasNextPage: boolean;\n  let endCursor: string | null = null;\n  do {\n    const query = buildCheckQuery(endCursor);\n\n    const response = await client.request<WebhookCheckResponse>(query);\n\n    response.data?.webhookSubscriptions?.edges.forEach(\n      (edge: WebhookCheckResponseNode) => {\n        const handler = buildHandlerFromNode(edge);\n\n        if (!existingHandlers[edge.node.topic]) {\n          existingHandlers[edge.node.topic] = [];\n        }\n\n        existingHandlers[edge.node.topic].push(handler);\n      },\n    );\n\n    endCursor = response.data?.webhookSubscriptions?.pageInfo.endCursor!;\n    hasNextPage = response.data?.webhookSubscriptions?.pageInfo.hasNextPage!;\n  } while (hasNextPage);\n\n  return existingHandlers;\n}\n\nfunction buildCheckQuery(endCursor: string | null) {\n  return queryTemplate(TEMPLATE_GET_HANDLERS, {\n    END_CURSOR: JSON.stringify(endCursor),\n  });\n}\n\nfunction buildHandlerFromNode(edge: WebhookCheckResponseNode): WebhookHandler {\n  const endpoint = edge.node.endpoint;\n\n  let handler: WebhookHandler;\n\n  switch (endpoint.__typename) {\n    case 'WebhookHttpEndpoint':\n      handler = {\n        deliveryMethod: DeliveryMethod.Http,\n        callbackUrl: endpoint.callbackUrl,\n        // This is a dummy for now because we don't really care about it\n        callback: async () => {},\n      };\n      break;\n    case 'WebhookEventBridgeEndpoint':\n      handler = {\n        deliveryMethod: DeliveryMethod.EventBridge,\n        arn: endpoint.arn,\n      };\n      break;\n    case 'WebhookPubSubEndpoint':\n      handler = {\n        deliveryMethod: DeliveryMethod.PubSub,\n        pubSubProject: endpoint.pubSubProject,\n        pubSubTopic: endpoint.pubSubTopic,\n      };\n      break;\n  }\n\n  // Set common fields\n  handler.id = edge.node.id;\n  handler.includeFields = edge.node.includeFields;\n  handler.metafieldNamespaces = edge.node.metafieldNamespaces;\n\n  // Sort the array fields to make them cheaper to compare later on\n  handler.includeFields?.sort();\n  handler.metafieldNamespaces?.sort();\n\n  return handler;\n}\n\nasync function registerTopic({\n  config,\n  session,\n  topic,\n  existingHandlers,\n  handlers,\n}: RegisterTopicParams): Promise<RegisterResult[]> {\n  let registerResults: RegisterResult[] = [];\n\n  const {toCreate, toUpdate, toDelete} = categorizeHandlers(\n    config,\n    existingHandlers,\n    handlers,\n  );\n\n  const GraphqlClient = graphqlClientClass({config});\n  const client = new GraphqlClient({session});\n\n  let operation = WebhookOperation.Create;\n  registerResults = registerResults.concat(\n    await runMutations({config, client, topic, operation, handlers: toCreate}),\n  );\n\n  operation = WebhookOperation.Update;\n  registerResults = registerResults.concat(\n    await runMutations({config, client, topic, operation, handlers: toUpdate}),\n  );\n\n  operation = WebhookOperation.Delete;\n  registerResults = registerResults.concat(\n    await runMutations({config, client, topic, operation, handlers: toDelete}),\n  );\n\n  return registerResults;\n}\n\ntype HandlersByKey = Record<string, WebhookHandler>;\n\nfunction categorizeHandlers(\n  config: ConfigInterface,\n  existingHandlers: WebhookHandler[],\n  handlers: WebhookHandler[],\n) {\n  const handlersByKey = handlers.reduce((acc: HandlersByKey, value) => {\n    acc[handlerIdentifier(config, value)] = value;\n    return acc;\n  }, {});\n  const existingHandlersByKey = existingHandlers.reduce(\n    (acc: HandlersByKey, value) => {\n      acc[handlerIdentifier(config, value)] = value;\n      return acc;\n    },\n    {},\n  );\n\n  const toCreate: HandlersByKey = {...handlersByKey};\n  const toUpdate: HandlersByKey = {};\n  const toDelete: HandlersByKey = {};\n  for (const existingKey in existingHandlersByKey) {\n    if (\n      !Object.prototype.hasOwnProperty.call(existingHandlersByKey, existingKey)\n    ) {\n      continue;\n    }\n\n    const existingHandler = existingHandlersByKey[existingKey];\n    const handler = handlersByKey[existingKey];\n\n    if (existingKey in handlersByKey) {\n      delete toCreate[existingKey];\n\n      if (!areHandlerFieldsEqual(existingHandler, handler)) {\n        toUpdate[existingKey] = handler;\n        toUpdate[existingKey].id = existingHandler.id;\n      }\n    } else {\n      toDelete[existingKey] = existingHandler;\n    }\n  }\n\n  return {\n    toCreate: Object.values(toCreate),\n    toUpdate: Object.values(toUpdate),\n    toDelete: Object.values(toDelete),\n  };\n}\nfunction areHandlerFieldsEqual(\n  arr1: WebhookHandler,\n  arr2: WebhookHandler,\n): boolean {\n  const includeFieldsEqual = arraysEqual(\n    arr1.includeFields || [],\n    arr2.includeFields || [],\n  );\n  const metafieldNamespacesEqual = arraysEqual(\n    arr1.metafieldNamespaces || [],\n    arr2.metafieldNamespaces || [],\n  );\n\n  return includeFieldsEqual && metafieldNamespacesEqual;\n}\n\nfunction arraysEqual(arr1: any[], arr2: any[]): boolean {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nasync function runMutations({\n  config,\n  client,\n  topic,\n  handlers,\n  operation,\n}: RunMutationsParams): Promise<RegisterResult[]> {\n  const registerResults: RegisterResult[] = [];\n\n  for (const handler of handlers) {\n    registerResults.push(\n      await runMutation({config, client, topic, handler, operation}),\n    );\n  }\n\n  return registerResults;\n}\n\nasync function runMutation({\n  config,\n  client,\n  topic,\n  handler,\n  operation,\n}: RunMutationParams): Promise<RegisterResult> {\n  let registerResult: RegisterResult;\n\n  logger(config).debug(`Running webhook mutation`, {topic, operation});\n\n  try {\n    const query = buildMutation(config, topic, handler, operation);\n\n    const result = await client.request(query);\n\n    registerResult = {\n      deliveryMethod: handler.deliveryMethod,\n      success: isSuccess(result, handler, operation),\n      result,\n      operation,\n    };\n  } catch (error) {\n    if (error instanceof InvalidDeliveryMethodError) {\n      registerResult = {\n        deliveryMethod: handler.deliveryMethod,\n        success: false,\n        result: {message: error.message},\n        operation,\n      };\n    } else {\n      throw error;\n    }\n  }\n\n  return registerResult;\n}\n\nfunction buildMutation(\n  config: ConfigInterface,\n  topic: string,\n  handler: WebhookHandler,\n  operation: WebhookOperation,\n): string {\n  const params: Record<string, string> = {};\n\n  let identifier: string;\n  if (handler.id) {\n    identifier = `id: \"${handler.id}\"`;\n  } else {\n    identifier = `topic: ${topic}`;\n  }\n\n  const mutationArguments = {\n    MUTATION_NAME: getMutationName(handler, operation),\n    IDENTIFIER: identifier,\n    MUTATION_PARAMS: '',\n  };\n\n  if (operation !== WebhookOperation.Delete) {\n    switch (handler.deliveryMethod) {\n      case DeliveryMethod.Http:\n        params.callbackUrl = `\"${addHostToCallbackUrl(\n          config,\n          handler.callbackUrl,\n        )}\"`;\n        break;\n      case DeliveryMethod.EventBridge:\n        params.arn = `\"${handler.arn}\"`;\n        break;\n      case DeliveryMethod.PubSub:\n        params.pubSubProject = `\"${handler.pubSubProject}\"`;\n        params.pubSubTopic = `\"${handler.pubSubTopic}\"`;\n        break;\n      default:\n        throw new InvalidDeliveryMethodError(\n          `Unrecognized delivery method '${(handler as any).deliveryMethod}'`,\n        );\n    }\n\n    if (handler.includeFields) {\n      params.includeFields = JSON.stringify(handler.includeFields);\n    }\n    if (handler.metafieldNamespaces) {\n      params.metafieldNamespaces = JSON.stringify(handler.metafieldNamespaces);\n    }\n\n    if (handler.subTopic) {\n      const subTopicString = `subTopic: \"${handler.subTopic}\",`;\n      mutationArguments.MUTATION_PARAMS = subTopicString;\n    }\n\n    const paramsString = Object.entries(params)\n      .map(([key, value]) => `${key}: ${value}`)\n      .join(', ');\n\n    mutationArguments.MUTATION_PARAMS += `webhookSubscription: {${paramsString}}`;\n  }\n\n  return queryTemplate(TEMPLATE_MUTATION, mutationArguments);\n}\n\nfunction getMutationName(\n  handler: WebhookHandler,\n  operation: WebhookOperation,\n): string {\n  switch (operation) {\n    case WebhookOperation.Create:\n      return `${getEndpoint(handler)}Create`;\n    case WebhookOperation.Update:\n      return `${getEndpoint(handler)}Update`;\n    case WebhookOperation.Delete:\n      return 'webhookSubscriptionDelete';\n    default:\n      throw new ShopifyError(`Unrecognized operation '${operation}'`);\n  }\n}\n\nfunction getEndpoint(handler: WebhookHandler): string {\n  switch (handler.deliveryMethod) {\n    case DeliveryMethod.Http:\n      return 'webhookSubscription';\n    case DeliveryMethod.EventBridge:\n      return 'eventBridgeWebhookSubscription';\n    case DeliveryMethod.PubSub:\n      return 'pubSubWebhookSubscription';\n    default:\n      throw new ShopifyError(\n        `Unrecognized delivery method '${(handler as any).deliveryMethod}'`,\n      );\n  }\n}\n\nfunction isSuccess(\n  result: any,\n  handler: WebhookHandler,\n  operation: WebhookOperation,\n): boolean {\n  const mutationName = getMutationName(handler, operation);\n\n  return Boolean(\n    result.data &&\n      result.data[mutationName] &&\n      result.data[mutationName].userErrors.length === 0,\n  );\n}\n\nexport const TEMPLATE_GET_HANDLERS = `query shopifyApiReadWebhookSubscriptions {\n  webhookSubscriptions(\n    first: 250,\n    after: {{END_CURSOR}},\n  ) {\n    edges {\n      node {\n        id\n        topic\n        includeFields\n        metafieldNamespaces\n        endpoint {\n          __typename\n          ... on WebhookHttpEndpoint {\n            callbackUrl\n          }\n          ... on WebhookEventBridgeEndpoint {\n            arn\n          }\n          ... on WebhookPubSubEndpoint {\n            pubSubProject\n            pubSubTopic\n          }\n        }\n      }\n    }\n    pageInfo {\n      endCursor\n      hasNextPage\n    }\n  }\n}`;\n\nexport const TEMPLATE_MUTATION = `\n  mutation shopifyApiCreateWebhookSubscription {\n    {{MUTATION_NAME}}(\n      {{IDENTIFIER}},\n      {{MUTATION_PARAMS}}\n    ) {\n      userErrors {\n        field\n        message\n      }\n    }\n  }\n`;\n", "import {logger} from '../logger';\nimport {validateHmacFromRequestFactory} from '../utils/hmac-validator';\nimport {HmacValidationType, ValidationErrorReason} from '../utils/types';\nimport {\n  abstractConvertRequest,\n  getHeader,\n  Headers,\n  NormalizedRequest,\n} from '../../runtime/http';\nimport {ShopifyHeader} from '../types';\nimport {ConfigInterface} from '../base-types';\n\nimport {\n  WebhookFields,\n  WebhookValidateParams,\n  WebhookValidation,\n  WebhookValidationErrorReason,\n  WebhookValidationMissingHeaders,\n  WebhookValidationValid,\n} from './types';\nimport {topicForStorage} from './registry';\n\nconst OPTIONAL_HANDLER_PROPERTIES = {\n  subTopic: ShopifyHeader.SubTopic,\n};\n\nconst HANDLER_PROPERTIES = {\n  apiVersion: ShopifyHeader.ApiVersion,\n  domain: ShopifyHeader.Domain,\n  hmac: ShopifyHeader.Hmac,\n  topic: ShopifyHeader.Topic,\n  webhookId: ShopifyHeader.WebhookId,\n  ...OPTIONAL_HANDLER_PROPERTIES,\n};\n\nexport function validateFactory(config: ConfigInterface) {\n  return async function validate({\n    rawBody,\n    ...adapterArgs\n  }: WebhookValidateParams): Promise<WebhookValidation> {\n    const request: NormalizedRequest =\n      await abstractConvertRequest(adapterArgs);\n\n    const validHmacResult = await validateHmacFromRequestFactory(config)({\n      type: HmacValidationType.Webhook,\n      rawBody,\n      ...adapterArgs,\n    });\n\n    if (!validHmacResult.valid) {\n      if (validHmacResult.reason === ValidationErrorReason.InvalidHmac) {\n        const log = logger(config);\n        await log.debug(\n          \"Webhook HMAC validation failed. Please note that events manually triggered from a store's Notifications settings will fail this validation. To test this, please use the CLI or trigger the actual event in a development store.\",\n        );\n      }\n      return validHmacResult;\n    }\n\n    return checkWebhookHeaders(request.headers);\n  };\n}\n\nfunction checkWebhookHeaders(\n  headers: Headers,\n): WebhookValidationMissingHeaders | WebhookValidationValid {\n  const missingHeaders: ShopifyHeader[] = [];\n  const entries = Object.entries(HANDLER_PROPERTIES) as [\n    keyof WebhookFields,\n    ShopifyHeader,\n  ][];\n  const headerValues = entries.reduce((acc, [property, headerName]) => {\n    const headerValue = getHeader(headers, headerName);\n    if (headerValue) {\n      acc[property] = headerValue;\n    } else if (!(property in OPTIONAL_HANDLER_PROPERTIES)) {\n      missingHeaders.push(headerName);\n    }\n\n    return acc;\n  }, {} as WebhookFields);\n\n  if (missingHeaders.length) {\n    return {\n      valid: false,\n      reason: WebhookValidationErrorReason.MissingHeaders,\n      missingHeaders,\n    };\n  } else {\n    return {\n      valid: true,\n      ...headerValues,\n      ...(headerValues.subTopic ? {subTopic: headerValues.subTopic} : {}),\n      topic: topicForStorage(headerValues.topic),\n    };\n  }\n}\n", "import {StatusCode} from '@shopify/network';\n\nimport {\n  abstractConvertResponse,\n  AdapterResponse,\n  isOK,\n  NormalizedResponse,\n} from '../../runtime/http';\nimport {ConfigInterface} from '../base-types';\nimport * as ShopifyErrors from '../error';\nimport {logger} from '../logger';\n\nimport {\n  DeliveryMethod,\n  HttpWebhookHandlerWithCallback,\n  WebhookProcessParams,\n  WebhookRegistry,\n  WebhookValidationErrorReason,\n  WebhookValidationInvalid,\n  WebhookValidationMissingHeaders,\n  WebhookValidationValid,\n} from './types';\nimport {validateFactory} from './validate';\n\ninterface HandlerCallResult {\n  statusCode: StatusCode;\n  errorMessage?: string;\n}\n\ninterface ErrorCallResult {\n  statusCode: StatusCode;\n  errorMessage: string;\n}\n\nconst STATUS_TEXT_LOOKUP: Record<string, string> = {\n  [StatusCode.Ok]: 'OK',\n  [StatusCode.BadRequest]: 'Bad Request',\n  [StatusCode.Unauthorized]: 'Unauthorized',\n  [StatusCode.NotFound]: 'Not Found',\n  [StatusCode.InternalServerError]: 'Internal Server Error',\n};\n\nexport function process(\n  config: ConfigInterface,\n  webhookRegistry: WebhookRegistry<HttpWebhookHandlerWithCallback>,\n) {\n  return async function process({\n    context,\n    rawBody,\n    ...adapterArgs\n  }: WebhookProcessParams): Promise<AdapterResponse> {\n    const response: NormalizedResponse = {\n      statusCode: StatusCode.Ok,\n      statusText: STATUS_TEXT_LOOKUP[StatusCode.Ok],\n      headers: {},\n    };\n\n    await logger(config).info('Receiving webhook request');\n\n    const webhookCheck = await validateFactory(config)({\n      rawBody,\n      ...adapterArgs,\n    });\n\n    let errorMessage = 'Unknown error while handling webhook';\n    if (webhookCheck.valid) {\n      const handlerResult = await callWebhookHandlers(\n        config,\n        webhookRegistry,\n        webhookCheck,\n        rawBody,\n        context,\n      );\n\n      response.statusCode = handlerResult.statusCode;\n      if (!isOK(response)) {\n        errorMessage = handlerResult.errorMessage || errorMessage;\n      }\n    } else {\n      const errorResult = await handleInvalidWebhook(config, webhookCheck);\n\n      response.statusCode = errorResult.statusCode;\n      response.statusText = STATUS_TEXT_LOOKUP[response.statusCode];\n      errorMessage = errorResult.errorMessage;\n    }\n\n    const returnResponse = await abstractConvertResponse(response, adapterArgs);\n    if (!isOK(response)) {\n      throw new ShopifyErrors.InvalidWebhookError({\n        message: errorMessage,\n        response: returnResponse,\n      });\n    }\n\n    return Promise.resolve(returnResponse);\n  };\n}\n\nasync function callWebhookHandlers(\n  config: ConfigInterface,\n  webhookRegistry: WebhookRegistry<HttpWebhookHandlerWithCallback>,\n  webhookCheck: WebhookValidationValid,\n  rawBody: string,\n  context: any,\n): Promise<HandlerCallResult> {\n  const log = logger(config);\n  const {hmac: _hmac, valid: _valid, ...loggingContext} = webhookCheck;\n\n  await log.debug(\n    'Webhook request is valid, looking for HTTP handlers to call',\n    loggingContext,\n  );\n\n  const handlers = webhookRegistry[webhookCheck.topic] || [];\n\n  const response: HandlerCallResult = {statusCode: StatusCode.Ok};\n\n  let found = false;\n  for (const handler of handlers) {\n    if (handler.deliveryMethod !== DeliveryMethod.Http) {\n      continue;\n    }\n    if (!handler.callback) {\n      response.statusCode = StatusCode.InternalServerError;\n      response.errorMessage =\n        \"Cannot call webhooks.process with a webhook handler that doesn't have a callback\";\n\n      throw new ShopifyErrors.MissingWebhookCallbackError({\n        message: response.errorMessage,\n        response,\n      });\n    }\n\n    found = true;\n\n    await log.debug('Found HTTP handler, triggering it', loggingContext);\n\n    try {\n      await handler.callback(\n        webhookCheck.topic,\n        webhookCheck.domain,\n        rawBody,\n        webhookCheck.webhookId,\n        webhookCheck.apiVersion,\n        ...(webhookCheck?.subTopic ? webhookCheck.subTopic : ''),\n        context,\n      );\n    } catch (error) {\n      response.statusCode = StatusCode.InternalServerError;\n      response.errorMessage = error.message;\n    }\n  }\n\n  if (!found) {\n    await log.debug('No HTTP handlers found', loggingContext);\n\n    response.statusCode = StatusCode.NotFound;\n    response.errorMessage = `No HTTP webhooks registered for topic ${webhookCheck.topic}`;\n  }\n\n  return response;\n}\n\nasync function handleInvalidWebhook(\n  config: ConfigInterface,\n  webhookCheck: WebhookValidationInvalid,\n): Promise<ErrorCallResult> {\n  const response: ErrorCallResult = {\n    statusCode: StatusCode.InternalServerError,\n    errorMessage: 'Unknown error while handling webhook',\n  };\n\n  switch (webhookCheck.reason) {\n    case WebhookValidationErrorReason.MissingHeaders:\n      response.statusCode = StatusCode.BadRequest;\n      response.errorMessage = `Missing one or more of the required HTTP headers to process webhooks: [${(\n        webhookCheck as WebhookValidationMissingHeaders\n      ).missingHeaders.join(', ')}]`;\n      break;\n    case WebhookValidationErrorReason.MissingBody:\n      response.statusCode = StatusCode.BadRequest;\n      response.errorMessage = 'No body was received when processing webhook';\n      break;\n    case WebhookValidationErrorReason.MissingHmac:\n      response.statusCode = StatusCode.BadRequest;\n      response.errorMessage = `Missing HMAC header in request`;\n      break;\n    case WebhookValidationErrorReason.InvalidHmac:\n      response.statusCode = StatusCode.Unauthorized;\n      response.errorMessage = `Could not validate request HMAC`;\n      break;\n  }\n\n  await logger(config).debug(\n    `Webhook request is invalid, returning ${response.statusCode}: ${response.errorMessage}`,\n  );\n\n  return response;\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {addHandlers, getTopicsAdded, getHandlers, registry} from './registry';\nimport {register} from './register';\nimport {process} from './process';\nimport {validateFactory} from './validate';\nimport {HttpWebhookHandlerWithCallback, WebhookRegistry} from './types';\n\ninterface Webhooks {\n  /**\n   * Add shop-specific webhook handlers to the library registry,\n   * allowing you to register webhooks with Shopify and process HTTP webhook requests from Shopify.\n   * In most cases, you should use app-specific webhooks:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, you do not need to use `addHandlers`.\n   *\n   */\n  addHandlers: ReturnType<typeof addHandlers>;\n\n  /**\n   * Fetches all topics that were added to the registry.\n   *\n   * In most cases, you should use app-specific webhooks:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, you do not need to use `getTopicsAdded`.\n   *\n   */\n  getTopicsAdded: ReturnType<typeof getTopicsAdded>;\n\n  /**\n   * Fetches the configured handlers for shop-specific webhooks for the given topic.\n   *\n   * In most cases, you should use app-specific webhooks:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, you do not need to use `getHandlers`.\n   *\n   */\n  getHandlers: ReturnType<typeof getHandlers>;\n\n  /**\n   * Registers a webhook handler for a given topic.\n   *\n   * In most cases, you should use app-specific webhooks:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, you do not need to use `register`.\n   *\n   */\n  register: ReturnType<typeof register>;\n\n  /**\n   * Processes a webhook request.\n   *\n   * In most cases, you should use app-specific webhooks:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, you do not need to use `process`.\n   *\n   */\n  process: ReturnType<typeof process>;\n\n  /**\n   * Validates an incoming request for `Http` handlers.\n   *\n   * If the call is invalid, it will return a `valid` field set to `false`.\n   *\n   * `validate` can be used to validate app-specific and shop-specific webhook requests.\n   *\n   */\n  validate: ReturnType<typeof validateFactory>;\n}\n\nexport function shopifyWebhooks(config: ConfigInterface): Webhooks {\n  const webhookRegistry = registry();\n\n  return {\n    addHandlers: addHandlers(config, webhookRegistry),\n    getTopicsAdded: getTopicsAdded(webhookRegistry),\n    getHandlers: getHandlers(webhookRegistry),\n    register: register(config, webhookRegistry),\n    process: process(\n      config,\n      webhookRegistry as WebhookRegistry<HttpWebhookHandlerWithCallback>,\n    ),\n    validate: validateFactory(config),\n  };\n}\n\nexport type ShopifyWebhooks = ReturnType<typeof shopifyWebhooks>;\n", "import {\n  BillingInterval,\n  BillingReplacementBehavior,\n  RecurringBillingIntervals,\n} from '../types';\nimport {Session} from '../session/session';\nimport {\n  FeatureEnabled,\n  FutureFlagOptions,\n  FutureFlags,\n} from '../../future/flags';\n\nexport interface BillingConfigPlan {\n  /**\n   * Amount to charge for this plan.\n   */\n  amount: number;\n  /**\n   * Currency code for this plan.\n   */\n  currencyCode: string;\n}\n\nexport interface BillingConfigOneTimePlan extends BillingConfigPlan {\n  /**\n   * Interval for this plan.\n   *\n   * Must be set to `OneTime`.\n   */\n  interval: BillingInterval.OneTime;\n}\n\nexport interface BillingConfigSubscriptionPlan extends BillingConfigPlan {\n  /**\n   * Recurring interval for this plan.\n   *\n   * Must be either `Every30Days` or `Annual`.\n   */\n  interval: Exclude<RecurringBillingIntervals, BillingInterval.Usage>;\n  /**\n   * How many trial days to give before charging for this plan.\n   */\n  trialDays?: number;\n  /**\n   * The behavior to use when replacing an existing subscription with a new one.\n   */\n  replacementBehavior?: BillingReplacementBehavior;\n  /**\n   * The discount to apply to this plan.\n   */\n  discount?: BillingConfigSubscriptionPlanDiscount;\n}\n\nexport interface BillingConfigSubscriptionPlanDiscountAmount {\n  /**\n   * The amount to discount.\n   *\n   * Cannot be set if `percentage` is set.\n   */\n  amount: number;\n  /**\n   * The percentage to discount.\n   *\n   * Cannot be set if `amount` is set.\n   */\n  percentage?: never;\n}\n\nexport interface BillingConfigSubscriptionPlanDiscountPercentage {\n  /**\n   * The amount to discount.\n   *\n   * Cannot be set if `percentage` is set.\n   */\n  amount?: never;\n  /**\n   * The percentage to discount.\n   *\n   * Cannot be set if `amount` is set.\n   */\n  percentage: number;\n}\n\nexport interface BillingConfigSubscriptionPlanDiscount {\n  /**\n   * The number of intervals to apply the discount for.\n   */\n  durationLimitInIntervals?: number;\n  /**\n   * The discount to apply.\n   */\n  value:\n    | BillingConfigSubscriptionPlanDiscountAmount\n    | BillingConfigSubscriptionPlanDiscountPercentage;\n}\n\nexport interface BillingConfigUsagePlan extends BillingConfigPlan {\n  /**\n   * Interval for this plan.\n   *\n   * Must be set to `Usage`.\n   */\n  interval: BillingInterval.Usage;\n  /**\n   * Usage terms for this plan.\n   */\n  usageTerms: string;\n  /**\n   * How many trial days to give before charging for this plan.\n   */\n  trialDays?: number;\n  /**\n   * The behavior to use when replacing an existing subscription with a new one.\n   */\n  replacementBehavior?: BillingReplacementBehavior;\n}\n\nexport type BillingConfigLegacyItem =\n  | BillingConfigOneTimePlan\n  | BillingConfigSubscriptionPlan\n  | BillingConfigUsagePlan;\n\nexport type BillingConfigItem<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> =\n  FeatureEnabled<Future, 'lineItemBilling'> extends true\n    ? BillingConfigOneTimePlan | BillingConfigSubscriptionLineItemPlan\n    : BillingConfigLegacyItem;\n\n// Type this as an interface to improve TSDoc support for it.\n\n/**\n * Billing configuration options, indexed by an app-specific plan name.\n */\nexport interface BillingConfig<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> {\n  /**\n   * An individual billing plan.\n   */\n  [plan: string]: BillingConfigItem<\n    Future & {\n      lineItemBilling: Future extends FutureFlags\n        ? Future['lineItemBilling'] extends true\n          ? true\n          : Future['lineItemBilling'] extends false\n            ? false\n            : Future['v10_lineItemBilling'] extends true\n              ? true\n              : false\n        : false;\n    }\n  >;\n}\n\nexport type RequestConfigOverrides =\n  | Partial<BillingConfigOneTimePlan>\n  | Partial<BillingConfigSubscriptionPlan>\n  | Partial<BillingConfigUsagePlan>;\n\nexport interface BillingConfigLineItem {\n  /**\n   * The amount to charge for this line item.\n   */\n  amount: number;\n  /**\n   * The currency code for this line item.\n   */\n  currencyCode: string;\n}\n\nexport interface BillingConfigRecurringLineItem extends BillingConfigLineItem {\n  /**\n   * The recurring interval for this line item.\n   *\n   * Must be either `Every30Days` or `Annual`.\n   */\n  interval: BillingInterval.Every30Days | BillingInterval.Annual;\n  /**\n   * An optional discount to apply for this line item.\n   */\n  discount?: BillingConfigSubscriptionPlanDiscount;\n}\n\nexport interface BillingConfigUsageLineItem extends BillingConfigLineItem {\n  /**\n   * The usage interval for this line item.\n   *\n   * Must be set to `Usage`.\n   */\n  interval: BillingInterval.Usage;\n  /**\n   * The capped amount or the maximum amount to be charged in the interval.\n   */\n  amount: number;\n  /**\n   * Usage terms for this line item.\n   */\n  terms: string;\n}\n\nexport interface BillingConfigSubscriptionLineItemPlan {\n  /**\n   * The replacement behavior to use for this plan.\n   */\n  replacementBehavior?: BillingReplacementBehavior;\n  /**\n   * How many trial days to give before charging for this plan.\n   */\n  trialDays?: number;\n  /**\n   * The line items for this plan.\n   */\n  lineItems: (BillingConfigRecurringLineItem | BillingConfigUsageLineItem)[];\n}\n\ntype DeepPartial<T> = T extends object\n  ? {[P in keyof T]?: DeepPartial<T[P]>}\n  : T;\nexport type RequestConfigLineItemOverrides =\n  DeepPartial<BillingConfigSubscriptionLineItemPlan>;\n\ninterface BillingCheckParamsNew {\n  /**\n   * The session to use for this check.\n   */\n  session: Session;\n  /**\n   * The plans to accept for this check.\n   */\n  plans?: string[] | string;\n  /**\n   * Whether to include charges that were created on test mode. Test shops and demo shops cannot be charged.\n   */\n  isTest?: boolean;\n}\n\ninterface BillingCheckParamsOld extends BillingCheckParamsNew {\n  /**\n   * The plans to accept for this check.\n   */\n  plans: string[] | string;\n  /**\n   * Whether to return the full response object.\n   */\n  returnObject?: boolean;\n}\n\nexport type BillingCheckParams<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> =\n  FeatureEnabled<Future, 'unstable_managedPricingSupport'> extends true\n    ? BillingCheckParamsNew\n    : BillingCheckParamsOld;\n\nexport interface BillingCheckResponseObject {\n  /**\n   * Whether the user has an active payment method.\n   */\n  hasActivePayment: boolean;\n  /**\n   * The one-time purchases the shop has.\n   */\n  oneTimePurchases: OneTimePurchase[];\n  /**\n   * The active subscriptions the shop has.\n   */\n  appSubscriptions: AppSubscription[];\n}\n\nexport type BillingCheckResponse<\n  Params extends BillingCheckParams<Future>,\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> =\n  FeatureEnabled<Future, 'unstable_managedPricingSupport'> extends true\n    ? BillingCheckResponseObject\n    : Params extends BillingCheckParamsOld\n      ? Params['returnObject'] extends true\n        ? BillingCheckResponseObject\n        : boolean\n      : never;\n\ntype BillingRequestOverridesType<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> =\n  FeatureEnabled<Future, 'lineItemBilling'> extends true\n    ? RequestConfigOverrides & RequestConfigLineItemOverrides\n    : RequestConfigOverrides;\n\nexport type BillingRequestParams<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> = {\n  /**\n   * The session to use for this request.\n   */\n  session: Session;\n  /**\n   * The plan to request.\n   */\n  plan: string;\n  /**\n   * Whether this is a test purchase.\n   */\n  isTest?: boolean;\n  /**\n   * Override the return URL after the purchase is complete.\n   */\n  returnUrl?: string;\n  /**\n   * Whether to return the full response object.\n   */\n  returnObject?: boolean;\n} & BillingRequestOverridesType<Future>;\n\nexport interface BillingRequestResponseObject {\n  /**\n   * The confirmation URL for this request.\n   */\n  confirmationUrl: string;\n  /**\n   * The one-time purchase created by this request.\n   */\n  oneTimePurchase?: OneTimePurchase;\n  /**\n   * The app subscription created by this request.\n   */\n  appSubscription?: AppSubscription;\n}\n\nexport type BillingRequestResponse<Params extends BillingRequestParams> =\n  Params['returnObject'] extends true ? BillingRequestResponseObject : string;\n\nexport interface BillingCancelParams {\n  /**\n   * The session to use for this request.\n   */\n  session: Session;\n  /**\n   * The subscription ID to cancel.\n   */\n  subscriptionId: string;\n  /**\n   * Whether to prorate the cancellation.\n   */\n  prorate?: boolean;\n  /**\n   * Whether to consider test purchases.\n   */\n  isTest?: boolean;\n}\n\nexport interface BillingSubscriptionParams {\n  /**\n   * The session to use for this request.\n   */\n  session: Session;\n}\n\nexport interface AppSubscription {\n  /**\n   * The ID of the app subscription.\n   */\n  id: string;\n  /**\n   * The name of the purchased plan.\n   */\n  name: string;\n  /**\n   * Whether this is a test subscription.\n   */\n  test: boolean;\n  /**\n   * The number of trial days for this subscription.\n   */\n  trialDays: number;\n  /**\n   * The date and time when the subscription was created.\n   */\n  createdAt: string;\n  /**\n   * The date and time when the current period ends.\n   */\n  currentPeriodEnd: string;\n  /**\n   * The return URL for this subscription.\n   */\n  returnUrl: string;\n\n  /*\n   * The line items for this plan. This will become mandatory in v10.\n   */\n  lineItems?: ActiveSubscriptionLineItem[];\n\n  /*\n   * The status of the subscription. [ACTIVE, CANCELLED, PENDING, DECLINED, EXPIRED, FROZEN, ACCEPTED]\n   */\n  status:\n    | 'ACTIVE'\n    | 'CANCELLED'\n    | 'PENDING'\n    | 'DECLINED'\n    | 'EXPIRED'\n    | 'FROZEN'\n    | 'ACCEPTED';\n}\n\nexport interface ActiveSubscriptions {\n  activeSubscriptions: AppSubscription[];\n}\n\nexport interface ActiveSubscriptionLineItem {\n  /*\n   * The ID of the line item.\n   */\n  id: string;\n  /*\n   * The details of the plan.\n   */\n  plan: AppPlan;\n}\n\nexport interface RecurringAppPlan {\n  /*\n   * The interval for this plan is charged on.\n   */\n  interval: BillingInterval.Every30Days | BillingInterval.Annual;\n  /*\n   * The price of the plan.\n   */\n  price: Money;\n  /*\n   * The discount applied to the plan.\n   */\n  discount: AppPlanDiscount;\n}\n\nexport interface UsageAppPlan {\n  /*\n   * The total usage records for interval.\n   */\n  balanceUsed: Money;\n  /*\n   * The capped amount prevents the merchant from being charged for any usage over that amount during a billing period.\n   */\n  cappedAmount: Money;\n  /*\n   * The terms and conditions for app usage pricing.\n   */\n  terms: string;\n}\n\nexport interface Money {\n  amount: number;\n  currencyCode: string;\n}\n\nexport interface AppPlanDiscount {\n  /*\n   * The total number of intervals the discount applies to.\n   */\n  durationLimitInIntervals: number;\n  /*\n   * The remaining number of intervals the discount applies to.\n   */\n  remainingDurationInIntervals: number;\n  /*\n   * The price after the discount is applied.\n   */\n  priceAfterDiscount: Money;\n  /*\n   * The value of the discount applied every billing interval.\n   */\n  value: AppPlanDiscountAmount;\n}\n\nexport interface AppSubscriptionLineItemUpdatePayload {\n  userErrors: string[];\n  confirmationUrl: string;\n  appSubscription: AppSubscription;\n}\n\nexport type UpdateCappedAmountConfirmation = Omit<\n  AppSubscriptionLineItemUpdatePayload,\n  'userErrors'\n>;\n\ntype AppPlanDiscountAmount =\n  | BillingConfigSubscriptionPlanDiscountAmount\n  | BillingConfigSubscriptionPlanDiscountPercentage;\n\nexport interface AppPlan {\n  /*\n   * The pricing details of the plan.\n   */\n  pricingDetails: RecurringAppPlan | UsageAppPlan;\n}\nexport interface OneTimePurchase {\n  /**\n   * The ID of the one-time purchase.\n   */\n  id: string;\n  /**\n   * The name of the purchased plan.\n   */\n  name: string;\n  /**\n   * Whether this is a test purchase.\n   */\n  test: boolean;\n  /*\n   * The status of the subscription. [ACTIVE, CANCELLED, PENDING, DECLINED, EXPIRED, FROZEN, ACCEPTED]\n   */\n  status:\n    | 'ACTIVE'\n    | 'CANCELLED'\n    | 'PENDING'\n    | 'DECLINED'\n    | 'EXPIRED'\n    | 'FROZEN'\n    | 'ACCEPTED';\n}\n\nexport interface BillingCreateUsageRecordParams {\n  /**\n   * The session to use for this request.\n   */\n  session: Session;\n  /**\n   * The description of the usage record.\n   */\n  description: string;\n  /**\n   * The price and currency of the usage record.\n   */\n  price: {\n    /**\n     * The amount to charge for this usage record.\n     */\n    amount: number;\n    /**\n     * The currency code for this usage record.\n     */\n    currencyCode: string;\n  };\n  /**\n   * The subscription line item ID to associate the usage record with.\n   */\n  subscriptionLineItemId?: string;\n  /**\n   * The idempotency key for this request.\n   */\n  idempotencyKey?: string;\n  /**\n   * Whether this is a test charge.\n   * */\n  isTest?: boolean;\n}\n\nexport interface UsageRecord {\n  /**\n   * The ID of the usage record.\n   */\n  id: string;\n  /**\n   * The description of the usage record.\n   */\n  description: string;\n  /**\n   * The price and currency of the usage record.\n   */\n  price: {\n    /**\n     * The amount to charge for this usage record.\n     */\n    amount: number;\n    /**\n     * The currency code for this usage record.\n     */\n    currencyCode: string;\n  };\n  /**\n   * The subscription line item associated with the usage record.\n   */\n  plan: ActiveSubscriptionLineItem;\n  /**\n   * The idempotency key for this request.\n   */\n  idempotencyKey?: string;\n  /**\n   * The subscription line item associated with the usage record.\n   */\n  subscriptionLineItem: AppSubscriptionLineItem;\n}\n\nexport interface AppSubscriptionLineItem {\n  /**\n   * The ID of the subscription line item.\n   */\n  id: string;\n  /**\n   * The plan associated with the subscription line item.\n   */\n  plan: AppPlan;\n}\n\nexport interface BillingUpdateUsageCappedAmountParams {\n  /**\n   * The session to use for this request.\n   */\n  session: Session;\n  /**\n   * The subscription line item ID to update.\n   */\n  subscriptionLineItemId: string;\n  /**\n   * The maximum charge for the usage billing plan.\n   */\n  cappedAmount: {\n    /**\n     * The amount to update.\n     */\n    amount: number;\n    /**\n     * The currency code to update.\n     */\n    currencyCode: string;\n  };\n}\n\ninterface OneTimePurchases {\n  oneTimePurchases: {\n    edges: {\n      node: OneTimePurchase;\n    }[];\n    pageInfo: {\n      endCursor: string;\n      hasNextPage: boolean;\n    };\n  };\n}\n\nexport type CurrentAppInstallation = OneTimePurchases & ActiveSubscriptions;\n\nexport interface CurrentAppInstallations {\n  currentAppInstallation?: CurrentAppInstallation;\n}\n\nexport interface RequestResponse {\n  userErrors: string[];\n  confirmationUrl: string;\n}\n\ninterface AppSubscriptionCreate {\n  userErrors: string[];\n  confirmationUrl: string;\n  appSubscription: AppSubscription;\n}\n\ninterface AppPurchaseOneTimeCreate {\n  userErrors: string[];\n  confirmationUrl: string;\n  oneTimePurchase: OneTimePurchase;\n}\n\nexport interface RecurringPaymentResponse {\n  appSubscriptionCreate?: AppSubscriptionCreate;\n}\n\nexport interface SinglePaymentResponse {\n  appPurchaseOneTimeCreate?: AppPurchaseOneTimeCreate;\n}\n\nexport type RequestResponseData =\n  | AppSubscriptionCreate\n  | AppPurchaseOneTimeCreate;\n\nexport interface SubscriptionResponse {\n  currentAppInstallation?: ActiveSubscriptions;\n}\n\nexport interface CancelResponse {\n  appSubscriptionCancel?: {\n    appSubscription: AppSubscription;\n    userErrors: string[];\n  };\n}\n\nexport interface UsageRecordCreateResponse {\n  appUsageRecordCreate?: {\n    appUsageRecord: UsageRecord;\n    userErrors: string[];\n  };\n}\n\nexport interface BillingUpdateUsageCappedAmountResponse {\n  appSubscriptionLineItemUpdate?: AppSubscriptionLineItemUpdatePayload;\n}\n\nexport type BillingCheck<Future extends FutureFlagOptions> = <\n  Params extends BillingCheckParams<Future>,\n>(\n  params: Params,\n) => Promise<BillingCheckResponse<Params, Future>>;\n\nexport type BillingRequest = <Params extends BillingRequestParams>(\n  params: Params,\n) => Promise<BillingRequestResponse<Params>>;\n\nexport type BillingCancel = (\n  params: BillingCancelParams,\n) => Promise<AppSubscription>;\n\nexport type BillingSubscriptions = (\n  params: BillingSubscriptionParams,\n) => Promise<ActiveSubscriptions>;\n\nexport type BillingCreateUsageRecord = (\n  params: BillingCreateUsageRecordParams,\n) => Promise<UsageRecord>;\n\nexport type BillingUpdateUsageCappedAmount = (\n  params: BillingUpdateUsageCappedAmountParams,\n) => Promise<UpdateCappedAmountConfirmation>;\n\nexport interface ShopifyBilling<Future extends FutureFlagOptions> {\n  check: BillingCheck<Future>;\n  request: BillingRequest;\n  cancel: BillingCancel;\n  subscriptions: BillingSubscriptions;\n  createUsageRecord: BillingCreateUsageRecord;\n  updateUsageCappedAmount: BillingUpdateUsageCappedAmount;\n}\n\nexport const APP_SUBSCRIPTION_FRAGMENT = `\n  fragment AppSubscriptionFragment on AppSubscription {\n    id\n    name\n    test\n    status\n    trialDays\n    createdAt\n    currentPeriodEnd\n    returnUrl\n    lineItems {\n      id\n      plan {\n        pricingDetails {\n          ... on AppRecurringPricing {\n            price {\n              amount\n              currencyCode\n            }\n            interval\n            discount {\n              durationLimitInIntervals\n              remainingDurationInIntervals\n              priceAfterDiscount {\n                amount\n              }\n              value {\n                ... on AppSubscriptionDiscountAmount {\n                  amount {\n                    amount\n                    currencyCode\n                  }\n                }\n                ... on AppSubscriptionDiscountPercentage {\n                  percentage\n                }\n              }\n            }\n          }\n          ... on AppUsagePricing {\n            balanceUsed {\n              amount\n              currencyCode\n            }\n            cappedAmount {\n              amount\n              currencyCode\n            }\n            terms\n          }\n        }\n      }\n    }\n  }\n`;\n", "import {ActiveSubscriptionLineItem} from './types';\n\n/**\n * Converts string amounts to numbers in Money type objects\n */\nexport function convertMoneyAmount(data: any) {\n  if (!data) return data;\n\n  convertAppUsagePricingMoney(data);\n  convertAppRecurringPricingMoney(data);\n  convertAppDiscountMoney(data);\n\n  return data;\n}\n\nexport function convertAppRecurringPricingMoney(data: any): void {\n  if (!data) return;\n\n  if (data.price?.amount && typeof data.price.amount === 'string') {\n    data.price.amount = parseFloat(data.price.amount);\n  }\n}\n\nexport function convertAppDiscountMoney(data: any): void {\n  if (!data) return;\n\n  if (\n    data.discount?.priceAfterDiscount?.amount &&\n    typeof data.discount.priceAfterDiscount.amount === 'string'\n  ) {\n    data.discount.priceAfterDiscount.amount = parseFloat(\n      data.discount.priceAfterDiscount.amount,\n    );\n  }\n\n  if (\n    data.discount?.value?.amount?.amount &&\n    typeof data.discount.value.amount.amount === 'string'\n  ) {\n    data.discount.value.amount.amount = parseFloat(\n      data.discount.value.amount.amount,\n    );\n  }\n}\n\nexport function convertAppUsagePricingMoney(data: any): void {\n  if (!data) return;\n\n  if (data.balanceUsed?.amount && typeof data.balanceUsed.amount === 'string') {\n    data.balanceUsed.amount = parseFloat(data.balanceUsed.amount);\n  }\n\n  if (\n    data.cappedAmount?.amount &&\n    typeof data.cappedAmount.amount === 'string'\n  ) {\n    data.cappedAmount.amount = parseFloat(data.cappedAmount.amount);\n  }\n}\n\n/**\n * Converts Money amounts in line items\n */\nexport function convertLineItems(lineItems: ActiveSubscriptionLineItem[]) {\n  return lineItems.map((item) => {\n    if (item.plan?.pricingDetails) {\n      item.plan.pricingDetails = convertMoneyAmount(item.plan.pricingDetails);\n    }\n    return item;\n  });\n}\n", "import {FutureFlagOptions} from '../../future/flags';\nimport {ConfigInterface} from '../base-types';\nimport {graphqlClientClass, GraphqlClient} from '../clients/admin';\nimport {BillingError} from '../error';\n\nimport {\n  AppSubscription,\n  BillingCheck,\n  BillingCheckParams,\n  BillingCheckResponse,\n  BillingCheckResponseObject,\n  CurrentAppInstallation,\n  CurrentAppInstallations,\n  OneTimePurchase,\n  APP_SUBSCRIPTION_FRAGMENT,\n} from './types';\nimport {convertLineItems} from './utils';\n\ninterface SubscriptionMeetsCriteriaParams {\n  subscription: AppSubscription;\n  isTest?: boolean;\n  plans?: string | string[];\n}\n\ninterface PurchaseMeetsCriteriaParams {\n  purchase: OneTimePurchase;\n  isTest?: boolean;\n  plans?: string | string[];\n}\n\ninterface InternalParams {\n  client: GraphqlClient;\n  isTest?: boolean;\n  plans?: string | string[];\n}\n\nexport function check<\n  Config extends ConfigInterface,\n  Future extends FutureFlagOptions = Config['future'],\n>(config: Config): BillingCheck<Future> {\n  return async function check<Params extends BillingCheckParams<Future>>(\n    params: Params,\n  ): Promise<BillingCheckResponse<Params, Future>> {\n    if (!config.future?.unstable_managedPricingSupport && !config.billing) {\n      throw new BillingError({\n        message: 'Attempted to look for purchases without billing configs',\n        errorData: [],\n      });\n    }\n\n    const {session, isTest = true, plans} = params;\n    const returnObject =\n      (params as BillingCheckParams<{unstable_managedPricingSupport: false}>)\n        .returnObject ?? false;\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    const payments = await assessPayments({client, isTest, plans});\n\n    if (config.future?.unstable_managedPricingSupport || returnObject) {\n      return payments as BillingCheckResponse<Params, Future>;\n    } else {\n      return payments.hasActivePayment as BillingCheckResponse<Params, Future>;\n    }\n  };\n}\n\nexport async function assessPayments({\n  client,\n  isTest,\n  plans,\n}: InternalParams): Promise<BillingCheckResponseObject> {\n  const returnValue: BillingCheckResponseObject = {\n    hasActivePayment: false,\n    oneTimePurchases: [],\n    appSubscriptions: [],\n  };\n\n  let installation: CurrentAppInstallation;\n  let endCursor: string | null = null;\n  do {\n    const currentInstallations = await client.request<CurrentAppInstallations>(\n      HAS_PAYMENTS_QUERY,\n      {variables: {endCursor}},\n    );\n\n    installation = currentInstallations.data?.currentAppInstallation!;\n    installation.activeSubscriptions.forEach((subscription) => {\n      if (subscriptionMeetsCriteria({subscription, isTest, plans})) {\n        returnValue.hasActivePayment = true;\n        if (subscription.lineItems) {\n          subscription.lineItems = convertLineItems(subscription.lineItems);\n        }\n        returnValue.appSubscriptions.push(subscription);\n      }\n    });\n    installation.oneTimePurchases.edges.forEach(({node: purchase}) => {\n      if (purchaseMeetsCriteria({purchase, isTest, plans})) {\n        returnValue.hasActivePayment = true;\n        returnValue.oneTimePurchases.push(purchase);\n      }\n    });\n\n    endCursor = installation.oneTimePurchases.pageInfo.endCursor;\n  } while (installation?.oneTimePurchases.pageInfo.hasNextPage);\n\n  return returnValue;\n}\n\nfunction subscriptionMeetsCriteria({\n  subscription,\n  isTest,\n  plans,\n}: SubscriptionMeetsCriteriaParams): boolean {\n  return (\n    (typeof plans === 'undefined' || plans.includes(subscription.name)) &&\n    (isTest || !subscription.test)\n  );\n}\n\nfunction purchaseMeetsCriteria({\n  purchase,\n  isTest,\n  plans,\n}: PurchaseMeetsCriteriaParams): boolean {\n  return (\n    (typeof plans === 'undefined' || plans.includes(purchase.name)) &&\n    (isTest || !purchase.test) &&\n    purchase.status === 'ACTIVE'\n  );\n}\n\nconst HAS_PAYMENTS_QUERY = `\n  ${APP_SUBSCRIPTION_FRAGMENT}\n  query appSubscription($endCursor: String) {\n    currentAppInstallation {\n      activeSubscriptions {\n        ...AppSubscriptionFragment\n      }\n      oneTimePurchases(first: 250, sortKey: CREATED_AT, after: $endCursor) {\n        edges {\n          node {\n            id\n            name\n            test\n            status\n          }\n        }\n        pageInfo {\n          hasNextPage\n          endCursor\n        }\n      }\n    }\n  }\n`;\n", "import {ConfigInterface, ConfigParams} from '../base-types';\nimport {BillingInterval} from '../types';\nimport {BillingError} from '../error';\nimport {buildEmbeddedAppUrl} from '../auth/get-embedded-app-url';\nimport {GraphqlClient, graphqlClientClass} from '../clients/admin';\nimport {hashString} from '../../runtime/crypto';\nimport {HashFormat} from '../../runtime/crypto/types';\nimport {FutureFlagOptions} from '../../future/flags';\n\nimport {\n  BillingConfigSubscriptionPlan,\n  BillingConfigOneTimePlan,\n  BillingConfigUsagePlan,\n  BillingRequestParams,\n  BillingRequestResponse,\n  RecurringPaymentResponse,\n  RequestResponseData,\n  SinglePaymentResponse,\n  BillingConfigSubscriptionLineItemPlan,\n  RequestConfigLineItemOverrides,\n  BillingRequest,\n  APP_SUBSCRIPTION_FRAGMENT,\n} from './types';\n\nconst RECURRING_PURCHASE_MUTATION = `\n  ${APP_SUBSCRIPTION_FRAGMENT}\n  mutation AppSubscriptionCreate(\n    $name: String!\n    $returnUrl: URL!\n    $test: Boolean\n    $trialDays: Int\n    $replacementBehavior: AppSubscriptionReplacementBehavior\n    $lineItems: [AppSubscriptionLineItemInput!]!\n  ) {\n    appSubscriptionCreate(\n      name: $name\n      returnUrl: $returnUrl\n      test: $test\n      trialDays: $trialDays\n      replacementBehavior: $replacementBehavior\n      lineItems: $lineItems\n    ) {\n      appSubscription {\n        ...AppSubscriptionFragment\n      }\n      confirmationUrl\n      userErrors {\n        field\n        message\n      }\n    }\n  }\n`;\n\nconst ONE_TIME_PURCHASE_MUTATION = `\n  mutation test(\n    $name: String!\n    $price: MoneyInput!\n    $returnUrl: URL!\n    $test: Boolean\n  ) {\n    appPurchaseOneTimeCreate(\n      name: $name\n      price: $price\n      returnUrl: $returnUrl\n      test: $test\n    ) {\n      appPurchaseOneTime {\n        id\n        name\n        test\n      }\n      confirmationUrl\n      userErrors {\n        field\n        message\n      }\n    }\n  }\n`;\n\ninterface RequestInternalParams {\n  client: GraphqlClient;\n  plan: string;\n  returnUrl: string;\n  isTest: boolean;\n}\n\ninterface RequestSubscriptionInternalParams extends RequestInternalParams {\n  billingConfig: BillingConfigSubscriptionPlan;\n}\n\ninterface RequestOneTimePaymentInternalParams extends RequestInternalParams {\n  billingConfig: BillingConfigOneTimePlan;\n}\n\ninterface RequestUsageSubscriptionInternalParams extends RequestInternalParams {\n  billingConfig: BillingConfigUsagePlan;\n}\n\ninterface RequestSubscriptionParams extends RequestInternalParams {\n  billingConfig: BillingConfigSubscriptionLineItemPlan;\n}\n\nexport function request<\n  Config extends ConfigInterface<Params>,\n  Params extends ConfigParams<any, Future>,\n  Future extends FutureFlagOptions,\n>(config: Config): BillingRequest {\n  return async function <Params extends BillingRequestParams>({\n    session,\n    plan,\n    isTest = true,\n    returnUrl: returnUrlParam,\n    returnObject = false,\n    ...overrides\n  }: Params): Promise<BillingRequestResponse<Params>> {\n    if (!config.billing || !config.billing[plan]) {\n      throw new BillingError({\n        message: `Could not find plan ${plan} in billing settings`,\n        errorData: [],\n      });\n    }\n\n    const billingConfig = {\n      ...config.billing[plan],\n    };\n    const filteredOverrides = Object.fromEntries(\n      Object.entries(overrides).filter(([_key, value]) => value !== undefined),\n    );\n\n    const cleanShopName = session.shop.replace('.myshopify.com', '');\n    const embeddedAppUrl = buildEmbeddedAppUrl(config)(\n      hashString(`admin.shopify.com/store/${cleanShopName}`, HashFormat.Base64),\n    );\n\n    const appUrl = `${config.hostScheme}://${config.hostName}?shop=${session.shop}`;\n\n    // if provided a return URL, use it, otherwise use the embedded app URL or hosted app URL\n    const returnUrl =\n      returnUrlParam || (config.isEmbeddedApp ? embeddedAppUrl : appUrl);\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    function isLineItemPlan(\n      billingConfig: any,\n    ): billingConfig is BillingConfigSubscriptionLineItemPlan {\n      return 'lineItems' in billingConfig;\n    }\n\n    function isOneTimePlan(\n      billingConfig: any,\n    ): billingConfig is BillingConfigOneTimePlan {\n      return billingConfig.interval === BillingInterval.OneTime;\n    }\n\n    let data: RequestResponseData;\n    if (isLineItemPlan(billingConfig)) {\n      const mergedBillingConfigs = mergeBillingConfigs(\n        billingConfig,\n        filteredOverrides,\n      );\n      const mutationRecurringResponse = await requestSubscriptionPayment({\n        billingConfig: mergedBillingConfigs,\n        plan,\n        client,\n        returnUrl,\n        isTest,\n      });\n\n      data = mutationRecurringResponse.appSubscriptionCreate!;\n    } else if (isOneTimePlan(billingConfig)) {\n      const mutationOneTimeResponse = await requestSinglePayment({\n        billingConfig: {...billingConfig, ...filteredOverrides},\n        plan,\n        client,\n        returnUrl,\n        isTest,\n      });\n      data = mutationOneTimeResponse.appPurchaseOneTimeCreate!;\n    } else {\n      switch (billingConfig.interval) {\n        case BillingInterval.Usage: {\n          const mutationUsageResponse = await requestUsagePayment({\n            billingConfig: {...billingConfig, ...filteredOverrides},\n            plan,\n            client,\n            returnUrl,\n            isTest,\n          });\n          data = mutationUsageResponse.appSubscriptionCreate!;\n          break;\n        }\n        default: {\n          const mutationRecurringResponse = await requestRecurringPayment({\n            billingConfig: {...billingConfig, ...filteredOverrides},\n            plan,\n            client,\n            returnUrl,\n            isTest,\n          });\n          data = mutationRecurringResponse.appSubscriptionCreate!;\n        }\n      }\n    }\n\n    if (data.userErrors?.length) {\n      throw new BillingError({\n        message: 'Error while billing the store',\n        errorData: data.userErrors,\n      });\n    }\n\n    if (returnObject) {\n      return data as Omit<\n        RequestResponseData,\n        'userErrors'\n      > as BillingRequestResponse<Params>;\n    } else {\n      return data.confirmationUrl as BillingRequestResponse<Params>;\n    }\n  };\n}\n\nasync function requestSubscriptionPayment({\n  billingConfig,\n  plan,\n  client,\n  returnUrl,\n  isTest,\n}: RequestSubscriptionParams): Promise<RecurringPaymentResponse> {\n  const lineItems = billingConfig.lineItems.map((item) => {\n    if (\n      item.interval === BillingInterval.Every30Days ||\n      item.interval === BillingInterval.Annual\n    ) {\n      const appRecurringPricingDetails: any = {\n        interval: item.interval,\n        price: {\n          amount: item.amount,\n          currencyCode: item.currencyCode,\n        },\n      };\n\n      if (item.discount) {\n        appRecurringPricingDetails.discount = {\n          durationLimitInIntervals: item.discount.durationLimitInIntervals,\n          value: {\n            amount: item.discount.value.amount,\n            percentage: item.discount.value.percentage,\n          },\n        };\n      }\n\n      return {\n        plan: {\n          appRecurringPricingDetails,\n        },\n      };\n    } else if (item.interval === BillingInterval.Usage) {\n      const appUsagePricingDetails = {\n        terms: item.terms,\n        cappedAmount: {\n          amount: item.amount,\n          currencyCode: item.currencyCode,\n        },\n      };\n\n      return {\n        plan: {\n          appUsagePricingDetails,\n        },\n      };\n    } else {\n      throw new BillingError({\n        message: 'Invalid interval provided',\n        errorData: [item],\n      });\n    }\n  });\n\n  const mutationResponse = await client.request<RecurringPaymentResponse>(\n    RECURRING_PURCHASE_MUTATION,\n    {\n      variables: {\n        name: plan,\n        trialDays: billingConfig.trialDays,\n        replacementBehavior: billingConfig.replacementBehavior,\n        returnUrl,\n        test: isTest,\n        lineItems,\n      },\n    },\n  );\n\n  if (mutationResponse.errors) {\n    throw new BillingError({\n      message: 'Error while billing the store',\n      errorData: mutationResponse.errors,\n    });\n  }\n\n  return mutationResponse.data!;\n}\n\nasync function requestRecurringPayment({\n  billingConfig,\n  plan,\n  client,\n  returnUrl,\n  isTest,\n}: RequestSubscriptionInternalParams): Promise<RecurringPaymentResponse> {\n  const mutationResponse = await client.request<RecurringPaymentResponse>(\n    RECURRING_PURCHASE_MUTATION,\n    {\n      variables: {\n        name: plan,\n        returnUrl,\n        test: isTest,\n        trialDays: billingConfig.trialDays,\n        replacementBehavior: billingConfig.replacementBehavior,\n        lineItems: [\n          {\n            plan: {\n              appRecurringPricingDetails: {\n                interval: billingConfig.interval,\n                price: {\n                  amount: billingConfig.amount,\n                  currencyCode: billingConfig.currencyCode,\n                },\n                discount: billingConfig.discount\n                  ? {\n                      durationLimitInIntervals:\n                        billingConfig.discount?.durationLimitInIntervals,\n                      value: {\n                        amount: billingConfig.discount?.value?.amount,\n                        percentage: billingConfig.discount?.value?.percentage,\n                      },\n                    }\n                  : undefined,\n              },\n            },\n          },\n        ],\n      },\n    },\n  );\n\n  if (mutationResponse.data?.appSubscriptionCreate?.userErrors.length) {\n    throw new BillingError({\n      message: 'Error while creating a subscription',\n      errorData: mutationResponse.data?.appSubscriptionCreate?.userErrors,\n    });\n  }\n\n  return mutationResponse.data!;\n}\n\nasync function requestUsagePayment({\n  billingConfig,\n  plan,\n  client,\n  returnUrl,\n  isTest,\n}: RequestUsageSubscriptionInternalParams): Promise<RecurringPaymentResponse> {\n  const mutationResponse = await client.request<RecurringPaymentResponse>(\n    RECURRING_PURCHASE_MUTATION,\n    {\n      variables: {\n        name: plan,\n        returnUrl,\n        test: isTest,\n        trialDays: billingConfig.trialDays,\n        replacementBehavior: billingConfig.replacementBehavior,\n        lineItems: [\n          {\n            plan: {\n              appUsagePricingDetails: {\n                terms: billingConfig.usageTerms,\n                cappedAmount: {\n                  amount: billingConfig.amount,\n                  currencyCode: billingConfig.currencyCode,\n                },\n              },\n            },\n          },\n        ],\n      },\n    },\n  );\n\n  if (mutationResponse.data?.appSubscriptionCreate?.userErrors.length) {\n    throw new BillingError({\n      message: 'Error while creating a subscription',\n      errorData: mutationResponse.data?.appSubscriptionCreate?.userErrors,\n    });\n  }\n\n  return mutationResponse.data!;\n}\n\nasync function requestSinglePayment({\n  billingConfig,\n  plan,\n  client,\n  returnUrl,\n  isTest,\n}: RequestOneTimePaymentInternalParams): Promise<SinglePaymentResponse> {\n  const mutationResponse = await client.request<SinglePaymentResponse>(\n    ONE_TIME_PURCHASE_MUTATION,\n    {\n      variables: {\n        name: plan,\n        returnUrl,\n        test: isTest,\n        price: {\n          amount: billingConfig.amount,\n          currencyCode: billingConfig.currencyCode,\n        },\n      },\n    },\n  );\n\n  if (mutationResponse.errors) {\n    throw new BillingError({\n      message: 'Error while billing the store',\n      errorData: mutationResponse.errors,\n    });\n  }\n\n  return mutationResponse.data!;\n}\n\nfunction mergeBillingConfigs(\n  billingConfig: BillingConfigSubscriptionLineItemPlan,\n  overrides: RequestConfigLineItemOverrides,\n): BillingConfigSubscriptionLineItemPlan {\n  const mergedConfig = {...billingConfig, ...overrides};\n  const mergedLineItems = [];\n\n  if (billingConfig.lineItems && overrides.lineItems) {\n    for (const i of billingConfig.lineItems) {\n      let found = false;\n\n      for (const j of overrides.lineItems) {\n        if (i.interval === j!.interval) {\n          mergedLineItems.push({...i, ...j});\n          found = true;\n          break;\n        }\n      }\n\n      if (!found) {\n        mergedLineItems.push(i);\n      }\n    }\n\n    mergedConfig.lineItems = mergedLineItems;\n  }\n\n  return mergedConfig as BillingConfigSubscriptionLineItemPlan;\n}\n", "import {ConfigInterface} from '../base-types';\nimport {graphqlClientClass} from '../clients/admin';\nimport {BillingError, GraphqlQueryError} from '../error';\n\nimport {\n  AppSubscription,\n  BillingCancel,\n  BillingCancelParams,\n  CancelResponse,\n  APP_SUBSCRIPTION_FRAGMENT,\n} from './types';\n\nconst CANCEL_MUTATION = `\n  ${APP_SUBSCRIPTION_FRAGMENT}\n  mutation appSubscriptionCancel($id: ID!, $prorate: Boolean) {\n    appSubscriptionCancel(id: $id, prorate: $prorate) {\n      appSubscription {\n        ...AppSubscriptionFragment\n      }\n      userErrors {\n        field\n        message\n      }\n    }\n  }\n`;\n\nexport function cancel(config: ConfigInterface): BillingCancel {\n  return async function (\n    subscriptionInfo: BillingCancelParams,\n  ): Promise<AppSubscription> {\n    const {session, subscriptionId, prorate = true} = subscriptionInfo;\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    try {\n      const response = await client.request<CancelResponse>(CANCEL_MUTATION, {\n        variables: {id: subscriptionId, prorate},\n      });\n\n      if (response.data?.appSubscriptionCancel?.userErrors.length) {\n        throw new BillingError({\n          message: 'Error while canceling a subscription',\n          errorData: response.data?.appSubscriptionCancel?.userErrors,\n        });\n      }\n\n      return response.data?.appSubscriptionCancel?.appSubscription!;\n    } catch (error) {\n      if (error instanceof GraphqlQueryError) {\n        throw new BillingError({\n          message: error.message,\n          errorData: error.response?.errors,\n        });\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n", "import {BillingError} from '../error';\nimport {ConfigInterface} from '../base-types';\nimport {graphqlClientClass} from '../clients/admin';\n\nimport {\n  ActiveSubscriptions,\n  BillingSubscriptionParams,\n  BillingSubscriptions,\n  SubscriptionResponse,\n  APP_SUBSCRIPTION_FRAGMENT,\n} from './types';\nimport {convertLineItems} from './utils';\n\nconst SUBSCRIPTION_QUERY = `\n${APP_SUBSCRIPTION_FRAGMENT}\nquery appSubscription {\n  currentAppInstallation {\n    activeSubscriptions {\n      ...AppSubscriptionFragment\n    }\n  }\n}\n`;\n\nexport function subscriptions(config: ConfigInterface): BillingSubscriptions {\n  return async function ({\n    session,\n  }: BillingSubscriptionParams): Promise<ActiveSubscriptions> {\n    if (!config.future?.unstable_managedPricingSupport && !config.billing) {\n      throw new BillingError({\n        message: 'Attempted to look for purchases without billing configs',\n        errorData: [],\n      });\n    }\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    const response =\n      await client.request<SubscriptionResponse>(SUBSCRIPTION_QUERY);\n\n    if (!response.data?.currentAppInstallation?.activeSubscriptions) {\n      return {activeSubscriptions: []};\n    }\n\n    const activeSubscriptions =\n      response.data.currentAppInstallation.activeSubscriptions;\n    activeSubscriptions.forEach((subscription) => {\n      if (subscription.lineItems) {\n        subscription.lineItems = convertLineItems(subscription.lineItems);\n      }\n    });\n\n    return {\n      activeSubscriptions,\n    };\n  };\n}\n", "import {ConfigInterface} from '../base-types';\nimport {BillingError, GraphqlQueryError} from '../error';\nimport {GraphqlClient, graphqlClientClass} from '../clients/admin';\n\nimport {\n  AppSubscription,\n  BillingCreateUsageRecord,\n  BillingCreateUsageRecordParams,\n  UsageRecord,\n  UsageRecordCreateResponse,\n  Money,\n} from './types';\nimport {assessPayments} from './check';\nimport {convertAppRecurringPricingMoney, convertAppUsagePricingMoney} from './utils';\ninterface InternalParams {\n  client: GraphqlClient;\n  isTest?: boolean;\n}\n\ninterface CreateUsageRecordVariables {\n  description: string;\n  price: Money;\n  subscriptionLineItemId: string;\n  idempotencyKey?: string;\n}\n\nconst CREATE_USAGE_RECORD_MUTATION = `\nmutation appUsageRecordCreate($description: String!, $price: MoneyInput!, $subscriptionLineItemId: ID!) {\n  appUsageRecordCreate(description: $description, price: $price, subscriptionLineItemId: $subscriptionLineItemId) {\n    userErrors {\n      field\n      message\n    }\n    appUsageRecord {\n      id\n      description\n      idempotencyKey\n      price {\n        amount\n        currencyCode\n      }\n      subscriptionLineItem {\n        id\n        plan {\n          pricingDetails {\n            ... on AppUsagePricing {\n              balanceUsed {\n                amount\n                currencyCode\n              }\n              cappedAmount {\n                amount\n                currencyCode\n              }\n              terms\n            }\n          }\n        }\n      }\n    }\n  }\n}\n`;\n\nexport function createUsageRecord(\n  config: ConfigInterface,\n): BillingCreateUsageRecord {\n  return async function createUsageRecord(\n    usageRecordInfo: BillingCreateUsageRecordParams,\n  ): Promise<UsageRecord> {\n    const {\n      session,\n      subscriptionLineItemId,\n      description,\n      price,\n      idempotencyKey,\n      isTest = true,\n    } = usageRecordInfo;\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    // If a subscription line item ID is not passed, we will query Shopify\n    // for an active usage subscription line item ID\n    const usageSubscriptionLineItemId = subscriptionLineItemId\n      ? subscriptionLineItemId\n      : await getUsageRecordSubscriptionLineItemId({client, isTest});\n\n    const variables: CreateUsageRecordVariables = {\n      description,\n      price,\n      subscriptionLineItemId: usageSubscriptionLineItemId,\n    };\n    if (idempotencyKey) {\n      variables.idempotencyKey = idempotencyKey;\n    }\n\n    try {\n      const response = await client.request<UsageRecordCreateResponse>(\n        CREATE_USAGE_RECORD_MUTATION,\n        {\n          variables,\n        },\n      );\n      if (response.data?.appUsageRecordCreate?.userErrors.length) {\n        throw new BillingError({\n          message: 'Error while creating a usage record',\n          errorData: response.data?.appUsageRecordCreate?.userErrors,\n        });\n      }\n\n      const appUsageRecord = response.data?.appUsageRecordCreate?.appUsageRecord!;\n      convertAppRecurringPricingMoney(appUsageRecord.price);\n      convertAppUsagePricingMoney(appUsageRecord.subscriptionLineItem.plan.pricingDetails);\n\n      return appUsageRecord;\n    } catch (error) {\n      if (error instanceof GraphqlQueryError) {\n        throw new BillingError({\n          message: error.message,\n          errorData: error.response?.errors,\n        });\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n\nasync function getUsageRecordSubscriptionLineItemId({\n  client,\n  isTest,\n}: InternalParams): Promise<string> {\n  const payments = await assessPayments({client, isTest});\n\n  if (!payments.hasActivePayment) {\n    throw new BillingError({\n      message: 'No active payment found',\n      errorData: [],\n    });\n  }\n  if (!payments.appSubscriptions.length) {\n    throw new BillingError({\n      message: 'No active subscriptions found',\n      errorData: [],\n    });\n  }\n  if (payments.appSubscriptions) {\n    const usageSubscriptionLineItemId = getUsageLineItemId(\n      payments.appSubscriptions,\n    );\n    return usageSubscriptionLineItemId;\n  }\n  throw new BillingError({\n    message: 'Unable to find active subscription line item',\n    errorData: [],\n  });\n}\n\nfunction getUsageLineItemId(subscriptions: AppSubscription[]): string {\n  for (const subscription of subscriptions) {\n    // An app can have only one active subscription\n    if (subscription.status === 'ACTIVE' && subscription.lineItems) {\n      // An app can have only one usage subscription line item\n      for (const lineItem of subscription.lineItems) {\n        if ('balanceUsed' in lineItem.plan.pricingDetails) {\n          return lineItem.id;\n        }\n      }\n    }\n  }\n\n  throw new BillingError({\n    message: 'No active usage subscription found',\n    errorData: [],\n  });\n}\n", "import {BillingError, GraphqlQueryError} from '../error';\nimport {ConfigInterface} from '../base-types';\nimport {graphqlClientClass} from '../clients/admin';\n\nimport {\n  BillingUpdateUsageCappedAmount,\n  BillingUpdateUsageCappedAmountParams,\n  BillingUpdateUsageCappedAmountResponse,\n  UpdateCappedAmountConfirmation,\n  APP_SUBSCRIPTION_FRAGMENT,\n} from './types';\nimport {convertLineItems} from './utils';\n\nconst UPDATE_USAGE_CAPPED_AMOUNT_MUTATION = `\n${APP_SUBSCRIPTION_FRAGMENT}\nmutation appSubscriptionLineItemUpdate($cappedAmount: MoneyInput!, $id: ID!) {\n  appSubscriptionLineItemUpdate(cappedAmount: $cappedAmount, id: $id) {\n    userErrors {\n      field\n      message\n    }\n    confirmationUrl\n    appSubscription {\n      ...AppSubscriptionFragment\n    }\n  }\n}\n`;\n\nexport function updateUsageCappedAmount(\n  config: ConfigInterface,\n): BillingUpdateUsageCappedAmount {\n  return async function updateUsageCappedAmount(\n    params: BillingUpdateUsageCappedAmountParams,\n  ): Promise<UpdateCappedAmountConfirmation> {\n    if (!config.billing) {\n      throw new BillingError({\n        message: 'Attempted to update line item without billing configs',\n        errorData: [],\n      });\n    }\n\n    const {\n      session,\n      subscriptionLineItemId,\n      cappedAmount: {amount, currencyCode},\n    } = params;\n\n    const GraphqlClient = graphqlClientClass({config});\n    const client = new GraphqlClient({session});\n\n    try {\n      const response =\n        await client.request<BillingUpdateUsageCappedAmountResponse>(\n          UPDATE_USAGE_CAPPED_AMOUNT_MUTATION,\n          {\n            variables: {\n              id: subscriptionLineItemId,\n              cappedAmount: {\n                amount,\n                currencyCode,\n              },\n            },\n          },\n        );\n\n      if (response.data?.appSubscriptionLineItemUpdate?.userErrors.length) {\n        throw new BillingError({\n          message: 'Error while updating usage subscription capped amount',\n          errorData: response.data?.appSubscriptionLineItemUpdate?.userErrors,\n        });\n      }\n\n      const appSubscription =\n        response.data?.appSubscriptionLineItemUpdate?.appSubscription!;\n      if (appSubscription && appSubscription.lineItems) {\n        appSubscription.lineItems = convertLineItems(appSubscription.lineItems);\n      }\n\n      return {\n        confirmationUrl:\n          response.data?.appSubscriptionLineItemUpdate?.confirmationUrl!,\n        appSubscription,\n      };\n    } catch (error) {\n      if (error instanceof GraphqlQueryError) {\n        throw new BillingError({\n          message: error.message,\n          errorData: error.response?.errors,\n        });\n      }\n\n      throw error;\n    }\n  };\n}\n", "import {ConfigInterface} from '../base-types';\nimport {FutureFlagOptions} from '../../future/flags';\n\nimport {check} from './check';\nimport {request} from './request';\nimport {cancel} from './cancel';\nimport {subscriptions} from './subscriptions';\nimport {createUsageRecord} from './create-usage-record';\nimport {updateUsageCappedAmount} from './update-usage-subscription-capped-amount';\nimport {ShopifyBilling} from './types';\n\nexport type {ShopifyBilling} from './types';\n\nexport function shopifyBilling<Future extends FutureFlagOptions>(\n  config: ConfigInterface,\n): ShopifyBilling<Future> {\n  return {\n    check: check(config),\n    request: request(config),\n    cancel: cancel(config),\n    subscriptions: subscriptions(config),\n    createUsageRecord: createUsageRecord(config),\n    updateUsageCappedAmount: updateUsageCappedAmount(config),\n  };\n}\n", "import {\n  HmacValidationType,\n  ValidationInvalid,\n  ValidationValid,\n  ValidateParams,\n} from '../utils/types';\nimport {validateHmacFromRequestFactory} from '../utils/hmac-validator';\nimport {ConfigInterface} from '../base-types';\n\nexport function validateFactory(config: ConfigInterface) {\n  return async function validate({\n    rawBody,\n    ...adapterArgs\n  }: ValidateParams): Promise<ValidationInvalid | ValidationValid> {\n    return validateHmacFromRequestFactory(config)({\n      type: HmacValidationType.Flow,\n      rawBody,\n      ...adapterArgs,\n    });\n  };\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {validateFactory} from './validate';\n\nexport function shopifyFlow(config: ConfigInterface) {\n  return {\n    validate: validateFactory(config),\n  };\n}\n\nexport type ShopifyFlow = ReturnType<typeof shopifyFlow>;\n", "import {ConfigInterface} from '../base-types';\nimport {validateHmacFromRequestFactory} from '../utils/hmac-validator';\nimport {\n  HmacValidationType,\n  ValidateParams,\n  ValidationInvalid,\n  ValidationValid,\n} from '../utils/types';\n\nexport function validateFactory(config: ConfigInterface) {\n  return async function validate({\n    rawBody,\n    ...adapterArgs\n  }: ValidateParams): Promise<ValidationInvalid | ValidationValid> {\n    return validateHmacFromRequestFactory(config)({\n      type: HmacValidationType.FulfillmentService,\n      rawBody,\n      ...adapterArgs,\n    });\n  };\n}\n", "import {ConfigInterface} from '../base-types';\n\nimport {validateFactory} from './validate';\n\nexport function fulfillmentService(config: ConfigInterface) {\n  return {\n    validate: validateFactory(config),\n  };\n}\n\nexport type FulfillmentService = ReturnType<typeof fulfillmentService>;\n", "import {loadRestResources} from '../rest/load-rest-resources';\nimport {ShopifyRestResources} from '../rest/types';\nimport {abstractRuntimeString} from '../runtime/platform';\nimport {FutureFlagOptions, logDisabledFutureFlags} from '../future/flags';\n\nimport {ConfigParams, ConfigInterface} from './base-types';\nimport {validateConfig} from './config';\nimport {clientClasses, ShopifyClients} from './clients';\nimport {shopifyAuth, ShopifyAuth} from './auth';\nimport {shopifySession, ShopifySession} from './session';\nimport {shopifyUtils, ShopifyUtils} from './utils';\nimport {shopifyWebhooks, ShopifyWebhooks} from './webhooks';\nimport {shopifyBilling, ShopifyBilling} from './billing';\nimport {logger, ShopifyLogger} from './logger';\nimport {SHOPIFY_API_LIBRARY_VERSION} from './version';\nimport {restClientClass} from './clients/admin/rest/client';\nimport {ShopifyFlow, shopifyFlow} from './flow';\nimport {FulfillmentService, fulfillmentService} from './fulfillment-service';\n\nexport * from './error';\nexport * from './session/classes';\n\nexport * from '../rest/types';\nexport * from './types';\nexport * from './base-types';\nexport * from './auth/types';\nexport * from './billing/types';\nexport * from './clients/types';\nexport * from './session/types';\nexport * from './webhooks/types';\nexport * from './utils/types';\n\nexport interface Shopify<\n  Params extends ConfigParams = ConfigParams,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> {\n  config: ConfigInterface<Params>;\n  clients: ShopifyClients;\n  auth: ShopifyAuth;\n  session: ShopifySession;\n  utils: ShopifyUtils;\n\n  /**\n   * Functions for working with webhooks.\n   *\n   * Most of these functions are used for interacting with shop-specific webhooks.\n   * Unless your app needs different webhooks for different shops, we recommend using app-specific webhooks instead:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-subscriptions}\n   *\n   * If you use only app-specific webhooks, the only function you will need is `shopify.webhooks.validate`.\n   */\n  webhooks: ShopifyWebhooks;\n  billing: ShopifyBilling<Future>;\n  logger: ShopifyLogger;\n  rest: Resources;\n  flow: ShopifyFlow;\n  fulfillmentService: FulfillmentService;\n}\n\nexport function shopifyApi<\n  Params extends ConfigParams<Resources, Future>,\n  Resources extends ShopifyRestResources,\n  Future extends FutureFlagOptions,\n>({\n  future,\n  restResources,\n  ...config\n}: {future?: Future; restResources?: Resources} & Params): Shopify<\n  Params,\n  Resources,\n  Future\n> {\n  const libConfig = {...config, future, restResources};\n  const validatedConfig = validateConfig(libConfig);\n\n  const shopify = {\n    config: validatedConfig,\n    clients: clientClasses(validatedConfig),\n    auth: shopifyAuth(validatedConfig),\n    session: shopifySession(validatedConfig),\n    utils: shopifyUtils(validatedConfig),\n    webhooks: shopifyWebhooks(validatedConfig),\n    billing: shopifyBilling(validatedConfig),\n    flow: shopifyFlow(validatedConfig),\n    fulfillmentService: fulfillmentService(validatedConfig),\n    logger: logger(validatedConfig),\n    rest: {} as Resources,\n  };\n\n  if (restResources) {\n    shopify.rest = loadRestResources({\n      resources: restResources,\n      config: validatedConfig,\n      RestClient: restClientClass({config: validatedConfig}),\n    });\n  }\n\n  shopify.logger\n    .info(\n      `version ${SHOPIFY_API_LIBRARY_VERSION}, environment ${abstractRuntimeString()}`,\n    )\n    .catch((err) => console.log(err));\n\n  logDisabledFutureFlags(validatedConfig, shopify.logger);\n\n  return shopify as Shopify<Params, Resources, Future>;\n}\n", "import {\n  RegisterReturn,\n  Shopify,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\nimport {SessionStorage} from '@shopify/shopify-app-session-storage';\n\nimport type {AuthenticateAdmin} from './authenticate/admin/types';\nimport type {AuthenticateFlow} from './authenticate/flow/types';\nimport {AuthenticateFulfillmentService} from './authenticate/fulfillment-service/types';\nimport type {AuthenticatePublic} from './authenticate/public/types';\nimport type {\n  AuthenticateWebhook,\n  RegisterWebhooksOptions,\n} from './authenticate/webhooks/types';\nimport type {AppConfig, AppConfigArg} from './config-types';\nimport type {\n  ApiConfigWithFutureFlags,\n  ApiFutureFlags,\n  FutureFlagOptions,\n} from './future/flags';\nimport type {Unauthenticated} from './unauthenticated/types';\n\nexport interface BasicParams<\n  Future extends FutureFlagOptions = FutureFlagOptions,\n> {\n  api: Shopify<\n    ApiConfigWithFutureFlags<Future>,\n    ShopifyRestResources,\n    ApiFutureFlags<Future>\n  >;\n  config: AppConfig;\n  logger: Shopify['logger'];\n}\n\n// eslint-disable-next-line no-warning-comments\n// TODO: Use this enum to replace the isCustomStoreApp config option in shopify-api-js\nexport enum AppDistribution {\n  AppStore = 'app_store',\n  SingleMerchant = 'single_merchant',\n  ShopifyAdmin = 'shopify_admin',\n}\n\ntype RegisterWebhooks = (\n  options: RegisterWebhooksOptions,\n) => Promise<RegisterReturn | void>;\n\nexport enum LoginErrorType {\n  MissingShop = 'MISSING_SHOP',\n  InvalidShop = 'INVALID_SHOP',\n}\n\nexport interface LoginError {\n  shop?: LoginErrorType;\n}\n\ntype Login = (request: Request) => Promise<LoginError | never>;\n\ntype AddDocumentResponseHeaders = (request: Request, headers: Headers) => void;\n\ntype RestResourcesType<Config extends AppConfigArg> =\n  Config['restResources'] extends ShopifyRestResources\n    ? Config['restResources']\n    : ShopifyRestResources;\n\ntype SessionStorageType<Config extends AppConfigArg> =\n  Config['sessionStorage'] extends SessionStorage\n    ? Config['sessionStorage']\n    : SessionStorage;\n\ninterface Authenticate<Config extends AppConfigArg> {\n  /**\n   * Authenticate an admin Request and get back an authenticated admin context.  Use the authenticated admin context to interact with Shopify.\n   *\n   * Examples of when to use this are requests from your app's UI, or requests from admin extensions.\n   *\n   * If there is no session for the Request, this will redirect the merchant to correct auth flows.\n   *\n   * @example\n   * <caption>Authenticating a request for an embedded app.</caption>\n   * ```ts\n   * // /app/routes/**\\/*.jsx\n   * import { LoaderFunctionArgs, json } from \"@remix-run/node\";\n   * import { authenticate } from \"../../shopify.server\";\n   *\n   * export async function loader({ request }: LoaderFunctionArgs) {\n   *   const {admin, session, sessionToken, billing} = authenticate.admin(request);\n   *   const response = await admin.graphql(`{ shop { name } }`)\n   *\n   *   return json(await response.json());\n   * }\n   * ```\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { LATEST_API_VERSION, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * export const authenticate = shopify.authenticate;\n   * ```\n   */\n  admin: AuthenticateAdmin<Config, RestResourcesType<Config>>;\n\n  /**\n   * Authenticate a Flow extension Request and get back an authenticated context, containing an admin context to access\n   * the API, and the payload of the request.\n   *\n   * If there is no session for the Request, this will return an HTTP 400 error.\n   *\n   * Note that this will always be a POST request.\n   *\n   * @example\n   * <caption>Authenticating a Flow extension request.</caption>\n   * ```ts\n   * // /app/routes/**\\/*.jsx\n   * import { ActionFunctionArgs, json } from \"@remix-run/node\";\n   * import { authenticate } from \"../../shopify.server\";\n   *\n   * export async function action({ request }: ActionFunctionArgs) {\n   *   const {admin, session, payload} = authenticate.flow(request);\n   *\n   *   // Perform flow extension logic\n   *\n   *   // Return a 200 response\n   *   return null;\n   * }\n   * ```\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { LATEST_API_VERSION, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * export const authenticate = shopify.authenticate;\n   * ```\n   */\n  flow: AuthenticateFlow<Config, RestResourcesType<Config>>;\n\n  /**\n   * Authenticate a request from a fulfillment service and get back an authenticated context.\n   *\n   * @example\n   * <caption>Shopify session for the fulfillment service request.</caption>\n   * <description>Use the session associated with this request to use the Admin GraphQL API </description>\n   * ```ts\n   * // /app/routes/fulfillment_order_notification.ts\n   * import { ActionFunctionArgs } from \"@remix-run/node\";\n   * import { authenticate } from \"../shopify.server\";\n   *\n   * export async function action({ request }: ActionFunctionArgs) {\n   *   const { admin, session } = await authenticate.fulfillmentService(request);\n   *\n   *   console.log(session.id)\n   *\n   *   return new Response();\n   * }\n   * ```\n   * */\n  fulfillmentService: AuthenticateFulfillmentService<\n    Config,\n    RestResourcesType<Config>\n  >;\n\n  /**\n   * Authenticate a public request and get back a session token.\n   *\n   * @example\n   * <caption>Authenticating a request from a checkout extension</caption>\n   *\n   * ```ts\n   * // /app/routes/api/checkout.jsx\n   * import { LoaderFunctionArgs, json } from \"@remix-run/node\";\n   * import { authenticate } from \"../../shopify.server\";\n   * import { getWidgets } from \"~/db/widgets\";\n   *\n   * export async function loader({ request }: LoaderFunctionArgs) {\n   *   const {sessionToken} = authenticate.public.checkout(request);\n   *\n   *   return json(await getWidgets(sessionToken));\n   * }\n   * ```\n   */\n  public: AuthenticatePublic<Config>;\n\n  /**\n   * Authenticate a Shopify webhook request, get back an authenticated admin context and details on the webhook request\n   * \n   * @example\n   * <caption>Authenticating a webhook request</caption>\n   *\n   * ```ts\n   * // app/routes/webhooks.ts\n   * import { ActionFunctionArgs } from \"@remix-run/node\";\n   * import { authenticate } from \"../shopify.server\";\n   * import db from \"../db.server\";\n   *\n   * export const action = async ({ request }: ActionFunctionArgs) => {\n   *   const { topic, shop, session, payload } = await authenticate.webhook(request);\n   * \n   *   // Webhook requests can trigger after an app is uninstalled\n   *   // If the app is already uninstalled, the session may be undefined.\n   *   if (!session) {\n   *     throw new Response();\n   *   }\n   * \n   *   // Handle the webhook\n   *   console.log(`${TOPIC} webhook received with payload:`, JSON.stringify(payload))\n   *\n   *   throw new Response();\n   * };\n   * ```\n   * \n   * @example\n   * <caption>Registering app-specific webhooks (Recommended)</caption>\n   * ```toml\n   * # shopify.app.toml\n   * [webhooks]\n   * api_version = \"2024-07\"\n\n   *   [[webhooks.subscriptions]]\n   *   topics = [\"products/create\"]\n   *   uri = \"/webhooks/products/create\"\n   * \n   * ```\n   * \n   * @example\n   * <caption>Registering shop-specific webhooks.</caption>\n   * <description>In many cases you won't need this. Please see: [https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions](https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions)\n   * </description>\n   * ```ts\n   * // app/shopify.server.ts\n   * import { DeliveryMethod, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   webhooks: {\n   *     PRODUCTS_CREATE: {\n   *       deliveryMethod: DeliveryMethod.Http,\n   *       callbackUrl: \"/webhooks/products/create\",\n   *     },\n   *   },\n   *   hooks: {\n   *     afterAuth: async ({ session }) => {\n   *       // Register webhooks for the shop\n   *       // In this example, every shop will have these webhooks\n   *       // You could wrap this in some custom shop specific conditional logic if needed\n   *       shopify.registerWebhooks({ session });\n   *     },\n   *   },\n   *   // ...etc\n   * });\n   * ```\n   */\n  webhook: AuthenticateWebhook<Config, RestResourcesType<Config>, string>;\n}\n\nexport interface ShopifyAppBase<Config extends AppConfigArg> {\n  /**\n   * The `SessionStorage` instance you passed in as a config option.\n   *\n   * @example\n   * <caption>Storing sessions with Prisma.</caption>\n   * <description>Import the `@shopify/shopify-app-session-storage-prisma` package to store sessions in your Prisma database.</description>\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   * import { PrismaSessionStorage } from \"@shopify/shopify-app-session-storage-prisma\";\n   * import prisma from \"~/db.server\";\n   *\n   * const shopify = shopifyApp({\n   *   sessionStorage: new PrismaSessionStorage(prisma),\n   *   // ...etc\n   * })\n   *\n   * // shopify.sessionStorage is an instance of PrismaSessionStorage\n   * ```\n   */\n  sessionStorage?: SessionStorageType<Config>;\n\n  /**\n   * Adds the required Content Security Policy headers for Shopify apps to the given Headers object.\n   *\n   * {@link https://shopify.dev/docs/apps/store/security/iframe-protection}\n   *\n   * @example\n   * <caption>Return headers on all requests.</caption>\n   * <description>Add headers to all HTML requests by calling `shopify.addDocumentResponseHeaders` in `entry.server.tsx`.</description>\n   *\n   * ```\n   * // ~/shopify.server.ts\n   * import { shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * export const addDocumentResponseheaders = shopify.addDocumentResponseheaders;\n   * ```\n   *\n   * ```ts\n   * // entry.server.tsx\n   * import { addDocumentResponseHeaders } from \"~/shopify.server\";\n   *\n   * export default function handleRequest(\n   *   request: Request,\n   *   responseStatusCode: number,\n   *   responseHeaders: Headers,\n   *   remixContext: EntryContext\n   * ) {\n   *   const markup = renderToString(\n   *     <RemixServer context={remixContext} url={request.url} />\n   *   );\n   *\n   *   responseHeaders.set(\"Content-Type\", \"text/html\");\n   *   addDocumentResponseHeaders(request, responseHeaders);\n   *\n   *   return new Response(\"<!DOCTYPE html>\" + markup, {\n   *     status: responseStatusCode,\n   *     headers: responseHeaders,\n   *   });\n   * }\n   * ```\n   */\n  addDocumentResponseHeaders: AddDocumentResponseHeaders;\n\n  /**\n   * Register shop-specific webhook subscriptions using the Admin GraphQL API.\n   *\n   * In many cases defining app-specific webhooks in the `shopify.app.toml` will be sufficient and easier to manage.  Please see:\n   *\n   * {@link https://shopify.dev/docs/apps/build/webhooks/subscribe#app-specific-vs-shop-specific-subscriptions}\n   *\n   * You should only use this if you need shop-specific webhooks.\n   *\n   * @example\n   * <caption>Registering shop-specific webhooks after install</caption>\n   * <description>Trigger the registration to create the shop-specific webhook subscriptions after a merchant installs your app using the `afterAuth` hook. Learn more about [subscribing to webhooks.](https://shopify.dev/docs/api/shopify-app-remix/v3/guide-webhooks)</description>\n   * ```ts\n   * // app/shopify.server.ts\n   * import { DeliveryMethod, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   webhooks: {\n   *     PRODUCTS_CREATE: {\n   *       deliveryMethod: DeliveryMethod.Http,\n   *       callbackUrl: \"/webhooks/products/create\",\n   *     },\n   *   },\n   *   hooks: {\n   *     afterAuth: async ({ session }) => {\n   *       // Register webhooks for the shop\n   *       // In this example, every shop will have these webhooks\n   *       // You could wrap this in some custom shop specific conditional logic if needed\n   *       shopify.registerWebhooks({ session });\n   *     },\n   *   },\n   *   // ...etc\n   * });\n   * ```\n   */\n  registerWebhooks: RegisterWebhooks;\n\n  /**\n   * Ways to authenticate requests from different surfaces across Shopify.\n   *\n   * @example\n   * <caption>Authenticate Shopify requests.</caption>\n   * <description>Use the functions in `authenticate` to validate requests coming from Shopify.</description>\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { LATEST_API_VERSION, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * ```\n   * ```ts\n   * // /app/routes/**\\/*.jsx\n   * import { LoaderFunctionArgs, json } from \"@remix-run/node\";\n   * import shopify from \"../../shopify.server\";\n   *\n   * export async function loader({ request }: LoaderFunctionArgs) {\n   *   const {admin, session, sessionToken, billing} = shopify.authenticate.admin(request);\n   *   const response = admin.graphql(`{ shop { name } }`)\n   *\n   *   return json(await response.json());\n   * }\n   * ```\n   */\n  authenticate: Authenticate<Config>;\n\n  /**\n   * Ways to get Contexts from requests that do not originate from Shopify.\n   *\n   * @example\n   * <caption>Using unauthenticated contexts.</caption>\n   * <description>Create contexts for requests that don't come from Shopify.</description>\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { LATEST_API_VERSION, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * ```\n   * ```ts\n   * // /app/routes/**\\/*.jsx\n   * import { LoaderFunctionArgs, json } from \"@remix-run/node\";\n   * import { authenticateExternal } from \"~/helpers/authenticate\"\n   * import shopify from \"../../shopify.server\";\n   *\n   * export async function loader({ request }: LoaderFunctionArgs) {\n   *   const shop = await authenticateExternal(request)\n   *   const {admin} = await shopify.unauthenticated.admin(shop);\n   *   const response = admin.graphql(`{ shop { currencyCode } }`)\n   *\n   *   return json(await response.json());\n   * }\n   * ```\n   */\n  unauthenticated: Unauthenticated<Config, RestResourcesType<Config>>;\n}\n\nexport interface ShopifyAppLogin {\n  /**\n   * Log a merchant in, and redirect them to the app root. Will redirect the merchant to authentication if a shop is\n   * present in the URL search parameters or form data.\n   *\n   * This function won't be present when the `distribution` config option is set to `AppDistribution.ShopifyAdmin`,\n   * because Admin apps aren't allowed to show a login page.\n   *\n   * @example\n   * <caption>Creating a login page.</caption>\n   * <description>Use `shopify.login` to create a login form, in a route that can handle GET and POST requests.</description>\n   * ```ts\n   * // /app/shopify.server.ts\n   * import { LATEST_API_VERSION, shopifyApp } from \"@shopify/shopify-app-remix/server\";\n   *\n   * const shopify = shopifyApp({\n   *   // ...etc\n   * });\n   * export default shopify;\n   * ```\n   * ```ts\n   * // /app/routes/auth/login.tsx\n   * import shopify from \"../../shopify.server\";\n   *\n   * export async function loader({ request }: LoaderFunctionArgs) {\n   *   const errors = shopify.login(request);\n   *\n   *   return json(errors);\n   * }\n   *\n   * export async function action({ request }: ActionFunctionArgs) {\n   *   const errors = shopify.login(request);\n   *\n   *   return json(errors);\n   * }\n   *\n   * export default function Auth() {\n   *   const actionData = useActionData<typeof action>();\n   *   const [shop, setShop] = useState(\"\");\n   *\n   *   return (\n   *     <Page>\n   *       <Card>\n   *         <Form method=\"post\">\n   *           <FormLayout>\n   *             <Text variant=\"headingMd\" as=\"h2\">\n   *               Login\n   *             </Text>\n   *             <TextField\n   *               type=\"text\"\n   *               name=\"shop\"\n   *               label=\"Shop domain\"\n   *               helpText=\"e.g: my-shop-domain.myshopify.com\"\n   *               value={shop}\n   *               onChange={setShop}\n   *               autoComplete=\"on\"\n   *               error={actionData?.errors.shop}\n   *             />\n   *             <Button submit primary>\n   *               Submit\n   *             </Button>\n   *           </FormLayout>\n   *         </Form>\n   *       </Card>\n   *     </Page>\n   *   );\n   * }\n   * ```\n   */\n  login: Login;\n}\n\nexport type AdminApp<Config extends AppConfigArg> = ShopifyAppBase<Config>;\nexport type SingleMerchantApp<Config extends AppConfigArg> =\n  ShopifyAppBase<Config> & ShopifyAppLogin;\nexport type AppStoreApp<Config extends AppConfigArg> = ShopifyAppBase<Config> &\n  ShopifyAppLogin;\n\ntype EnforceSessionStorage<Config extends AppConfigArg, Base> = Base & {\n  sessionStorage: SessionStorageType<Config>;\n};\n\n/**\n * An object your app can use to interact with Shopify.\n *\n * By default, the app's distribution is `AppStore`.\n */\nexport type ShopifyApp<Config extends AppConfigArg> =\n  Config['distribution'] extends AppDistribution.ShopifyAdmin\n    ? AdminApp<Config>\n    : Config['distribution'] extends AppDistribution.SingleMerchant\n      ? EnforceSessionStorage<Config, SingleMerchantApp<Config>>\n      : Config['distribution'] extends AppDistribution.AppStore\n        ? EnforceSessionStorage<Config, AppStoreApp<Config>>\n        : EnforceSessionStorage<Config, AppStoreApp<Config>>;\n", "import {HeadersArgs} from '@remix-run/server-runtime';\n\nexport function headersBoundary(headers: HeadersArgs): Headers {\n  const {parentHeaders, loaderHeaders, actionHeaders, errorHeaders} = headers;\n\n  if (errorHeaders && Array.from(errorHeaders.entries()).length > 0) {\n    return errorHeaders;\n  }\n\n  return new Headers([\n    ...(parentHeaders ? Array.from(parentHeaders.entries()) : []),\n    ...(loaderHeaders ? Array.from(loaderHeaders.entries()) : []),\n    ...(actionHeaders ? Array.from(actionHeaders.entries()) : []),\n  ]);\n}\n", "export function errorBoundary(error: any) {\n  if (\n    error.constructor.name === 'ErrorResponse' ||\n    error.constructor.name === 'ErrorResponseImpl'\n  ) {\n    return (\n      <div\n        dangerouslySetInnerHTML={{__html: error.data || 'Handling response'}}\n      />\n    );\n  }\n\n  throw error;\n}\n", "import {headersBoundary} from './headers';\nimport {errorBoundary} from './error';\n\n/**\n * A collection of functions that handle the necessary code for error boundaries in routes using authenticate.admin.\n */\nexport const boundary = {\n  /**\n   * A function that handles errors or thrown responses.\n   *\n   * @example\n   * <caption>Catching errors in a route</caption>\n   * ```ts\n   * // /app/routes/admin/widgets.ts\n   * import { boundary } from \"@shopify/shopify-app-remix/server\";\n   *\n   * export function ErrorBoundary() {\n   *   return boundary.error(useRouteError());\n   * }\n   * ```\n   */\n  error: errorBoundary,\n\n  /**\n   * A function that sets the appropriate document response headers.\n   *\n   * @example\n   * <caption>Catching errors in a route</caption>\n   * ```ts\n   * // /app/routes/admin/widgets.ts\n   * import { boundary } from \"@shopify/shopify-app-remix/server\";\n   *\n   * export const headers = (headersArgs) => {\n   *   return boundary.headers(headersArgs);\n   * };\n   * ```\n   */\n  headers: headersBoundary,\n};\n", "export const SHOPIFY_REMIX_LIBRARY_VERSION = '3.8.5';\n", "import type {BasicParams} from '../../types';\n\nimport type {RegisterWebhooksOptions} from './types';\n\nexport function registerWebhooksFactory({api, logger}: BasicParams) {\n  return async function registerWebhooks({session}: RegisterWebhooksOptions) {\n    return api.webhooks\n      .register({session})\n      .then((response) => {\n        Object.entries(response).forEach(([topic, topicResults]) => {\n          topicResults.forEach(({success, ...rest}) => {\n            if (success) {\n              logger.debug('Registered webhook', {\n                topic,\n                shop: session.shop,\n                operation: rest.operation,\n              });\n            } else {\n              logger.error('Failed to register webhook', {\n                topic,\n                shop: session.shop,\n                result: JSON.stringify(rest.result),\n              });\n            }\n          });\n        });\n\n        return response;\n      })\n      .catch((error) => {\n        const graphQLErrors: {extensions: {code?: string}}[] =\n          error.body?.errors?.graphQLErrors || [];\n\n        const throttled = graphQLErrors.find(\n          ({extensions: {code}}) => code === 'THROTTLED',\n        );\n\n        if (throttled) {\n          logger.error('Failed to register webhooks', {\n            shop: session.shop,\n            error: JSON.stringify(error),\n          });\n        } else {\n          throw error;\n        }\n      });\n  };\n}\n", "export const APP_BRIDGE_URL =\n  'https://cdn.shopify.com/shopifycloud/app-bridge.js';\n\nexport const REAUTH_URL_HEADER =\n  'X-Shopify-API-Request-Failure-Reauthorize-Url';\n\nexport const RETRY_INVALID_SESSION_HEADER = {\n  'X-Shopify-Retry-Invalid-Session-Request': '1',\n};\n\nexport const CORS_HEADERS = {\n  'Access-Control-Allow-Origin': '*',\n  'Access-Control-Allow-Headers': 'Authorization',\n  'Access-Control-Expose-Headers': REAUTH_URL_HEADER,\n};\n", "import {BasicParams} from '../../types';\nimport {REAUTH_URL_HEADER} from '../const';\n\nexport interface EnsureCORSFunction {\n  (response: Response): Response;\n}\n\nexport function ensureCORSHeadersFactory(\n  params: BasicParams,\n  request: Request,\n  corsHeaders: string[] = [],\n): EnsureCORSFunction {\n  const {logger, config} = params;\n\n  return function ensureCORSHeaders(response) {\n    const origin = request.headers.get('Origin');\n    if (origin && origin !== config.appUrl) {\n      logger.debug(\n        'Request comes from a different origin, adding CORS headers',\n      );\n\n      const corsHeadersSet = new Set([\n        'Authorization',\n        'Content-Type',\n        ...corsHeaders,\n      ]);\n\n      response.headers.set('Access-Control-Allow-Origin', '*');\n      response.headers.set(\n        'Access-Control-Allow-Headers',\n        [...corsHeadersSet].join(', '),\n      );\n      response.headers.set('Access-Control-Expose-Headers', REAUTH_URL_HEADER);\n    }\n\n    return response;\n  };\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport {BasicParams} from '../../../types';\n\nexport const redirectToBouncePage = (params: BasicParams, url: URL): never => {\n  const {config} = params;\n\n  // Make sure we always point to the configured app URL so it also works behind reverse proxies (that alter the Host\n  // header).\n  const searchParams = url.searchParams;\n  searchParams.delete('id_token');\n  searchParams.set(\n    'shopify-reload',\n    `${config.appUrl}${url.pathname}?${searchParams.toString()}`,\n  );\n\n  // eslint-disable-next-line no-warning-comments\n  // TODO Make sure this works on chrome without a tunnel (weird HTTPS redirect issue)\n  // https://github.com/orgs/Shopify/projects/6899/views/1?pane=issue&itemId=28376650\n  throw redirect(\n    `${config.auth.patchSessionTokenPath}?${searchParams.toString()}`,\n  );\n};\n", "import {redirectToBouncePage} from '../admin/helpers/redirect-to-bounce-page';\nimport {RETRY_INVALID_SESSION_HEADER} from '../const';\nimport {BasicParams} from '../../types';\n\ninterface RespondToInvalidSessionTokenParams {\n  params: BasicParams;\n  request: Request;\n  retryRequest?: boolean;\n}\n\nexport function respondToInvalidSessionToken({\n  params,\n  request,\n  retryRequest = false,\n}: RespondToInvalidSessionTokenParams) {\n  const {api, logger, config} = params;\n\n  const isDocumentRequest = !request.headers.get('authorization');\n  if (isDocumentRequest) {\n    return redirectToBouncePage({api, logger, config}, new URL(request.url));\n  }\n\n  throw new Response(undefined, {\n    status: 401,\n    statusText: 'Unauthorized',\n    headers: retryRequest ? RETRY_INVALID_SESSION_HEADER : {},\n  });\n}\n", "export function getShopFromRequest(request: Request) {\n  const url = new URL(request.url);\n  return url.searchParams.get('shop')!;\n}\n", "import {JwtPayload} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../types';\n\nimport {respondToInvalidSessionToken} from './respond-to-invalid-session-token';\nimport {getShopFromRequest} from './get-shop-from-request';\n\ninterface ValidateSessionTokenOptions {\n  checkAudience?: boolean;\n  retryRequest?: boolean;\n}\n\nexport async function validateSessionToken(\n  params: BasicParams,\n  request: Request,\n  token: string,\n  {checkAudience = true, retryRequest = true}: ValidateSessionTokenOptions = {},\n): Promise<JwtPayload> {\n  const {api, logger} = params;\n  const shop = getShopFromRequest(request);\n  logger.debug('Validating session token', {shop});\n\n  try {\n    const payload = await api.session.decodeSessionToken(token, {\n      checkAudience,\n    });\n    logger.debug('Session token is valid - validated', {\n      shop,\n      payload: JSON.stringify(payload),\n    });\n\n    return payload;\n  } catch (error) {\n    logger.debug(`Failed to validate session token: ${error.message}`, {\n      shop,\n    });\n\n    throw respondToInvalidSessionToken({params, request, retryRequest});\n  }\n}\n", "const SESSION_TOKEN_PARAM = 'id_token';\n\nexport function getSessionTokenHeader(request: Request): string | undefined {\n  return request.headers.get('authorization')?.replace('Bearer ', '');\n}\n\nexport function getSessionTokenFromUrlParam(request: Request): string | null {\n  const url = new URL(request.url);\n\n  return url.searchParams.get(SESSION_TOKEN_PARAM);\n}\n", "import {isbot} from 'isbot';\n\nimport type {BasicParams} from '../../types';\n\nconst SHOPIFY_POS_USER_AGENT = /Shopify POS\\//;\nconst SHOPIFY_MOBILE_USER_AGENT = /Shopify Mobile\\//;\n\nconst SHOPIFY_USER_AGENTS = [SHOPIFY_POS_USER_AGENT, SHOPIFY_MOBILE_USER_AGENT];\n\nexport function respondToBotRequest(\n  {logger}: BasicParams,\n  request: Request,\n): void | never {\n  const userAgent = request.headers.get('User-Agent') ?? '';\n\n  // We call isbot below to prevent good (self-identifying) bots from triggering auth requests, but there are some\n  // Shopify-specific cases we want to allow that are identified as bots by isbot.\n  if (SHOPIFY_USER_AGENTS.some((agent) => agent.test(userAgent))) {\n    logger.debug('Request is from a Shopify agent, allow');\n    return;\n  }\n\n  if (isbot(userAgent)) {\n    logger.debug('Request is from a bot, skipping auth');\n    throw new Response(undefined, {status: 410, statusText: 'Gone'});\n  }\n}\n", "import {BasicParams} from '../../types';\n\nimport {ensureCORSHeadersFactory} from './ensure-cors-headers';\n\nexport function respondToOptionsRequest(\n  params: BasicParams,\n  request: Request,\n  corsHeaders?: string[],\n) {\n  if (request.method === 'OPTIONS') {\n    const ensureCORSHeaders = ensureCORSHeadersFactory(\n      params,\n      request,\n      corsHeaders,\n    );\n\n    throw ensureCORSHeaders(\n      new Response(null, {\n        status: 204,\n        headers: {\n          'Access-Control-Max-Age': '7200',\n        },\n      }),\n    );\n  }\n}\n", "import type {BasicParams} from '../../../types';\n\nexport async function beginAuth(\n  params: BasicParams,\n  request: Request,\n  isOnline: boolean,\n  shop: string,\n): Promise<never> {\n  const {api, config} = params;\n\n  throw await api.auth.begin({\n    shop,\n    callbackPath: config.auth.callbackPath,\n    isOnline,\n    rawRequest: request,\n  });\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport type {BasicParams} from '../../../types';\n\nexport function redirectWithExitIframe(\n  params: BasicParams,\n  request: Request,\n  shop: string,\n): never {\n  const {api, config} = params;\n  const url = new URL(request.url);\n\n  const queryParams = url.searchParams;\n\n  const host = api.utils.sanitizeHost(queryParams.get('host')!);\n\n  queryParams.set('shop', shop);\n\n  let destination = `${config.auth.path}?shop=${shop}`;\n\n  if (host) {\n    queryParams.set('host', host);\n    destination = `${destination}&host=${host}`;\n  }\n  queryParams.set('exitIframe', destination);\n\n  throw redirect(`${config.auth.exitIframePath}?${queryParams.toString()}`);\n}\n", "import {REAUTH_URL_HEADER} from '../../const';\n\nexport function redirectWithAppBridgeHeaders(redirectUri: string): never {\n  throw new Response(undefined, {\n    status: 401,\n    statusText: 'Unauthorized',\n    headers: getAppBridgeHeaders(redirectUri),\n  });\n}\n\nexport function getAppBridgeHeaders(url: string) {\n  return new Headers({[REAUTH_URL_HEADER]: url});\n}\n", "import type {BasicParams} from '../../../types';\n\nimport {beginAuth} from './begin-auth';\nimport {redirectWithExitIframe} from './redirect-with-exitiframe';\nimport {redirectWithAppBridgeHeaders} from './redirect-with-app-bridge-headers';\n\nexport async function redirectToAuthPage(\n  params: BasicParams,\n  request: Request,\n  shop: string,\n  isOnline = false,\n): Promise<never> {\n  const {config} = params;\n\n  const url = new URL(request.url);\n  const isEmbeddedRequest = url.searchParams.get('embedded') === '1';\n  const isXhrRequest = request.headers.get('authorization');\n\n  if (isXhrRequest) {\n    const redirectUri = new URL(config.auth.path, config.appUrl);\n    redirectUri.searchParams.set('shop', shop);\n    redirectWithAppBridgeHeaders(redirectUri.toString());\n  } else if (isEmbeddedRequest) {\n    redirectWithExitIframe(params, request, shop);\n  } else {\n    throw await beginAuth(params, request, isOnline, shop);\n  }\n}\n", "import {Session} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../types';\n\nexport async function invalidateAccessToken(\n  params: BasicParams,\n  session: Session,\n): Promise<void> {\n  const {logger, config} = params;\n\n  logger.debug(`Invalidating access token for session - ${session.id}`, {\n    shop: session.shop,\n  });\n\n  session.accessToken = undefined;\n  await config.sessionStorage!.storeSession(session);\n}\n", "import {HttpResponseError, Session} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport {redirectToAuthPage} from '../helpers';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport type {CancelBillingOptions} from './types';\n\nexport function cancelBillingFactory(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  return async function cancelBilling(options: CancelBillingOptions) {\n    const {api, logger} = params;\n\n    logger.debug('Cancelling billing', {shop: session.shop, ...options});\n\n    try {\n      return await api.billing.cancel({\n        session,\n        subscriptionId: options.subscriptionId,\n        isTest: options.isTest,\n        prorate: options.prorate,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', {\n          shop: session.shop,\n        });\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n", "import {\n  BillingCheckResponseObject,\n  HttpResponseError,\n  Session,\n} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport type {AppConfigArg} from '../../../config-types';\nimport {redirectToAuthPage} from '../helpers';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport type {RequireBillingOptions} from './types';\n\nexport function requireBillingFactory<Config extends AppConfigArg>(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  const {api, logger} = params;\n\n  return async function requireBilling(options: RequireBillingOptions<Config>) {\n    const logContext = {\n      shop: session.shop,\n      plans: options.plans,\n      isTest: options.isTest,\n    };\n\n    logger.debug('Checking billing for the shop', logContext);\n\n    let data: BillingCheckResponseObject;\n    try {\n      data = await api.billing.check({\n        session,\n        plans: options.plans as string[],\n        isTest: options.isTest,\n        returnObject: true,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', logContext);\n\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n\n    if (!data.hasActivePayment) {\n      logger.debug('Billing check failed', logContext);\n      throw await options.onFailure(new Error('Billing check failed'));\n    }\n\n    logger.debug('Billing check succeeded', logContext);\n\n    return data;\n  };\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport {BasicParams} from '../../../types';\nimport {getAppBridgeHeaders} from '../helpers';\n\nexport function redirectOutOfApp(\n  params: BasicParams,\n  request: Request,\n  url: string,\n  shop: string,\n): never {\n  const {config, logger} = params;\n\n  logger.debug('Redirecting out of app', {shop, url});\n\n  const requestUrl = new URL(request.url);\n  const isEmbeddedRequest = requestUrl.searchParams.get('embedded') === '1';\n  const isXhrRequest = request.headers.get('authorization');\n\n  if (isXhrRequest) {\n    // eslint-disable-next-line no-warning-comments\n    // TODO Check this with the beta flag disabled (with the bounce page)\n    // Remix is not including the X-Shopify-API-Request-Failure-Reauthorize-Url when throwing a Response\n    // https://github.com/remix-run/remix/issues/5356\n    throw new Response(undefined, {\n      status: 401,\n      statusText: 'Unauthorized',\n      headers: getAppBridgeHeaders(url),\n    });\n  } else if (isEmbeddedRequest) {\n    const params = new URLSearchParams({\n      shop,\n      host: requestUrl.searchParams.get('host')!,\n      exitIframe: url,\n    });\n\n    throw redirect(`${config.auth.exitIframePath}?${params.toString()}`);\n  } else {\n    // This will only ever happen for non-embedded apps, because the authenticator will stop before reaching this point\n    throw redirect(url);\n  }\n}\n", "import {\n  BillingRequestResponseObject,\n  HttpResponseError,\n  Session,\n} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport {BasicParams} from '../../../types';\nimport {redirectToAuthPage} from '../helpers';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport {redirectOutOfApp} from './helpers';\nimport type {RequestBillingOptions} from './types';\n\nexport function requestBillingFactory<Config extends AppConfigArg>(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  return async function requestBilling({\n    plan,\n    isTest,\n    returnUrl,\n    ...overrides\n  }: RequestBillingOptions<Config>): Promise<never> {\n    const {api, logger} = params;\n\n    logger.info('Requesting billing', {\n      shop: session.shop,\n      plan,\n      isTest,\n      returnUrl,\n    });\n\n    let result: BillingRequestResponseObject;\n    try {\n      result = await api.billing.request({\n        plan: plan as string,\n        session,\n        isTest,\n        returnUrl,\n        returnObject: true,\n        ...overrides,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', {\n          shop: session.shop,\n        });\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n\n    throw redirectOutOfApp(\n      params,\n      request,\n      result.confirmationUrl,\n      session.shop,\n    );\n  };\n}\n", "import {HttpResponseError, Session} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport {redirectToAuthPage} from '../helpers';\nimport type {AppConfigArg} from '../../../config-types';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport type {CheckBillingOptions} from './types';\n\nexport function checkBillingFactory<Config extends AppConfigArg>(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  return async function checkBilling(\n    options: CheckBillingOptions<Config> = {},\n  ) {\n    const {api, logger} = params;\n\n    logger.debug('Checking billing plans', {shop: session.shop, ...options});\n\n    try {\n      return await api.billing.check({\n        session,\n        plans: options.plans as string[],\n        isTest: options.isTest,\n        returnObject: true,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', {\n          shop: session.shop,\n        });\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n", "import {HttpResponseError, Session} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport {redirectToAuthPage} from '../helpers';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport type {CreateUsageRecordOptions} from './types';\n\nexport function createUsageRecordFactory(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  return async function createUsageRecord(options: CreateUsageRecordOptions) {\n    const {api, logger} = params;\n\n    logger.debug('Create usage record', {shop: session.shop, ...options});\n\n    try {\n      return await api.billing.createUsageRecord({\n        ...options,\n        session,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', {\n          shop: session.shop,\n        });\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n  };\n}\n", "import {\n  HttpResponseError,\n  Session,\n  UpdateCappedAmountConfirmation,\n} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport {redirectToAuthPage} from '../helpers';\nimport {invalidateAccessToken} from '../../helpers';\n\nimport {UpdateUsageCappedAmountOptions} from './types';\nimport {redirectOutOfApp} from './helpers';\n\nexport function updateUsageCappedAmountFactory(\n  params: BasicParams,\n  request: Request,\n  session: Session,\n) {\n  return async function updateUsageCappedAmount(\n    options: UpdateUsageCappedAmountOptions,\n  ): Promise<never> {\n    const {api, logger} = params;\n\n    logger.debug('Updating usage subscription capped amount', {\n      shop: session.shop,\n      ...options,\n    });\n\n    let result: UpdateCappedAmountConfirmation;\n    try {\n      result = await api.billing.updateUsageCappedAmount({\n        session,\n        subscriptionLineItemId: options.subscriptionLineItemId,\n        cappedAmount: options.cappedAmount,\n      });\n    } catch (error) {\n      if (error instanceof HttpResponseError && error.response.code === 401) {\n        logger.debug('API token was invalid, redirecting to OAuth', {\n          shop: session.shop,\n        });\n        await invalidateAccessToken(params, session);\n        throw await redirectToAuthPage(params, request, session.shop);\n      } else {\n        throw error;\n      }\n    }\n\n    throw redirectOutOfApp(\n      params,\n      request,\n      result.confirmationUrl,\n      session.shop,\n    );\n  };\n}\n", "import {AdminOperations} from '@shopify/admin-api-client';\n\nimport {GraphQLClient} from '../types';\n\nimport {AdminClientOptions} from './types';\n\n// eslint-disable-next-line no-warning-comments\n// TODO: This is actually just a call through to the Shopify API client, but with a different API. We should eventually\n// move this over to the library layer. While doing that, we should also allow the apiVersion to be passed into the REST\n// client request calls.\nexport function graphqlClientFactory({\n  params,\n  handleClientError,\n  session,\n}: AdminClientOptions): GraphQLClient<AdminOperations> {\n  return async function query(operation, options) {\n    const client = new params.api.clients.Graphql({\n      session,\n      apiVersion: options?.apiVersion,\n    });\n\n    try {\n      // We convert the incoming response to a Response object to bring this client closer to the Remix client.\n      const apiResponse = await client.request(operation, {\n        variables: options?.variables,\n        retries: options?.tries ? options.tries - 1 : 0,\n        headers: options?.headers,\n        signal: options?.signal,\n      });\n\n      return new Response(JSON.stringify(apiResponse));\n    } catch (error) {\n      if (handleClientError) {\n        throw await handleClientError({error, params, session});\n      }\n\n      throw error;\n    }\n  };\n}\n", "import {\n  DeleteRequestParams,\n  GetRequestParams,\n  PostRequestParams,\n  PutRequestParams,\n  RequestParams,\n  Session,\n  Shopify,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\n\nimport type {AdminClientOptions} from './types';\n\nexport type RestClientWithResources<Resources extends ShopifyRestResources> =\n  RemixRestClient & {resources: Resources};\n\nexport function restClientFactory<\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>({\n  params,\n  handleClientError,\n  session,\n}: AdminClientOptions): RestClientWithResources<Resources> {\n  const {api} = params;\n  const client = new RemixRestClient({\n    params,\n    handleClientError,\n    session,\n  }) as RestClientWithResources<Resources>;\n\n  if (api.rest) {\n    client.resources = {} as Resources;\n\n    const RestResourceClient = restResourceClientFactory({\n      params,\n      handleClientError,\n      session,\n    });\n\n    Object.entries(api.rest).forEach(([name, resource]) => {\n      class RemixResource extends resource {\n        public static Client = RestResourceClient;\n      }\n\n      Reflect.defineProperty(RemixResource, 'name', {\n        value: name,\n      });\n\n      Reflect.set(client.resources, name, RemixResource);\n    });\n  }\n\n  return client;\n}\n\nclass RemixRestClient {\n  public session: Session;\n  private params: AdminClientOptions['params'];\n  private handleClientError: AdminClientOptions['handleClientError'];\n\n  constructor({params, session, handleClientError}: AdminClientOptions) {\n    this.params = params;\n    this.handleClientError = handleClientError;\n    this.session = session;\n  }\n\n  /**\n   * Performs a GET request on the given path.\n   *\n   * @deprecated In a future major release REST will be removed from this package. Please see [all-in on graphql](https://www.shopify.com/ca/partners/blog/all-in-on-graphql).\n   */\n  public async get(params: GetRequestParams) {\n    return this.makeRequest({\n      method: 'GET' as RequestParams['method'],\n      ...params,\n    });\n  }\n\n  /**\n   * Performs a POST request on the given path.\n   *\n   * @deprecated In a future major release REST will be removed from this package. Please see [all-in on graphql](https://www.shopify.com/ca/partners/blog/all-in-on-graphql).\n   */\n  public async post(params: PostRequestParams) {\n    return this.makeRequest({\n      method: 'POST' as RequestParams['method'],\n      ...params,\n    });\n  }\n\n  /**\n   * Performs a PUT request on the given path.\n   *\n   * @deprecated In a future major release REST will be removed from this package. Please see [all-in on graphql](https://www.shopify.com/ca/partners/blog/all-in-on-graphql).\n   */\n  public async put(params: PutRequestParams) {\n    return this.makeRequest({\n      method: 'PUT' as RequestParams['method'],\n      ...params,\n    });\n  }\n\n  /**\n   * Performs a DELETE request on the given path.\n   *\n   * @deprecated In a future major release REST will be removed from this package. Please see [all-in on graphql](https://www.shopify.com/ca/partners/blog/all-in-on-graphql).\n   */\n  public async delete(params: DeleteRequestParams) {\n    return this.makeRequest({\n      method: 'DELETE' as RequestParams['method'],\n      ...params,\n    });\n  }\n\n  protected async makeRequest(params: RequestParams): Promise<Response> {\n    const originalClient = new this.params.api.clients.Rest({\n      session: this.session,\n    });\n    const originalRequest = Reflect.get(originalClient, 'request');\n\n    try {\n      const apiResponse = await originalRequest.call(originalClient, params);\n\n      // We use a separate client for REST requests and REST resources because we want to override the API library\n      // client class to return a Response object instead.\n      return new Response(JSON.stringify(apiResponse.body), {\n        headers: apiResponse.headers,\n      });\n    } catch (error) {\n      if (this.handleClientError) {\n        throw await this.handleClientError({\n          error,\n          session: this.session,\n          params: this.params,\n        });\n      } else throw new Error(error);\n    }\n  }\n}\n\nfunction restResourceClientFactory({\n  params,\n  handleClientError,\n  session,\n}: AdminClientOptions): Shopify['clients']['Rest'] {\n  const {api} = params;\n\n  const ApiClient = api.clients.Rest;\n  return class RestResourceClient extends ApiClient {\n    protected async request(requestParams: RequestParams) {\n      const originalClient = new api.clients.Rest({session});\n      const originalRequest = Reflect.get(originalClient, 'request');\n\n      try {\n        // We just call through to the API library client, and handle the error response here, so that data parsing\n        // behaves the same way.\n        return await originalRequest.call(originalClient, requestParams);\n      } catch (error) {\n        if (handleClientError) {\n          throw await handleClientError({error, params, session});\n        } else throw new Error(error);\n      }\n    }\n  };\n}\n", "import {Session, ShopifyRestResources} from '@shopify/shopify-api';\n\nimport type {AppConfigArg} from '../../config-types';\nimport {BasicParams} from '../../types';\n\nimport {graphqlClientFactory} from './graphql';\nimport {restClientFactory} from './rest';\nimport type {AdminApiContext} from './types';\n\ninterface RestClientOptions {\n  params: BasicParams;\n  session: Session;\n  handleClientError?: (error: any) => Promise<void>;\n}\n\nexport function adminClientFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>({\n  params,\n  handleClientError,\n  session,\n}: RestClientOptions): AdminApiContext<ConfigArg, Resources> {\n  if (params.config.future.removeRest) {\n    return {\n      graphql: graphqlClientFactory({params, session, handleClientError}),\n    } as AdminApiContext<ConfigArg, Resources>;\n  }\n\n  return {\n    rest: restClientFactory<Resources>({\n      params,\n      session,\n      handleClientError,\n    }),\n    graphql: graphqlClientFactory({params, session, handleClientError}),\n  } as AdminApiContext<ConfigArg, Resources>;\n}\n", "import {Session, ShopifyRestResources} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport type {BasicParams} from '../../../types';\nimport {\n  AdminApiContext,\n  HandleAdminClientError,\n  adminClientFactory,\n} from '../../../clients/admin';\n\nexport function createAdminApiContext<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>(\n  session: Session,\n  params: BasicParams,\n  handleClientError: HandleAdminClientError,\n): AdminApiContext<ConfigArg, Resources> {\n  return adminClientFactory<ConfigArg, Resources>({\n    session,\n    params,\n    handleClientError,\n  });\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport type {BasicParams} from '../../../types';\n\nexport async function redirectToShopifyOrAppRoot(\n  request: Request,\n  params: BasicParams,\n  responseHeaders?: Headers,\n): Promise<never> {\n  const {api} = params;\n  const url = new URL(request.url);\n\n  const host = api.utils.sanitizeHost(url.searchParams.get('host')!)!;\n  const shop = api.utils.sanitizeShop(url.searchParams.get('shop')!)!;\n\n  const redirectUrl = api.config.isEmbeddedApp\n    ? await api.auth.getEmbeddedAppUrl({rawRequest: request})\n    : `/?shop=${shop}&host=${encodeURIComponent(host)}`;\n\n  throw redirect(redirectUrl, {headers: responseHeaders});\n}\n", "import {BasicParams} from '../../../types';\n\nimport {redirectToShopifyOrAppRoot} from './redirect-to-shopify-or-app-root';\n\nexport const ensureAppIsEmbeddedIfRequired = async (\n  params: BasicParams,\n  request: Request,\n) => {\n  const {api, logger, config} = params;\n  const url = new URL(request.url);\n\n  const shop = url.searchParams.get('shop')!;\n\n  if (api.config.isEmbeddedApp && url.searchParams.get('embedded') !== '1') {\n    logger.debug('App is not embedded, redirecting to Shopify', {shop});\n    await redirectToShopifyOrAppRoot(request, {api, logger, config});\n  }\n};\n", "import {BasicParams} from '../../../types';\n\nimport {redirectToBouncePage} from './redirect-to-bounce-page';\n\nconst SESSION_TOKEN_PARAM = 'id_token';\n\nexport const ensureSessionTokenSearchParamIfRequired = async (\n  params: BasicParams,\n  request: Request,\n) => {\n  const {api, logger} = params;\n  const url = new URL(request.url);\n\n  const shop = url.searchParams.get('shop')!;\n  const searchParamSessionToken = url.searchParams.get(SESSION_TOKEN_PARAM);\n  const isEmbedded = url.searchParams.get('embedded') === '1';\n\n  if (api.config.isEmbeddedApp && isEmbedded && !searchParamSessionToken) {\n    logger.debug(\n      'Missing session token in search params, going to bounce page',\n      {shop},\n    );\n    redirectToBouncePage(params, url);\n  }\n};\n", "import {APP_BRIDGE_URL} from '../const';\n\nlet appBridgeUrlOverride: string | undefined;\nexport function setAppBridgeUrlOverride(url: string) {\n  appBridgeUrlOverride = url;\n}\n\nexport function appBridgeUrl() {\n  return appBridgeUrlOverride || APP_BRIDGE_URL;\n}\n", "import type {BasicParams} from '../../types';\n\nexport type AddDocumentResponseHeadersFunction = (\n  request: Request,\n  headers: Headers,\n) => void;\n\nexport function addDocumentResponseHeadersFactory(\n  params: BasicParams,\n): AddDocumentResponseHeadersFunction {\n  const {api, config} = params;\n\n  return function (request: Request, headers: Headers) {\n    const {searchParams} = new URL(request.url);\n    const shop = api.utils.sanitizeShop(searchParams.get('shop')!);\n\n    addDocumentResponseHeaders(headers, config.isEmbeddedApp, shop);\n  };\n}\n\nexport function addDocumentResponseHeaders(\n  headers: Headers,\n  isEmbeddedApp: boolean,\n  shop: string | null | undefined,\n) {\n  if (shop) {\n    headers.set(\n      'Link',\n      '<https://cdn.shopify.com/shopifycloud/app-bridge.js>; rel=\"preload\"; as=\"script\";',\n    );\n  }\n\n  if (isEmbeddedApp) {\n    if (shop) {\n      headers.set(\n        'Content-Security-Policy',\n        `frame-ancestors https://${shop} https://admin.shopify.com https://*.spin.dev https://admin.myshopify.io https://admin.shop.dev;`,\n      );\n    }\n  } else {\n    headers.set('Content-Security-Policy', `frame-ancestors 'none';`);\n  }\n}\n", "import {ShopifyError} from '@shopify/shopify-api';\n\ninterface Options {\n  requireSSL?: boolean;\n  throwOnInvalid?: boolean;\n}\n\ntype SanitizedRedirectUrl<OptionsArg extends Options> =\n  OptionsArg['throwOnInvalid'] extends false ? URL | undefined : URL;\n\nconst FILE_URI_MATCH = /\\/\\/\\//;\nconst INVALID_RELATIVE_URL = /[/\\\\][/\\\\]/;\nconst WHITESPACE_CHARACTER = /\\s/;\nconst VALID_PROTOCOLS = ['https:', 'http:'];\n\nfunction isSafe(\n  domain: string,\n  redirectUrl: unknown,\n  requireSSL: boolean | undefined = true,\n): redirectUrl is string {\n  if (typeof redirectUrl !== 'string') {\n    return false;\n  }\n\n  if (\n    FILE_URI_MATCH.test(redirectUrl) ||\n    WHITESPACE_CHARACTER.test(redirectUrl)\n  ) {\n    return false;\n  }\n\n  let url: URL;\n\n  try {\n    url = new URL(redirectUrl, domain);\n  } catch (error) {\n    return false;\n  }\n\n  if (INVALID_RELATIVE_URL.test(url.pathname)) {\n    return false;\n  }\n\n  if (!VALID_PROTOCOLS.includes(url.protocol)) {\n    return false;\n  }\n\n  if (requireSSL && url.protocol !== 'https:') {\n    return false;\n  }\n\n  return true;\n}\n\nexport function sanitizeRedirectUrl<OptionsArg extends Options>(\n  domain: string,\n  redirectUrl: unknown,\n  options: OptionsArg = {} as OptionsArg,\n): SanitizedRedirectUrl<OptionsArg> {\n  if (isSafe(domain, redirectUrl, options.requireSSL)) {\n    return new URL(redirectUrl, domain) as SanitizedRedirectUrl<OptionsArg>;\n  } else if (options.throwOnInvalid === false) {\n    return undefined as SanitizedRedirectUrl<OptionsArg>;\n  } else {\n    throw new ShopifyError('Invalid URL. Refusing to redirect');\n  }\n}\n", "import {BasicParams} from '../../../types';\nimport {appBridgeUrl} from '../../helpers/app-bridge-url';\nimport {addDocumentResponseHeaders} from '../../helpers/add-response-headers';\n\nimport {sanitizeRedirectUrl} from './validate-redirect-url';\n\nimport type {RedirectTarget} from '.';\n\nexport interface RedirectToOptions {\n  url: string | URL;\n  target?: RedirectTarget;\n}\n\nexport function renderAppBridge(\n  {config}: BasicParams,\n  request: Request,\n  redirectTo?: RedirectToOptions,\n): never {\n  let redirectToScript = '';\n  if (redirectTo) {\n    const destination = sanitizeRedirectUrl(config.appUrl, redirectTo.url);\n\n    const target = redirectTo.target ?? '_top';\n\n    redirectToScript = `<script>window.open(${JSON.stringify(\n      destination.toString(),\n    )}, ${JSON.stringify(target)})</script>`;\n  }\n\n  const responseHeaders = new Headers({\n    'content-type': 'text/html;charset=utf-8',\n  });\n  addDocumentResponseHeaders(\n    responseHeaders,\n    config.isEmbeddedApp,\n    new URL(request.url).searchParams.get('shop'),\n  );\n\n  throw new Response(\n    `\n      <script data-api-key=\"${config.apiKey}\" src=\"${appBridgeUrl()}\"></script>\n      ${redirectToScript}\n    `,\n    {headers: responseHeaders},\n  );\n}\n", "import {\n  TypedResponse,\n  redirect as remixRedirect,\n} from '@remix-run/server-runtime';\n\nimport {BasicParams} from '../../../types';\nimport {getSessionTokenHeader} from '../../helpers/get-session-token-header';\n\nimport {renderAppBridge} from './render-app-bridge';\nimport {redirectWithAppBridgeHeaders} from './redirect-with-app-bridge-headers';\n\nexport type RedirectTarget = '_self' | '_parent' | '_top' | '_blank';\nexport type RedirectInit = number | (ResponseInit & {target?: RedirectTarget});\nexport type RedirectFunction = (\n  url: string,\n  init?: RedirectInit,\n) => TypedResponse<never>;\n\ninterface ParseURLOptions {\n  params: BasicParams;\n  url: string;\n  base: string;\n  shop: string;\n  init: RedirectInit;\n}\n\ninterface ParsedURL {\n  url: URL;\n  target: RedirectTarget;\n}\n\nexport function redirectFactory(\n  params: BasicParams,\n  request: Request,\n  shop: string,\n): RedirectFunction {\n  const {config, logger} = params;\n\n  return function redirect(url, init: RedirectInit) {\n    const {searchParams} = new URL(request.url);\n    const {url: parsedUrl, target} = parseURL({\n      params,\n      url,\n      base: config.appUrl,\n      shop,\n      init,\n    });\n\n    logger.debug('Redirecting', {shop, url: parsedUrl.toString()});\n\n    const isSameOrigin = parsedUrl.origin === config.appUrl;\n    if (isSameOrigin || url.startsWith('/')) {\n      searchParams.forEach((value, key) => {\n        if (!parsedUrl.searchParams.has(key)) {\n          parsedUrl.searchParams.set(key, value);\n        }\n      });\n    }\n\n    if (target === '_self') {\n      if (isBounceRequest(request)) {\n        throw renderAppBridge(params, request, {\n          url: parsedUrl.toString(),\n          target,\n        });\n      } else {\n        return remixRedirect(parsedUrl.toString(), init);\n      }\n    } else if (isDataRequest(request)) {\n      throw redirectWithAppBridgeHeaders(parsedUrl.toString());\n    } else if (isEmbeddedRequest(request)) {\n      throw renderAppBridge(params, request, {\n        url: parsedUrl.toString(),\n        target,\n      });\n    }\n    return remixRedirect(url, init);\n  };\n}\n\nfunction isBounceRequest(request: Request) {\n  return (\n    Boolean(getSessionTokenHeader(request)) &&\n    request.headers.has('X-Shopify-Bounce')\n  );\n}\n\nfunction isDataRequest(request: Request) {\n  const isGet = request.method === 'GET';\n  const sessionTokenHeader = Boolean(getSessionTokenHeader(request));\n\n  return (\n    sessionTokenHeader &&\n    !isBounceRequest(request) &&\n    (!isEmbeddedRequest(request) || !isGet)\n  );\n}\n\nfunction isEmbeddedRequest(request: Request) {\n  const {searchParams} = new URL(request.url);\n\n  return searchParams.get('embedded') === '1';\n}\n\nfunction parseURL({params, base, init, shop, url}: ParseURLOptions): ParsedURL {\n  let target: RedirectTarget | undefined =\n    typeof init !== 'number' && init?.target ? init.target : undefined;\n\n  if (isAdminRemotePath(url)) {\n    const {config} = params;\n\n    const adminPath = getAdminRemotePath(url);\n    const cleanShopName = shop.replace('.myshopify.com', '');\n\n    if (!target) {\n      target = config.isEmbeddedApp ? '_parent' : '_self';\n    }\n\n    return {\n      url: new URL(\n        `https://admin.shopify.com/store/${cleanShopName}${adminPath}`,\n      ),\n      target,\n    };\n  } else {\n    return {\n      url: new URL(url, base),\n      target: target ?? '_self',\n    };\n  }\n}\n\nconst ADMIN_REGEX = /^shopify:\\/*admin\\//i;\n\nfunction isAdminRemotePath(url: string) {\n  return ADMIN_REGEX.test(url);\n}\n\nfunction getAdminRemotePath(url: string | URL) {\n  const parsedUrl = removeRestrictedParams(new URL(url)).href;\n  return parsedUrl.replace(ADMIN_REGEX, '/');\n}\n\nconst embeddedFrameParamsToRemove = [\n  'hmac',\n  'locale',\n  'protocol',\n  'session',\n  'id_token',\n  'shop',\n  'timestamp',\n  'host',\n  'embedded',\n  // sent when clicking rel=\"home\" nav item\n  'appLoadId',\n];\n\nfunction removeRestrictedParams(url: URL | string) {\n  const newUrl = new URL(url);\n  embeddedFrameParamsToRemove.forEach((param) =>\n    newUrl.searchParams.delete(param),\n  );\n  return newUrl;\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport {BasicParams} from '../../../types';\n\nexport function validateShopAndHostParams(\n  params: BasicParams,\n  request: Request,\n) {\n  const {api, config, logger} = params;\n\n  if (config.isEmbeddedApp) {\n    const url = new URL(request.url);\n    const shop = api.utils.sanitizeShop(url.searchParams.get('shop')!);\n    if (!shop) {\n      logger.debug('Missing or invalid shop, redirecting to login path', {\n        shop,\n      });\n      throw redirectToLoginPath(request, params);\n    }\n\n    const host = api.utils.sanitizeHost(url.searchParams.get('host')!);\n    if (!host) {\n      logger.debug('Invalid host, redirecting to login path', {\n        shop,\n        host: url.searchParams.get('host'),\n      });\n      throw redirectToLoginPath(request, params);\n    }\n  }\n}\n\nfunction redirectToLoginPath(request: Request, params: BasicParams): never {\n  const {config, logger} = params;\n\n  const {pathname} = new URL(request.url);\n  if (pathname === config.auth.loginPath) {\n    const message =\n      `Detected call to shopify.authenticate.admin() from configured login path ` +\n      `('${config.auth.loginPath}'), please make sure to call shopify.login() from that route instead.`;\n\n    logger.debug(message);\n    throw new Response(message, {status: 500});\n  }\n\n  throw redirect(config.auth.loginPath);\n}\n", "import {redirect as remixRedirect} from '@remix-run/server-runtime';\n\nimport type {BasicParams} from '../../../types';\n\nimport {redirectWithAppBridgeHeaders} from './redirect-with-app-bridge-headers';\n\nexport async function redirectToInstallPage(\n  params: BasicParams,\n  shop: string,\n  optionalScopes: string[] = [],\n): Promise<never> {\n  const installUrl = buildInstallUrl(params, shop, optionalScopes);\n  if (params.config.isEmbeddedApp) {\n    throw redirectWithAppBridgeHeaders(installUrl);\n  } else {\n    throw remixRedirect(installUrl);\n  }\n}\n\nfunction buildInstallUrl(\n  params: BasicParams,\n  shop: string,\n  optionalScopes: string[] = [],\n) {\n  const baseInstallUrl = buildBaseInstallUrl(params, shop);\n  baseInstallUrl.search = buildParamsInstallUrl(\n    params,\n    optionalScopes,\n  ).toString();\n  return baseInstallUrl.href;\n}\n\nfunction buildBaseInstallUrl({api}: BasicParams, shop: string) {\n  const cleanShop = api.utils.sanitizeShop(shop, true);\n  return new URL(`https://${cleanShop}/admin/oauth/install`);\n}\n\nfunction buildParamsInstallUrl(\n  {config}: BasicParams,\n  optionalScopes: string[] = [],\n) {\n  const optionalScopesParam =\n    optionalScopes && optionalScopes.length > 0\n      ? {optional_scopes: optionalScopes.join(',')}\n      : undefined;\n\n  const query = {\n    client_id: config.apiKey,\n    scope: config.scopes?.toString() || '',\n    ...optionalScopesParam,\n  };\n  return new URLSearchParams(query);\n}\n", "import {AppConfigArg} from '../../../../config-types';\nimport {AdminApiContext} from '../../../../clients';\n\nexport interface FetchScopesDetailResponse {\n  app: {\n    requestedAccessScopes: {\n      handle: string;\n    }[];\n    optionalAccessScopes: {\n      handle: string;\n    }[];\n    installation: {\n      accessScopes: {\n        handle: string;\n      }[];\n    };\n  };\n}\n\nconst FETCH_SCOPES_DETAIL_QUERY = `#graphql\nquery FetchAccessScopes{\n  app {\n    requestedAccessScopes {\n      handle\n    }\n    optionalAccessScopes {\n      handle\n    }\n    installation {\n      accessScopes {\n        handle\n      }\n    }\n  }\n}`;\n\nexport async function fetchScopeDetail<ConfigArg extends AppConfigArg>(\n  admin: AdminApiContext<ConfigArg>,\n): Promise<FetchScopesDetailResponse> {\n  const fetchScopeDetailResult = await admin.graphql(FETCH_SCOPES_DETAIL_QUERY);\n\n  const resultContent = await fetchScopeDetailResult.json();\n  return resultContent.data;\n}\n", "import {AuthScopes, Session} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport type {BasicParams} from '../../../types';\nimport {redirectToInstallPage} from '../helpers/redirect-to-install-page';\nimport {AdminApiContext} from '../../../clients';\n\nimport {fetchScopeDetail} from './client/fetch-scopes-details';\n\nexport function requestScopesFactory<ConfigArg extends AppConfigArg>(\n  params: BasicParams,\n  session: Session,\n  admin: AdminApiContext<ConfigArg>,\n) {\n  return async function requestScopes(scopes: string[]) {\n    const {logger} = params;\n\n    logger.debug('Requesting optional scopes: ', {shop: session.shop, scopes});\n\n    if (scopes.length === 0) return;\n    if (await alreadyGranted(scopes, admin)) return;\n\n    throw await redirectToInstallPage(params, session.shop, scopes);\n  };\n\n  async function alreadyGranted(\n    scopes: string[],\n    admin: AdminApiContext<ConfigArg>,\n  ) {\n    const scopesDetail = await fetchScopeDetail(admin);\n    const grantedScopes = scopesDetail.app.installation.accessScopes.map(\n      (scope) => scope.handle,\n    );\n    return new AuthScopes(grantedScopes).has(scopes);\n  }\n}\n", "import {AuthScopes, Session} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport {AdminApiContext} from '../../../clients';\nimport type {BasicParams} from '../../../types';\n\nimport {ScopesDetail} from './types';\nimport {\n  FetchScopesDetailResponse,\n  fetchScopeDetail,\n} from './client/fetch-scopes-details';\n\nexport function queryScopesFactory<ConfigArg extends AppConfigArg>(\n  params: BasicParams,\n  session: Session,\n  admin: AdminApiContext<ConfigArg>,\n) {\n  return async function queryScopes() {\n    const {logger} = params;\n\n    logger.debug('Querying scopes details: ', {\n      shop: session.shop,\n    });\n\n    const scopesDetail = await fetchScopeDetail(admin);\n    return mapFetchScopeDetail(scopesDetail);\n  };\n}\n\nexport function mapFetchScopeDetail(\n  scopesDetailResponse: FetchScopesDetailResponse,\n): ScopesDetail {\n  const appInformation = scopesDetailResponse.app;\n\n  const granted = new AuthScopes(\n    appInformation.installation.accessScopes.map((scope) => scope.handle),\n  ).toArray(true);\n\n  const required = new AuthScopes(\n    appInformation.requestedAccessScopes.map((scope) => scope.handle),\n  ).toArray(true);\n\n  const optional = new AuthScopes(\n    appInformation.optionalAccessScopes.map((scope) => scope.handle),\n  ).toArray(true);\n\n  return {\n    granted,\n    required,\n    optional,\n  };\n}\n", "import {AppConfigArg} from '../../../../config-types';\nimport {AdminApiContext} from '../../../../clients';\n\nexport interface RevokeScopesResponse {\n  revoked: {\n    handle: string;\n  }[];\n  userErrors: {\n    field: string;\n    message: string;\n  }[];\n}\n\nconst REVOKE_SCOPE_MUTATION = `#graphql\nmutation AppRevokeAccessScopes($scopes: [String!]!) {\n  appRevokeAccessScopes(scopes: $scopes){\n    revoked {\n      handle\n    }\n    userErrors {\n      field\n      message\n    }\n  }\n}`;\n\nexport async function revokeScopes<ConfigArg extends AppConfigArg>(\n  admin: AdminApiContext<ConfigArg>,\n  scopes: string[],\n): Promise<RevokeScopesResponse> {\n  const revokeScopesResult = await admin.graphql(REVOKE_SCOPE_MUTATION, {\n    variables: {\n      scopes,\n    },\n  });\n\n  const resultContent = await revokeScopesResult.json();\n  return resultContent.data.appRevokeAccessScopes;\n}\n", "import {Session} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport {AdminApiContext} from '../../../clients';\nimport type {BasicParams} from '../../../types';\n\nimport {revokeScopes} from './client/revoke-scopes';\n\nexport function revokeScopesFactory<ConfigArg extends AppConfigArg>(\n  params: BasicParams,\n  session: Session,\n  admin: AdminApiContext<ConfigArg>,\n) {\n  return async function revoke(scopes: string[]) {\n    const {logger} = params;\n\n    await validateScopes(scopes);\n\n    logger.debug('Revoke scopes: ', {\n      shop: session.shop,\n      scopes,\n    });\n\n    const revokeScopesResult = await revokeScopes(admin, scopes);\n    if (revokeScopesResult.userErrors?.length > 0) {\n      logger.error('Failed to revoke scopes: ', {\n        shop: session.shop,\n        errors: revokeScopesResult.userErrors,\n      });\n\n      throw new Response(JSON.stringify(revokeScopesResult.userErrors), {\n        status: 422,\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n    }\n\n    return {\n      revoked: revokeScopesResult.revoked.map((scope) => scope.handle),\n    };\n  };\n}\n\nasync function validateScopes(scopes: string[]) {\n  if (!scopes || scopes.length === 0) {\n    throw new Response('No scopes provided', {status: 400});\n  }\n}\n", "import {Session} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport {BasicParams} from '../../../types';\nimport {AdminApiContext} from '../../../clients';\n\nimport {ScopesApiContext} from './types';\nimport {requestScopesFactory} from './request';\nimport {queryScopesFactory} from './query';\nimport {revokeScopesFactory} from './revoke';\n\nexport function scopesApiFactory<ConfigArg extends AppConfigArg>(\n  params: BasicParams,\n  session: Session,\n  admin: AdminApiContext<ConfigArg>,\n): ScopesApiContext {\n  return {\n    query: queryScopesFactory(params, session, admin),\n    request: requestScopesFactory(params, session, admin),\n    revoke: revokeScopesFactory(params, session, admin),\n  };\n}\n", "import {JwtPayload, Session, ShopifyRestResources} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../types';\nimport type {AppConfigArg} from '../../config-types';\nimport {\n  getSessionTokenHeader,\n  ensureCORSHeadersFactory,\n  getSessionTokenFromUrlParam,\n  respondToBotRequest,\n  respondToOptionsRequest,\n  validateSessionToken,\n  getShopFromRequest,\n} from '../helpers';\n\nimport {\n  cancelBillingFactory,\n  requestBillingFactory,\n  requireBillingFactory,\n  checkBillingFactory,\n  createUsageRecordFactory,\n  updateUsageCappedAmountFactory,\n} from './billing';\nimport type {\n  AdminContext,\n  AuthenticateAdmin,\n  EmbeddedAdminContext,\n  NonEmbeddedAdminContext,\n} from './types';\nimport {\n  createAdminApiContext,\n  ensureAppIsEmbeddedIfRequired,\n  ensureSessionTokenSearchParamIfRequired,\n  redirectFactory,\n  renderAppBridge,\n  validateShopAndHostParams,\n} from './helpers';\nimport {AuthorizationStrategy} from './strategies/types';\nimport {scopesApiFactory} from './scope/factory';\n\nexport interface SessionTokenContext {\n  shop: string;\n  sessionId?: string;\n  sessionToken?: string;\n  payload?: JwtPayload;\n}\n\ninterface AuthStrategyParams extends BasicParams {\n  strategy: AuthorizationStrategy;\n}\n\nexport function authStrategyFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>({\n  strategy,\n  ...params\n}: AuthStrategyParams): AuthenticateAdmin<ConfigArg, Resources> {\n  const {api, logger, config} = params;\n\n  async function respondToBouncePageRequest(request: Request) {\n    const url = new URL(request.url);\n\n    if (url.pathname === config.auth.patchSessionTokenPath) {\n      logger.debug('Rendering bounce page', {\n        shop: getShopFromRequest(request),\n      });\n      throw renderAppBridge({config, logger, api}, request);\n    }\n  }\n\n  async function respondToExitIframeRequest(request: Request) {\n    const url = new URL(request.url);\n\n    if (url.pathname === config.auth.exitIframePath) {\n      const destination = url.searchParams.get('exitIframe')!;\n\n      logger.debug('Rendering exit iframe page', {\n        shop: getShopFromRequest(request),\n        destination,\n      });\n      throw renderAppBridge({config, logger, api}, request, {url: destination});\n    }\n  }\n\n  type AdminContextBase =\n    | EmbeddedAdminContext<ConfigArg, Resources>\n    | NonEmbeddedAdminContext<ConfigArg, Resources>;\n\n  function createContext(\n    request: Request,\n    session: Session,\n    authStrategy: AuthorizationStrategy,\n    sessionToken?: JwtPayload,\n  ): AdminContext<ConfigArg, Resources> {\n    let context: AdminContextBase = {\n      admin: createAdminApiContext<ConfigArg, Resources>(\n        session,\n        params,\n        authStrategy.handleClientError(request),\n      ),\n      billing: {\n        require: requireBillingFactory(params, request, session),\n        check: checkBillingFactory(params, request, session),\n        request: requestBillingFactory(params, request, session),\n        cancel: cancelBillingFactory(params, request, session),\n        createUsageRecord: createUsageRecordFactory(params, request, session),\n        updateUsageCappedAmount: updateUsageCappedAmountFactory(\n          params,\n          request,\n          session,\n        ),\n      },\n\n      session,\n      cors: ensureCORSHeadersFactory(params, request),\n    };\n\n    context = addEmbeddedFeatures(context, request, session, sessionToken);\n    context = addScopesFeatures(context);\n\n    return context as AdminContext<ConfigArg, Resources>;\n  }\n\n  function addEmbeddedFeatures(\n    context: AdminContextBase,\n    request: Request,\n    session: Session,\n    sessionToken?: JwtPayload,\n  ) {\n    if (config.isEmbeddedApp) {\n      return {\n        ...context,\n        sessionToken,\n        redirect: redirectFactory(params, request, session.shop),\n      };\n    }\n    return context;\n  }\n\n  function addScopesFeatures(context: AdminContextBase) {\n    return {\n      ...context,\n      scopes: scopesApiFactory(params, context.session, context.admin),\n    };\n  }\n\n  return async function authenticateAdmin(request: Request) {\n    try {\n      respondToBotRequest(params, request);\n      respondToOptionsRequest(params, request);\n      await respondToBouncePageRequest(request);\n      await respondToExitIframeRequest(request);\n      await strategy.respondToOAuthRequests(request);\n\n      // If this is a valid request, but it doesn't have a session token header, this is a document request. We need to\n      // ensure we're embedded if needed and we have the information needed to load the session.\n      if (!getSessionTokenHeader(request)) {\n        validateShopAndHostParams(params, request);\n        await ensureAppIsEmbeddedIfRequired(params, request);\n        await ensureSessionTokenSearchParamIfRequired(params, request);\n      }\n\n      logger.info('Authenticating admin request', {\n        shop: getShopFromRequest(request),\n      });\n\n      const {payload, shop, sessionId, sessionToken} =\n        await getSessionTokenContext(params, request);\n\n      logger.debug('Loading session from storage', {shop, sessionId});\n      const existingSession = sessionId\n        ? await config.sessionStorage!.loadSession(sessionId)\n        : undefined;\n\n      const session = await strategy.authenticate(request, {\n        session: existingSession,\n        sessionToken,\n        shop,\n      });\n\n      return createContext(request, session, strategy, payload);\n    } catch (errorOrResponse) {\n      if (errorOrResponse instanceof Response) {\n        logger.debug('Authenticate returned a response', {\n          shop: getShopFromRequest(request),\n        });\n        ensureCORSHeadersFactory(params, request)(errorOrResponse);\n      }\n\n      throw errorOrResponse;\n    }\n  };\n}\n\nasync function getSessionTokenContext(\n  params: BasicParams,\n  request: Request,\n): Promise<SessionTokenContext> {\n  const {api, config, logger} = params;\n\n  const headerSessionToken = getSessionTokenHeader(request);\n  const searchParamSessionToken = getSessionTokenFromUrlParam(request);\n  const sessionToken = (headerSessionToken || searchParamSessionToken)!;\n\n  logger.debug('Attempting to authenticate session token', {\n    shop: getShopFromRequest(request),\n    sessionToken: JSON.stringify({\n      header: headerSessionToken,\n      search: searchParamSessionToken,\n    }),\n  });\n\n  if (config.isEmbeddedApp) {\n    const payload = await validateSessionToken(params, request, sessionToken);\n    const dest = new URL(payload.dest);\n    const shop = dest.hostname;\n\n    logger.debug('Session token is valid - authenticated', {shop, payload});\n    const sessionId = config.useOnlineTokens\n      ? api.session.getJwtSessionId(shop, payload.sub)\n      : api.session.getOfflineId(shop);\n\n    return {shop, payload, sessionId, sessionToken};\n  }\n\n  const url = new URL(request.url);\n  const shop = url.searchParams.get('shop')!;\n\n  const sessionId = await api.session.getCurrentId({\n    isOnline: config.useOnlineTokens,\n    rawRequest: request,\n  });\n\n  return {shop, sessionId, payload: undefined, sessionToken};\n}\n", "import {HttpResponseError} from '@shopify/shopify-api';\n\nimport type {HandleAdminClientError} from '../../../clients/admin/types';\nimport {HandleClientErrorOptions} from '../strategies/types';\n\nexport function handleClientErrorFactory({\n  request,\n  onError,\n}: HandleClientErrorOptions): HandleAdminClientError {\n  return async function handleClientError({\n    error,\n    params,\n    session,\n  }): Promise<never> {\n    if (error instanceof HttpResponseError !== true) {\n      params.logger.debug(\n        `Got a response error from the API: ${error.message}`,\n        {shop: session.shop},\n      );\n      throw error;\n    }\n\n    params.logger.debug(\n      `Got an HTTP response error from the API: ${error.message}`,\n      {\n        shop: session.shop,\n        code: error.response.code,\n        statusText: error.response.statusText,\n        body: JSON.stringify(error.response.body),\n      },\n    );\n\n    if (onError) {\n      await onError({request, session, error});\n    }\n\n    // forward a minimal copy of the upstream HTTP response instead of an Error:\n    throw new Response(JSON.stringify(error.response.body), {\n      status: error.response.code,\n      headers: {\n        'Content-Type': error.response.headers!['Content-Type'] as string,\n      },\n    });\n  };\n}\n", "import {AppDistribution, BasicParams} from '../../types';\n\nexport async function createOrLoadOfflineSession(\n  shop: string,\n  {api, config, logger}: BasicParams,\n) {\n  if (config.distribution === AppDistribution.ShopifyAdmin) {\n    logger.debug('Creating custom app session from configured access token', {\n      shop,\n    });\n    return api.session.customAppSession(shop);\n  } else {\n    logger.debug('Loading offline session from session storage', {shop});\n    const offlineSessionId = api.session.getOfflineId(shop);\n    const session = await config.sessionStorage!.loadSession(offlineSessionId);\n\n    return session;\n  }\n}\n", "import {\n  ShopifyRestResources,\n  WebhookValidationErrorReason,\n} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../config-types';\nimport type {BasicParams} from '../../types';\nimport {adminClientFactory} from '../../clients';\nimport {handleClientErrorFactory} from '../admin/helpers';\nimport {createOrLoadOfflineSession} from '../helpers';\n\nimport type {\n  AuthenticateWebhook,\n  WebhookContext,\n  WebhookContextWithoutSession,\n} from './types';\n\nexport function authenticateWebhookFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources,\n  Topics extends string,\n>(params: BasicParams): AuthenticateWebhook<ConfigArg, Resources, Topics> {\n  const {api, logger} = params;\n\n  return async function authenticate(\n    request: Request,\n  ): Promise<WebhookContext<ConfigArg, Resources, Topics>> {\n    if (request.method !== 'POST') {\n      logger.debug(\n        'Received a non-POST request for a webhook. Only POST requests are allowed.',\n        {url: request.url, method: request.method},\n      );\n      throw new Response(undefined, {\n        status: 405,\n        statusText: 'Method not allowed',\n      });\n    }\n\n    const rawBody = await request.text();\n\n    const check = await api.webhooks.validate({\n      rawBody,\n      rawRequest: request,\n    });\n\n    if (!check.valid) {\n      if (check.reason === WebhookValidationErrorReason.InvalidHmac) {\n        logger.debug('Webhook HMAC validation failed', check);\n        throw new Response(undefined, {\n          status: 401,\n          statusText: 'Unauthorized',\n        });\n      } else {\n        logger.debug('Webhook validation failed', check);\n        throw new Response(undefined, {status: 400, statusText: 'Bad Request'});\n      }\n    }\n    const session = await createOrLoadOfflineSession(check.domain, params);\n    const webhookContext: WebhookContextWithoutSession<Topics> = {\n      apiVersion: check.apiVersion,\n      shop: check.domain,\n      topic: check.topic as Topics,\n      webhookId: check.webhookId,\n      payload: JSON.parse(rawBody),\n      subTopic: check.subTopic || undefined,\n      session: undefined,\n      admin: undefined,\n    };\n\n    if (!session) {\n      return webhookContext;\n    }\n\n    const admin = adminClientFactory<ConfigArg, Resources>({\n      params,\n      session,\n      handleClientError: handleClientErrorFactory({request}),\n    });\n\n    return {\n      ...webhookContext,\n      session,\n      admin,\n    };\n  };\n}\n", "import semver from 'semver';\nimport {FeatureDeprecatedError, Shopify} from '@shopify/shopify-api';\n\nimport {SHOPIFY_REMIX_LIBRARY_VERSION} from './version';\n\n// eslint-disable-next-line no-warning-comments\n// TODO This has been copied from shopify-app-express, it should be extracted into a shared package\n// https://github.com/orgs/Shopify/projects/6899/views/1?pane=issue&itemId=28358070\nexport function overrideLogger(logger: Shopify['logger']): Shopify['logger'] {\n  const baseContext = {package: 'shopify-app'};\n\n  const warningFunction: Shopify['logger']['warning'] = (\n    message,\n    context = {},\n  ) => logger.warning(message, {...baseContext, ...context});\n\n  function deprecated(warningFunction: Shopify['logger']['warning']) {\n    return function (version: string, message: string): Promise<void> {\n      if (semver.gte(SHOPIFY_REMIX_LIBRARY_VERSION, version)) {\n        throw new FeatureDeprecatedError(\n          `Feature was deprecated in version ${version}`,\n        );\n      }\n\n      return warningFunction(`[Deprecated | ${version}] ${message}`);\n    };\n  }\n\n  return {\n    ...logger,\n    log: (severity, message, context = {}) =>\n      logger.log(severity, message, {...baseContext, ...context}),\n    debug: (message, context = {}) =>\n      logger.debug(message, {...baseContext, ...context}),\n    info: (message, context = {}) =>\n      logger.info(message, {...baseContext, ...context}),\n    warning: warningFunction,\n    error: (message, context = {}) =>\n      logger.error(message, {...baseContext, ...context}),\n    deprecated: deprecated(warningFunction),\n  };\n}\n", "import {redirect} from '@remix-run/server-runtime';\n\nimport {BasicParams, LoginError, LoginErrorType} from '../../types';\n\nexport function loginFactory(params: BasicParams) {\n  const {api, config, logger} = params;\n\n  return async function login(request: Request): Promise<LoginError | never> {\n    const url = new URL(request.url);\n    const shopParam = url.searchParams.get('shop');\n\n    if (request.method === 'GET' && !shopParam) {\n      return {};\n    }\n\n    const shop: string | null =\n      shopParam || ((await request.formData()).get('shop') as string);\n\n    if (!shop) {\n      logger.debug('Missing shop parameter', {shop});\n      return {shop: LoginErrorType.MissingShop};\n    }\n\n    const shopWithoutProtocol = shop\n      .replace(/^https?:\\/\\//, '')\n      .replace(/\\/$/, '');\n    const shopWithDomain =\n      shop?.indexOf('.') === -1\n        ? `${shopWithoutProtocol}.myshopify.com`\n        : shopWithoutProtocol;\n    const sanitizedShop = api.utils.sanitizeShop(shopWithDomain);\n\n    if (!sanitizedShop) {\n      logger.debug('Invalid shop parameter', {shop});\n      return {shop: LoginErrorType.InvalidShop};\n    }\n\n    const authPath = `${config.appUrl}${config.auth.path}?shop=${sanitizedShop}`;\n\n    const adminPath = api.utils.legacyUrlToShopAdminUrl(sanitizedShop);\n    const installPath = `https://${adminPath}/oauth/install?client_id=${config.apiKey}`;\n\n    const shouldInstall =\n      config.isEmbeddedApp && config.future.unstable_newEmbeddedAuthStrategy;\n    const redirectUrl = shouldInstall ? installPath : authPath;\n\n    logger.info(`Redirecting login request to ${redirectUrl}`, {\n      shop: sanitizedShop,\n    });\n\n    throw redirect(redirectUrl);\n  };\n}\n", "import {ShopifyError} from '@shopify/shopify-api';\n\nexport class SessionNotFoundError extends ShopifyError {}\n", "import {ShopifyRestResources} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../config-types';\nimport {createOrLoadOfflineSession} from '../../authenticate/helpers/create-or-load-offline-session';\nimport {SessionNotFoundError} from '../../errors';\nimport {BasicParams} from '../../types';\nimport {adminClientFactory} from '../../clients/admin';\n\nimport {UnauthenticatedAdminContext} from './types';\n\nexport function unauthenticatedAdminContextFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources,\n>(params: BasicParams) {\n  return async (\n    shop: string,\n  ): Promise<UnauthenticatedAdminContext<ConfigArg, Resources>> => {\n    const session = await createOrLoadOfflineSession(shop, params);\n\n    if (!session) {\n      throw new SessionNotFoundError(\n        `Could not find a session for shop ${shop} when creating unauthenticated admin context`,\n      );\n    }\n\n    return {\n      session,\n      admin: adminClientFactory<ConfigArg, Resources>({params, session}),\n    };\n  };\n}\n", "import {BasicParams} from '../../../types';\nimport {\n  respondToBotRequest,\n  respondToOptionsRequest,\n  getSessionTokenHeader,\n  validateSessionToken,\n  ensureCORSHeadersFactory,\n  getShopFromRequest,\n} from '../../helpers';\n\nimport {AuthenticateExtension, ExtensionContext} from './types';\n\nexport function authenticateExtensionFactory(\n  params: BasicParams,\n  requestType: string,\n): AuthenticateExtension {\n  return async function authenticateExtension(\n    request,\n    options = {},\n  ): Promise<ExtensionContext> {\n    const {logger} = params;\n\n    const corsHeaders = options.corsHeaders ?? [];\n\n    respondToBotRequest(params, request);\n    respondToOptionsRequest(params, request, corsHeaders);\n\n    const sessionTokenHeader = getSessionTokenHeader(request);\n\n    logger.info(`Authenticating ${requestType} request`, {\n      shop: getShopFromRequest(request),\n    });\n\n    if (!sessionTokenHeader) {\n      logger.debug('Request did not contain a session token', {\n        shop: getShopFromRequest(request),\n      });\n      throw new Response(undefined, {\n        status: 401,\n        statusText: 'Unauthorized',\n      });\n    }\n\n    return {\n      sessionToken: await validateSessionToken(\n        params,\n        request,\n        sessionTokenHeader,\n        {checkAudience: false, retryRequest: false},\n      ),\n      cors: ensureCORSHeadersFactory(params, request, corsHeaders),\n    };\n  };\n}\n", "import type {BasicParams} from '../../../types';\nimport {authenticateExtensionFactory} from '../extension/authenticate';\n\nimport type {AuthenticateCheckout} from './types';\n\nexport function authenticateCheckoutFactory(\n  params: BasicParams,\n): AuthenticateCheckout {\n  return authenticateExtensionFactory(\n    params,\n    'checkout',\n  ) as AuthenticateCheckout;\n}\n", "import {Session} from '@shopify/shopify-api';\n\nimport {BasicParams} from '../../types';\n\nimport type {StorefrontContext} from '.';\n\nexport function storefrontClientFactory({\n  params,\n  session,\n}: {\n  params: BasicParams;\n  session: Session;\n}): StorefrontContext {\n  const {api} = params;\n\n  return {\n    graphql: async (query, options = {}) => {\n      const client = new api.clients.Storefront({\n        session,\n        apiVersion: options.apiVersion,\n      });\n\n      const apiResponse = await client.request(query, {\n        variables: options?.variables,\n        retries: options?.tries ? options.tries - 1 : 0,\n        headers: options?.headers,\n      });\n\n      return new Response(JSON.stringify(apiResponse));\n    },\n  };\n}\n", "import {ShopifyRestResources} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../../config-types';\nimport {adminClientFactory, storefrontClientFactory} from '../../../clients';\nimport {BasicParams} from '../../../types';\n\nimport {\n  AppProxyContext,\n  AppProxyContextWithSession,\n  AuthenticateAppProxy,\n  LiquidResponseFunction,\n} from './types';\n\nexport function authenticateAppProxyFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources,\n>(params: BasicParams): AuthenticateAppProxy<ConfigArg, Resources> {\n  const {api, config, logger} = params;\n\n  return async function authenticate(\n    request,\n  ): Promise<\n    AppProxyContext | AppProxyContextWithSession<ConfigArg, Resources>\n  > {\n    const url = new URL(request.url);\n    const shop = url.searchParams.get('shop')!;\n    logger.info('Authenticating app proxy request', {shop});\n\n    if (!(await validateAppProxyHmac(params, url))) {\n      logger.info('App proxy request has invalid signature', {shop});\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    const sessionId = api.session.getOfflineId(shop);\n    const session = await config.sessionStorage!.loadSession(sessionId);\n\n    if (!session) {\n      logger.debug('Could not find offline session, returning empty context', {\n        shop,\n        ...Object.fromEntries(url.searchParams.entries()),\n      });\n\n      const context: AppProxyContext = {\n        liquid,\n        session: undefined,\n        admin: undefined,\n        storefront: undefined,\n      };\n\n      return context;\n    }\n\n    const context: AppProxyContextWithSession<ConfigArg, Resources> = {\n      liquid,\n      session,\n      admin: adminClientFactory<ConfigArg, Resources>({params, session}),\n      storefront: storefrontClientFactory({params, session}),\n    };\n\n    return context;\n  };\n}\n\nconst liquid: LiquidResponseFunction = (body, initAndOptions) => {\n  const processedBody = processLiquidBody(body);\n\n  if (typeof initAndOptions !== 'object') {\n    return new Response(processedBody, {\n      status: initAndOptions || 200,\n      headers: {\n        'Content-Type': 'application/liquid',\n      },\n    });\n  }\n\n  const {layout, ...responseInit} = initAndOptions || {};\n  const responseBody =\n    layout === false ? `{% layout none %} ${processedBody}` : processedBody;\n\n  const headers = new Headers(responseInit.headers);\n  headers.set('Content-Type', 'application/liquid');\n\n  return new Response(responseBody, {\n    ...responseInit,\n    headers,\n  });\n};\n\nasync function validateAppProxyHmac(\n  params: BasicParams,\n  url: URL,\n): Promise<boolean> {\n  const {api, logger} = params;\n\n  try {\n    let searchParams = new URLSearchParams(url.search);\n    if (!searchParams.get('index')) {\n      searchParams.delete('index');\n    }\n\n    let isValid = await api.utils.validateHmac(\n      Object.fromEntries(searchParams.entries()),\n      {signator: 'appProxy'},\n    );\n\n    if (!isValid) {\n      const cleanPath = url.pathname\n        .replace(/^\\//, '')\n        .replace(/\\/$/, '')\n        .replaceAll('/', '.');\n      const data = `routes%2F${cleanPath}`;\n\n      searchParams = new URLSearchParams(\n        `?_data=${data}&${searchParams.toString().replace(/^\\?/, '')}`,\n      );\n\n      isValid = await api.utils.validateHmac(\n        Object.fromEntries(searchParams.entries()),\n        {signator: 'appProxy'},\n      );\n\n      if (!isValid) {\n        const searchParams = new URLSearchParams(\n          `?_data=${data}._index&${url.search.replace(/^\\?/, '')}`,\n        );\n\n        isValid = await api.utils.validateHmac(\n          Object.fromEntries(searchParams.entries()),\n          {signator: 'appProxy'},\n        );\n      }\n    }\n\n    return isValid;\n  } catch (error) {\n    const shop = url.searchParams.get('shop')!;\n    logger.info(error.message, {shop});\n    throw new Response(undefined, {status: 400, statusText: 'Bad Request'});\n  }\n}\n\nfunction processLiquidBody(body: string) {\n  return (\n    body\n      // Add trailing slashes to relative form action URLs\n      .replaceAll(\n        /<(form[^>]+)action=\"(\\/[^\"?]+)(\\?[^\"]+)?\">/g,\n        '<$1action=\"$2/$3\">',\n      )\n      // Add trailing slashes to relative link href URLs\n      .replaceAll(/<(a[^>]+)href=\"(\\/[^\"?]+)(\\?[^\"]+)?\">/g, '<$1href=\"$2/$3\">')\n  );\n}\n", "import {BasicParams} from '../../../types';\nimport {authenticateExtensionFactory} from '../extension/authenticate';\n\nimport {AuthenticateCustomerAccount} from './types';\n\nexport function authenticateCustomerAccountFactory(\n  params: BasicParams,\n): AuthenticateCustomerAccount {\n  return authenticateExtensionFactory(\n    params,\n    'customer account',\n  ) as AuthenticateCustomerAccount;\n}\n", "import {BasicParams} from '../../../types';\nimport {authenticateExtensionFactory} from '../extension/authenticate';\n\nimport type {AuthenticatePOS} from './types';\n\nexport function authenticatePOSFactory(params: BasicParams): AuthenticatePOS {\n  return authenticateExtensionFactory(params, 'pos') as AuthenticatePOS;\n}\n", "import {ShopifyRestResources} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../config-types';\nimport {BasicParams} from '../../types';\n\nimport {authenticateCheckoutFactory} from './checkout/authenticate';\nimport {authenticateAppProxyFactory} from './appProxy/authenticate';\nimport {authenticateCustomerAccountFactory} from './customer-account/authenticate';\nimport {AuthenticatePublic} from './types';\nimport {authenticatePOSFactory} from './pos/authenticate';\n\nexport function authenticatePublicFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources,\n>(params: BasicParams) {\n  const authenticateCheckout = authenticateCheckoutFactory(params);\n  const authenticateAppProxy = authenticateAppProxyFactory<\n    ConfigArg,\n    Resources\n  >(params);\n  const authenticateCustomerAccount =\n    authenticateCustomerAccountFactory(params);\n  const authenticatePOS = authenticatePOSFactory(params);\n\n  const context: AuthenticatePublic<ConfigArg> = {\n    checkout: authenticateCheckout,\n    appProxy: authenticateAppProxy,\n    customerAccount: authenticateCustomerAccount,\n    pos: authenticatePOS,\n  };\n\n  return context;\n}\n", "import {createOrLoadOfflineSession} from '../../authenticate/helpers/create-or-load-offline-session';\nimport {SessionNotFoundError} from '../../errors';\nimport {BasicParams} from '../../types';\nimport {storefrontClientFactory} from '../../clients/storefront';\n\nimport {\n  UnauthenticatedStorefrontContext,\n  GetUnauthenticatedStorefrontContext,\n} from './types';\n\nexport function unauthenticatedStorefrontContextFactory(\n  params: BasicParams,\n): GetUnauthenticatedStorefrontContext {\n  return async (shop: string): Promise<UnauthenticatedStorefrontContext> => {\n    const session = await createOrLoadOfflineSession(shop, params);\n\n    if (!session) {\n      throw new SessionNotFoundError(\n        `Could not find a session for shop ${shop} when creating unauthenticated storefront context`,\n      );\n    }\n\n    return {\n      session,\n      storefront: storefrontClientFactory({params, session}),\n    };\n  };\n}\n", "import {Session, ShopifyRestResources} from '@shopify/shopify-api';\n\nimport type {AppConfigArg} from '../../../config-types';\nimport {AdminApiContextWithRest} from '../../../clients';\nimport type {BasicParams} from '../../../types';\nimport {AuthorizationStrategy} from '../strategies/types';\n\nimport {createAdminApiContext} from './create-admin-api-context';\n\nexport async function triggerAfterAuthHook<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>(\n  params: BasicParams,\n  session: Session,\n  request: Request,\n  authStrategy: AuthorizationStrategy,\n) {\n  const {config, logger} = params;\n  if (config.hooks.afterAuth) {\n    logger.info('Running afterAuth hook', {shop: session.shop});\n\n    const admin = createAdminApiContext<ConfigArg, Resources>(\n      session,\n      params,\n      authStrategy.handleClientError(request),\n    ) as AdminApiContextWithRest<Resources>;\n\n    await config.hooks.afterAuth({\n      session,\n      admin,\n    });\n  }\n}\n", "import {\n  CookieNotFound,\n  GraphqlQueryError,\n  HttpResponseError,\n  InvalidHmacError,\n  InvalidOAuthError,\n  Session,\n  Shopify,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\n\nimport type {BasicParams} from '../../../types';\nimport {\n  beginAuth,\n  handleClientErrorFactory,\n  redirectToAuthPage,\n  redirectToShopifyOrAppRoot,\n  redirectWithExitIframe,\n  triggerAfterAuthHook,\n  validateShopAndHostParams,\n} from '../helpers';\nimport {AppConfig, AppConfigArg} from '../../../config-types';\nimport {getSessionTokenHeader} from '../../helpers';\nimport {HandleAdminClientError} from '../../../clients';\nimport type {\n  ApiConfigWithFutureFlags,\n  ApiFutureFlags,\n} from '../../../future/flags';\n\nimport {AuthorizationStrategy, SessionContext, OnErrorOptions} from './types';\n\nexport class AuthCodeFlowStrategy<\n  Config extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n> implements AuthorizationStrategy\n{\n  protected api: Shopify<\n    ApiConfigWithFutureFlags<Config['future']>,\n    ShopifyRestResources,\n    ApiFutureFlags<Config['future']>\n  >;\n\n  protected config: AppConfig;\n  protected logger: Shopify['logger'];\n\n  public constructor({api, config, logger}: BasicParams) {\n    this.api = api;\n    this.config = config;\n    this.logger = logger;\n  }\n\n  public async respondToOAuthRequests(request: Request): Promise<void | never> {\n    const {api, config} = this;\n\n    const url = new URL(request.url);\n    const isAuthRequest = url.pathname === config.auth.path;\n    const isAuthCallbackRequest = url.pathname === config.auth.callbackPath;\n\n    if (isAuthRequest || isAuthCallbackRequest) {\n      const shop = api.utils.sanitizeShop(url.searchParams.get('shop')!);\n      if (!shop) throw new Response('Shop param is invalid', {status: 400});\n\n      if (isAuthRequest) {\n        throw await this.handleAuthBeginRequest(request, shop);\n      } else {\n        throw await this.handleAuthCallbackRequest(request, shop);\n      }\n    }\n\n    if (!getSessionTokenHeader(request)) {\n      // This is a document request that doesn't contain a session token. We check if the app is installed.\n      // If the app isn't installed, we initiate the OAuth auth code flow.\n      // Requests with a header can only happen after the app is installed.\n      await this.ensureInstalledOnShop(request);\n    }\n  }\n\n  public async authenticate(\n    request: Request,\n    sessionContext: SessionContext,\n  ): Promise<Session | never> {\n    const {api, config, logger} = this;\n\n    const {shop, session} = sessionContext;\n\n    if (!session) {\n      logger.debug('No session found, redirecting to OAuth', {shop});\n      await redirectToAuthPage({config, logger, api}, request, shop);\n    } else if (!session.isActive(config.scopes)) {\n      logger.debug(\n        'Found a session, but it has expired, redirecting to OAuth',\n        {shop},\n      );\n      await redirectToAuthPage({config, logger, api}, request, shop);\n    }\n\n    logger.debug('Found a valid session', {shop});\n\n    return session!;\n  }\n\n  public handleClientError(request: Request): HandleAdminClientError {\n    const {api, config, logger} = this;\n    return handleClientErrorFactory({\n      request,\n      onError: async ({session, error}: OnErrorOptions) => {\n        if (error.response.code === 401) {\n          throw await redirectToAuthPage(\n            {api, config, logger},\n            request,\n            session.shop,\n          );\n        }\n      },\n    });\n  }\n\n  private async ensureInstalledOnShop(request: Request) {\n    const {api, config, logger} = this;\n\n    validateShopAndHostParams({api, config, logger}, request);\n\n    const url = new URL(request.url);\n    let shop = url.searchParams.get('shop');\n\n    // Ensure app is installed\n    logger.debug('Ensuring app is installed on shop', {shop});\n\n    if (!(await this.hasValidOfflineId(request))) {\n      logger.info(\"Could not find a shop, can't authenticate request\");\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    const offlineSession = await this.getOfflineSession(request);\n    const isEmbedded = url.searchParams.get('embedded') === '1';\n\n    if (!offlineSession) {\n      logger.info(\"Shop hasn't installed app yet, redirecting to OAuth\", {\n        shop,\n      });\n      if (isEmbedded) {\n        redirectWithExitIframe({api, config, logger}, request, shop!);\n      } else {\n        throw await beginAuth({api, config, logger}, request, false, shop!);\n      }\n    }\n\n    shop = shop || offlineSession.shop;\n\n    if (config.isEmbeddedApp && !isEmbedded) {\n      try {\n        logger.debug('Ensuring offline session is valid before embedding', {\n          shop,\n        });\n        await this.testSession(offlineSession);\n\n        logger.debug('Offline session is still valid, embedding app', {shop});\n      } catch (error) {\n        await this.handleInvalidOfflineSession(error, request, shop);\n      }\n    }\n  }\n\n  private async handleAuthBeginRequest(\n    request: Request,\n    shop: string,\n  ): Promise<never> {\n    const {api, config, logger} = this;\n\n    logger.info('Handling OAuth begin request', {shop});\n\n    // If we're loading from an iframe, we need to break out of it\n    if (\n      config.isEmbeddedApp &&\n      request.headers.get('Sec-Fetch-Dest') === 'iframe'\n    ) {\n      logger.debug('Auth request in iframe detected, exiting iframe', {shop});\n      throw redirectWithExitIframe({api, config, logger}, request, shop);\n    } else {\n      throw await beginAuth({api, config, logger}, request, false, shop);\n    }\n  }\n\n  private async handleAuthCallbackRequest(\n    request: Request,\n    shop: string,\n  ): Promise<never> {\n    const {api, config, logger} = this;\n\n    logger.info('Handling OAuth callback request', {shop});\n\n    try {\n      const {session, headers: responseHeaders} = await api.auth.callback({\n        rawRequest: request,\n      });\n\n      await config.sessionStorage!.storeSession(session);\n\n      if (config.useOnlineTokens && !session.isOnline) {\n        logger.info('Requesting online access token for offline session', {\n          shop,\n        });\n        await beginAuth({api, config, logger}, request, true, shop);\n      }\n\n      logger.debug('Request is valid, loaded session from OAuth callback', {\n        shop: session.shop,\n        isOnline: session.isOnline,\n      });\n\n      await triggerAfterAuthHook<Config, Resources>(\n        {api, config, logger},\n        session,\n        request,\n        this,\n      );\n\n      throw await redirectToShopifyOrAppRoot(\n        request,\n        {api, config, logger},\n        responseHeaders,\n      );\n    } catch (error) {\n      if (error instanceof Response) throw error;\n\n      throw await this.oauthCallbackError(error, request, shop);\n    }\n  }\n\n  private async getOfflineSession(\n    request: Request,\n  ): Promise<Session | undefined> {\n    const offlineId = await this.getOfflineSessionId(request);\n    return this.config.sessionStorage!.loadSession(offlineId!);\n  }\n\n  private async hasValidOfflineId(request: Request) {\n    return Boolean(await this.getOfflineSessionId(request));\n  }\n\n  private async getOfflineSessionId(\n    request: Request,\n  ): Promise<string | undefined> {\n    const {api} = this;\n    const url = new URL(request.url);\n    const shop = url.searchParams.get('shop');\n\n    return shop\n      ? api.session.getOfflineId(shop)\n      : api.session.getCurrentId({isOnline: false, rawRequest: request});\n  }\n\n  private async testSession(session: Session): Promise<void> {\n    const {api} = this;\n\n    const client = new api.clients.Graphql({\n      session,\n    });\n\n    await client.request(`#graphql\n      query shopifyAppShopName {\n        shop {\n          name\n        }\n      }\n    `);\n  }\n\n  private async oauthCallbackError(\n    error: Error,\n    request: Request,\n    shop: string,\n  ) {\n    const {logger} = this;\n    logger.error('Error during OAuth callback', {shop, error: error.message});\n\n    if (error instanceof CookieNotFound) {\n      return this.handleAuthBeginRequest(request, shop);\n    }\n\n    if (\n      error instanceof InvalidHmacError ||\n      error instanceof InvalidOAuthError\n    ) {\n      return new Response(undefined, {\n        status: 400,\n        statusText: 'Invalid OAuth Request',\n      });\n    }\n\n    return new Response(undefined, {\n      status: 500,\n      statusText: 'Internal Server Error',\n    });\n  }\n\n  private async handleInvalidOfflineSession(\n    error: Error,\n    request: Request,\n    shop: string,\n  ) {\n    const {api, logger, config} = this;\n    if (error instanceof HttpResponseError) {\n      if (error.response.code === 401) {\n        logger.info('Shop session is no longer valid, redirecting to OAuth', {\n          shop,\n        });\n        throw await beginAuth({api, config, logger}, request, false, shop);\n      } else {\n        const message = JSON.stringify(error.response.body, null, 2);\n        logger.error(`Unexpected error during session validation: ${message}`, {\n          shop,\n        });\n\n        throw new Response(undefined, {\n          status: error.response.code,\n          statusText: error.response.statusText,\n        });\n      }\n    } else if (error instanceof GraphqlQueryError) {\n      const context: Record<string, string> = {shop};\n      if (error.response) {\n        context.response = JSON.stringify(error.body);\n      }\n\n      logger.error(\n        `Unexpected error during session validation: ${error.message}`,\n        context,\n      );\n\n      throw new Response(undefined, {\n        status: 500,\n        statusText: 'Internal Server Error',\n      });\n    }\n  }\n}\n", "import {\n  HttpResponseError,\n  InvalidJwtError,\n  RequestedTokenType,\n  Session,\n  Shopify,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\n\nimport {AppConfig, AppConfigArg} from '../../../config-types';\nimport {BasicParams} from '../../../types';\nimport {\n  respondToInvalidSessionToken,\n  invalidateAccessToken,\n  getShopFromRequest,\n} from '../../helpers';\nimport {handleClientErrorFactory, triggerAfterAuthHook} from '../helpers';\nimport {HandleAdminClientError} from '../../../clients';\nimport type {\n  ApiConfigWithFutureFlags,\n  ApiFutureFlags,\n} from '../../../future/flags';\n\nimport {AuthorizationStrategy, SessionContext, OnErrorOptions} from './types';\n\nexport class TokenExchangeStrategy<Config extends AppConfigArg>\n  implements AuthorizationStrategy\n{\n  protected api: Shopify<\n    ApiConfigWithFutureFlags<Config['future']>,\n    ShopifyRestResources,\n    ApiFutureFlags<Config['future']>\n  >;\n\n  protected config: AppConfig;\n  protected logger: Shopify['logger'];\n\n  public constructor({api, config, logger}: BasicParams<Config['future']>) {\n    this.api = api;\n    this.config = config;\n    this.logger = logger;\n  }\n\n  public async respondToOAuthRequests(_request: Request): Promise<void> {}\n\n  public async authenticate(\n    request: Request,\n    sessionContext: SessionContext,\n  ): Promise<Session> {\n    const {api, config, logger} = this;\n    const {shop, session, sessionToken} = sessionContext;\n\n    if (!sessionToken) throw new InvalidJwtError();\n\n    if (!session || !session.isActive(undefined)) {\n      logger.info('No valid session found', {shop});\n      logger.info('Requesting offline access token', {shop});\n      const {session: offlineSession} = await this.exchangeToken({\n        request,\n        sessionToken,\n        shop,\n        requestedTokenType: RequestedTokenType.OfflineAccessToken,\n      });\n\n      await config.sessionStorage!.storeSession(offlineSession);\n\n      let newSession = offlineSession;\n\n      if (config.useOnlineTokens) {\n        logger.info('Requesting online access token', {shop});\n        const {session: onlineSession} = await this.exchangeToken({\n          request,\n          sessionToken,\n          shop,\n          requestedTokenType: RequestedTokenType.OnlineAccessToken,\n        });\n\n        await config.sessionStorage!.storeSession(onlineSession);\n        newSession = onlineSession;\n      }\n\n      logger.debug('Request is valid, loaded session from session token', {\n        shop: newSession.shop,\n        isOnline: newSession.isOnline,\n      });\n\n      try {\n        await this.handleAfterAuthHook(\n          {api, config, logger},\n          newSession,\n          request,\n          sessionToken,\n        );\n      } catch (errorOrResponse) {\n        if (errorOrResponse instanceof Response) {\n          throw errorOrResponse;\n        }\n\n        throw new Response(undefined, {\n          status: 500,\n          statusText: 'Internal Server Error',\n        });\n      }\n\n      return newSession;\n    }\n\n    return session!;\n  }\n\n  public handleClientError(request: Request): HandleAdminClientError {\n    const {api, config, logger} = this;\n    return handleClientErrorFactory({\n      request,\n      onError: async ({session, error}: OnErrorOptions) => {\n        if (error.response.code === 401) {\n          logger.debug('Responding to invalid access token', {\n            shop: getShopFromRequest(request),\n          });\n          await invalidateAccessToken({config, api, logger}, session);\n\n          respondToInvalidSessionToken({\n            params: {config, api, logger},\n            request,\n          });\n        }\n      },\n    });\n  }\n\n  private async exchangeToken({\n    request,\n    shop,\n    sessionToken,\n    requestedTokenType,\n  }: {\n    request: Request;\n    shop: string;\n    sessionToken: string;\n    requestedTokenType: RequestedTokenType;\n  }): Promise<{session: Session}> {\n    const {api, config, logger} = this;\n\n    try {\n      return await api.auth.tokenExchange({\n        sessionToken,\n        shop,\n        requestedTokenType,\n      });\n    } catch (error) {\n      if (\n        error instanceof InvalidJwtError ||\n        (error instanceof HttpResponseError &&\n          error.response.code === 400 &&\n          error.response.body?.error === 'invalid_subject_token')\n      ) {\n        throw respondToInvalidSessionToken({\n          params: {api, config, logger},\n          request,\n          retryRequest: true,\n        });\n      }\n\n      throw new Response(undefined, {\n        status: 500,\n        statusText: 'Internal Server Error',\n      });\n    }\n  }\n\n  private async handleAfterAuthHook(\n    params: BasicParams,\n    session: Session,\n    request: Request,\n    sessionToken: string,\n  ) {\n    const {config} = params;\n    await config.idempotentPromiseHandler.handlePromise({\n      promiseFunction: () => {\n        return triggerAfterAuthHook(params, session, request, this);\n      },\n      identifier: sessionToken,\n    });\n  }\n}\n", "import {\n  Session,\n  Shopify,\n  ShopifyError,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\n\nimport {AppConfig, AppConfigArg} from '../../../config-types';\nimport {BasicParams} from '../../../types';\nimport {ApiConfigWithFutureFlags, ApiFutureFlags} from '../../../future/flags';\nimport {HandleAdminClientError} from '../../../clients';\nimport {handleClientErrorFactory} from '../helpers';\nimport {getShopFromRequest} from '../../helpers';\n\nimport {AuthorizationStrategy, OnErrorOptions, SessionContext} from './types';\n\nexport class MerchantCustomAuth<Config extends AppConfigArg>\n  implements AuthorizationStrategy\n{\n  protected api: Shopify<\n    ApiConfigWithFutureFlags<Config['future']>,\n    ShopifyRestResources,\n    ApiFutureFlags<Config['future']>\n  >;\n\n  protected config: AppConfig;\n  protected logger: Shopify['logger'];\n\n  public constructor({api, config, logger}: BasicParams<Config['future']>) {\n    this.api = api;\n    this.config = config;\n    this.logger = logger;\n  }\n\n  public async respondToOAuthRequests(request: Request): Promise<void> {\n    this.logger.debug('Skipping OAuth request for merchant custom app', {\n      shop: getShopFromRequest(request),\n    });\n  }\n\n  public async authenticate(\n    _request: Request,\n    sessionContext: SessionContext,\n  ): Promise<Session | never> {\n    const {shop} = sessionContext;\n\n    this.logger.debug(\n      'Building session from configured access token for merchant custom app',\n      {shop},\n    );\n    const session = this.api.session.customAppSession(shop);\n\n    return session;\n  }\n\n  public handleClientError(request: Request): HandleAdminClientError {\n    return handleClientErrorFactory({\n      request,\n      onError: async ({error}: OnErrorOptions) => {\n        if (error.response.code === 401) {\n          this.logger.info(\n            'Request failed with 401. Review your API credentials or generate new tokens. https://shopify.dev/docs/apps/build/authentication-authorization/access-token-types/generate-app-access-tokens-admin#rotating-api-credentials-for-admin-created-apps ',\n          );\n          throw new ShopifyError(\n            'Unauthorized: Access token has been revoked.',\n          );\n        }\n      },\n    });\n  }\n}\n", "export interface IdempotentHandlePromiseParams {\n  promiseFunction: () => Promise<any>;\n  identifier: string;\n}\n\nconst IDENTIFIER_TTL_MS = 60000;\n\nexport class IdempotentPromiseHandler {\n  protected identifiers: Map<string, number>;\n\n  constructor() {\n    this.identifiers = new Map<string, number>();\n  }\n\n  async handlePromise({\n    promiseFunction,\n    identifier,\n  }: IdempotentHandlePromiseParams): Promise<any> {\n    try {\n      if (this.isPromiseRunnable(identifier)) {\n        await promiseFunction();\n      }\n    } finally {\n      this.clearStaleIdentifiers();\n    }\n\n    return Promise.resolve();\n  }\n\n  private isPromiseRunnable(identifier: string) {\n    if (!this.identifiers.has(identifier)) {\n      this.identifiers.set(identifier, Date.now());\n      return true;\n    }\n    return false;\n  }\n\n  private async clearStaleIdentifiers() {\n    this.identifiers.forEach((date, identifier, map) => {\n      if (Date.now() - date > IDENTIFIER_TTL_MS) {\n        map.delete(identifier);\n      }\n    });\n  }\n}\n", "import {ShopifyRestResources} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../config-types';\nimport {adminClientFactory} from '../../clients/admin';\nimport {BasicParams} from '../../types';\n\nimport type {AuthenticateFlow, FlowContext} from './types';\n\nexport function authenticateFlowFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>(params: BasicParams): AuthenticateFlow<ConfigArg, Resources> {\n  const {api, config, logger} = params;\n\n  return async function authenticate(\n    request: Request,\n  ): Promise<FlowContext<ConfigArg, Resources>> {\n    logger.info('Authenticating flow request');\n\n    if (request.method !== 'POST') {\n      logger.debug(\n        'Received a non-POST request for flow. Only POST requests are allowed.',\n        {url: request.url, method: request.method},\n      );\n      throw new Response(undefined, {\n        status: 405,\n        statusText: 'Method not allowed',\n      });\n    }\n\n    const rawBody = await request.text();\n    const result = await api.flow.validate({\n      rawBody,\n      rawRequest: request,\n    });\n\n    if (!result.valid) {\n      logger.error('Received an invalid flow request', {reason: result.reason});\n\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    const payload = JSON.parse(rawBody);\n\n    logger.debug('Flow request is valid, looking for an offline session', {\n      shop: payload.shopify_domain,\n    });\n\n    const sessionId = api.session.getOfflineId(payload.shopify_domain);\n    const session = await config.sessionStorage!.loadSession(sessionId);\n\n    if (!session) {\n      logger.info('Flow request could not find session', {\n        shop: payload.shopify_domain,\n      });\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    logger.debug('Found a session for the flow request', {shop: session.shop});\n\n    return {\n      session,\n      payload,\n      admin: adminClientFactory<ConfigArg, Resources>({params, session}),\n    };\n  };\n}\n", "import {ShopifyRestResources, ShopifyHeader} from '@shopify/shopify-api';\n\nimport {AppConfigArg} from '../../config-types';\nimport {adminClientFactory} from '../../clients/admin';\nimport {BasicParams} from '../../types';\nimport {createOrLoadOfflineSession} from '../helpers';\n\nimport type {\n  AuthenticateFulfillmentService,\n  FulfillmentServiceContext,\n} from './types';\n\nexport function authenticateFulfillmentServiceFactory<\n  ConfigArg extends AppConfigArg,\n  Resources extends ShopifyRestResources = ShopifyRestResources,\n>(params: BasicParams): AuthenticateFulfillmentService<ConfigArg, Resources> {\n  const {api, logger} = params;\n\n  return async function authenticate(\n    request: Request,\n  ): Promise<FulfillmentServiceContext<ConfigArg, Resources>> {\n    logger.info('Authenticating fulfillment service request');\n\n    if (request.method !== 'POST') {\n      logger.debug(\n        'Received a non-POST request for fulfillment service. Only POST requests are allowed.',\n        {url: request.url, method: request.method},\n      );\n      throw new Response(undefined, {\n        status: 405,\n        statusText: 'Method not allowed',\n      });\n    }\n\n    const rawBody = await request.text();\n    const result = await api.fulfillmentService.validate({\n      rawBody,\n      rawRequest: request,\n    });\n\n    if (!result.valid) {\n      logger.error('Received an invalid fulfillment service request', {\n        reason: result.reason,\n      });\n\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    const payload = JSON.parse(rawBody);\n    const shop = request.headers.get(ShopifyHeader.Domain) || '';\n\n    logger.debug(\n      'Fulfillment service request is valid, looking for an offline session',\n      {\n        shop,\n      },\n    );\n\n    const session = await createOrLoadOfflineSession(shop, params);\n\n    if (!session) {\n      logger.info('Fulfillment service request could not find session', {\n        shop,\n      });\n      throw new Response(undefined, {\n        status: 400,\n        statusText: 'Bad Request',\n      });\n    }\n\n    logger.debug('Found a session for the fulfillment service request', {\n      shop,\n    });\n\n    return {\n      session,\n      payload,\n      admin: adminClientFactory<ConfigArg, Resources>({params, session}),\n    };\n  };\n}\n", "import type {\n  ConfigParams,\n  Shopify,\n  ShopifyRestResources,\n} from '@shopify/shopify-api';\n\nimport {AppConfig} from '../config-types';\n\n// When adding new flags, you should also add them to the `TEST_FUTURE_FLAGS` object in `test-config.ts` to ensure that\n// it doesn't cause regressions.\nexport interface FutureFlags {\n  /**\n   * When enabled, embedded apps will fetch access tokens via [token exchange](https://shopify.dev/docs/apps/auth/get-access-tokens/token-exchange).\n   * This assumes the app has scopes declared for [Shopify managing installation](https://shopify.dev/docs/apps/auth/installation#shopify-managed-installation).\n   *\n   * Learn more about this [new embedded app auth strategy](https://shopify.dev/docs/api/shopify-app-remix#embedded-auth-strategy).\n   *\n   * @default false\n   */\n  unstable_newEmbeddedAuthStrategy?: boolean;\n\n  /**\n   * When enabled, methods for interacting with the admin REST API will not be returned.\n   *\n   * This affects:\n   *\n   * * `authenticate.admin(request)`\n   * * `authenticate.webhook(request)`\n   * * `authenticate.flow(request)`\n   * * `authenticate.appProxy(request)`\n   * * `authenticate.fulfillmentService(request)`\n   * * `unauthenticated.admin(shop)`\n   *\n   * In a future release we will remove REST from the package completely.\n   *\n   * Please see: [https://www.shopify.com/ca/partners/blog/all-in-on-graphql](https://www.shopify.com/ca/partners/blog/all-in-on-graphql)\n   *\n   * @default false\n   */\n  removeRest?: boolean;\n}\n\n// When adding new flags, use this format:\n// apiFutureFlag: Future extends FutureFlags ? Future['remixFutureFlag'] : false;\nexport interface ApiFutureFlags<_Future extends FutureFlagOptions> {\n  // We're currently hardcoding this flag to true in our settings, so we should propagate it here\n  lineItemBilling: true;\n  unstable_managedPricingSupport: true;\n}\n\nexport type ApiConfigWithFutureFlags<Future extends FutureFlagOptions> =\n  ConfigParams<ShopifyRestResources, ApiFutureFlags<Future>>;\n\nexport type FutureFlagOptions = FutureFlags | undefined;\n\nexport type FeatureEnabled<\n  Future extends FutureFlagOptions,\n  Flag extends keyof FutureFlags,\n> = Future extends FutureFlags\n  ? Future[Flag] extends true\n    ? true\n    : false\n  : false;\n\nexport function logDisabledFutureFlags(\n  config: AppConfig,\n  logger: Shopify['logger'],\n) {\n  const logFlag = (flag: string, message: string) =>\n    logger.info(`Future flag ${flag} is disabled.\\n\\n  ${message}\\n`);\n\n  if (!config.future.unstable_newEmbeddedAuthStrategy) {\n    logFlag(\n      'unstable_newEmbeddedAuthStrategy',\n      'Enable this to use OAuth token exchange instead of auth code to generate API access tokens.' +\n        '\\n  Your app must be using Shopify managed install: https://shopify.dev/docs/apps/auth/installation',\n    );\n  }\n}\n", "import '@shopify/shopify-api/adapters/web-api';\nimport {\n  ConfigInterface as ApiConfig,\n  LATEST_API_VERSION,\n  ShopifyError,\n  ShopifyRestResources,\n  shopifyApi,\n} from '@shopify/shopify-api';\nimport {SessionStorage} from '@shopify/shopify-app-session-storage';\n\nimport {type AppConfig, type AppConfigArg} from './config-types';\nimport {\n  AppDistribution,\n  type BasicParams,\n  type ShopifyApp,\n  type ShopifyAppBase,\n  type AdminApp,\n  type SingleMerchantApp,\n  type AppStoreApp,\n} from './types';\nimport {SHOPIFY_REMIX_LIBRARY_VERSION} from './version';\nimport {registerWebhooksFactory} from './authenticate/webhooks';\nimport {authStrategyFactory} from './authenticate/admin/authenticate';\nimport {authenticateWebhookFactory} from './authenticate/webhooks/authenticate';\nimport {overrideLogger} from './override-logger';\nimport {addDocumentResponseHeadersFactory} from './authenticate/helpers';\nimport {loginFactory} from './authenticate/login/login';\nimport {unauthenticatedAdminContextFactory} from './unauthenticated/admin';\nimport {authenticatePublicFactory} from './authenticate/public';\nimport {unauthenticatedStorefrontContextFactory} from './unauthenticated/storefront';\nimport {AuthCodeFlowStrategy} from './authenticate/admin/strategies/auth-code-flow';\nimport {TokenExchangeStrategy} from './authenticate/admin/strategies/token-exchange';\nimport {MerchantCustomAuth} from './authenticate/admin/strategies/merchant-custom-app';\nimport {IdempotentPromiseHandler} from './authenticate/helpers/idempotent-promise-handler';\nimport {authenticateFlowFactory} from './authenticate/flow/authenticate';\nimport {authenticateFulfillmentServiceFactory} from './authenticate/fulfillment-service/authenticate';\nimport {FutureFlagOptions, logDisabledFutureFlags} from './future/flags';\n\n/**\n * Creates an object your app will use to interact with Shopify.\n *\n * @param appConfig Configuration options for your Shopify app, such as the scopes your app needs.\n * @returns `ShopifyApp` An object constructed using your appConfig.  It has methods for interacting with Shopify.\n *\n * @example\n * <caption>The minimum viable configuration</caption>\n * ```ts\n * // /shopify.server.ts\n * import { shopifyApp } from \"@shopify/shopify-app-remix/server\";\n *\n * const shopify = shopifyApp({\n *   apiKey: process.env.SHOPIFY_API_KEY!,\n *   apiSecretKey: process.env.SHOPIFY_API_SECRET!,\n *   scopes: process.env.SCOPES?.split(\",\")!,\n *   appUrl: process.env.SHOPIFY_APP_URL!,\n * });\n * export default shopify;\n * ```\n */\nexport function shopifyApp<\n  Config extends AppConfigArg<Resources, Storage, Future>,\n  Resources extends ShopifyRestResources,\n  Storage extends SessionStorage,\n  Future extends FutureFlagOptions = Config['future'],\n>(appConfig: Readonly<Config>): ShopifyApp<Config> {\n  const api = deriveApi(appConfig);\n  const config = deriveConfig<Storage>(appConfig, api.config);\n  const logger = overrideLogger(api.logger);\n\n  if (appConfig.webhooks) {\n    api.webhooks.addHandlers(appConfig.webhooks);\n  }\n\n  const params: BasicParams = {api, config, logger};\n\n  let strategy;\n  if (config.distribution === AppDistribution.ShopifyAdmin) {\n    strategy = new MerchantCustomAuth(params);\n  } else if (\n    config.future.unstable_newEmbeddedAuthStrategy &&\n    config.isEmbeddedApp\n  ) {\n    strategy = new TokenExchangeStrategy(params);\n  } else {\n    strategy = new AuthCodeFlowStrategy(params);\n  }\n\n  const authStrategy = authStrategyFactory<Config, Resources>({\n    ...params,\n    strategy,\n  });\n\n  const shopify:\n    | AdminApp<Config>\n    | AppStoreApp<Config>\n    | SingleMerchantApp<Config> = {\n    sessionStorage: config.sessionStorage,\n    addDocumentResponseHeaders: addDocumentResponseHeadersFactory(params),\n    registerWebhooks: registerWebhooksFactory(params),\n    authenticate: {\n      admin: authStrategy,\n      flow: authenticateFlowFactory<Config, Resources>(params),\n      public: authenticatePublicFactory<Config, Resources>(params),\n      fulfillmentService: authenticateFulfillmentServiceFactory<\n        Config,\n        Resources\n      >(params),\n      webhook: authenticateWebhookFactory<Config, Resources, string>(params),\n    },\n    unauthenticated: {\n      admin: unauthenticatedAdminContextFactory<Config, Resources>(params),\n      storefront: unauthenticatedStorefrontContextFactory(params),\n    },\n  };\n\n  if (\n    isAppStoreApp(shopify, appConfig) ||\n    isSingleMerchantApp(shopify, appConfig)\n  ) {\n    shopify.login = loginFactory(params);\n  }\n\n  logDisabledFutureFlags(config, logger);\n\n  return shopify as ShopifyApp<Config>;\n}\n\nfunction isAppStoreApp<Config extends AppConfigArg>(\n  _shopify: ShopifyAppBase<Config>,\n  config: Config,\n): _shopify is AppStoreApp<Config> {\n  return config.distribution === AppDistribution.AppStore;\n}\n\nfunction isSingleMerchantApp<Config extends AppConfigArg>(\n  _shopify: ShopifyAppBase<Config>,\n  config: Config,\n): _shopify is SingleMerchantApp<Config> {\n  return config.distribution === AppDistribution.SingleMerchant;\n}\n\n// This function is only exported so we can unit test it without having to mock the underlying module.\n// It's not available to consumers of the library because it is not exported in the index module, and never should be.\nexport function deriveApi(appConfig: AppConfigArg): BasicParams['api'] {\n  let appUrl: URL;\n  try {\n    appUrl = new URL(appConfig.appUrl);\n  } catch (error) {\n    const message =\n      appConfig.appUrl === ''\n        ? `Detected an empty appUrl configuration, please make sure to set the necessary environment variables.\\n` +\n          `If you're deploying your app, you can find more information at https://shopify.dev/docs/apps/launch/deployment/deploy-web-app/deploy-to-hosting-service#step-4-set-up-environment-variables`\n        : `Invalid appUrl configuration '${appConfig.appUrl}', please provide a valid URL.`;\n    throw new ShopifyError(message);\n  }\n\n  /* eslint-disable no-process-env */\n  if (appUrl.hostname === 'localhost' && !appUrl.port && process.env.PORT) {\n    appUrl.port = process.env.PORT;\n  }\n  /* eslint-enable no-process-env */\n  appConfig.appUrl = appUrl.origin;\n\n  let userAgentPrefix = `Shopify Remix Library v${SHOPIFY_REMIX_LIBRARY_VERSION}`;\n  if (appConfig.userAgentPrefix) {\n    userAgentPrefix = `${appConfig.userAgentPrefix} | ${userAgentPrefix}`;\n  }\n\n  return shopifyApi({\n    ...appConfig,\n    hostName: appUrl.host,\n    hostScheme: appUrl.protocol.replace(':', '') as 'http' | 'https',\n    userAgentPrefix,\n    isEmbeddedApp: appConfig.isEmbeddedApp ?? true,\n    apiVersion: appConfig.apiVersion ?? LATEST_API_VERSION,\n    isCustomStoreApp: appConfig.distribution === AppDistribution.ShopifyAdmin,\n    billing: appConfig.billing as ApiConfig['billing'],\n    future: {\n      lineItemBilling: true,\n      unstable_managedPricingSupport: true,\n    },\n    _logDisabledFutureFlags: false,\n  });\n}\n\nfunction deriveConfig<Storage extends SessionStorage>(\n  appConfig: AppConfigArg,\n  apiConfig: ApiConfig,\n): AppConfig<Storage> {\n  if (\n    !appConfig.sessionStorage &&\n    appConfig.distribution !== AppDistribution.ShopifyAdmin\n  ) {\n    throw new ShopifyError(\n      'Please provide a valid session storage. Refer to https://github.com/Shopify/shopify-app-js/blob/main/README.md#session-storage-options for options.',\n    );\n  }\n\n  const authPathPrefix = appConfig.authPathPrefix || '/auth';\n  appConfig.distribution = appConfig.distribution ?? AppDistribution.AppStore;\n\n  return {\n    ...appConfig,\n    ...apiConfig,\n    billing: appConfig.billing as ApiConfig['billing'],\n    scopes: apiConfig.scopes,\n    idempotentPromiseHandler: new IdempotentPromiseHandler(),\n    canUseLoginForm: appConfig.distribution !== AppDistribution.ShopifyAdmin,\n    useOnlineTokens: appConfig.useOnlineTokens ?? false,\n    hooks: appConfig.hooks ?? {},\n    sessionStorage: appConfig.sessionStorage as Storage,\n    future: appConfig.future ?? {},\n    auth: {\n      path: authPathPrefix,\n      callbackPath: `${authPathPrefix}/callback`,\n      patchSessionTokenPath: `${authPathPrefix}/session-token`,\n      exitIframePath: `${authPathPrefix}/exit-iframe`,\n      loginPath: `${authPathPrefix}/login`,\n    },\n    distribution: appConfig.distribution,\n  };\n}\n", "import '@shopify/shopify-api/adapters/web-api';\nimport {setAbstractRuntimeString} from '@shopify/shopify-api/runtime';\n\nsetAbstractRuntimeString(() => {\n  return `Remix`;\n});\n\nexport {\n  LATEST_API_VERSION,\n  RELEASE_CANDIDATE_API_VERSION,\n  LogSeverity,\n  DeliveryMethod,\n  BillingInterval,\n  BillingReplacementBehavior,\n  ApiVersion,\n  Session,\n} from '@shopify/shopify-api';\n\nexport type {JwtPayload} from '@shopify/shopify-api';\n\nexport type * from './types-contexts';\nexport type {ShopifyApp, LoginError} from './types';\nexport {LoginErrorType, AppDistribution} from './types';\nexport {boundary} from './boundary';\nexport {shopifyApp} from './shopify-app';\nexport * from './errors';\n"],
  "mappings": "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",
  "names": ["parse", "parse", "parse", "parse", "parse", "compare", "compare", "compare", "compare", "compare", "compare", "compare", "compare", "compare", "parse", "satisfies", "require_valid", "satisfies", "satisfies", "compare", "satisfies", "compare", "require_semver", "parse", "compare", "satisfies", "HashFormat", "_a", "request", "message", "message", "message", "crypto", "request", "value", "_a", "LogSeverity", "ApiVersion", "ShopifyHeader", "ClientType", "BillingInterval", "BillingReplacementBehavior", "message", "message", "RestClient", "logger", "_a", "_b", "message", "_a", "_b", "logger", "createLogger", "message", "message", "logger", "request", "flatHeaders", "headers", "decoder", "boundary", "data", "errors", "_a", "_b", "logger", "year", "getHeaders", "DEFAULT_CLIENT_VERSION", "CLIENT", "RETRIABLE_STATUS_CODES", "CLIENT", "logger", "CLIENT", "DEFAULT_CLIENT_VERSION", "getHeaders", "Method", "logger", "CLIENT", "generateApiUrlFormatter", "generateClientLogger", "RETRIABLE_STATUS_CODES", "request", "apiVersion", "DEFAULT_CLIENT_VERSION", "params", "normalizedHeaders", "Method", "StatusCode", "Header", "CspDirective", "CspSandboxAllow", "SpecialSource", "SriAsset", "HashAlgorithm", "ResponseType", "CacheControl", "message", "_a", "ShopifyErrors.HttpRequestError", "ShopifyErrors.GraphqlQueryError", "_b", "ShopifyErrors.HttpMaxRetriesError", "ShopifyErrors.HttpThrottlingError", "ShopifyErrors.HttpInternalError", "ShopifyErrors.HttpResponseError", "ShopifyErrors.MissingRequiredArgument", "message", "ShopifyErrors.MissingRequiredArgument", "message", "Method", "ShopifyErrors.InvalidRequestError", "_a", "_b", "link", "pattern", "request", "DEFAULT_CONTENT_TYPE", "DEFAULT_SDK_VARIANT", "DEFAULT_CLIENT_VERSION", "SDK_VARIANT_HEADER", "SDK_VERSION_HEADER", "CLIENT", "CLIENT", "logger", "CLIENT", "generateApiUrlFormatter", "DEFAULT_CONTENT_TYPE", "SDK_VARIANT_HEADER", "DEFAULT_SDK_VARIANT", "SDK_VERSION_HEADER", "DEFAULT_CLIENT_VERSION", "getHeaders", "generateGetApiUrl", "ShopifyErrors.MissingRequiredArgument", "message", "ShopifyErrors.InvalidSession", "GraphqlClient", "ShopifyErrors.MissingRequiredArgument", "ShopifyErrors.SafeCompareError", "HmacValidationType", "ShopifyErrors.InvalidHmacError", "request", "log", "DataType", "log", "crypto", "nonce", "validate", "URL", "URL", "_a", "URL", "_a", "_b", "message", "_a", "message", "types", "_a", "parse", "_a", "_b", "_a", "base64url_exports", "decode", "encode", "encode", "decode", "ShopifyErrors.InvalidJwtError", "getCurrentSessionId", "request", "log", "ShopifyErrors.MissingJwtTokenError", "uuidv4", "request", "log", "callback", "ShopifyErrors.BotActivityDetected", "ShopifyErrors.CookieNotFound", "ShopifyErrors.InvalidOAuthError", "message", "ShopifyErrors.PrivateAppError", "request", "ShopifyErrors.MissingRequiredArgument", "ShopifyErrors.InvalidRequestError", "RequestedTokenType", "DeliveryMethod", "WebhookOperation", "addHandlers", "getTopicsAdded", "getHandlers", "log", "_a", "_b", "register", "log", "GraphqlClient", "_b", "_a", "validate", "request", "log", "process", "ShopifyErrors.InvalidWebhookError", "log", "ShopifyErrors.MissingWebhookCallbackError", "process", "_a", "_b", "check", "_a", "GraphqlClient", "_b", "GraphqlClient", "billingConfig", "_a", "_b", "GraphqlClient", "_b", "_a", "_a", "GraphqlClient", "_b", "createUsageRecord", "GraphqlClient", "_b", "_a", "subscriptions", "updateUsageCappedAmount", "GraphqlClient", "_b", "_a", "validateFactory", "validate", "validateFactory", "validateFactory", "validate", "validateFactory", "AppDistribution", "LoginErrorType", "_jsx", "logger", "_b", "_a", "request", "logger", "request", "logger", "request", "request", "logger", "request", "_a", "logger", "request", "request", "request", "request", "request", "isEmbeddedRequest", "logger", "request", "logger", "request", "logger", "request", "logger", "isEmbeddedRequest", "params", "request", "logger", "request", "logger", "request", "createUsageRecord", "logger", "request", "updateUsageCappedAmount", "logger", "request", "request", "logger", "SESSION_TOKEN_PARAM", "request", "logger", "request", "request", "request", "logger", "redirect", "remixRedirect", "request", "logger", "message", "remixRedirect", "_a", "logger", "admin", "logger", "logger", "_a", "logger", "request", "shop", "sessionId", "request", "logger", "logger", "request", "check", "logger", "message", "deprecated", "warningFunction", "semver", "logger", "request", "request", "logger", "logger", "request", "context", "searchParams", "request", "logger", "logger", "request", "message", "logger", "request", "_a", "logger", "request", "logger", "request", "logger", "request", "logDisabledFutureFlags", "logger", "message", "logger", "logDisabledFutureFlags", "message"]
}
